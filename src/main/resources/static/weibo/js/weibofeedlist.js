var V={};STK.register("lib.kit.dom.parseDOM",function(a){return function(a){for(var b in a){if(a[b]&&a[b].length==1){a[b]=a[b][0]}}return a}});
STK.register("lib.kit.dom.isTurnoff",function(a){return function(a){return!(a.parentNode&&a.parentNode.nodeType!=11&&!a.disabled)}});
STK.register("lib.kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c){try{return a.selectionStart}catch(b){return 0}}var d=c.createRange(),e,f,g=0;var h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(g;h.compareEndPoints("StartToStart",d)<0;g++){h.moveStart("character",1)}return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c){a.setSelectionRange(b,d);return}var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i);return}var j=c.createRange();j.moveStart("character",-f);j.text=d};b.replaceText=function(a,d){a.focus();var e=a.value;var f=b.getSelectedText(a);var g=f.length;if(f.length==0){b.insertText(a,d,b.getCursorPos(a))}else{var h=b.getCursorPos(a);if(c){var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}else{var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStart=e.text.length-d.text.length;a.selectionEnd=a.selectionStart+d.text.length;b=a.selectionStart}else if(a.selectionStart||a.selectionStart=="0"){b=a.selectionStart}return b};b.getSelectedText=function(a){var b="";var d=function(a){if(a.selectionStart!=undefined&&a.selectionEnd!=undefined)return a.value.substring(a.selectionStart,a.selectionEnd);else return""};if(window.getSelection){b=d(a)}else{b=c.createRange().text}return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else if(a.setSelectionRange){a.setSelectionRange(b,b+c)}};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("lib.kit.extra.count",function(a){function b(b){var c=41,d=140,e=20,f=b;var g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[];var h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^((http|https):\/\/t.cn)/.test(g[i])){continue}else{if(/^((http|https):\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^((http|https):\/\/)+(weibo.com|weibo.cn)/.test(g[i])){h+=k<=c?k:k<=d?e:k-d+e}else{h+=k<=d?e:k-d+e}}f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return num=b(a)}});
STK.register("lib.module.editor",function(a){var b=a.core.evt.addEvent;var c=a.core.evt.custEvent;var d=a.core.dom.getStyle;var e=a.core.dom.setStyle;return function(b,c){var d={};var c=c;var e={},f="";var g={reset:function(){e.textEl.value="";a.core.evt.custEvent.fire(d,"changed");e.textEl.removeAttribute("extra");f=""},delWords:function(a){var b=g.getWords();if(b.indexOf(a)>-1){e.textEl.value="";i.textInput(b.replace(a,""))}else{return false}},getWords:function(){return a.core.str.trim(e.textEl.value)},getExtra:function(){var b;var c=e.textEl.getAttribute("extra")||"";if(c!=null){b=a.core.str.trim(c)}return b},focus:function(b,c){if(typeof b!="undefined"){a.lib.kit.extra.textareaUtils.setCursor(e.textEl,b,c)}else{var d=e.textEl.value.length;a.lib.kit.extra.textareaUtils.setCursor(e.textEl,d)}h.cacheCurPos()},blur:function(){e.textEl.blur()},addExtraInfo:function(a){if(typeof a=="string"){e.textEl.setAttribute("extra",a)}},disableEditor:function(b){a.core.evt.removeEvent(e.textEl,"mouseup",h.cacheCurPos);if(b===true){e.textEl.setAttribute("disabled","disabled")}else{a.core.evt.addEvent(e.textEl,"mouseup",h.cacheCurPos);e.textEl.removeAttribute("disabled")}},getCurPos:function(){var a=e.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(e.textEl.value).length==0?a.core.str.trim(e.textEl.value):e.textEl.value;return a.lib.kit.extra.count(b)},addShortUrlLog:function(b){b=b&&a.trim(b);if(b){var c=new RegExp("^"+b+"$|"+"_"+b+"$|^"+b+"_|"+"_"+b+"_");if(!c.test(f)){if(!f){f=b}else{f=f+"_"+b}}}},getShortUrlLog:function(){return f}};var h={textElFocus:function(){if(e.recommendTopic){a.core.dom.setStyle(e.recommendTopic,"display","none")}a.custEvent.fire(d,"focus");return;if(e.num){a.core.dom.setStyle(e.num,"display","block")}if(g.getWords()==c.tipText){g.delWords(c.tipText)}},textElBlur:function(){setTimeout(function(){if(e.textEl.value.length===0){if(e.recommendTopic)a.core.dom.setStyle(e.recommendTopic,"display","block");if(e.num&&e.recommendTopic)a.core.dom.setStyle(e.num,"display","none");a.custEvent.fire(d,"blur");if(typeof c.tipText!="undefined"){e.textEl.value=c.tipText}}},50)},cacheCurPos:function(){var b=a.lib.kit.extra.textareaUtils.getSelectedText(e.textEl);var c=b==""||b==null?0:b.length;var d=a.lib.kit.extra.textareaUtils.getCursorPos(e.textEl);var f=d+"&"+c;e.textEl.setAttribute("range",f)}};var i={textChanged:function(){a.custEvent.fire(d,"keyUpCount")},textInput:function(b,f){var i=g.getCurPos();var f=i[0];var j=i[1];if(g.getWords()==c.tipText&&b!=c.tipText){g.delWords(c.tipText)}a.lib.kit.extra.textareaUtils.unCoverInsertText(e.textEl,b,{rcs:i[0],rccl:i[1]});h.cacheCurPos();a.core.evt.custEvent.fire(d,"changed")}};var j={};var k=function(){n();o()};var l=function(){p();r();s();m()};var m=function(){if(c.storeWords){if(e.textEl.value.length==0){i.textInput(c.storeWords)}return}if(c.tipText){e.textEl.value=c.tipText}};var n=function(){if(!b)throw"node is not defined in module editor"};var o=function(){var c=a.core.dom.builder(b).list;e=a.lib.kit.dom.parseDOM(c);if(!e.widget)throw"can not find nodes.widget in module editor"};var p=function(){a.core.evt.addEvent(e.textEl,"focus",h.textElFocus);a.core.evt.addEvent(e.textEl,"blur",h.textElBlur);a.core.evt.addEvent(e.textEl,"mouseup",h.cacheCurPos);a.core.evt.addEvent(e.textEl,"keyup",h.cacheCurPos)};var q=function(){a.core.evt.custEvent.define(d,"changed")};var r=function(){q();a.core.evt.custEvent.add(d,"changed",i.textChanged)};var s=function(){};var t=function(){};k();var u={reset:g.reset,getWords:g.getWords,getExtra:g.getExtra,delWords:g.delWords,focus:g.focus,blur:g.blur,insertText:i.textInput,check:i.textChanged,addExtraInfo:g.addExtraInfo,disableEditor:g.disableEditor,getCurPos:g.getCurPos,count:g.count,textElFocus:h.textElFocus,cacheCurPos:h.cacheCurPos,addShortUrlLog:g.addShortUrlLog,getShortUrlLog:g.getShortUrlLog};d.destroy=t;d.API=u;d.nodeList=e;d.init=l;d.opts=c;return d}});
STK.register("common.editor.plugin.count",function(a){function e(a,b){if(!a.textEl){throw"[editor plugin count]: plz check nodeList"}}function d(a){var d=c(a);var e=Math.abs(b-d);var f;if(d>b||d<1){f={wordsnum:d,vnum:e,overflow:true}}else if(d==0){f={wordsnum:d,vnum:e,overflow:true}}else{f={wordsnum:d,vnum:e,overflow:false}}return f}function c(b){var c=41,d=140,e=20,f=b;var g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];var h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^((http|https):\/\/t.cn)/.test(g[i])){continue}else{if(/^((http|https):\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^((http|https):\/\/)+(weibo.com|weibo.cn)/.test(g[i])){h+=k<=c?k:k<=d?e:k-d+e}else{h+=k<=d?e:k-d+e}}f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList;var g;var h=c.opts;var i=a.lib.kit.extra.language;b=h.limitNum;e(f);a.core.evt.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl;var k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value;var e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);if(b.length>=0&&j.focus){if(f.overflow&&f.wordsnum!=0){k.innerHTML=(e?i(e):"")+i("#L{已经超过}")+'<strong class="warn">'+f.vnum+"</strong>字"}else{k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<strong>"+f.vnum+"</strong>字"}}else if(b.length===0){k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<strong>"+f.vnum+"</strong>字"}a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("lib.kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i))){c=c.replace(d[1]+d[2]+d[3],"")}return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++){if(c[b].indexOf(a+":")==0){c.splice(b,1)}}return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("lib.module.at",function(a){var b=window,c=document,d=a.core.util.browser,e="font-family:Tahoma,宋体;",f=a.lib.kit.extra.textareaUtils.selectionStart;var g;var h,i,j,k;var l=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',e,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',e,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}();var m=function(){var b=[],c=g.textEl.style.cssText,d;a.foreach(["margin","padding","border"],function(c){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;if(c!="border"){e=b.push(c,"-",d.toLowerCase(),":",a.getStyle(g.textEl,c+d),";");return}a.foreach(["Color","Style","Width"],function(e){b.push(c,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(g.textEl,[c,d,e].join("")),";")})})});b.push("font-size:"+a.getStyle(g.textEl,""+"fontSize")+";");return a.lib.kit.dom.cssText([c,b.join(""),e,"\n\t\t\tword-wrap: break-word;\n\t\t\tline-height: 18px;\n\t\t\toverflow-y:auto;\n\t\t\toverflow-x:hidden;\n\t\t\toutline:none;\n\t\t"].join("")).getCss()};var n=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list;var e=b["wrap"][0],f=b["flag"][0],h=b["after"][0],i=b["before"][0],j=0,n,o,p;var q=function(a){if(d.MOZ){return-2}if(d.MOBILE&&d.SAFARI&&(d.IPAD||d.ITOUCH||d.IPHONE)){return-2}return 0};return{bind:function(){if(o===g.textEl){return}k=a.position(g.textEl);var b=["left:",k.l,"px;top:",k.t+20,"px;"].join("");o=g.textEl;var d=m();o.style.cssText=d;p=[b,d,"\n\t\t\t\t\tposition:absolute;\n\t\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\t\topacity:0;\n\t\t\t\t\tz-index:-1000;\n\t\t\t\t"].join("");e.style.cssText=p;if(!j){j=1;c.body.appendChild(e)}},content:function(b,c,d,j){e.style.cssText=[p,"\n\t\t\t\t\twidth:",(parseInt(a.getStyle(o,"width"))||o.offsetWidth)+q(),"px;\n\t\t\t\t\theight:",parseInt(a.getStyle(o,"height"))||o.offsetHeight,"px;\n\t\t\t\t\toverflow-x:hidden;\n\t\t\t\t\toverflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(o,"overflowY"),";\n\t\t\t\t"].join("");i.innerHTML=l(b);f.innerHTML=l(c)||"&thinsp;";h.innerHTML=l([d,j].join(""));clearTimeout(n);n=setTimeout(function(){var b=a.position(f);a.custEvent.fire(g.eId,"at",{t:b.t-o.scrollTop-k.t,l:b.l-k.l,key:d,flag:c,textarea:g.textEl})},30)},hide:function(){e.style.display="none"},show:function(){e.style.display=""}}}();var o=function(){if(a.lib.kit.dom.isTurnoff(g.textEl)){clearInterval(h);return}var b=g.textEl.value.replace(/\r/g,"");var c=f(g.textEl);if(c<0||c==j){return}j=c;var d=b.slice(0,c);var e=d.match(new RegExp(["(",g["flag"],")([a-zA-Z0-9一-龥_]{0,20})$"].join("")));if(!e){a.custEvent.fire(g.eId,"hidden");return}var i=b.slice(c);d=d.slice(0,-e[0].length);n.content(d,e[1],e[2],i)};return function(b){if(!b||!b["textEl"]){return}b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!g){return}clearInterval(h);a.removeEvent(g.textEl,"blur",c);n.hide()};var d=function(){c();g=b;j=null;n.bind();n.show();h=setInterval(o,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b["eId"]}});
STK.register("lib.kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a){c[d]=a[d]}for(var d in b){c[d]=b[d]}return c}});
STK.register("lib.kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b["args"];if(e["__rnd"]){delete e["__rnd"]}(new Image).src="//weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b["url"])+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d,e,f,g,h,i,j;i=function(a){h=false;c.onComplete(a,d["args"]);setTimeout(k,0)};j=function(a){h=false;if(typeof c.onFail==="function"){c.onFail(a,d["args"])}setTimeout(k,0);try{b(d)}catch(e){}};f=[];g=null;h=false;d=a.parseParam({url:"",method:"get",responseType:"json",timeout:30*1e3,onTraning:a.funcEmpty,isEncode:true},c);d["onComplete"]=i;d["onFail"]=j;d["onTimeout"]=function(){try{b(d)}catch(a){}};var k=function(){if(!f.length){return}if(h===true){return}h=true;d.args=f.shift();if(d.method.toLowerCase()=="post"){var b=a.core.util.URL(d.url);b.setParam("__rnd",(new Date).valueOf());d.url=b.toString()}g=a.ajax(d)};var l=function(a){while(f.length){f.shift()}h=false;if(g){try{g.abort()}catch(b){}}g=null};e={};e.request=function(a){if(!a){a={}}if(c["noQueue"]){l()}if(!c["uniqueRequest"]||!g){f.push(a);a["_t"]=0;k()}};e.abort=l;return e}});
STK.register("lib.kit.io.jsonp",function(a){return function(b){var c,d,e,f,g;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:30*1e3,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:true},b);e=[];f={};g=false;var h=function(){if(!e.length){return}if(g===true){return}g=true;f.args=e.shift();f.onComplete=function(a){g=false;c.onComplete(a,f["args"]);setTimeout(h,0)};f.onFail=function(a){g=false;c.onFail(a);setTimeout(h,0)};a.jsonp(a.lib.kit.extra.merge(c,{args:f.args,onComplete:function(a){f.onComplete(a)},onFail:function(a){try{f.onFail(a)}catch(b){}}}))};d={};d.request=function(a){if(!a){a={}}e.push(a);a["_t"]=1;h()};d.abort=function(a){while(e.length){e.shift()}g=false;f=null};return d}});
STK.register("lib.kit.io.inter",function(a){return function(){var b,c,d;b={};c={};d={};b.register=function(a,b){if(c[a]!==undefined){throw a+" interface has been registered"}c[a]=b;d[a]={}};b.hookComplete=function(b,c){var e=a.core.util.getUniqueKey();d[b][e]=c;return e};b.removeHook=function(a,b){if(d[a]&&d[a][b]){delete d[a][b]}};b.getTrans=function(b,e){var f=a.lib.kit.extra.merge(c[b],e);f.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a["code"]==="100000"){try{e.onSuccess(a,c)}catch(f){}}else{try{if(a["code"]==="100002"){window.location.href=a["data"];return}e.onError(a,c)}catch(f){}}for(var g in d[b]){try{d[b][g](a,c)}catch(f){}}};if(c[b]["requestMode"]==="jsonp"){return a.lib.kit.io.jsonp(f)}else if(c[b]["requestMode"]==="ijax"){return a.lib.kit.io.ijax(f)}else{return a.lib.kit.io.ajax(f)}};b.request=function(b,e,f){var g=a.core.json.merge(c[b],e);g.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a["code"]==="100000"){try{e.onSuccess(a,c)}catch(f){}}else{try{if(a["code"]==="100002"){window.location.href=a["data"];return}e.onError(a,c)}catch(f){}}for(var g in d[b]){try{d[b][g](a,c)}catch(f){}}};g=a.core.obj.cut(g,["noqueue"]);g.args=f;if(c[b]["requestMode"]==="jsonp"){return a.jsonp(g)}else if(c[b]["requestMode"]==="ijax"){return a.ijax(g)}else{return a.ajax(g)}};return b}});
STK.register("common.trans.global",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("add",{url:"/ajax_User/follow",method:"post"});c("del",{url:"/ajax_User/unfollow",method:"post"});c("addgroup",{url:"/ajax_User/addgroup",method:"post"});c("setgroup",{url:"/ajax_User/addUserToGroup",method:"post"});c("listgroup",{url:"/ajax/user/GroupList",method:"get"});c("followTopic",{url:"/Ajax_object/stopicFollow",method:"post"});c("followList",{url:"/Ajax_Search/suggest",method:"get"});c("publish",{url:"/Ajax_Mblog/publish",method:"post"});c("share",{url:"/ajax/mblog/searchshare",method:"post"});c("topshare",{url:"/ajax/mblog/searchshare",method:"post"});c("upcover",{url:"/ajax/claim/uploadpic",method:"post"});c("commitcover",{url:"/ajax/claim/Setinfo",method:"post"});c("weiboActs",{url:"/ajax/claim/topicweibo",method:"get"});c("weibotop",{url:"/ajax/claim/shield",method:"get"});c("setAD",{url:"/aj/proxy/adclickserve",method:"post"});c("setADMonitor",{url:"/aj/proxy/monitor",method:"post"});c("adDeal",{url:"/aj/ad/deal",method:"post"});c("playstatistics",{url:"/aj/video/playstatistics",method:"post"});c("playInteractLog",{url:"/aj/log/h5playlog",method:"post"});c("newVideoUrl",{url:"/aj/mblog/videourl",method:"get"});c("third_rend",{url:"/aj/mblog/renderfeed",method:"post"});return b});
STK.register("lib.module.suggest",function(a){var b=null,c=a.custEvent,d=c.define,e=c.fire,f=c.add,g=a.addEvent,h=a.removeEvent,i=a.stopEvent;var j=[],k={};var l={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9};var m=function(b){var c=-1,j=[],k=b["textNode"],m=b["uiNode"];var n=a.core.evt.delegatedEvent(m);var o=d(k,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);o.setFlag=p;var p=function(a){b.flag=a};var q=function(){return a.sizzle(["[action-type=",b["actionType"],"]"].join(""),m)};var r=function(){c=-1;h(k,"keydown",s);n.destroy()};var s=function(a){var d,f;if(!(d=a)||!(f=d.keyCode)){return}if(f==l["ENTER"]){i();e(o,"onSelect",[c,k,b.flag]);return false}if(f==l["UP"]){i();var g=q().length;c=c<1?g-1:c-1;e(o,"onIndexChange",[c]);return false}if(f==l["DOWN"]){i();var g=q().length;c=c==g-1?0:c+1;e(o,"onIndexChange",[c]);return false}if(f==l["ESC"]){i();r();e(o,"onClose");return false}if(f==l["TAB"]){r();e(o,"onClose");return false}};var t=function(c){e(o,"onSelect",[a.core.arr.indexOf(c.el,q()),k,b["flag"]])};var u=function(b){c=a.core.arr.indexOf(b.el,q());e(o,"onIndexChange",[a.core.arr.indexOf(b.el,q())])};f(o,"open",function(a,c){k=c;r();g(c,"keydown",s);n.add(b["actionType"],"mouseover",u);n.add(b["actionType"],"click",t);e(o,"onOpen",[b.flag])});f(o,"openSetFlag",function(a,b){p(b)});f(o,"close",function(){r();e(o,"onClose",[b.flag])});f(o,"indexChange",function(a,d){c=d;e(o,"onIndexChange",[c,b.flag])});return o};var n=function(b){var c=b["textNode"];var d=a.core.arr.indexOf(c,j);if(!k[d]){j[d=j.length]=c;k[d]=m(b)}return k[d]};return function(c){if(!c["textNode"]||!c["uiNode"]){return}c=a.parseParam({textNode:b,uiNode:b,actionType:"item",actionData:"index",flag:""},c);return n(c)}});
STK.register("common.channel.listener",function(a){var b={};var c={};c.define=function(c,d){if(b[c]!=null){throw"common.channel.listener.define: 频道已被占用"}b[c]=d;var e={};e.register=function(d,e){if(b[c]==null){throw"common.channel.listener.define: 频道未定义"}a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null){throw"common.channel.listener.define: 频道未定义"}a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("common.channel.at",function(a){var b=["open","close"];return a.common.channel.listener.define("common.channel.at",b)});
STK.register("common.editor.plugin.at",function(a){var b=""+'<div style="min-width:100px;" class="m-user-list">'+'<ul node-type="suggestWrap">'+"</ul>"+"</div>";var c={"@":"<#et temp data>"+'<li class="suggest_title"><span>想用@提到谁？</span></li>'+"<#list data as list>"+'<li action-type="item" '+"<#if (list_index == 0)>"+'class="cur" '+"</#if>"+'action-data="value=${list.nickname}" value="${list.nickname}"><a href="javascript:void(0);">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li>'+"</#list>"+"</#et>","#":"<#et temp data>"+'<li class="suggest_title">想用什么话题？</li>'+"<#list data as list>"+'<li action-type="item" '+"<#if (list_index == 0)>"+'class="cur" '+"</#if>"+'action-data="value=${list.topic}" value="${list.topic}"><a href="javascript:void(0);">${list.topic}<#if (list.count)>(${list.count})</#if></a></li>'+"</#list>"+"</#et>"};var d,e,f,g,h,i,j=false,k;var l;var m={"@":"followList","#":"topicList"};var n=0;var o=function(){setTimeout(function(){a.custEvent.fire(d,"close")},200)};var p=function(){h.style.display="none"};var q=function(){a.custEvent.add(d,"onIndexChange",function(a,b){u(b)});a.custEvent.add(d,"onSelect",function(b,c,e,f){a.core.evt.stopEvent();var g=l[c].getAttribute("value");g=g.replace(/\(.*\)/,"");try{e.focus()}catch(h){}var i=a.lib.kit.extra.textareaUtils.selectionStart(e)*1;var j=new RegExp(f+"([a-zA-Z0-9一-龥_]{0,20})$");var k=e.value.slice(0,i).match(j);var m=e.value.slice(i,i+1);k=k&&k[1]?k[1].length:0;var n=a.lib.kit.extra.textareaUtils;if(f=="#"){if(typeof m!="undefined"&&m!=f){g=g+f+" "}}else{g=g+" "}n.insertText(e,g,i,k);var o=n.getCursorPos(e);if(f=="#"&&m==f){n.setCursor(e,o+1);n.insertText(e," ",o+1,0)}o=n.getCursorPos(e);var p=n.getSelectedText(e);var q=p==""||p==null?0:p.length;e.setAttribute("range",o+"&"+q);a.custEvent.fire(d,"close")});a.addEvent(f.textEl,"blur",o);a.custEvent.add(d,"onClose",p);a.custEvent.add(d,"onOpen",function(b,c){g.style.display="";h.style.display="";j=true;setTimeout(function(){a.custEvent.fire(d,"indexChange",0)},100)})};var r=function(){a.core.evt.custEvent.add(e,"hidden",function(b,c){a.custEvent.fire(d,"close")});a.core.evt.custEvent.add(e,"at",function(b,e){i=e.key;if(i.length==0){a.custEvent.fire(d,"close");return}var f=e.flag;var j=a.common.trans.global.getTrans(m[f],{onSuccess:function(b,i){var j=a.core.util.easyTemplate(c[f],b.data);a.custEvent.fire(d,"openSetFlag",f);a.custEvent.fire(d,"open",e.textarea);var k=a.core.dom.builder(j);var l=k.box;g.innerHTML=l;h.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");a.common.channel.at.fire("open");a.lib.kit.dom.layoutPos(h,e.textarea,{pos:"left-top",offsetX:e.l,offsetY:e.t})},onError:function(){a.custEvent.fire(d,"close")}}).request({key:i,type:"at"})})};var s=function(){k=f.textEl;e=STK.lib.module.at({textEl:k,flag:"@|#"})};var t=function(c){h=STK.C("div");document.body.appendChild(h);if(h.innerHTML.length==0){h.innerHTML=b;g=a.core.dom.sizzle('[node-type="suggestWrap"]',h)[0];h.style.display="none"}d=a.lib.module.suggest({textNode:c,uiNode:g,actionType:"item",actionData:"value",flag:"@"});q()};var u=function(b){l=a.sizzle("li[class!=suggest_title]",g);a.core.dom.removeClassName(l[n],"cur");a.core.dom.addClassName(l[b],"cur");n=b};return function(a,b){f=a.nodeList;var c={};c.init=function(){s();t(f.textEl);r()};return c}});
STK.register("common.editor.base",function(a){function c(){}var b={limitNum:140};return function(c,d){var e={};var f,g,h,i;f=a.lib.kit.extra.merge(b,d);g=a.lib.module.editor(c,f);h=g.nodeList;i=[];if(typeof d.count=="undefined"||d.count=="enable"){var j=a.common.editor.plugin.count(g,f)}var k=a.common.editor.plugin.at(g,f);k.init();g.init();g.widget=function(a,b,c){i.push(a);a.init(g,b,c);return g};g.closeWidget=function(){if(i&&i.length!=0){for(var a=0,b=i.length;a<b;a++){i[a].hide()}}};return g}});
STK.register("lib.module.layer",function(a){var b=function(a){var b={};if(a.style.display=="none"){a.style.visibility="hidden";a.style.display="";b.w=a.offsetWidth;b.h=a.offsetHeight;a.style.display="none";a.style.visibility="visible"}else{b.w=a.offsetWidth;b.h=a.offsetHeight}return b};var c=function(c,d){d=d||"topleft";var e=null;if(c.style.display=="none"){c.style.visibility="hidden";c.style.display="";e=a.core.dom.position(c);c.style.display="none";c.style.visibility="visible"}else{e=a.core.dom.position(c)}if(d!=="topleft"){var f=b(c);if(d==="topright"){e["l"]=e["l"]+f["w"]}else if(d==="bottomleft"){e["t"]=e["t"]+f["h"]}else if(d==="bottomright"){e["l"]=e["l"]+f["w"];e["t"]=e["t"]+f["h"]}}return e};return function(d){var e=a.core.dom.builder(d);var f=e.list["outer"][0],g=e.list["inner"][0];var h=a.core.dom.uniqueID(f);var i={};var j=a.core.evt.custEvent.define(i,"show");a.core.evt.custEvent.define(j,"hide");var k=null;i.show=function(){f.style.display="";a.core.evt.custEvent.fire(j,"show");return i};i.hide=function(){f.style.display="none";a.custEvent.fire(j,"hide");return i};i.getPosition=function(a){return c(f,a)};i.getSize=function(a){if(a||!k){k=b.apply(i,[f])}return k};i.html=function(a){if(a!==undefined){g.innerHTML=a}return g.innerHTML};i.text=function(b){if(text!==undefined){g.innerHTML=a.core.str.encodeHTML(b)}return a.core.str.decodeHTML(g.innerHTML)};i.appendChild=function(a){g.appendChild(a);return i};i.getUniqueID=function(){return h};i.getOuter=function(){return f};i.getInner=function(){return g};i.getParentNode=function(){return f.parentNode};i.getDomList=function(){return e.list};i.getDomListByKey=function(a){return e.list[a]};i.getDom=function(a,b){if(!e.list[a]){return false}return e.list[a][b||0]};i.getCascadeDom=function(b,c){if(!e.list[b]){return false}return a.core.dom.cascadeNode(e.list[b][c||0])};return i}});
STK.register("lib.kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c)){throw"lib.kit.dom.layerOutElement need element as first parameter"}if(c===document.body){return false}if(!c.parentNode){return false}if(c.style.display==="none"){return false}var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f){return false}while(f!==document.body){f=f.parentNode;if(f.style.display==="none"){return false}j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed"){break}if(k==="true"&&j==="relative"){break}}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e["pos"].split("-");if(i[0]==="left"){b.style.left=g.l+e.offsetX+"px"}else if(i[0]==="right"){b.style.left=g.l+h.w+e.offsetX+"px"}else if(i[0]==="center"){b.style.left=g.l+h.w/2+e.offsetX+"px"}if(i[1]==="top"){b.style.top=g.t+e.offsetY+"px"}else if(i[1]==="bottom"){if($CONFIG.pageid=="pic"){e.offsetY+=f.scrollTop}b.style.top=g.t+h.h+e.offsetY+"px"}else if(i[1]==="middle"){b.style.top=g.t+h.h/2+e.offsetY+"px"}return true}});
STK.register("lib.module.bubble",function(a){return function(b,c){if(!b){throw"module.bubble need template as first parameter"}var d;var e,f,g,h,i,j;e=a.parseParam({width:null,height:null,parent:document.body},c);f=a.lib.module.layer(b);g=f.getDom("outer");h=f.getDom("inner");if(f.getDomListByKey("close")){i=f.getDom("close")}g.style.display="none";j=false;var k=function(b){if(j){return true}var c=a.fixEvent(b);if(!a.contains(g,c.target)){f.hide()}};if(i){a.addEvent(i,"click",f.hide)}a.custEvent.add(f,"show",function(){setTimeout(function(){a.addEvent(document.body,"click",k)},0)});a.custEvent.add(f,"hide",function(){j=false;a.removeEvent(document.body,"click",k)});d=f;d.setPosition=function(a){g.style.top=a["t"]+"px";g.style.left=a["l"]+"px";return d};d.setLayout=function(b,c){if(!a.isNode(b)){throw"module.bubble.setDown need element as first parameter"}a.lib.kit.dom.layoutPos(g,b,c);return d};d.setContent=function(b){if(typeof b==="string"){h.innerHTML=b}else if(a.isNode(b)){h.appendChild(b)}return d};d.setArrow=function(a){var b;if(f.getDomListByKey("arrow")){b=f.getDom("arrow");if(a["className"]){b.className=a["className"]||""}if(a["style"]){b.style.cssText=a["style"]||""}}};d.clearContent=function(){while(h.children.length){a.removeNode(h.children[0])}};d.stopBoxClose=function(){j=true};d.startBoxClose=function(){j=false};d.destroy=function(){a.removeEvent(document.body,"click",k);f=null;g=null;h=null;i=null};return d}});
STK.register("core.util.getUniqueKey",function(a){var b=(new Date).getTime().toString(),c=1;return function(){return b+c++}});
STK.register("lib.ui.bubble",function(a){var b=['<div class="m-layer-face" node-type="outer" style="position:absolute">','<a class="wbicon close" href="javascript:void(0);" node-type="close" >X</a>','<div class="bg" node-type="layoutContent">','<div node-type="inner"></div>',"</div>",'<div class="arrow" node-type="arrow"><em class="br"></em><em class="bg"></em></div>',"</div>"].join("");var c=[];return function(d){var e=a.parseParam({template:b,isHold:false},d);var f={get:function(){if(e["isHold"]){return a.lib.module.bubble(e["template"],e)}else{return f.checkBob()}},checkBob:function(){var a;for(var b=0,d=c.length;b<d;b++){if(!c[b]["used"]){a=c[b]["bub"];continue}}if(!a){a=f.create()}return a},refresh:function(a,b){for(var d=0,e=c.length;d<e;d++){if(a===c[d]["bub"]){c[d]["used"]=b;return}}},cevt:function(b){a.custEvent.add(b,"hide",function(){f.refresh(b,false);b.clearContent()});a.custEvent.add(b,"show",function(){f.refresh(b,true)})},create:function(){var b=a.lib.module.bubble(e["template"],e);c.push({bub:b,used:true});f.cevt(b);return b}};return f.get()}});
STK.register("common.trans.publisher",function(a){var b=a.lib.kit.io.inter();var c="/ajax/jsProxy.php?interurl=http://new.weibo.com";var d="/ajax/";var e=b.register;e("publish",{url:"/Ajax_Mblog/publish",method:"post"});e("face",{url:"/ajax_Mblog/face?type=face",method:"get"});e("magicFace",{url:"/ajax_Mblog/face?type=ani",method:"post"});e("getTopic",{url:d+"mblog/face?type=cartoon",method:"post"});e("suggestMusic",{url:c+"/aj/mblog/music/suggest&method=get",requestMode:"jsonp"});e("searchMusic",{url:c+"/aj/mblog/music/search&method=get",requestMode:"jsonp"});e("addMusic",{url:c+"/aj/mblog/music/submit&method=get",requestMode:"jsonp"});e("parseMusic",{url:c+"/aj/mblog/music/parse&method=get",requestMode:"jsonp"});e("parseVideo",{url:c+"/aj/mblog/video&method=post"});return b});
STK.register("lib.kit.dom.fix",function(a){function f(c,e,f){if(!d(c))return;var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.core.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){if(h<o)h=o;if(i<p)i=p}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++){if(typeof b[c]!="number")b[c]=0}return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=true,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){if(!b){b&&a.core.evt.removeEvent(window,"scroll",n)}a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);if(k&&(!b||i=="c")){f(d,i,j)}}if(!b){a.core.evt.addEvent(window,"scroll",n)}a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("lib.module.mask",function(a){function k(b){var c;if(!(c=b.getAttribute(f))){b.setAttribute(f,c=a.getUniqueKey())}return">"+b.tagName.toLowerCase()+"["+f+'="'+c+'"]'}function j(){b=a.C("div");var c='<div node-type="outer">';if(a.core.util.browser.IE6){}c+="</div>";b=a.builder(c).list["outer"][0];document.body.appendChild(b);e=true;d=a.lib.kit.dom.fix(b,"lt");var f=function(){var c=a.core.util.winSize();b.style.cssText=a.core.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+"px").getCss()};i.add(d,"beforeFix",f);f()}var b,c=[],d,e=false,f="STK-Mask-Key";var g=a.core.dom.setStyle,h=a.core.dom.getStyle,i=a.core.evt.custEvent;var l={getNode:function(){return b},show:function(c,f){if(e){c=a.core.obj.parseParam({opacity:.3,background:"#000000"},c);b.style.background=c.background;g(b,"opacity",c.opacity);b.style.opacity=c.opacity;b.style.display="";d.setAlign("lt");f&&f()}else{j();l.show(c,f)}return l},hide:function(){b.style.display="none";nowIndex=undefined;c=[];return l},showUnderNode:function(d,e){if(a.isNode(d)){l.show(e,function(){g(b,"zIndex",h(d,"zIndex"));var e=k(d);var f=a.core.arr.indexOf(c,e);if(f!=-1){c.splice(f,1)}c.push(e);a.core.dom.insertElement(d,b,"beforebegin")})}return l},back:function(){if(c.length<1){return l}var d,e;c.pop();if(c.length<1){l.hide()}else if((e=c[c.length-1])&&(d=a.sizzle(e,document.body)[0])){g(b,"zIndex",h(d,"zIndex"));a.core.dom.insertElement(d,b,"beforebegin")}else{l.back()}return l},destroy:function(){i.remove(d);b.style.display="none";lastNode=undefined;_cache={}}};return l});
STK.register("common.bubble.magic",function(a){var b=a.core.util.swf;var c=a.lib.module.mask;var d,e,f,g,h,i;var j=function(){if(d)return;d=a.C("div");d.style.cssText="display:none;width:440px;height:360px;z-index:100000;";e=a.core.dom.uniqueID(d);h=function(b){b=a.fixEvent(b||window.event);if(b.target.getAttribute("name")!=e)k.hide()};document.body.appendChild(d)};var k=function(l,m){j();if(f)return;f=true;c.showUnderNode(d);a.addEvent(c.getNode(),"click",h);c.getNode().title="点击关闭";d.style.display="";if(!g){g=a.lib.kit.dom.fix(d,"c")}else{g.setAlign("c")}d.innerHTML=b.html(l,{id:e,width:440,height:360,paras:{allowScriptAccess:"never",wmode:"transparent"},attrs:{name:e},flashvars:{playMovie:"true"}});clearInterval(i);i=setInterval(function(){var a=document[e]||window[e],b=0;if(a&&a.PercentLoaded()==100){clearInterval(i);i=setInterval(function(){var c=a.CurrentFrame(),d;try{d=a.TotalFrames()}catch(e){d=a.TotalFrames}if(c<0){return}if(c<d&&b<=c){b=c}else{k.hide()}},80)}},100)};k.hide=function(){if(d){d.style.display="none";d.innerHTML=""}clearInterval(i);a.removeEvent(c.getNode(),"click",h);c.getNode().title="";c.back();f=false;return k};k.destroy=function(){k.hide();g&&g.destroy();a.removeNode(d);i=d=e=f=g=h};return k});
STK.register("lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});var b=function(a,b){var c=[];for(var d=2,e=arguments.length;d<e;d+=1){c.push(arguments[d])}return a.replace(/#L\{((.*?)(?:[^\\]))\}/ig,function(){var a=arguments[1];var d;if(b&&b[a]!==undefined){d=b[a]}else{d=a}if(c.length){d=d.replace(/(\%s)/ig,function(){var a=c.shift();if(a!==undefined){return a}else{return arguments[0]}})}return d})};return function(a){var c=[].splice.call(arguments,1,arguments.length);var d=[a,$LANG].concat(c);var e=b.apply(this,d);return e}});
STK.register("common.bubble.face",function(a){var b=a.lib.kit.extra.language;var c=""+'<div node-type="outer" class="face-box">'+'<div class="tab">'+'<ul node-type="categorys"></ul>'+"</div>"+'<div class="face">'+'<ul class="hot-face" node-type="hotFace"></ul>'+'<ul node-type="inner"></ul>'+"</div>"+"</div>";var d='<li><a href="javascript:void(0);" action-type="category" action-data="category=#{item}">#{item}</a></li>';var e='<li><a href="javascript:void(0);" action-type="category" action-data="category=#{item}" class="cur">#{item}</a></li>';var f='<li action-type="insert" action-data="text=#{phrase}"><img src="#{icon}" alt="#{phrase}" /></li>';var g=b('<li><a action-type="insert" action-data="text=#{value}" class="img" href="javascript:void(0);"><img src="#{icon}" alt="#{phrase}" /></a><a title="#L{表情预览}" class="play" href="javascript:void(0);" action-type="play" action-data="swf=#{swf}"></a><span>#{phrase}</span></li>');var h='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" onclick="return false;">#{label}</a>';var i='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" class="current" onclick="return false;">#{label}</a>';var j=b('<div style="text-align:center"><i class="W_loading S_loading"></i><span>#L{正在加载，请稍后}...</span></div>');var k='<li class="clear"></li>';var l=5;var m=b("#L{默认}");var n,o,p,q,r,s;s={};var t=function(b){var c=b.cPoniter;var f=b.categorys;var g=b.currentCategory;var h=f.slice(c,c+l);h=a.foreach(h,function(b,c){if(g===b){return a.templet(e,{item:b})}else{return a.templet(d,{item:b})}});o["categorys"].innerHTML=h.join("");u(b)};var u=function(a){var b=a.page;if(a.currentCategory===m){o["hotFace"].style.display=""}else{o["hotFace"].style.display="none"}};var v={general:function(a){r=A;r.init();o["inner"].className="faces_list clearfix"},magic:function(a){r=magic;r.init();o["inner"].className="faces_magic_list"}};var w={category:function(a){r.page=0;r.currentCategory=a.data.category;r.rend();setTimeout(function(){t(r)},0)},prev:function(a){var b=r.cPoniter;var c=r.categorys;if(b<=0){return false}r.cPoniter-=l;t(r)},next:function(a){var b=r.cPoniter;var c=r.categorys;if(b>=c.length-l){return false}r.cPoniter+=l;t(r)},play:function(b){a.common.bubble.magic(b.data.swf)},insert:function(b){a.custEvent.fire(s,"insert",{value:b.data.text})},page:function(a){r.page=parseInt(a.data.num,10);r.rend()}};var x=function(b){p=a.lib.ui.bubble();y();z();v[b]();a.custEvent.add(p,"hide",function(b){return function(){a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(s,"hide",{})}}(p))};var y=function(){n=a.lib.module.layer(b(c));o={};var d=n.getDomList();for(var e in d){o[e]=d[e][0]}y=function(){p.setContent(o["outer"])};y()};var z=function(){a.custEvent.define(s,"insert");a.custEvent.define(s,"hide");delegate=a.core.evt.delegatedEvent(o["outer"]);delegate.add("category","click",w["category"]);delegate.add("prev","click",w["prev"]);delegate.add("next","click",w["next"]);delegate.add("insert","click",w["insert"]);delegate.add("play","click",w["play"]);delegate.add("page","click",w["page"]);z=function(){}};var A={init:function(){o["inner"].innerHTML=j;var b=a.common.trans.publisher.getTrans("face",{onSuccess:function(b,c){A.cache=b.data.more||{};try{A.hotList=b.data.usual.hot.slice(0,10);o["hotFace"].innerHTML=a.foreach(A.hotList,function(b,c){return a.templet(f,b)}).join("")}catch(d){}A.categorys=[m];for(var e in A.cache){A.categorys.push(e)}A.cache[m]=b.data.usual.norm;A.init=function(){A.page=0;A.cPoniter=0;A.currentCategory=m;A.rend();t(A)};A.init()},onError:function(a,b){}});b.request({})},rend:function(){var b=A.currentCategory;var c=A.cache[b];var d=A.page;var e=A.itemNumber;c=c.slice(d*e,d*e+e);c=a.foreach(c,function(b,c){return a.templet(f,b)});o["inner"].innerHTML=c.join("")},page:0,cache:null,hotList:null,cPoniter:0,categorys:[],currentCategory:m,itemNumber:1e3};s.getBub=function(){return p};return function(b,c){if(!a.isNode(b)){throw"common.bubble.face need el as first parameter!"}var d=a.parseParam({l:0},c);x("general");p.setLayout(b,{offsetX:-5,offsetY:5});p.show();return s}});
STK.register("common.editor.widget.face",function(a){return function(b){var c={};var d,e,f,g;g=a.parseParam({t:0,l:-15},b);var h=function(a,b){d.API.insertText(b.value);e.getBub().hide()};var i=function(){a.core.evt.preventDefault();e=a.common.bubble.face(d.nodeList[f],g);a.custEvent.add(e,"insert",h);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"insert",h)})};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",i)};c.clear=function(){};c.show=function(){};c.hide=function(){};c.destroy=function(){d=null};return c}});
STK.register("common.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5},d);var f=e["start"].split("");var g=e["color"].split("");var h=[];for(var i=0;i<e["step"];i+=1){var j=f[0];for(var k=1;k<4;k+=1){var l=parseInt(f[k],16);var m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e["step"],10)).toString(16)}h.push(j)}for(var i=0;i<e["times"];i+=1){h=b(h)}var n=false;var o=a.timer.add(function(){if(!h.length){a.timer.remove(o);return}if(n){n=false;return}else{n=true}c.style.backgroundColor=h.pop()})}});
STK.register("pl.feedlist.sendweibo",function(a){var b={limitNum:1e5};return function(c){var d={},e,f;var g;var h={canPublish:function(a,b){doms["operate"].style.display="block";if(b.count==0){doms["num"].style.visibility="hidden";doms["submit"].className="disable s-btn-g"}else{doms["num"].style.visibility="visible";doms["submit"].className="s-btn-g"}if(b.count>=140){doms["num"].innerHTML='已输入<strong class="warn">'+b.count+"</strong>字"}doms["num"].innerHTML="已输入<strong>"+b.count+"</strong>字"},sendweibo:function(){var b=a.core.json.queryToJson(doms["submit"].getAttribute("action-data"));if(doms["userFollow"]!=undefined){var c=a.core.json.queryToJson(doms["userFollow"].getAttribute("action-data"))}var d=f.API.getWords();if(d.length==0){a.common.extra.shine(doms["textEl"]);return}var e={};e["content"]=d;e["action_code"]="11";a.common.trans.global.getTrans("publish",{onSuccess:function(a,b){doms["num"].style.visibility="hidden";doms["textEl"].innerText="";doms["textEl"].value="";doms["submit"].className="s-btn-g";doms["success"].style.display="block";setTimeout(function(){doms["success"].style.display="none"},1500)},onError:function(b){a.lib.ui.alert(b.msg)}}).request(e);if(doms["userFollow"]!=undefined){if(doms["userFollow"].checked){var g={};g["type"]="followed";g["uid"]=c.uid;g["action_code"]="71";a.common.trans.global.getTrans("add",{onSuccess:function(a,b){},onError:function(b){a.lib.ui.alert(b.msg)}}).request(g)}}}};var i=function(){if(!c)throw"[pl_aboutTopic] : missing  -> path : comp.aboutTopic"};var j=function(){e=a.sizzle("[node-type=sendweibo]",c)[0];doms=a.lib.kit.dom.parseDOM(a.builder(e).list)};var k=function(){a.core.evt.addEvent(doms["submit"],"click",h.sendweibo);a.custEvent.add(f,"textNum",h.canPublish)};var l=function(){f=a.common.editor.base(e,b);f.widget(a.common.editor.widget.face(),"smileBtn")};var m=function(){i();j();l();k()};m();var n=function(){a.custEvent.remove(f,"textNum",h.canPublish)};d.destroy=n;return d}});
STK.register("lib.kit.dom.rotateImage",function(a){var b={},c=function(c){var d=a.core.dom.uniqueID(c);return b[d]||(b[d]={})};var d={0:0,90:1,180:2,270:3};var e=function(a,b){a=((b||0)+a)%360;a<0&&(a=360+a);var c=Math.PI*a/180,d=Math.round(Math.cos(c)*Math.pow(10,15))/Math.pow(10,15),e=Math.round(Math.sin(c)*Math.pow(10,15))/Math.pow(10,15);return{sin:e,cos:d,M11:d,M12:-e,M21:e,M22:d,angle:a,rotation:c}};var f=function(b,c,f,g){f=f||440;var h=e(c,g.oldAngle);c=g.oldAngle=h.angle;b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+h.M11+",M12="+h.M12+",M21="+h.M21+",M22="+h.M22+",SizingMethod='auto expand')";a.setStyle(b.parentNode,"position","relative");if(d[c]%2==0){b.width=g.originalWidth;b.height=g.originalHeight;a.setStyle(b.parentNode,"height",b.height+"px");a.setStyle(b,"position","static")}else if(d[c]%2==1){b.height=g.originalHeight>f?f:g.originalHeight;b.width=b.height*g.originalWidth/g.originalHeight;a.setStyle(b.parentNode,"height",b.width+"px");a.setStyle(b,"position","absolute");a.setStyle(b,"left",Math.abs((b.parentNode.offsetWidth-b.height)/2)+"px");a.setStyle(b,"top","0")}};var g=function(a,b,c,d){var e=a;d.oldAngle=e.angle=((e.angle==undefined?0:e.angle)+b)%360;if(e.angle>=0){var f=Math.PI*e.angle/180}else{var f=Math.PI*(360+e.angle)/180}var g=Math.cos(f);var h=Math.sin(f);var i=document.createElement("canvas");if(!e.oImage){i.oImage=e}else{i.oImage=e.oImage}var j=new Image;j.onload=function(){i.style.width=i.width=Math.abs(g*j.width)+Math.abs(h*j.height);i.style.height=i.height=Math.abs(g*j.height)+Math.abs(h*j.width);if(i.width>c){i.style.width=c+"px";i.style.height=c*j.width/j.height+"px"}var a=i.getContext("2d");a.save();if(f<=Math.PI/2){a.translate(h*j.height,0)}else if(f<=Math.PI){a.translate(i.width,-g*j.height)}else if(f<=1.5*Math.PI){a.translate(-g*j.width,i.height)}else{a.translate(0,-h*j.width)}a.rotate(f);try{a.drawImage(j,0,0,j.width,j.height)}catch(b){}a.restore();i.angle=e.angle;e.parentNode.replaceChild(i,e);i.id=e.id;j.onload=null};j.src=i.oImage.src;return i};var h=function(){var a=["transform","MozTransform","webkitTransform","OTransform"];var b=0,c=document.createElement("div").style;while(a[b]&&!(a[b]in c)){++b}return a[b]}();var i=function(b,c,f,g){var i=e(c,g.oldAngle),j;c=g.oldAngle=i.angle;if(!g.rotated){g.rotated=true;j=a.C("div");j.style.position="relative";g.textAlign=j.style.textAlign=a.getStyle(b.parentNode,"textAlign");b.parentNode.insertBefore(j,b);j.appendChild(b);b.style.position="absolute"}else{j=b.parentNode}if(d[c]%2==0){if(g.originalWidth>f){g.imgViewWidth=b.width=f}else{g.imgViewWidth=b.width=g.originalWidth}g.imgViewHeight=b.height=g.originalHeight}else if(d[c]%2==1){if(g.originalHeight>f){g.imgViewWidth=b.height=f}else{g.imgViewWidth=b.height=g.originalHeight}g.imgViewHeight=b.width=b.height*g.originalWidth/g.originalHeight}j.style.height=g.imgViewHeight+"px";if(f>j.offsetWidth){j.style.width=f+"px"}b.style[h]="matrix("+i.M11+","+i.M21+","+i.M12+","+i.M22+", 0, 0)";var k=(g.imgViewHeight-g.imgViewWidth)/2;var l=(g.imgViewWidth-g.imgViewHeight)/2;if(d[c]%2==0){b.style.top="0px";if(g.textAlign=="center"){b.style.left=(j.offsetWidth-g.imgViewWidth)/2+"px"}else{b.style[g.textAlign=="right"?"right":"left"]="0px"}}else{b.style.top=k+"px";if(g.textAlign=="center"){b.style.left=l+(j.offsetWidth-g.imgViewWidth)/2+"px"}else{b.style[g.textAlign=="right"?"right":"left"]=l+"px"}}};var j=function(b,d,e){var j=c(b);if(!("originalWidth"in j)){j.originalWidth=b.width;j.originalHeight=b.height}e||(e=j.originalWidth);if(h){i(b,d,e,j)}else if("getContext"in a.C("canvas")){g(b.canvas?b.canvas:b,d,e,j)}else if("filters"in a.C("div")){f(b,d,e,j)}};var k={rotateRight:function(a,b,c){j(a,b==undefined?90:b,c)},rotateLeft:function(a,b,c){j(a,b==undefined?-90:-b,c)},rotateDefault:function(a){var b=c(a);if(b.oldAngle){j(a,360-b.oldAngle,b.originalWidth)}},removeDataCache:function(c){var d=a.uniqueID(c),e;if(h){if(e=c.parentNode&&c.parentNode.parentNode){c.parentNode.parentNode.insertBefore(c,e);a.removeNode(e)}}b[d]&&delete b[d]},destroy:function(){b={}}};return k});
STK.register("lib.kit.dom.parentElementBy",function(a){return function(a,b,c){if(!a||!b){throw new Error("传入的参数为空")}var d=0,e;a=a.parentNode;while(a&&a.parentNode){d++;e=c(a);if(e===false){return false}else if(e===true){return a}else if(e===b){return null}a=a.parentNode;if(d>3e4){return false}}return null}});
STK.register("common.feed.feedList.feedTemps",function(a){var b=a.lib.kit.extra.language;var c=$CONFIG["imgPath"]+"/style/images/common/loading.gif";return{loadingIMG:b('<div class="card-together"><div class="loading"><i node-type="loading" class="s-loading"></i>#L{正在加载，请稍候}...</div></div>'),newFeedTipHTML:b('<a action-type="feed_list_newBar" class="notes" href="">#L{有} [n] #L{条新微博}，#L{点击查看}</a>'),loadingHTML:b('<div requestType="[n]"><i style="margin:12px 10px 17px" class="W_loading S_loading"></i><span>#L{正在加载，请稍候}...</span></div>'),loadErrorRetryHTML:b('<div class="zero_tips W_textb"><span>#L{加载失败}，<a action-type="feed_list_retry" requestType="[n]" href="javascript:void(0)">#L{请重试}</a></span></div>'),loadErrorEndHTML:b('<div class="zero_tips W_textb" requestType="[n]"><span>#L{加载失败}。</span></div>'),mediaIMGTEMP:b("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<div class="WB_expand_media S_bg1">'+'<div class="tab_feed_a clearfix">'+'<div class="tab">'+'<ul class="clearfix">'+'<li><span class="line S_line1"><a action-type="feed_list_media_toSmall"  href="javascript:void(0);" class="W_texta" <#if (data.suda && data.suda.retract)>suda-data="${data.suda.retract}"</#if>><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{收起}</a></span></li>'+'<li><span class="line S_line1"><a href="${data.largeSrc}" target="_blank" class="W_texta" <#if (data.suda && data.suda.showBig)>suda-data="${data.suda.showBig}"</#if>><i class="W_ficon ficon_search S_ficon">f</i>#L{查看大图}</a></span></li>'+'<li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:void(0);" class="W_texta" <#if (data.suda && data.suda.left)>suda-data="${data.suda.left}"</#if>><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{向左转}</a></span></li>'+'<li><span class="line S_line1"><a action-type="feed_list_media_toRight" <#if (data.suda && data.suda.right)>suda-data="${data.suda.right}"</#if> href="javascript:void(0);" class="W_texta"><i class="W_ficon ficon_turnright S_ficon">n</i>#L{向右转}</a></span></li>'+"</ul>"+"</div>"+"</div>"+'<div class="WB_media_view">'+'<div class="smallcursor" style="position:relative; width:440px; margin:0 auto;"  action-type="feed_list_media_bigimgDiv" <#if (data.suda && data.suda.big)>suda-data="${data.suda.big}"</#if>>'+'<div class="media-pay-hint" <#if (data.ispay)>style="display: none;"</#if>>'+'<p style="border-width:0">开通Ta的专属会员即可浏览图片和Ta的全部付费内容</p>'+'<a href="https://vipclub.weibo.com/vmember/opendetail?vuid=${data.uid[0]}" action-type="feed_list_media_bigimgDiv_link" >立即开通</a>'+"</div>"+'<img dynamic-id="${data.uniqueId}"   action-type="feed_list_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}" <#if (!data.ispay)>style="width:440px;height:280px;"</#if> />'+"<#if (data.tags != null)>"+"<#list data.tags as tags>"+'<a title="${tags.tag_name}" node-type="tag" action-type="tag" '+"<#if (tags.url.length != 0)>"+'href="${tags.url}" target="_blank"'+"<#else>"+'href="javascript:void(0);"'+"</#if>"+' class="tag_showpicL" style="left: ${tags.pos_x*100}%; top: ${tags.pos_y*100}%; white-space: nowrap; display:none;" tag-id="3">'+'<span class="inner">'+'<#if (tags.tag_type === "user")>'+'<em class="W_autocut">@${tags.tag_name}</em>'+'<#elseif (tags.tag_type === "topic")>'+'<em class="W_autocut">#${tags.tag_name}#</em>'+'<#elseif (tags.tag_type === "place")>'+'<em class="W_autocut">${tags.tag_name}</em>'+"<#else>"+'<em class="W_autocut">${tags.tag_name}</em>'+"</#if>"+"</span>"+"</a>"+"</#list>"+"</#if>"+"</div>"+"</div>"+"<#if (data.notForward)></dd></#if>"+"</div>"+"</#et>"),mediaIMGTEMPwithBtn:b("<#et temp data>"+'<div class="WB_expand_media S_bg1">'+'<div class="tab_feed_a clearfix">'+'<div class="tab">'+'<ul class="clearfix">'+'<li><span class="line S_line1"><a action-type="feed_list_media_toSmall" action-data="key=${data.uniqueKey}" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{收起}</a></span></li>'+'<#if (data.isPrivate == 1 && data.relation !=1 )><li><span class="line S_line1"><a action-type="widget_photoview" action-data="${data.acdata}" href="javascript:;" class="S_ficon_dis"><i class="W_ficon ficon_search S_ficon_dis">f</i>#L{查看大图}</a></span></li>'+'<li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:;" action-data="${data.acdata}"  class="S_ficon_dis"><i class="W_ficon ficon_turnleft S_ficon_dis">m</i>#L{向左旋转}</a></span></li>'+'<li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:;"  action-data="${data.acdata}" class="S_ficon_dis"><i class="W_ficon ficon_turnright S_ficon_dis">n</i>#L{向右旋转}</a></span></li>'+'<#else><li><span class="line S_line1"><a action-type="widget_photoview" action-data="${data.acdata}" href="javascript:;" class="${data.type == "story" ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_search ${data.type == "story" ? "S_ficon_dis" : "S_ficon"}">f</i>#L{查看大图}</a></span></li>'+'<li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:;" action-data="${data.acdata}"  class="${data.uniqueKey ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_turnleft ${data.uniqueKey ? "S_ficon_dis" : "S_ficon"}">m</i>#L{向左旋转}</a></span></li>'+'<li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:;"  action-data="${data.acdata}" class="${data.uniqueKey ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_turnright ${data.uniqueKey ? "S_ficon_dis" : "S_ficon"}">n</i>#L{向右旋转}</a></span></li></#if>'+'<li><span class="line S_line1"><a action-type="feed_list_media_replay" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_replay S_ficon">y</i>#L{重播}</a></span></li>'+"</ul>"+"</div>"+"</div>"+'<div action-type="feed_list_media_bigimgDiv" node-type="feed_list_media_bigimgDiv"  action-data="${data.acdata}" class="WB_media_view">'+'<div class="media_show_box">'+'<ul class="clearfix">'+'<li class="smallcursor"><div node-type="artwork_box" class="artwork_box"><div action-type="feed_list_media_bigimg"><#if (!data.uniqueKey)><img dynamic-id="${data.uniqueId}"/></#if></div>'+'<span style="display:none;" action-type="feed_list_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}">'+'<#if (data.is_liked)><a href="javascript:;" class="W_btn_alpha" title="#L{取消赞}"><i class="icon_praised"></i><span node-type="count">(${data.count})</span></a></div>'+'<#else><a href="javascript:;" class="W_btn_alpha" title="#L{赞}"><i class="icon_praise"></i><span node-type="count">(${data.count})</span></a></#if>'+"</span>"+"</li>"+"</ul>"+"</div>"+"</div>"+"</div>"+"</#et>"),mediaVideoMusicTEMP:b("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<p class="W_no_border"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i><a href="${data.short_url}" title="${data.short_url}" class="show_big" target="_blank">${data.title}</a><i class="W_vline">|</i><a action-type="feed_list_media_toFloat" action-data="title=${data.fTitle}" href="javascript:void(0);" class="turn_right">#L{弹出}</a></p>'+'<div node-type="feed_list_media_big${data.type}Div" style="text-align:center;min-height:18px;"><img class="loading_gif" src="'+c+'"/></div>'+"<#if (data.notForward)></dd></#if>"+"</#et>"),mediaVideoMusicTEMP_HotRecommend:b("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<div class="W_bgcolor_arrow" node-type="arrow"><em class="W_arrline_mini">◆</em></div>'+'<dl class="comment">'+'<dd class="expand">'+'<p class="W_no_border"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i><a href="${data.short_url}" title="${data.short_url}" class="show_big" target="_blank">${data.title}</a><i class="W_vline">|</i></p>'+'<div node-type="feed_list_media_big${data.type}Div" style="text-align:center;min-height:18px;"><img class="loading_gif" src="'+c+'"/></div>'+"</dd>"+"</dl>"+"<#if (data.notForward)></dd></#if>"+"</#et>"),feedListThirdVideo:b("<#et temp data>"+'<#if (data.notForward)><dd class=""></#if>'+'<dl class="">'+'<dd class="expand">'+'<p class="W_no_border"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i><a href="${data.short_url}" title="${data.short_url}" class="show_big" target="_blank">${data.title}</a><i class="W_vline">|</i></p>'+'<div node-type="feed_list_media_big${data.type}Div" style="text-align:center;min-height:18px;" class="feed_list_media_bigvideoDiv">'+'<img class="video_pre" src="${data.img}"/><span class="loading_big_gif"></span></div>'+"</dd>"+"</dl>"+"<#if (data.notForward)></dd></#if>"+"</#et>"),feedListPromotionVideo:b("<#et temp data>"+'<#if (data.notForward)><dd class=""></#if>'+'<dl class="">'+'<dd class="expand">'+'<p class="W_no_border" style="display:none;"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i><a href="${data.short_url}" title="${data.short_url}" class="show_big" target="_blank">${data.title}</a><i class="W_vline">|</i></p>'+'<div node-type="feed_list_media_big${data.type}Div" style="text-align:center;min-height:18px;width: 690px;" class="feed_list_media_bigvideoDiv">'+'<img class="video_pre" src="${data.img}"/><span class="loading_big_gif"></span></div>'+"</dd>"+"</dl>"+"<#if (data.notForward)></dd></#if>"+"</#et>"),mediaVideoMusicFloatTEMP:b("<#et temp data>"+'<div node-type="outer" class="W_layer" style="top:50px;left:50px;">'+'<div class="bg">'+'<table border="0" cellspacing="0" cellpadding="0">'+"<tr>"+"<td>"+'<div class="content">'+'<div class="title"><h3>${data.title}</h3></div>'+'<a href="####" onclick="return false;" node-type="close" class="W_close"></a>'+'<div node-type="mediaContent" style="text-align:center;width:440px;"><img style="margin:10px;" class="loading_gif" src="'+c+'"/></div>'+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"+"</#et>"),widgetTEMP:b("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<p class="W_no_border"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank">${data.title}</a></p>'+'<div node-type="feed_list_media_widgetDiv"><img class="loading_gif" src="'+c+'"/></div>'+"<#if (data.notForward)></dd></#if>"+"</#et>"),qingTEMP:b("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<p class="W_no_border"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank">${data.title}</a></p>'+'<div node-type="feed_list_media_qingDiv"><img class="loading_gif" src="'+c+'"/></div>'+"<#if (data.notForward)></dd></#if>"+"</#et>")}});
STK.register("lib.kit.dom.parentAttr",function(a){return function(a,b,c){var d;if(a&&b){c=c||document.body;while(a&&a!=c&&!(d=a.getAttribute(b))){a=a.parentNode}}return d}});
STK.register("common.trans.feed",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("delete",{url:"/ajax/mblog/del",method:"post"});c("mediaShow",{url:"//api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("mediaShowThirdRend",{url:"/ajax/object/render",method:"post"});c("qingShow",{url:"//api.t.sina.com.cn/widget/show.json?source=3818214747",varkey:"callback",method:"get",requestMode:"jsonp"});c("profileSearch",{url:"/ajax/mblog/mbloglist",method:"get"});c("homeSearch",{url:"/ajax/mblog/newtips",method:"get"});c("groupSearch",{url:"/ajax/relation/status",method:"get"});c("atMeSearch",{url:"/ajax/at/mblog/list",method:"get"});c("atMeShield",{url:"/ajax/at/mblog/shield",method:"post"});c("widget",{url:"/ajax/mblog/showinfo",method:"post"});c("third_rend",{url:"/ajax/mblog/renderfeed",method:"post"});c("feedShield",{url:"/ajax/user/block",method:"post"});c("feedTagList",{url:"/ajax/mblog/tag/mytaglist",method:"post"});c("feedTagUpdate",{url:"/ajax/mblog/tag/updatetags",method:"post"});c("feedTagDel",{url:"/ajax/mblog/tag/destroy",method:"post"});c("feedTagEdit",{url:"/ajax/mblog/tag/update",method:"post"});c("getAtmeComment",{url:"/ajax/at/comment/comment",method:"get"});c("getAtmeBlog",{url:"/ajax/at/mblog/mblog",method:"get"});c("welcome",{url:"/ajax/mblog/welcome",method:"get"});c("gslist",{url:"/ajax/mblog/gslist",method:"get"});c("recmodlayer",{url:"/ajax_photo/recomlayer?_wv=5",method:"get"});return b});
STK.register("common.trans.favorite",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("add",{url:"/ajax_Mblog/favAdd",method:"post"});c("del",{url:"/ajax_Mblog/favDel",method:"post"});return b});
STK.register("common.feed.feedList.utils",function(a){var b=a.lib.kit.dom.parentAttr;var c=a.core.evt.preventDefault;var d={getMid:function(a,c){return a.mid||(a.mid=b(a,"mid",c))},getFeedNode:function(b,c){return a.core.dom.dir(b,{expr:"[action-type=feed_list_item]",endpoint:c||document.body})[0]},getFeeds:function(b,c){return a.sizzle("div["+c+"]",b)},preventDefault:function(a){c(a);return false},getFeedTrans:a.common.trans.feed.getTrans,getFavoriteTrans:a.common.trans.favorite.getTrans};return d});
STK.register("widget.module.component",function(a){return function(){var b={};b.initParam=a.core.func.empty;b.initEvent=a.core.func.empty;b.destroyParam=a.core.func.empty;b.destroyEvent=a.core.func.empty;b.init=function(){b.initParam();b.initEvent()};b.destroy=function(){b.destroyEvent();b.destroyParam()};return b}});
STK.register("widget.parse",function(a){var b="//js.t.sinajs.cn/t4/apps/search/js/",c="STK.",d=["destroy","part_destroy","part_flush"],e=1,f=typeof $CONFIG=="undefined"?e:$CONFIG["version"];return function(e,g){var h=a.widget.module.component(),i=a.core.obj.sup(h,["init","destroy"]),j={},k,l;h.handler={getMethod:function(b){b=b.split(".");var c,d=a;while(c=b.shift()){if(!(d=d[c])){break}}return d},extract:function(a){var b=h.handler.getMethod(a.ns);if(b){j[a.uniqueID]={info:a,entity:b(a)};j[a.uniqueID].entity.init()}},getDomInfo:function(b){return{dom:b,top:h.entity.dom,ns:b.getAttribute("component"),uniqueID:a.core.dom.uniqueID(b),data:a.queryToJson(b.getAttribute("component-data")||""),param:a.queryToJson(b.getAttribute("component-param")||"")}},loadComponent:function(b){var c=h.handler.getDomInfo(b);var d=[{url:[k["baseURL"],c.ns.replace(/\./g,"/"),".js?version=",f].join(""),NS:k["baseNS"]+c.ns}];a.core.io.require(d,h.handler.extract,c)}};h.accept={partDestroy:function(b,c){var d=c.dom;for(var e in j){if(a.contains(d,j[e].info.dom)){j[e].entity.destroy();delete j[e].info;delete j[e].entity;delete j[e]}}},partFlush:function(b,c){a.foreach(a.sizzle("[component]",c.dom),h.handler.loadComponent)}};h.initParam=function(){h.entity={dom:e};l=a.custEvent.define(h.entity.dom,d);k=a.parseParam({baseURL:b,baseNS:c},g);j={}};h.destroyParam=function(){k=null;j=null};h.initEvent=function(){a.custEvent.add(l,"part_destroy",h.accept.partDestroy);a.custEvent.add(l,"part_flush",h.accept.partFlush)};h.destroyEvent=function(){a.custEvent.remove(l,"part_destroy",h.accept.partDestroy);a.custEvent.remove(l,"part_flush",h.accept.partFlush)};h.destroy=function(){for(var a in j){j[a].entity.destroy();delete j[a].info;delete j[a].entity;delete j[a]}i.destroy()};h.init=function(){i.init();a.foreach(a.sizzle("[component]",h.entity.dom),h.handler.loadComponent)};return h}});
STK.register("common.feed.widget",function(a){var b={};return{add:function(c,d){if(!b[c]){b[c]=a.widget.parse(d);b[c].init()}},clear:function(a){if(b[a]){b[a].destroy();delete b[a]}},destroy:function(){for(var a in b){b[a].destroy();delete b[id]}}}});
STK.register("common.feed.feedList.plugins.media_hotrecommend",function(a){var b=a.common.feed.feedList.utils;var c=a.common.feed.feedList.feedTemps;var d=a.core.util.easyTemplate;var e=a.lib.kit.extra.language;var f=e("#L{本多媒体内容由于版权问题无法播放，请点击原链接查看。}");var g=e("#L{很抱歉，该内容无法显示，请稍后再试。}");var h=a.core.util.browser.IE;var i=40;var j=450;var k=function(e,g,i,j){var k=e.el;var l=e.data;var m=a.core.dom.builder(a.lib.kit.dom.parentElementBy(k,g,function(a){if(a.getAttribute("node-type")==="like"){return true}}));var n=m.box.getAttribute("isForward")?"1":"";var o=l.short_url;var p={disp:m.list.feed_list_media_disp[0],prev:m.list.feed_list_media_prev[0]};if(p.disp.innerHTML!=""){return}var q=decodeURIComponent(l.title);var r=a.bLength(q)>71?a.leftB(q,70)+"...":q;q=a.bLength(q)>24?a.leftB(q,23)+"...":q;p.disp.innerHTML="";p.disp.appendChild(a.builder(d(c.mediaVideoMusicTEMP_HotRecommend,{notForward:!n,short_url:decodeURIComponent(l.short_url),full_url:decodeURIComponent(l.full_url),title:q,fTitle:r,type:i}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var s=a.sizzle('div[node-type="feed_list_media_big'+i+'Div"]',p.disp)[0];if(!s){a.log('media: node-type="feed_list_media_big'+i+'Div" is not be found in feed_list_media_disp node!');return}j.dispContentNode[o]=s;var t="default";try{if(h){t="object"}else if(navigator.plugins["Shockwave Flash"]){t="embed"}else{t="html5"}}catch(u){}var v=function(){s.innerHTML=f};var w=function(b){if(!b["result"]||b["error_code"]||b["error"]){v();return}var c=j.dispContentNode[o];c.mediaData=b["result"];c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);floatFix&&floatFix.setFixed(true)};b.getFeedTrans("mediaShow",{onComplete:w,onFail:v}).request({vers:3,lang:$CONFIG["lang"],mid:o,short_url:l.short_url.replace(/(http|https)\:\/\/(t|sinaurl)\.cn\//,""),template_name:t,source:"3818214747"})};var l=function(e,g,i,j,k){var l=e.el;var m=e.data;if(m.live&&m.live==1){window.open(m.short_url);return}var n=a.core.dom.builder(a.lib.kit.dom.parentElementBy(l,g,function(a){if(a.getAttribute("node-type")==="like"){return true}}));var o=n.box.getAttribute("isForward")?"1":"";var p=m.short_url;var q={disp:n.list.feed_list_media_disp[0],prev:n.list.feed_list_media_prev[0]};if(STK.core.str.trim(q.disp.innerHTML)!=""){return}var r=decodeURIComponent(m.title);var s=a.bLength(r)>71?a.leftB(r,70)+"...":r;r=a.bLength(r)>24?a.leftB(r,23)+"...":r;var t=a.sizzle("img",q.prev)[0].src;q.disp.innerHTML="";var u;if(k){u=c.feedListPromotionVideo}else{u=c.feedListThirdVideo}q.disp.appendChild(a.builder(d(u,{notForward:!o,short_url:decodeURIComponent(m.short_url),full_url:decodeURIComponent(m.full_url),title:r,fTitle:s,type:i,img:t}).toString()).box);q.prev.style.display="none";q.disp.style.display="";var v=a.sizzle('div[node-type="feed_list_media_big'+i+'Div"]',q.disp)[0];if(!v){a.log('media: node-type="feed_list_media_big'+i+'Div" is not be found in feed_list_media_disp node!');return}j.dispContentNode[p]=v;var w="default";try{if(h){w="object"}else if(navigator.plugins["Shockwave Flash"]){w="embed"}else{w="html5"}}catch(x){}var y=function(){v.innerHTML=f};var z=function(b){if(!b["data"]["render_data"]){y();return}var c=j.dispContentNode[p];b.data.render_data=b.data.render_data.replace('allowscriptaccess="never"','allowscriptaccess="always"');c.mediaData=b.data.render_data;c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);floatFix&&floatFix.setFixed(true)};b.getFeedTrans("mediaShowThirdRend",{onComplete:z,onFail:y}).request({lang:$CONFIG["lang"],template_type:w,source:"3818214747",object_id:m.object_id,action:0,is_promotion:k?l.getAttribute("is-promotion"):""})};var m=function(e,g,i,j){var k=e.el;var l=e.data;var m=a.core.dom.builder(a.lib.kit.dom.parentElementBy(k,g,function(a){if(a.getAttribute("node-type")==="like"){return true}}));var n=m.box.getAttribute("isForward")?"1":"";var o=l.short_url;var p={disp:m.list.feed_list_media_disp[0],prev:m.list.feed_list_media_prev[0]};if(p.disp.innerHTML!=""){return}var q=decodeURIComponent(l.title);var r=a.bLength(q)>71?a.leftB(q,70)+"...":q;q=a.bLength(q)>24?a.leftB(q,23)+"...":q;p.disp.innerHTML="";p.disp.appendChild(a.builder(d(c.mediaVideoMusicTEMP_HotRecommend,{notForward:!n,short_url:decodeURIComponent(l.short_url),full_url:decodeURIComponent(l.full_url),title:q,fTitle:r,type:i}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var s=a.sizzle('div[node-type="feed_list_media_big'+i+'Div"]',p.disp)[0];if(!s){a.log('media: node-type="feed_list_media_big'+i+'Div" is not be found in feed_list_media_disp node!');return}j.dispContentNode[o]=s;var t="default";try{if(h){t="object"}else if(navigator.plugins["Shockwave Flash"]){t="embed"}else{t="html5"}}catch(u){}var v=function(){s.innerHTML=f};var w=function(b){if(!b["data"]["render_data"]){v();return}var c=j.dispContentNode[o];b.data.render_data=b.data.render_data.replace('allowscriptaccess="never"','allowscriptaccess="always"');c.mediaData=b.data.render_data;c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);floatFix&&floatFix.setFixed(true)};b.getFeedTrans("mediaShowThirdRend",{onComplete:w,onFail:v}).request({lang:$CONFIG["lang"],template_type:t,source:"3818214747",object_id:l.object_id,action:0})};return function(b){if(!b){a.log("media : need object of the baseFeedList Class");return}var c=b;var d=STK.core.evt.delegatedEvent(c);var e={};var f={dispContentNode:{},voteObj:{}};var g=function(){a.custEvent.fire(b,"clearTips","media")};d.add("feed_list_media_toSmall","click",function(b){var c=b.el;var d=a.core.dom.builder(a.lib.kit.dom.parentElementBy(c,document,function(a){if(a.getAttribute("node-type")==="like"){return true}})).list;if(d.feed_list_media_disp&&d.feed_list_media_disp.length!=0){d.feed_list_media_disp[0].innerHTML="";d.feed_list_media_disp[0].style.display="none"}if(d.feed_list_media_prev&&d.feed_list_media_prev[0].length!=0){d.feed_list_media_prev[0].style.display=""}});d.add("feed_list_media_video","click",function(a){k(a,c,"video",f)});var h=a.sizzle("[node-type=feed_list]",c);var i=function(a){if(a.el.getAttribute("is-promotion")==="1"){l(a,c,"video",f,true)}else{l(a,c,"video",f)}};var j;if(WBH5Global&&WBH5Global.support&&WBH5Global.support.video&&WBH5Global.support.video()){j=WBH5Global.init(c,i)}else{}return e}});
STK.register("common.channel.window",function(a){return a.common.channel.listener.define("common.channel.window",["scroll"])});
STK.register("common.extra.lazyload",function(a){function f(){clearTimeout(c);c=setTimeout(e,300)}function e(){var b=a.core.util.scrollPos();var c=a.core.util.pageSize();var d={scrollLeft:b.left,scrollTop:b.top,winWidth:c.win.width,winHeight:c.win.height,pageWidth:c.page.width,pageHeight:c.page.height};a.common.channel.window.fire("scroll",d)}function d(b,c,d,e){var f,g,h;var i=b.length,j=new Date;if(b.length>0){for(var k=b.length-1;k>=0;k--){f=b[k];h=d["parent"]?f.parentNode:f;g=a.core.dom.position(h)["t"];if(g>e["top"]&&g<e["bottom"]){b.splice(k,1);c(f)}}}}var b=false;var c;return function(c,e,g){if(b==false){b=true;a.addEvent(window,"scroll",f);a.addEvent(window,"resize",f);f()}var h=function(b){var f={type:"",threshold:600,parent:false,over:false};f=a.core.obj.parseParam(f,g);d(c,e,g,{top:f.over?0:b["scrollTop"],bottom:parseInt(b["scrollTop"]+b["winHeight"]+f.threshold,10)})};a.common.channel.window.register("scroll",h);var i={destroy:function(){a.common.channel.window.remove("scroll",h)}};return i}});
STK.register("lib.kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;if(c&&c.nodeType!=1){c=b(c)}return c}});
STK.register("lib.kit.dom.lastChild",function(a){var b=a.core.dom.prev;return function(a){var c=a.lastChild;if(c&&c.nodeType!=1){c=b(c)}return c}});
STK.register("common.feed.feedList.baseFeedList",function(a){var b=a.common.feed.feedList.utils;var c=a.common.feed.feedList.feedTemps;var d=a.lib.kit.dom.firstChild;var e=a.lib.kit.dom.lastChild;var f=a.core.dom.insertElement;var g=function(b){a.custEvent.fire(b,"clearTips","base")};var h=function(b,e){var f;switch(b){case"waiting":f=c.loadingHTML;break;case"retry":f=c.loadErrorRetryHTML;break;case"end":f=c.loadErrorEndHTML;break}return d(a.builder(f.replace("[n]",e)).box)};return function(c,g){if(!a.isNode(c)){a.log("baseFeedList : parameter node is not a document node!")}g=a.parseParam({page:1,end_id:""},g);var i={};var j=a.core.evt.delegatedEvent(c),k,l,m=0,n=parseInt(g.page),o=false;var p={};var q=g.end_id;if(!q&&n<2&&(q=d(c))){q=q.getAttribute("mid")}var r=function(){if(n<2){var a=d(c);a&&(q=a.getAttribute("mid"))}};var s=function(a,b){o=true;u.removeTopNode();f(c,k=h(a,b),"afterbegin")};var t=function(a,b){u.removeBottomNode();c.appendChild(l=h(a,b))};var u={extra:{},extraData:{},getNode:function(){return c},getYellowNode:function(){var b=a.sizzle('a[action-type="feed_list_newBar"]',c);return b.length?b[0]:false},getNodeList:function(){var b=a.sizzle('dl[action-type="feed_list_item"]',c);return b.length?b:false},getDEvent:function(){return j},removeTopNode:function(){a.removeNode(k);k=null},setTopNode:function(a){k=a},removeBottomNode:function(){a.removeNode(l);l=null},setBottomNode:function(a){l=a},getEndId:function(){return q},isTopWaiting:function(){return o},getCurrentPage:function(){return n},setCurrentPage:function(a){n=a},getFeedCount:function(){return b.getFeeds(c,'action-type="feed_list_item"').length},setRequestAction:function(b,c){i[b]=a.parseParam({top:false,center:false,bottom:false},c)},setRequestData:function(a,b){p[a]={data:b,time:0}},getExtraData:function(a){return u.extraData[a]},setExtraData:function(a,b){u.extraData[a]=b},setExtraFunction:function(a,b){u.extra[a]=b},regCustEvent:function(b,c){a.custEvent.define(u,b);a.custEvent.add(u,b,c)},getFirstFeedId:function(){var b=k?a.core.dom.next(k):d(c);if(b){for(var e=0;e<m&&b;e++){b=a.core.dom.next(b)}if(b)return b.getAttribute("mid")}},getLastFeedId:function(){var b=l?a.core.dom.prev(l):e(c);if(b){return b.getAttribute("mid")}},showZeroTip:function(){var b=a.sizzle('div[node-type="feed_list_zero"]',c)[0];if(b){b.style.display=""}},hideZeroTip:function(){var b=a.sizzle('div[node-type="feed_list_zero"]',c)[0];if(b){b.style.display="none"}},insertFakeFeed:function(b){if(typeof b!="string"){a.log("insertFakeFeed feedHtml is not String!");return}u.hideZeroTip();m++;if(k){a.insertHTML(k,b,"afterend")}else{a.insertHTML(c,b,"afterbegin")}},updateFeed:function(b,e){if(b&&e&&i[e]){u.hideZeroTip();var f=i[e];if(f.top){o=false;u.removeTopNode();for(var g=0;g<m;g++){a.removeNode(d(c))}m=0;a.insertHTML(c,b,"afterbegin")}else if(f.bottom){u.removeBottomNode();a.insertHTML(c,b)}a.custEvent.fire(u,"updateFeed",[e,b])}},showWait:function(b){if(b&&i[b]){var d=i[b];if(d.top){s("waiting",b);d.bottom&&u.removeBottomNode()}else if(d.bottom){t("waiting",b)}if(d.center){k&&a.core.util.hideContainer.appendChild(k);l&&a.core.util.hideContainer.appendChild(l);c.innerHTML="";k&&c.appendChild(k);l&&c.appendChild(l)}p[b].time=0}},showError:function(b){if(b&&i[b]){var c=i[b];var d=p[b];var e;if(d.time>=3){d.time=0;e="end"}else{d.time++;e="retry"}if(c.top){s(e,b)}else if(c.bottom){t(e,b)}a.custEvent.fire(u,"showError",b)}}};u.destroy=function(){j.destroy()};a.custEvent.define(u,["request","updateFeed","clearTips","updateEndId","showError","utils"]);a.custEvent.add(u,"updateEndId",r);return u}});
STK.register("lib.kit.extra.reuse",function(a){return function(b,c){var d,e,f;d=a.parseParam({},c);f=[];var g=function(){var a=b();f.push({store:a,used:true});return a};var h=function(b){a.foreach(f,function(a,c){if(b===a["store"]){a["used"]=true;return false}})};var i=function(b){a.foreach(f,function(a,c){if(b===a["store"]){a["used"]=false;return false}})};var j=function(){for(var a=0,b=f.length;a<b;a+=1){if(f[a]["used"]===false){f[a]["used"]=true;return f[a]["store"]}}return g()};e={};e.setUsed=h;e.setUnused=i;e.getOne=j;e.getLength=function(){return f.length};return e}});
STK.register("lib.module.dialog",function(a){return function(b,c){if(!b){throw"module.dialog need template as first parameter"}var d,e,f,g,h,i,j,k,l,m,n,o;l=true;var p=function(){if(l!==false){e.hide()}};var q=function(){d=a.parseParam({t:null,l:null,width:null,height:null},c);e=a.lib.module.layer(b,d);g=e.getOuter();h=e.getDom("title");k=e.getDom("title_content");i=e.getDom("inner");j=e.getDom("close");a.addEvent(j,"click",function(b){a.preventDefault(b);n();return false});a.custEvent.add(e,"show",function(){a.hotKey.add(document.documentElement,["esc"],p,{type:"keyup",disableInInput:true})});a.custEvent.add(e,"hide",function(){a.hotKey.remove(document.documentElement,["esc"],p,{type:"keyup"});l=true})};q();o=a.objSup(e,["show","hide"]);n=function(b){if(typeof m==="function"&&!b){if(m()===false){return false}}o.hide();if(a.contains(document.body,e.getOuter())){document.body.removeChild(e.getOuter())}return f};f=e;f.show=function(){if(!a.contains(document.body,e.getOuter())){document.body.appendChild(e.getOuter())}o.show();return f};f.hide=n;f.setPosition=function(a){g.style.top=a["t"]+"px";g.style.left=a["l"]+"px";return f};f.setMiddle=function(){var b=a.core.util.winSize();var c=e.getSize(true);g.style.top=a.core.util.scrollPos()["top"]+(b.height-c.h)/2+"px";g.style.left=(b.width-c.w)/2+"px";return f};f.setTitle=function(a){k.innerHTML=a;return f};f.setContent=function(a){if(typeof a==="string"){i.innerHTML=a}else{i.appendChild(a)}return f};f.clearContent=function(){while(i.children.length){a.removeNode(i.children[0])}return f};f.setAlign=function(){};f.setBeforeHideFn=function(a){m=a};f.clearBeforeHideFn=function(){m=null};f.unsupportEsc=function(){l=false};f.supportEsc=function(){l=true};return f}});
STK.register("lib.kit.dom.drag",function(a){return function(b,c){var d,e,f,g,h,i,j,k;var l=function(){m();n()};var m=function(){d=a.parseParam({moveDom:b,perchStyle:"border:solid #999999 2px;",dragtype:"perch",actObj:{},pagePadding:5},c);f=d.moveDom;e={};g={};h=a.drag(b,{actObj:d.actObj});if(d["dragtype"]==="perch"){i=a.C("div");j=false;k=false;f=i}b.style.cursor="move"};var n=function(){a.custEvent.add(d.actObj,"dragStart",o);a.custEvent.add(d.actObj,"dragEnd",p);a.custEvent.add(d.actObj,"draging",q)};var o=function(c,e){document.body.style.cursor="move";var f=a.core.util.pageSize()["page"];g=a.core.dom.position(d.moveDom);g.pageX=e.pageX;g.pageY=e.pageY;g.height=d.moveDom.offsetHeight;g.width=d.moveDom.offsetWidth;g.pageHeight=f["height"];g.pageWidth=f["width"];if(d["dragtype"]==="perch"){var h=[];h.push(d["perchStyle"]);h.push("position:absolute");h.push("z-index:"+(d.moveDom.style.zIndex+10));h.push("width:"+d.moveDom.offsetWidth+"px");h.push("height:"+d.moveDom.offsetHeight+"px");h.push("left:"+g["l"]+"px");h.push("top:"+g["t"]+"px");i.style.cssText=h.join(";");k=true;setTimeout(function(){if(k){document.body.appendChild(i);j=true}},100)}if(b.setCapture!==undefined){b.setCapture()}};var p=function(a,c){document.body.style.cursor="auto";if(b.setCapture!==undefined){b.releaseCapture()}if(d["dragtype"]==="perch"){k=false;d.moveDom.style.top=i.style.top;d.moveDom.style.left=i.style.left;if(j){document.body.removeChild(i);j=false}}};var q=function(a,b){var c=g.t+(b.pageY-g.pageY);var e=g.l+(b.pageX-g.pageX);var h=c+g["height"];var i=e+g["width"];var j=g["pageHeight"]-d["pagePadding"];var k=g["pageWidth"]-d["pagePadding"];if(h<j&&c>0){f.style.top=c+"px"}else{if(c<0){f.style.top="0px"}if(h>=j){f.style.top=j-g["height"]+"px"}}if(i<k&&e>0){f.style.left=e+"px"}else{if(e<0){f.style.left="0px"}if(i>=k){f.style.left=k-g["width"]+"px"}}};l();e.destroy=function(){document.body.style.cursor="auto";if(typeof f.setCapture==="function"){f.releaseCapture()}if(d["dragtype"]==="perch"){k=false;if(j){document.body.removeChild(i);j=false}}a.custEvent.remove(d.actObj,"dragStart",o);a.custEvent.remove(d.actObj,"dragEnd",p);a.custEvent.remove(d.actObj,"draging",q);if(h.destroy){h.destroy()}d=null;f=null;g=null;h=null;i=null;j=null;k=null};e.getActObj=function(){return d.actObj};return e}});
STK.register("lib.ui.dialog",function(a){var b=""+'<div class="m-layer" node-type="outer" style="position:absolute;z-index:10000000">'+'<div class="header">'+'<h6 class="title" node-type="title"><span node-type="title_content"></span></h6>'+'<a href="javascript:void(0);" class="wbicon close" node-type="close">X</a>'+"</div>"+'<div class="inner" node-type="inner">'+"</div>"+"</div>";var c=a.lib.kit.extra.language;var d=null,e;var f=function(){var b=a.lib.module.dialog(c(e["template"]));a.custEvent.add(b,"show",function(){a.lib.module.mask.showUnderNode(b.getOuter())});a.custEvent.add(b,"hide",function(){a.lib.module.mask.back();b.setMiddle()});a.lib.kit.dom.drag(b.getDom("title"),{actObj:b,moveDom:b.getOuter()});b.destroy=function(){g(b);try{b.hide(true)}catch(a){}};return b};var g=function(a){a.setTitle("").clearContent();d.setUnused(a)};return function(c){e=a.parseParam({template:b,isHold:false},c);var h=e["isHold"];e=a.core.obj.cut(e,["isHold"]);if(!d){d=a.lib.kit.extra.reuse(f)}var i=d.getOne();if(!h){a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);g(i)})}return i}});
STK.register("lib.kit.dom.autoHeightTextArea",function(a){var b=a.core.util.browser.MOZ;var c=a.core.util.browser.IE6||a.core.util.browser.IE7||a.core.util.browser.IE8;var d=function(d){var e=a.core.dom.getStyle,f;if(!d.defaultHeight){d.defaultHeight=parseInt(e(d,"height"),10)||parseInt(d.offsetHeight,10)||20}if(c){var g=parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10);f=Math.max(d.scrollHeight-g,d.defaultHeight)}else{var g=b?0:parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10);var h=a.E("_____textarea_____");if(!h){h=a.C("textarea");h.id="_____textarea_____";document.body.appendChild(h)}if(h.currentTarget!=d){var i=[];i.push("width:"+e(d,"width"));i.push("font-size:"+e(d,"fontSize"));i.push("font-family:"+e(d,"fontFamily"));i.push("line-height:"+e(d,"lineHeight"));i.push("padding-left:"+e(d,"paddingLeft"));i.push("padding-right:"+e(d,"paddingRight"));i.push("padding-top:"+e(d,"paddingTop"));i.push("padding-bottom:"+e(d,"paddingBottom"));i.push("top:-1000px");i.push("height:0px");i.push("position:absolute");i.push("overflow:hidden");i.push("");i=i.join(";");h.style.cssText=i}h.value=d.value;f=Math.max(h.scrollHeight-g,d.defaultHeight);h.currentTarget=d}return f};return function(b){function j(b){var c=a.core.dom.getStyle,d;var e=[];e.push("width:"+c(b,"width"));e.push("font-size:"+c(b,"fontSize"));e.push("font-family:"+c(b,"fontFamily"));e.push("line-height:"+c(b,"lineHeight"));e.push("padding-left:"+c(b,"paddingLeft"));e.push("padding-right:"+c(b,"paddingRight"));e.push("padding-top:"+c(b,"paddingTop"));e.push("padding-bottom:"+c(b,"paddingBottom"));e.push("top:-1000px");e.push("height:0px");e.push("position:absolute");e.push("overflow:hidden");e.push("");e=e.join(";");return e}var c=b.textArea,e=b.maxHeight,f=b.inputListener,g=c.style,h;(h=function(){typeof f==="function"&&f();setTimeout(function(){var a=d(c),b;e=e||a;var f=a>e;b=f?e:a;g.overflowY=f?"auto":"hidden";g.height=Math.min(e,a)+"px"},0)})();if(!a.core.util.browser.IE){try{a.common.channel.at.register("open",function(){a.E("_____textarea_____").style.cssText=j(c)})}catch(i){a.log(i)}}if(!c.binded){a.addEvent(c,"keyup",h);a.addEvent(c,"focus",h);a.addEvent(c,"blur",h);c.binded=true;c.style.overflow="hidden"}}});
STK.register("lib.ui.alert",function(a){var b='<div class="m-confirm" node-type="outer">'+'<p class="para" node-type="inner"><i class="" node-type="icon"></i><span node-type="textLarge"></span></p>'+'<div class="btn-box">'+'<a href="javascript:void(0)" class="s-btn-a" node-type="OK"></a>'+"</div>"+"</div>";var c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon-ques"};var d=a.lib.kit.extra.language;var e=null;var f=function(a,b){a.getDom("icon").className=b["icon"];a.getDom("textLarge").innerHTML=b["textLarge"];a.getDom("textSmall").innerHTML=b["textSmall"];a.getDom("OK").innerHTML="<span>"+b["OKText"]+"</span>"};return function(g,h,i){var j,k,l,m,n;j=a.parseParam({title:d("#L{提示}"),icon:"warn",textLarge:g,textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),timeout:0},h);j["icon"]=c[j["icon"]];k={};if(!e){e=a.lib.kit.extra.reuse(function(){var c=a.lib.module.layer(d(b));return c})}l=e.getOne();m=a.lib.ui.dialog();m.setContent(l.getOuter());m.setTitle(j["title"]);f(l,j);var o=function(b){m.is_closed=b.target.parentNode.getAttribute("node-type");a.preventDefault(b);m.hide()};a.addEvent(l.getDom("OK"),"click",o);a.custEvent.add(m,"hide",function(){a.custEvent.remove(m,"hide",arguments.callee);a.removeEvent(l.getDom("OK"),"click",o);e.setUnused(l);clearTimeout(n);m.is_closed=="OK"?j["OK"]():i[0].innerHTML=d("#L{评论}")});if(j["timeout"]){n=setTimeout(m.hide,j["timeout"])}m.show().setMiddle();k.alt=l;k.dia=m;return k}});
STK.register("common.channel.feed",function(a){var b=["forward","publish","comment","delete","refresh","reply","feedTagUpdate"];return a.common.channel.listener.define("common.channel.feed",b)});
STK.register("common.trans.forward",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("toMicroblog",{url:"/Ajax_Mblog/repost",method:"post"});c("toMicrogroup",{url:"/ajax/qun/forward",method:"post"});c("setDefault",{url:"/ajax/mblog/repost/setdefault",method:"post"});c("simpleForwardLinks",{url:"/ajax/mblog/repost/unexpanded",method:"get"});c("detailForwardLinks",{url:"/ajax/mblog/repost/small",method:"get"});c("microgroupList",{url:"/ajax/qun/mylist",method:"get"});return b});
STK.register("common.forward.utils",function(a){var b={checkAtNum:function(a){var b=a.match(/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g);var c=a.match(/\/\/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g);b=b?b.length:0;c=c?c.length:0;return b-c},preventDefault:function(b){a.core.evt.preventDefault(b);return false}};return b});
STK.register("common.forward.report",function(a){return function(b){window.open("//weibo.com/complaint/complaint.php?url="+a.kit.extra.parseURL().url);a.core.evt.preventDefault(b.evt);return false}});
STK.register("lib.kit.extra.toFeedText",function(a){return function(b){if(typeof b!=="string"){throw"[kit.extra.toFeedText]:need string as first parameter"}var c=a.core.str.parseHTML(b);var d=[];for(var e=0,f=c.length;e<f;e+=1){if(!c[e][2]){d.push(c[e][0])}else if(c[e][2].toLowerCase()==="img"){var g=c[e][3].match(/(?:alt\s*=\s*["|']?([^"|'|\s]+)["|']?)/);if(g){d.push(g[1])}}}return d.join("")}});
STK.register("lib.ui.litePrompt",function(a){var b=a.lib.kit.extra.language;var c=a.core.util.easyTemplate;return function(b,d){var e,f,g,h,i;var d=a.parseParam({hideCallback:a.core.func.empty,type:"succM",msg:"",timeout:""},d);var j=d.template||"<#et temp data>"+'<div class="m-confirm" node-type="outer">'+'<p class="para" node-type="inner"><i class="icon_succM" node-type="icon"></i><span>${data.msg}</span></p>'+'<div class="btn-box">'+'<a href="javascript:void(0)" class="s-btn-a" node-type="OK"></a>'+"</div>"+"</div></#et>";var k=c(j,{type:d.type,msg:b}).toString();f={};g=a.lib.module.layer(k);i=g.getOuter();a.custEvent.add(g,"hide",function(){});a.custEvent.add(g,"show",function(){document.body.appendChild(i);a.lib.module.mask.showUnderNode(i);a.lib.module.mask.getNode().style.zIndex=10002});g.show();var l=a.core.util.winSize();var m=g.getSize(true);i.style.top=a.core.util.scrollPos()["top"]+(l.height-m.h)/2+"px";i.style.left=(l.width-m.w)/2+"px";i.style.zIndex=10002;f.layer=g;return f}});
STK.register("common.trans.validateCode",function(a){var b=a.lib.kit.io.inter();var c="/ajax/";var d=b.register;d("checkAnswer",{url:c+"pincode/verified?",method:"post"});return b});
STK.register("lib.kit.io.cssLoader",function(a){var b="";var c="//img.t.sinajs.cn/t4/";var d="//timg.sjs.sinajs.cn/t4/";if(typeof $CONFIG!="undefined"){c=$CONFIG.cssPath||c;b=$CONFIG["version"]||""}var e={};return function(f,g,h,i,j){i=i||b;h=h||function(){};var k=function(a,b){var c=e[a]||(e[a]={loaded:false,list:[]});if(c.loaded){b(a);return false}c.list.push(b);if(c.list.length>1){return false}return true};var l=function(a){var b=e[a].list;for(var c=0;c<b.length;c++){b[c](a)}e[a].loaded=true;delete e[a].list};if(!k(f,h))return;var m;if(j){m=d+f}else{m=c+f+"?version="+i}var n=a.C("link");n.setAttribute("rel","Stylesheet");n.setAttribute("type","text/css");n.setAttribute("charset","utf-8");n.setAttribute("href",m);document.getElementsByTagName("head")[0].appendChild(n);var o=a.C("div");o.id=g;a.core.util.hideContainer.appendChild(o);var p=3e3;var q=function(){if(parseInt(a.core.dom.getStyle(o,"height"))==42){a.core.util.hideContainer.removeChild(o);l(f);return}if(--p>0){setTimeout(q,10)}else{a.log(f+"timeout!");a.core.util.hideContainer.removeChild(o);delete e[f]}};setTimeout(q,50)}});
STK.register("lib.ui.confirm",function(a){var b='<div class="m-confirm" node-type="outer">'+'<p class="para" node-type="inner"><i class="" node-type="icon"></i><span node-type="textLarge"></span><span node-type="textComplex"></span>'+'<span node-type="textSmall"></span></p>'+'<div class="btn-box">'+'<a href="javascript:void(0)" class="s-btn-a" node-type="OK"></a>'+'<a href="javascript:void(0)" node-type="cancel"></a>'+"</div>"+"</div>";var c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon-ques"};var d=a.lib.kit.extra.language;var e=null;return function(f,g){var h,i,j,k,l,m;h=a.parseParam({title:d("#L{提示}"),icon:"question",textLarge:f,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),cancel:a.funcEmpty,cancelText:d("#L{取消}")},g);h["icon"]=c[h["icon"]];i={};if(!e){e=a.lib.kit.extra.reuse(function(){var c=a.lib.module.layer(b);return c})}j=e.getOne();k=a.lib.ui.dialog();k.setContent(j.getOuter());j.getDom("icon").className=h["icon"];j.getDom("textLarge").innerHTML=h["textLarge"];j.getDom("OK").innerHTML=h["OKText"];j.getDom("cancel").innerHTML=h["cancelText"];k.setTitle(h["title"]);var n=function(){l=true;m=a.htmlToJson(j.getDom("textComplex"));k.hide()};a.addEvent(j.getDom("OK"),"click",n);a.addEvent(j.getDom("cancel"),"click",k.hide);a.custEvent.add(k,"hide",function(){a.custEvent.remove(k,"hide",arguments.callee);a.removeEvent(j.getDom("OK"),"click",n);a.removeEvent(j.getDom("cancel"),"click",k.hide);e.setUnused(j);if(l){h["OK"](m)}else{h["cancel"](m)}});k.show().setMiddle();i.cfm=j;i.dia=k;return i}});
STK.register("common.dialog.authentication",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.core.util.browser;b=a.parseParam({src:"//weibo.com/a/verify/realname?stage=home_verification&from=search",icon:"warn",isHold:true,width:"380px",height:"240px",title:c("#L{帐号验证}")},b||{});var e={},f,g,h=false;var i="tblog_checkfailed_reform";var j={init:function(){!(d.IE6||d.IE7)&&(window.document.domain="weibo.com");f=a.lib.ui.dialog(b);var c=[];c.push('<iframe id="account_authentication" name="account_authentication" node-type="frame" width="'+b.width+'" height="'+b.height+'" allowtransparency="true" scrolling="no" frameborder="0" src=""></iframe>');var e=a.builder(c.join(""));f.setTitle(b.title);f.setContent(e.box);var g=f.getDomList();a.addEvent(g["close"][0],"click",function(){history.go(0)})},show:function(){try{SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_box")}catch(c){}if(!h){a.lib.kit.io.cssLoader("style/css/module/layer/layer_check_identity.css","js_style_css_module_layer_check_identity",function(){h=true})}f.show().setMiddle();g=a.E("account_authentication");var d=decodeURIComponent(b.src)+"&rnd=";if(g.attachEvent){g.attachEvent("onload",function(){g.height=b.height;f.setMiddle()})}else{g.onload=function(){g.height=b.height;f.setMiddle()}}g.src=d+a.core.util.getUniqueKey()},destroy:function(){},hook:function(a,b){try{if(a=="100000"){j.verifySucc()}else{j.verifyFail()}}catch(c){}},verifySucc:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_success");f.hide();var b={title:c("#L{提示}"),icon:"success",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_play");history.go(0)},OKText:c("#L{进入首页}"),msg:c("#L{恭喜，您的身份已验证成功，马上进入新浪微博。}")};var d=a.lib.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})},verifyFail:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_twotimes");f.hide();var b={title:c("#L{提示}"),icon:"warn",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_triple");j.show()},OKText:c("#L{再次验证}"),msg:c("#L{抱歉，您的身份信息不准确，请再次验证。<br/>}")+'<a class="W_spetxt" suda-data="key=tblog_checkfailed_reform&value=checkfailed_havealook" href="//weibo.com">'+c("#L{您也可以先体验微博，随后再验证身份信息>>}")+"</a>"};var d=a.lib.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})}};j.init();e.destroy=j.destroy;e.show=j.show;window["App"]=window["App"]||{};window["App"]["checkRealName"]=j.hook;return e}});
STK.register("common.layer.ioError",function(a){var b=a.lib.kit.extra.language;var c;return function(d,e,f){f=f||function(){};var g={100001:function(){a.lib.ui.alert(e.msg)},100002:function(){window.location.reload()},100003:function(){var c=a.parseParam({location:"",icon:"warn",title:b("#L{提示}"),OKText:b("#L{确认}"),cancelText:b("#L{取消}"),suda:""},e.data);c["OK"]=function(){a.preventDefault();var b=a.queryToJson(e.data.OKSuda||"");SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);e["ok"]&&e["ok"]();window.location.href=c.location};c["cancel"]=function(){a.preventDefault();var b=a.queryToJson(e.data.cancelSuda||"");SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);e["cancel"]&&e["cancel"]()};a.lib.ui.confirm(e.msg,c)},100004:function(){if(!c){c=a.common.dialog.authentication({})}c.show()}};var h=g[d]||g["100001"];return h()||f(d)}});
STK.register("common.dialog.validateCode",function(a){var b=a.lib.kit.extra.language;var c="/ajax/pincode/pin?type=rule&lang=zh-cn&ts=";var d={dialog_html:'<div class="layer_veriyfycode">'+'<div class="v_image"><img height="50" width="450" class="yzm_img" /></div>'+'<p class="v_chng"><a href="#" onclick="return false;" class="yzm_change" action-type="yzm_change">#L{换另一组题目}</a></p>'+'<p class="v_ans_t">#L{请输入上面问题的答案}：</p>'+'<p class="v_ans_i"><input type="text" class="W_inputStp v_inp yzm_input ontext" action-type="yzm_input"/><div class="M_notice_del yzm_error" style="display:none;"><span class="icon_del"></span><span class="txt"></span></div></p>'+'<p class="v_btn">'+'<a class="S_btn_b yzm_submit" href="#" action-type="yzm_submit"><span>#L{确定}</span></a><a class="Sbtn_a yzm_cancel" href="#" action-type="yzm_cancel" action-data="value=frombtn"><span>#L{取消}</span></a>'+"</p>"+"</div>"};var e;return function(){if(e){return e}var f={};var g={};var h;var i;var j;var k;var l=function(){g.yzm_error.innerHTML="";g.yzm_error.parentNode.style.display="none"};var m=function(a){g.yzm_error.innerHTML=a;g.yzm_error.parentNode.style.display=""};var n=function(){if(!h){o()}l();g.input_text.value="";h.show();t.changesrc();h.setMiddle();a.hotKey.add(document.documentElement,["esc"],t.closeDialog,{type:"keyup",disableInInput:true})};var o=function(){h=a.lib.ui.dialog({isHold:true});h.setTitle(b("#L{请输入验证码}"));h.setContent(b(d.dialog_html));var c=h.getOuter();s(c);u()};var p=a.common.trans.validateCode.getTrans("checkAnswer",{onSuccess:function(b,c){var d=b.data.retcode;l();g.input_text.value="";h.hide();var e=i.requestAjax;var f=a.lib.kit.extra.merge(i.param,{retcode:d});e.request(f);j=false},onError:function(){m(b("#L{验证码错误}"));t.changesrc();j=false},onFail:function(){m(b("#L{验证码错误}"));t.changesrc();j=false}});var q=function(){};var r=function(){};var s=function(b){g.vImg=a.core.dom.sizzle("img.yzm_img",b)[0];g.yzm_change=a.core.dom.sizzle("a.yzm_change",b)[0];g.yzm_submit=a.core.dom.sizzle("a.yzm_submit",b)[0];g.yzm_cancel=a.core.dom.sizzle("a.yzm_cancel",b)[0];g.input_text=a.core.dom.sizzle("input.yzm_input",b)[0];g.yzm_error=a.core.dom.sizzle("div.yzm_error span.txt",b)[0];g.close_icon=h.getDom("close")};var t={changesrc:function(){var b=c+a.getUniqueKey();g.vImg.setAttribute("src",b);try{g.yzm_change.blur()}catch(d){}},checkValidateCode:function(){l();var c=a.core.str.trim(g.input_text.value);if(!c){m(b("#L{请输入验证码}"))}else{if(!j){j=true;p.request({secode:c,type:"rule"})}}try{g.yzm_submit.blur()}catch(d){}},closeDialog:function(b){if(typeof b=="object"&&b.el){h.hide()}if(typeof i=="object"&&i.onRelease&&typeof i.onRelease=="function"){i.onRelease()}a.hotKey.remove(document.documentElement,["esc"],t.closeDialog,{type:"keyup"});try{a.preventDefault()}catch(c){}},onFocus:function(b){b=a.core.evt.getEvent();var c=b.target||b.srcElement;var d=c.value;if(!d){l()}}};var u=function(){var b=h.getOuter();k=a.core.evt.delegatedEvent(b);k.add("yzm_change","click",function(){t.changesrc();a.preventDefault()});k.add("yzm_submit","click",function(){t.checkValidateCode();a.preventDefault()});k.add("yzm_cancel","click",t.closeDialog);a.core.evt.addEvent(g.close_icon,"click",t.closeDialog);a.core.evt.addEvent(g.input_text,"focus",t.onFocus);a.core.evt.addEvent(g.input_text,"blur",t.onFocus)};var v=function(){if(h){k.destroy();a.core.evt.removeEvent(g.close_icon,"click",t.closeDialog);a.core.evt.removeEvent(g.input_text,"focus",t.onFocus);a.core.evt.removeEvent(g.input_text,"blur",t.onFocus);h&&h.destroy&&h.destroy()}h=e=null};var w=function(b,c,d){if(b.code=="100027"){i=d;n()}else if(b.code=="100000"){var e=d.onSuccess;e&&e(b,c)}else if(b.code=="100002"){window.location.href=b["data"];return}else if(b.code=="100050"){d.onError(b,c)}else if(b.code=="100004"){a.common.layer.ioError(b.code,c)}else if(b.code==2e7){var f=JSON.parse(b.msg)||{};a.lib.ui.alert(f.msg,{OK:function(){window.location.href=b.data;return}},c.dom).dia.setTitle(f.title)}else{a.lib.ui.alert(b.msg);d.onError(b,c)}};r();r=null;f.destroy=v;f.validateIntercept=w;f.addUnloadEvent=function(){if(h){a.core.evt.addEvent(window,"unload",v)}};e=f;return f}});
STK.register("common.forward.toMicroblog",function(a){var b=a.lib.kit.extra.language;var c=null;var d=a.common.dialog.validateCode();var e=b(""+"<#et userlist data>"+'<div node-type="toMicroblog_client">'+"<#if (data.isDialog == true)>"+'<div class="content"><p node-type="content">'+"<#if (data.showArrow == true)>"+'<i class="wbicon s-fr" action-type="origin_all">c</i>'+"</#if>"+"${data.content}</p></div>"+"</#if>"+'<div class="num" node-type="num">140 #L{字}</div>'+'<div class="func">'+'<div class="input-wrap input-wrap-share">'+'<div class="input">'+'<textarea node-type="textEl">${data.reason}</textarea>'+"</div>"+'<div class="func">'+'<div class="face" node-type="widget">'+'<a href="javascript:void(0);" node-type="smileyBtn"><i class="wbicon icon-face">o</i></a>'+"</div>  "+'<div class="btn" node-type="widget">'+'<div node-type="cmtopts">'+'<span style="display: inline-block;vertical-align: middle;">'+"<#if (data.forwardNick)>"+'<label class="opt" node-type="forwardLi" style="display:block"><input type="checkbox" checked="checked" node-type="forwardInput">#L{同时评论给} ${data.forwardNick}</label>'+"</#if>"+"<#if (data.originNick)>"+'<label class="opt" node-type="originLi"  style="display:block"><input type="checkbox" checked="checked" node-type="originInput">'+"<#if (data.forwardNick)>"+"#L{同时评论给原文作者} "+"<#else>"+"#L{同时评论给} "+"</#if>"+"${data.originNick}</label>"+"</#if>"+"</span>"+'<a href="javascript:void(0);" class="s-btn-g" title="#L{转发}#L{按钮}" onclick="return false;" node-type="submit"'+'<#if (data["suda-data"])>'+'suda-data=${data["suda-data"]}'+"</#if>"+'><span node-type="btnText">#L{转发}</span></a>'+"</div>"+"</div>"+"</div>"+"<#if (data.isDialog == true)>"+'<div node-type="forward_link"></div>'+"</#if>"+"</div>");var f={notice:"",defUpdate:"#L{转发微博}",netError:"#L{系统繁忙}",success:"#L{转发成功}!",retry:'#L{读取失败，请}<a href="#" onclick="return false;" action-type="retry" value="retry">#L{重试}</a>',off:"#L{关闭}",on:"#L{开启}"};var g={limitNum:140,tipText:b(f.notice),count:"disable"};var h=function(a,c){if(c=="normal"){a.innerHTML=b("#L{转发}")}else{a.innerHTML=b("#L{提交中...}")}};return function(i,j,k){if(i==null||j==null){throw new Error("[common.forward.toMicroblog]Required parameter client is missing")}var l=k.data;var m=56;var n=false;var o=l.originNick?"@"+l.originNick:"";var p=a.lib.kit.extra.toFeedText(l.origin.replace(/<[^>]+>/gi,""));l.content=p+"";if(a.bLength(a.core.str.decodeHTML(a.lib.kit.extra.toFeedText(p+o)))>m){l.content=a.leftB(p,m-a.bLength(o))+"...";n=true}else{l.content=l.origin}o='<a href="//weibo.com/'+(l["domain"]||l["rootuid"]||l["uid"])+'" target="_blank">'+o+"</a>:";l.content=o+l.content;var q=l.reason||"";var r=l.forwardNick?"//@"+l.forwardNick+":"+" ":"";var s,t,u,v,w,x,y,z,A,B,C,D,E,F=false,G=false,H,I,J=a.common.forward.utils;var K={};K.client=i;K.opts=k.data||{};K.isInit=false;u=a.parseParam({styleId:"1"},K.opts);a.custEvent.define(K,["forward","hide","center","count"]);var L=function(){if(v){if(w==="error"){a.common.extra.shine(t.textEl)}return}var d=a.trim(s.API.getWords()||"");if(d===b(f.notice)){d=""}v=true;w="loading";t.submit.className="s-btn-g disabled";h(t.btnText,"loading");var e={};e.mid=j;e.reason=d||b(f.defUpdate);e.action_code="11";if(t.originInput&&t.originInput.checked){e.is_comment_base="1";e.action_code="11,31"}if(t.forwardInput&&t.forwardInput.checked){e.is_comment="1";e.action_code="11,31";F=true}e=a.lib.module.getDiss(e,t.submit);c=e;if(J.checkAtNum(d)>5){a.lib.ui.confirm(b("#L{单条微博里面@ 太多的人，可能被其它用户投诉。如果投诉太多可能会被系统封禁。是否继续转发？}"),{OK:function(){x.request(e)},cancel:function(){v=false;w="";t.submit.className="s-btn-g";h(t.btnText,"normal")}});return}x.request(e)};var M=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){s.API.blur();L()}};var N=function(){var a=s.API.count();var c=g.limitNum-a;var d=c>=0?true:false;if(d){v=false;w="";if(d){t.num.innerHTML=b("#L{还可以输入}<strong>"+c+"</strong> #L{字}")}}else{v=true;w="error";t["num"].innerHTML=b('#L{已经超过}<strong class="warn">'+Math.abs(c)+"</strong> #L{字}")}};var O=function(d,e){v=false;w="";c=null;t.submit.className="s-btn-g";h(t.btnText,"normal");try{d.data.isComment=F;d.data.isToMiniBlog=true;a.custEvent.fire(K,"forward",[d.data,e,k.inDialog]);a.common.channel.feed.fire("forward",[d.data,e,k.inDialog])}catch(g){}a.custEvent.fire(K,"hide");a.lib.ui.alert(b(f.success),{type:"succM",timeout:"1000"});F=false;s.API.reset()};var P=function(c,d){v=false;w="";t.submit.className="s-btn-g";h(t.btnText,"normal");c.msg=c.msg||b(f.netError);a.common.layer.ioError(c.code,c);F=false};var Q=function(c,d){v=false;w="";t.submit.className="s-btn-g";h(t.btnText,"normal");a.lib.ui.alert(b(f.netError))};var R=function(){B=a.core.util.storage.get("forward_link_status");if(B=="null"){B="off"}C=B};var S=function(b){if(b==null){throw new Error("[common.forward.toMicroblog]function - setSwitchStatus required parameter sStatus is missing")}y.request({d_expanded:b});a.core.util.storage.set("forward_link_status",b);B=b};var T=function(){A=a.builder(i);A=a.lib.kit.dom.parseDOM(A.list).toMicroblog_client;s=a.common.editor.base(A,g);s.widget(a.common.editor.widget.face(),"smileyBtn");t=s.nodeList;a.addEvent(t.textEl,"focus",function(){H=setInterval(function(){N()},200)});a.addEvent(t.textEl,"blur",function(){clearInterval(H)});var b=a.core.str.decodeHTML(a.lib.kit.extra.toFeedText(q));s.API.insertText(r+b.replace(/(^\s*)|(\s*$)/g,""));a.lib.kit.dom.autoHeightTextArea({textArea:t.textEl,maxHeight:145,inputListener:a.funcEmpty});if(E){};};var U=function(){a.addEvent(t.submit,"click",L);a.addEvent(t.textEl,"keypress",M);if(E){D=a.delegatedEvent(A);D.add("origin_all","click",function(a){t.content.innerHTML=o+l.origin});D.add("report","click",function(b){return a.common.forward.report(b)});D.add("switch","click",function(c){var d={1:"on",2:"off"};var e=d[c.data.id];S(e);a.setStyle(c.el,"left",e=="on"?"23px":"0px");c.el.setAttribute("action-data",e=="on"?"id=2":"id=1");c.el.setAttribute("title",e=="on"?b(f.off):b(f.on))});D.add("retry","click",function(a){});D.add("show","click",function(a){C=a.data.id*1==1?"on":"off"})}};var V=function(){};var W=function(a,b){C=C=="on"?"off":"on";t.forward_link.innerHTML=a.data.html||"";if(t.cmtopts&&a.data.permission&&a.data.permission.allowComment==0){t.cmtopts.style.display="none";t.cmtopts.innerHTML=""}else if(t.originLi&&a.data.permission&&a.data.permission.allowRootComment==0){t.originLi.style.display="none";t.originLi.innerHTML=""}};var X=function(){t.forward_link.innerHTML=b(f.retry)};var Y=function(a,b){C=C=="on"?"off":"on"};var Z=function(){a.lib.ui.alert(b(f.netError))};var _=function(){x=a.common.trans.forward.getTrans("toMicroblog",{onSuccess:O,onError:P,onFail:Q,onTimeout:P});y=a.common.trans.forward.getTrans("setDefault",{onSuccess:Y,onError:Z,onFail:Z});z=a.common.trans.forward.getTrans("detailForwardLinks",{onSuccess:W,onError:X,onFail:X})};var ba=function(){};var bb=function(){R();_();T();U();ba();V()};var bc=function(b){if(K.isInit==false){k.data.isDialog=b;E=b;k.data.showArrow=n;k.data.reason="";a.addHTML(i,a.core.util.easyTemplate(e,k.data));if(!s){bb()}K.isInit=true}else{A&&a.setStyle(A,"display","")}};var bd=function(){a.common.extra.shine(s.nodeList.textEl)};var be=function(){s.API.blur();if(A!=null){a.setStyle(A,"display","none")}};var bf=function(){a.removeEvent(t.submit,"click",L);a.removeEvent(t.textEl,"keypress",M);a.custEvent.undefine(K);D&&D.remove("origin_all","click");D&&D.remove("report","click");D&&D.remove("switch","click");D&&D.remove("retry","click");D&&D.remove("show","click");D=null;d&&d.destroy&&d.destroy();s.closeWidget();H&&clearInterval(H);s=null;t=null;x=null;A=null;for(var b in K){delete K[b]}K=null};K.show=bc;K.hide=be;K.shine=bd;K.destroy=bf;return K}});
STK.register("common.forward.publisher",function(a){var b=a.lib.kit.extra.language;var c=a.common.forward;var d=b(""+"<#et userlist data>"+'<div class="card card-sender"><div node-type="forward_tab" class="tab">'+"<span>#L{转发到}：</span><ul>"+"<#list data.tab as list>"+'<li onclick="return false;" action-type="tab_item" action-data="id=${list.id}"'+"<#if (list.id==data.type)>"+' class="selected"'+"</#if>"+">${list.name}</li>"+"</#list>"+'</ul></div><div node-type="forward_client"></div></div>');var e=[{id:1,name:b("#L{我的微博}")}];return function(f,g){if(f==null){throw new Error("[common.forward.publisher]Required parameter mid is missing")}g=g||{type:1,styleId:"1"};var h={instances:{}};var i=g.type;var j,k;var l,m;var n,o,p=a.lib.kit.extra.toFeedText;var q={1:c.toMicroblog};var r={domInit:false,forwardNick:"",originNick:"",origin:"",reason:"",url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",uid:"",rootuid:"",pid:"",domain:"","suda-data":""};var s=function(){if(g.domInit==false){var b=a.core.util.easyTemplate(d);var c=b({type:i,tab:e,tab_count:e.length}).toString();var f=a.builder(c)}var h=a.lib.kit.dom.parseDOM(f.list);j=h.forward_tab;k=h.forward_client;return f.box};a.custEvent.define(h,["hide","center","forward"]);var t=function(a){if(f==null){throw new Error("[common.forward.publisher]Required parameter inner is missing")}l=a;u(i,{data:g,client:k})};var u=function(c,d){if(o!=null){o.hide()}c=c.toString();var e;if(h.instances[c]==null){var g={},i;for(var j in r){g[j]=d.data[j]}g.type=c;i={client:k,data:g,inDialog:true};if(parseInt(c)!=1){if(i.data.allowForward==="0"){i.data.originNick="";i.data.origin=b("#L{此微博已被原作者删除}")}i.data.reason=p(i.data.reason);i.data.origin=p(i.data.origin)}e=q[c](k,f,i);h.instances[c]=e;a.custEvent.add(e,"hide",function(){a.custEvent.fire(h,"hide")});a.custEvent.add(e,"center",function(){a.custEvent.fire(h,"center")});a.custEvent.add(e,"forward",function(b,c){a.custEvent.fire(h,"forward",c)})}else{e=h.instances[c]}e.show(true);o=e};var v=function(){for(var b in h.instances){var c=h.instances[b];c.destroy();c=null}h.instances=null;a.custEvent.undefine(h);j=null;k=null;l=null;m=null;n&&n.remove("tab_item","click");n=null};h.getDom=s;h.init=t;h.destroy=v;return h}});
STK.register("common.dialog.forward",function(a){var b={title:"#L{转发微博}",commentPerson:"#L{同时评论给}",originPerson:"#L{同时评论给原文作者}",notice:"",defUpdate:"#L{转发微博}"};var c=a.lib.kit.extra.language;return function(d){var e={};var f,g,h;var i;a.custEvent.define(e,["forward","hide","show"]);var j=function(d,j){if(typeof d!=="string"&&typeof d!=="number"){throw new Error("$.common.dialog.forward.show need string (or number) as weiboId")}f=d;if(j.pic){j.pid=j.pic}var l=a.parseParam({type:1,origin:"",reason:"",originNick:"",forwardNick:"",title:c(b.title),domInit:false,url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",pid:"",uid:"",rootuid:"",domain:"","suda-data":""},j);l["suda-data"]=decodeURIComponent(l["suda-data"]);h=a.lib.ui.dialog();h.setTitle(l.title);g=new a.common.forward.publisher(f,l);h.appendChild(g.getDom());h.setBeforeHideFn(function(){g.destroy();h.clearBeforeHideFn()});i=h.getInner();i.style.height="260px";i.style.width="458px";h.show();h.setMiddle();g.init(i);i.style.height="";i.style.width="auto";a.custEvent.add(g,"hide",function(){k()});a.custEvent.add(g,"forward",function(b,c){a.custEvent.fire(e,"forward",c)});a.custEvent.add(h,"hide",function(){var b=h;var c=arguments.callee;a.custEvent.remove(b,"hide",c);h=null;b=null;a.custEvent.fire(e,"hide")});a.custEvent.fire(e,"show",{box:h})};var k=function(){m();h.hide()};var l=function(){h.setMiddle(i)};var m=function(){g.destroy()};e.show=j;e.destroy=m;return e}});
STK.register("common.feed.feedList.plugins.forward",function(a){var b=a.common.feed.feedList.utils;var c=a.common.dialog.forward;var d=a.lib.kit.dom.firstChild;var e=a.lib.kit.extra.language;var f=e("#L{转发}");var g=[];var h={add:function(a){g.push(a)},setFocus:function(){if(g.length===0){return}g.pop().focus()}};return function(f,g){if(!f){a.log("forward : need object of the baseFeedList Class");return}var i=f.getNode();var j={};var k;f.getDEvent().add("feed_list_forward","click",function(f){var g=f.data.allowForward;if(g&&g!=1){a.lib.ui.alert(e('#L{很抱歉，根据相关法规和政策，此微博禁止转发。如需帮助请联系客服}<a href="//weibo.com/weibopiyao" target="_blank">@#L{微博辟谣}</a>#L{或者致电客服电话}400 096 0960 '));return}var j=k=f.el,l;if(l=j.getAttribute("error-msg")){a.lib.ui.alert(l);return b.preventDefault()}var m=b.getMid(j,i);var n=b.getFeedNode(j,i);var o=f.data;o.domain="u/"+(o.uid?o.uid:o.rootuid);var p=a.sizzle('[node-type="feed_list_content"]',n)[0];if(!p){a.log("forward : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return b.preventDefault()}o.originNick=p.getAttribute("nick-name");o.reason=p.innerHTML;var q=a.sizzle('[node-type="feed_list_forwardContent"]',n)[0];if(q){o.forwardNick=o.originNick;o.originNick=d(q).getAttribute("nick-name");var r=a.sizzle('p[node-type="feed_list_content"]',q)[0];if(!r){o.origin=""}else{o.origin=r.innerHTML}}else{o.origin=o.reason;delete o.reason}if(f.data["suda-data"]){o["suda-data"]=f.data["suda-data"]}if(f["suda-data"]){o["suda-data"]=f["suda-data"]}h.add(f.el);c().show(m,o);return b.preventDefault()});j.destroy=function(){a.custEvent.remove(forwardDialog);forwardDialog.destroy();forwardDialog=k=f=i=null};return j}});
STK.register("lib.ui.tipPrototype",function(a){var b=10003;return function(c){var d,e,f,g,h;var i='<div node-type="outer" style="position: absolute; clear: both; display:none;overflow:hidden;z-index:10003;" >'+'<div node-type="inner" ></div>'+"</div>";d=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty},c);e=a.lib.module.layer(i,d);f=e.getOuter();g=e.getInner();e.setTipWH=function(){h=this.getSize(true);this.tipWidth=h.w*1.2;this.tipHeight=h.h;return this};e.setTipWH();e.setContent=function(a){if(typeof a=="string"){g.innerHTML=a}else{g.appendChild(a)}this.setTipWH();return this};e.setLayerXY=function(c){if(!c){throw"ui.tipPrototype need pNode as first parameter to set tip position"}var e=STK.core.dom.position(c);var g=e.l;var h=c.offsetWidth;var i=c.offsetHeight;var j=Math.min(Math.max(g+(h-this.tipWidth)/2,a.scrollPos().left),a.scrollPos().left+STK.winSize().width-this.tipWidth);var k=e.t;if(d.direct==="down"){k+=i}var l=[";"];l.push("z-index:",b++,";");l.push("width:",this.tipWidth,"px;");l.push("height:",this.tipHeight,"px;");l.push("top:",k,"px;");l.push("left:",j,"px;");f.style.cssText+=l.join("")};e.aniShow=function(){var b=this.getOuter();b.style.height="0px";b.style.display="";var c=a.core.ani.tween(b,{end:d.showCallback,duration:250,animationType:"easeoutcubic"});if(d.direct==="down"){c.play({height:this.tipHeight},{staticStyle:"overflow:hidden;position:absolute;"})}else{var e=parseInt(b.style.top,10)-this.tipHeight;c.play({height:this.tipHeight,top:Math.max(e,a.scrollPos().top)},{staticStyle:"overflow:hidden;position:absolute;"})}};e.anihide=function(){var b=this.getOuter();var c=this;var e=a.core.ani.tween(b,{end:function(){b.style.display="none";b.style.height=c.tipHeight+"px";d.hideCallback()},duration:300,animationType:"easeoutcubic"});if(d.direct==="down"){e.play({height:0},{staticStyle:"overflow:hidden;position:absolute;"})}else{var f=parseInt(b.style.top,10)+this.tipHeight;e.play({height:0,top:f},{staticStyle:"overflow:hidden;position:absolute;"})}};document.body.appendChild(f);e.destroy=function(){document.body.removeChild(f);e=null};return e}});
STK.register("lib.ui.tipAlert",function(a){var b=a.core.util.easyTemplate;return function(c){c=a.parseParam({direct:"up",showCallback:a.core.func.empty,hideCallback:a.core.func.empty,type:"ok",msg:""},c);var d=a.lib.ui.tipPrototype(c);var e=d.getInner();var f=d.getOuter();f.className="m-layer";e.className="bg";var g=c.template||"<#et temp data>"+'<div class="m-tips" node-type="msgDiv" >'+'<p><i class="icon-warn icon-${data.type}-s"></i>${data.msg}</p>'+"</div> "+"</#et>";var h=a.builder(b(g,{type:c.type,msg:c.msg}).toString());d.setContent(h.box);var i=d.destroy;d.destroy=function(){i();d=null};return d}});
STK.register("lib.ui.tipConfirm",function(a){return function(b){b=b||{};var c=a.lib.kit.extra.language;var d=a.lib.ui.tipPrototype(b);var e=d.getInner();var f=d.getOuter();f.className="m-layer";e.className="m-tips";b.info=b.info||c("#L{确认要删除这条微博吗？}");b.icon=b.icon||"icon-ques-s";var g=b.template||c('<p node-type="info"><i node-type="icon" class="icon-warn '+b.icon+'"></i>'+b.info+"</p>"+'<div class="btn-box">'+'<a href="javascript:void(0)" node-type="ok" class="s-btn-a">#L{确定}</a>'+'<a href="javascript:void(0)" node-type="cancel">#L{取消}</a>'+"</div>");var h=a.builder(g);d.setContent(h.box);if(!h.list["ok"]){return d}var i=h.list["ok"][0];var j=h.list["cancel"][0];d.setIcon=function(a){h.list["info"].className=a;d.setTipWH()};d.setInfo=function(a){h.list["info"][0].innerHTML='<span node-type="icon" class="'+b.icon+'"></span>'+a;d.setTipWH()};d.cancelCallback=function(){if(a.getType(b.cancelCallback)=="function"){b.cancelCallback()}};d.okCallback=function(){if(a.getType(b.okCallback)=="function"){b.okCallback()}};var k=function(){d.anihide();d.cancelCallback()};var l=function(){d.anihide();d.okCallback()};a.addEvent(j,"click",k);a.addEvent(i,"click",l);var m=d.destroy;d.destroy=function(){a.removeEvent(j,"click",k);a.removeEvent(i,"click",l);m();d=null};return d}});
STK.register("lib.kit.dom.textSelection",function(a){return function(b,c){var d,e;d={};e=a.parseParam({},c);var f=function(c){return a.core.dom.selectText(b,c)};var g=function(){b["__areaQuery"]=a.jsonToQuery(a.core.dom.textSelectArea(b))};var h=function(){b["__areaQuery"]=false};a.addEvent(b,"beforedeactivate",g);a.addEvent(b,"active",h);var i=function(){var c=null;try{c=a.core.dom.textSelectArea(b)}catch(d){c=a.queryToJson(b["__areaQuery"])}if(c.start===0&&c.len===0&&b["__areaQuery"]){c=a.queryToJson(b["__areaQuery"])}c.start=parseInt(c.start,10);c.len=parseInt(c.len,10);return c};var j=function(a,c){var d=b.value;var e=c.start;var f=c.len||0;var g=d.slice(0,e);var h=d.slice(e+f,d.length);b.value=g+a+h;d=null;g=null;h=null;var e=null;var f=null};d.setCursor=function(a){f(a)};d.getCursor=function(){return i()};d.insertCursor=function(a){var b=i();j(a,b);b.len=a.length;f(b)};d.TempletCursor=function(c){var d,e,g;d=i();if(d.len>0){e=b.value.substr(d.start,d.len)}else{e=""}g=a.templet(c,{origin:e});j(g,d);d.start=d.start+c.indexOf("#{origin");d.len=g.length-c.replace(/#\{[origin].+?\}/,"").length;f(d)};d.insertText=j;d.destroy=function(){a.removeEvent(b,"beforedeactivate",g);a.removeEvent(b,"active",h);b=null};return d}});
STK.register("lib.kit.dom.smartInput",function(a){return function(b,c){var d,e,f,g,h;var i,j,k,l,m="stop",n,o,p;var q,r;d=a.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:false,LazyInputDelay:200},c);e=a.cascadeNode(b);h=a.lib.kit.dom.textSelection(b);a.custEvent.define(e,"enter");a.custEvent.define(e,"ctrlEnter");a.custEvent.define(e,"lazyInput");f=function(){if(d["maxLength"]&&a.bLength(b.value)>d["maxLength"]){b.value=a.leftB(b.value,d["maxLength"])}};o=function(){if(b.value===d["notice"]){b.value="";if(d["noticeClass"]!=null){a.removeClassName(b,d["noticeClass"])}}if(d["currentClass"]!=null){a.addClassName(b.parentNode,d["currentClass"])}};p=function(){if(b.value===""){b.value=d["notice"];if(d["noticeClass"]!=null){a.addClassName(b,d["noticeClass"])}}if(d["currentClass"]!=null){a.removeClassName(b.parentNode,d["currentClass"])}};g=function(){f();if(b.value===d["notice"]){return""}return b.value};q=function(b){if(b.keyCode===13){a.custEvent.fire(e,"enter",g())}};r=function(b){if((b.keyCode===13||b.keyCode===10)&&b.ctrlKey){a.custEvent.fire(e,"ctrlEnter",g())}};i=function(){if(m==="stop"){l=setInterval(k,d["LazyInputDelay"]);m="sleep"}};j=function(){clearInterval(l);m="stop"};k=function(){if(n===b.value){if(m==="weakup"){a.custEvent.fire(e,"lazyInput",b.value);m="sleep"}else if(m==="waiting"){m="weakup"}}else{m="waiting"}n=b.value};if(d["needLazyInput"]){a.addEvent(b,"focus",i);a.addEvent(b,"blur",j)}a.addEvent(b,"focus",o);a.addEvent(b,"blur",p);a.addEvent(b,"keyup",f);a.addEvent(b,"keydown",q);a.addEvent(b,"keydown",r);e.getValue=g;e.setValue=function(a){b.value=a;f();return e};e.setNotice=function(a){d.notice=a;return e};e.setNoticeClass=function(a){d.noticeClass=a;return e};e.setNoticeStyle=function(a){d.noticeStyle=a;return e};e.setMaxLength=function(a){d.maxLength=a;return e};e.restart=function(){p()};e.startLazyInput=i;e.stopLazyInput=j;e.setCursor=h.setCursor;e.getCursor=h.getCursor;e.insertCursor=h.insertCursor;e.insertText=h.insertText;e.destroy=function(){if(d["needLazyInput"]){a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p)}j();a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p);a.removeEvent(b,"keyup",f);a.removeEvent(b,"keydown",q);a.removeEvent(b,"keydown",r);a.custEvent.undefine(e,"enter");a.custEvent.undefine(e,"ctrlEnter");a.custEvent.undefine(e,"lazyInput");h.destroy();e=null};return e}});
STK.register("common.favorite.tagSave",function(a){var b=a.lib.kit.extra.language;var c=b("<#et temp data>"+'<div node-type="tagOuter" class="layer_addfavor_tags">'+"<#if (data.tipType&&data.tipInfo)>"+'\t<div class="succes"><span class="icon-warn icon-ok-s icon_${data.tipType}_s"></span>${data.tipInfo}</div>'+"</#if>"+"\t<dl>"+"\t\t<dt>#L{添加标签}：</dt>"+'\t\t<dd><input type="text" class="W_input" node-type="tagsInput" value="${data.lastTags}"/><div class="tipbox"><p class="note1 W_textb">最多2个标签，用空格分隔</p><p class="note W_textb" style="display:none;" node-type="tagsInputTip">#L{每个标签仅限12个字符}</p></div></dd>'+'\t\t<dt node-type="tagListTitle" style="display:none">#L{我的标签}：</dt>'+'\t\t<dd node-type="tagList" style="display:none"></dd>'+"\t</dl>"+'\t<div class="func"><a href="javascript:void(0);" class="S_btn_b" node-type="tagSave"><span>#L{确定}</span></a><label>&nbsp;</label></div>'+"</div>"+"</#et>");var d=b("#L{每个标签仅限12个字符}");var e="W_textb";var f=0;var g=function(b,c){if(b)return c(b);var d=function(a){if(++f==3){f=0;c()}else{g(b,c)}};a.common.trans.favorite.getTrans("tagList",{onSuccess:function(a){f=0;c(a.data.my_tags)},onFail:d,onError:d}).request()};return function(b){var f={};b=a.parseParam({title:"",tipType:"",tipInfo:"",flag:"add",mid:"",lastTags:"",myTags:""},b);if(!b.mid){a.log("common.favorite.tagSave: opts.mid is not defined!");return}a.custEvent.define(f,["success","error","hide"]);var h=a.lib.ui.dialog();h.setTitle(b.title);a.custEvent.add(h,"hide",function(){a.custEvent.fire(f,"hide")});if(/^(success|error)$/.test(b.tipType)){b.tipType=b.tipType=="success"?"ok":"warn"}else{b.tipType="warn"}var i=a.builder(a.core.util.easyTemplate(c,{tipType:b.tipType,tipInfo:b.tipInfo,lastTags:b.lastTags}).toString()).list;var j=i["tagOuter"][0];var k=i["tagsInputTip"][0];var l=i["tagsInput"][0];var m=i["tagListTitle"][0];var n=i["tagList"][0];var o=i["tagSave"][0];var p=function(){var b=l.value.replace(/^\s+?/,"").replace(/(.+)\s\1\s/g,"$1"+" ").replace(/\s{2,}/g," ");if(b.length>0){k.style.display="none"}else{k.style.display=""}var c=a.sizzle(">a",n);if(b==d){for(var f=0;f<c.length;f++){c[f].className=""}return}var g=b.split(" ");g=g.slice(0,2);var h=g.length;for(var f=0;f<g.length;f++){if(!g[f]){h--}g[f]=a.leftB(g[f],12)}g=" "+(l.value=g.join(" "))+" ";if(h>=2){for(var f=0;f<c.length;f++){c[f].className=e}}else{for(var f=0;f<c.length;f++){var i=c[f],j=i.getAttribute("action-data").replace(/^tagName=/,"");if((new RegExp(" "+j+" ")).test(g)){i.className=e}else{i.className=""}}}};l.value=b.lastTags?b.lastTags:d;var q=a.lib.kit.dom.smartInput(l,{notice:d,needLazyInput:true,noticeClass:"W_input_default"});q.on("focus",function(){window.setTimeout(function(){if(l.value==""){k.style.display=""}},0)});q.on("blur",function(){setTimeout(function(){p&&p()},0)});a.custEvent.add(q,"lazyInput",p);var r=a.delegatedEvent(n);r.add("tagItem","click",function(a){if(a.el.className==e)return;var b=a.data;if(l.value==d){l.value=""}l.value+=" "+b.tagName;p()});var s=function(b,c){a.common.trans.favorite.getTrans("alter",{onSuccess:function(b){a.custEvent.fire(f,"success",b);h.hide()},onFail:function(b){a.custEvent.fire(f,"error",b);h.hide()},onError:function(b){a.custEvent.fire(f,"error",b);h.hide()}}).request(a.module.getDiss(b,c.el))};var t=function(a){if(t.entered)return;t.entered=true;var c,e;l.value=l.value.replace(/(.+)\s\1$/g,"$1"+" ");if(b.flag=="add"){if(l.value==d){if(b.lastTags){c={mid:b.mid,tags:""};s(c,a)}h.hide();return}}var f=l.value==d?"":l.value;if(f==b.lastTags){h.hide();return}c={mid:b.mid,tags:f};s(c,a)};a.hotKey.add(l,"enter",t);a.addEvent(o,"click",t);f.show=function(){g(b.myTags,function(a){var b;if(a){m.style.display="";n.style.display="";a=a.split(" ");b=[];for(var c=0;c<a.length;c++){b.push('<a href="javascript:void(0);" action-type="tagItem" action-data="tagName='+a[c]+'">'+a[c]+"</a>")}b=b.join("");n.innerHTML=b;p()}});h.setContent(j);h.show();h.setMiddle();l.focus()};f.hide=function(){h.hide()};f.destroy=function(){a.hotKey.remove(l,"enter",t);a.removeEvent(o,"click",t);a.custEvent.undefine(f);r.destroy();q.destroy();b=i=j=k=l=o=p=null};return f}});
STK.register("lib.module.getDiss",function(a){return function(){var b={},c=0,d={location:$CONFIG["location"]};if(arguments[0]&&!a.core.dom.isNode(arguments[0]))b=arguments[c++];b=a.lib.kit.extra.merge(b,d);if(!arguments[c])return b;b=a.lib.kit.extra.merge(b,a.core.json.queryToJson(a.lib.kit.dom.parentAttr(arguments[c++],"diss-data",arguments[c])||""));return b}});
STK.register("common.favorite.favorite",function(a){var b=a.lib.kit.extra.language;var c=b("#L{成功}!"),d=b("#L{失败}!"),e=b("#L{取消收藏}"),f=b("#L{收藏}"),g,h="",i=b("#L{您已经收藏过此微博}！"),j=b("#L{添加收藏标签}"),k=b("#L{收藏成功!}");var l=function(b,c,d){if(!b)return;g=a.lib.ui.tipAlert({showCallback:function(){setTimeout(function(){g&&g.anihide()},600)},hideCallback:function(){tipOnMid=undefined;g&&g.destroy();g=null},msg:b,type:d?"warn":undefined});g.setLayerXY(c);g.aniShow()};var m,n,o;var p=function(c){return a.lib.ui.tipConfirm({info:b("#L{确认要取消收藏这条微博吗？}"),okCallback:function(){m&&m()},hideCallback:function(){n&&n()}})};var q=function(b,g,h,i){var j=i=="add"?f:e;var k=i=="add"?1:0;a.common.trans.favorite.getTrans(i,{onSuccess:function(d){l(j+c,h);a.custEvent.fire(b,"success")},onFail:function(){l(j+d,h,true);a.custEvent.fire(b,"fail")},onError:function(c){l(c.msg||j+d,h,true);a.custEvent.fire(b,"error",c)}}).request(a.lib.module.getDiss({mid:g,action_code:"17",statuses:k},h))};return function(b){var c={};b=a.parseParam({mid:null,node:null},b);if(!b.mid||!b.node){a.log("opts.mid, opts.node 都不能为空!");return}a.custEvent.define(c,["success","showForward","fail","error","cancel"]);c.add=function(){q(c,b.mid,b.node,"add")};c.del=function(){m=function(){q(c,b.mid,b.node,"del")};n=function(){a.custEvent.fire(c,"cancel")};o=o||p();o.setLayerXY(b.node);o.aniShow()};c.hideTip=function(){g&&g.hide()};c.anihideTip=function(){g&&g.anihide()};c.destroy=function(){g&&g.destroy();a.custEvent.undefine(c);c=b=tagSave=g=o=null};return c}});
STK.register("common.feed.feedList.plugins.favorite",function(a){var b=a.common.feed.feedList.utils;var c=a.lib.kit.extra.language;var d;var e=c("#L{取消收藏}");var f=c("#L{收藏}");var g;var h=function(){var b=a.queryToJson(location.search.slice(1));window.location.href="/fav";return;b.page=1;if($CONFIG["bigpipe"]==="true"&&a.historyM){a.historyM.setQuery(b)}var c=window.location.href};var i=function(b,c,h,i,j,k){g&&g.destroy();g=a.common.favorite.favorite({mid:i,node:c});if(!g){a.log("favoriteObj is undefined!");return}var l=e,m="W_textb",n="";a.custEvent.add(g,"success",function(){if(j&&!k){g&&g.destroy();h.style.height=h.offsetHeight+"px";h.innerHTML="";var b=a.tween(h,{end:function(){b.destroy();a.removeNode(h);c=h=null}}).play({height:0})}else{c.innerHTML=l;c.className=m;c.parentNode.className=n;c.setAttribute("favorite",k?"1":"0")}d=null});a.custEvent.add(g,"fail",function(){d=null});a.custEvent.add(g,"error",function(){d=null});a.custEvent.add(g,"cancel",function(){d=null});if(k){n="";g.add()}else{m="";l=f;g.del()}};var j=function(a,c,e,f,g){var h=c.el,j=b.getMid(h,e),k=b.getFeedNode(h,e);if(d==j)return;d=j;var l=h.getAttribute("favorite")!="1";i(a,h,k,j,f,l)};return function(c,d){if(!c){a.log("favorite : need object of the baseFeedList Class");return}d=a.parseParam({isFavoritePage:false},d);var e=c.getNode();var f={};a.custEvent.define(f,"showForward");c.getDEvent().add("feed_list_favorite","click",function(g){a.custEvent.fire(c,"clearTips","favorite");j(c,g,e,d.isFavoritePage,f);return b.preventDefault(g.evt)});f.hideTip=function(a){g&&(a?g.hideTip():g.anihideTip())};f.destroy=function(){g&&g.destroy()};return f}});
STK.register("lib.kit.extra.setPlainHash",function(a){return function(b){try{var c=window.$CONFIG;if(c&&c["bigpipe"]==="true"&&a.historyM){a.historyM.setPlainHash(b)}else{window.location.hash=b}}catch(d){}}});
STK.register("lib.kit.dom.dir",function(a){return function(b,c){c=a.parseParam({dir:"parentNode",expr:undefined,endpoint:document,maxLength:1},c);var d=c.dir,e=c.expr,f=c.endpoint,g=c.maxLength;if(!b||!e){a.log("kit dir: node or opts.expr is undefined.");return}var h=[],i=b[d];while(i){if(i.nodeType==1&&a.sizzle(e,null,null,[i]).length>0){h.push(i);if(h.length==g){break}}if(i==f){break}i=i[d]}return h}});
STK.register("lib.kit.dom.parents",function(a){return function(b,c){c=a.parseParam({expr:undefined,endpoint:document,maxLength:1},c);var d=c.expr;if(!b||!d){a.log("kit parents: node or opts.expr is undefined.");return}return a.lib.kit.dom.dir(b,c)}});
STK.register("common.trans.comment",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("reply",{url:"/Ajax_Comment/reply",method:"get"});c("smallList",{url:"/Ajax_Comment/small",method:"get"});c("add",{url:"/Ajax_Comment/add",method:"post"});c("delete",{url:"/Ajax_Comment/del",method:"post"});c("hotChange",{url:"/aj/comment/hotchange"});c("privateSetting",{url:"/ajax/account/setcommentprivacy",method:"post"});c("privateNoMore",{url:"/ajax/bubble/closebubble",method:"get"});c("isComment",{url:"/ajax/comment/privacy",method:"get"});c("getIn",{url:"/ajax/commentbox/in",method:"get"});c("getOut",{url:"/ajax/commentbox/out",method:"get"});c("getComment",{url:"/ajax/at/comment/comment",method:"get"});c("dialogue",{url:"/ajax/comment/conversation",method:"get"});return b});
STK.register("common.comment.inter",function(a){var b=null,c=function(){},d=a.lib.ui.alert,e,f=a.common.comment.privateSetting,g=a.lib.kit.extra.language;var h=function(b,c){if(b&&b.code){if(b.code!="100000"&&b.code!="100005"){a.common.layer.ioError(b.code,b)}c(b)}};return function(f,i){e=a.common.dialog.validateCode();var j={},k=0,l=a.common.trans.comment;f=a.parseParam({delete_success:c,delete_fail:c,delete_error:c,add_success:c,add_fail:c,add_error:c,smallList_success:c,smallList_fail:c,smallList_error:c,reply_success:c,reply_fail:c,reply_error:c},f||{});j.conf=a.parseParam({act:b,mid:b,cid:b,uid:$CONFIG.uid,page:b,forward:b,isroot:b,content:b,type:b,is_block:b,appkey:b},i);j.merge=function(b){b=a.lib.kit.extra.merge(j.conf,b);return a.core.obj.clear(b)};j.request=function(b,c,i){if(k){return}k=1;var m=j.merge(c);var n=l.getTrans(b,{onComplete:function(c,j){if(b=="add"){var l={onSuccess:function(a,c){h(a,function(a){f[b+(a.code=="100000"?"_success":"_fail")](a,m)})},onError:function(c,e){f[b+"_error"](c,m);if(c.code=="100005"){d(g("#L{由于对方隐私设置，你无法进行评论。}"),{textSmall:g("#L{绑定手机后可以更多地参与评论。}")+'<a href="//account.weibo.com/settings/mobile" target="_blank">'+g("#L{立即绑定}")+"</a>"});return}a.common.layer.ioError(c.code,c)},param:m,requestAjax:n,onRelease:function(){i&&i["onRelease"]&&i["onRelease"]()}};e.validateIntercept(c,j,l)}else{h(c,function(a){if(a.code=="100000"){f[b+"_success"](a,m)}else{var c=f[b+"_fail"];if(typeof c==="function"){f[b+"_fail"](a,m)}else{f[b+"_success"](a,m)}}})}k=0},onFail:function(){k=0}});n.request(m)};j.load=function(a){j.request("smallList",a)};j.reply=function(a){j.request("reply",a)};j.del=function(a){a.action_code="32";j.request("delete",a)};j.post=function(a,b){if(a.act=="reply"){if(a.forward==1){a.action_code="35,11"}else{a.action_code="35"}}else{if(a.forward==1){a.action_code="31,11"}else{a.action_code="31"}}j.request("add",a,b)};e.addUnloadEvent();return j}});
STK.register("common.comment.reply",function(a){var b=a.lib.kit.extra.language,c=a.common.trans.comment,d=a.core.dom.setStyle,e=a.core.dom.getStyle,f=a.core.evt.preventDefault,g=a.lib.kit.extra.setPlainHash;var h=[];var i={};var j={reply:b("#L{回复}"),alert:b("#L{写点东西吧，评论内容不能为空哦。}"),success:b("#L{评论成功}"),block:b("#L{同时将此用户加入黑名单}")};var k=new RegExp(["^",j["reply"],"@([^:]*):"].join(""));var l=function(a,c){if(c=="normal"){a.innerHTML=b("#L{发送}")}else{a.innerHTML=b("#L{提交中...}")}};var m=function(b,c){var e={},f,g,h,i,m,n,o,p,q,r,s,t,u,v,w,x;a.custEvent.define(e,["reply"]);var y=a.core.evt.delegatedEvent(b);var z={add_success:function(c){x=0;m.className="S_btn_b btn_noloading";l(o,"normal");f.API.reset();f.API.insertText(s);f.API.blur();d(b,"display","none");c.forward=p;a.custEvent.fire(e,"reply",[c]);a.lib.ui.litePrompt(j.success,{type:"succM",timeout:"500"})},add_fail:function(a){x=0;m.className="S_btn_b btn_noloading";l(o,"normal")},add_error:function(a){x=0;m.className="S_btn_b btn_noloading";l(o,"normal")}};var A=function(b){if(x){return}x=1;a.core.evt.preventDefault();p=h.checked?1:0;q=a.core.str.trim(i.value);t=q.match(k);if(q==s||q==""){a.lib.ui.alert(j.alert,{OK:function(){x=0}})}else{if(!t||!t[1]||t[1]!=r){c.cid=r=null}q=a.leftB(q,280);c.content=q;u=a.module.getDiss(a.lib.kit.extra.merge(c,{act:"reply",content:q,forward:p,isroot:0}),b.el);if(b&&b.el){b.el.className="W_btn_a_disable"}else{m&&(m.className="W_btn_a_disable")}l(o,"loading");g=a.common.comment.inter(z,u);g.post(u)}};h=a.sizzle('[node-type="forward"]',b)[0];i=a.sizzle('[node-type="textEl"]',b)[0];m=a.sizzle('[action-type="doReply"]',b)[0];o=a.sizzle('[node-type="btnText"]',b)[0];m.setAttribute("action-data",w);r=c.content;s=[j.reply,"@",r,":"].join("");f=a.common.editor.base(b,{count:"disable"});f.widget(a.common.editor.widget.face(),"smileyBtn");v=f.API.getWords();if(v==""){f.API.insertText(s)}else{f.API.insertText("")}y.add("doReply","click",A);a.core.evt.hotKey.add(b,["ctrl+enter"],A);a.lib.kit.dom.autoHeightTextArea({textArea:i,maxHeight:9999,inputListener:function(){var b=a.trim(i.value);if(a.bLength(b)>280){i.value=a.leftB(b,280)}}});e.focus=function(){f.API.insertText("")};return e};var n=function(b,c){var d=a.core.arr.indexOf(b,h);if(!i[d]){h[d=h.length]=b;i[d]=m(b,c)}return i[d]};return function(b,c){if(!c||!c.mid){a.log("common/comment/reply.js-------mid is not defined")}return n(b,c)}});
STK.register("common.dialog.commentDialogue",function(a){var b=a.lib.kit.extra.language;var c={TITLE:b("#L{查看对话}"),FRAME:b(""+'<div class="detail layer_comments_list">'+'<div node-type="more" class="more_list W_linkb"></div>'+'<div node-type="repeat_list" class="feed_list"></div>'+"</div>"),MOREAREA:{LOADING:b('<div><i class="W_loading S_loading"></i><span>&nbsp;#L{加载中...}</span></div>'),DELETEED:b("#L{回复记录中部分评论已被原作者删除。}"),RETRY:b('#L{加载失败，请}<a action-type="older" href="javascript:void(0)" onclick="return false;">#L{重试}</a>#L{。}'),DEFAULT:b('<a action-type="older" href="javascript:void(0)" onclick="return false;"><span class="more_arrow">&laquo;</span>#L{查看更早的评论}</a>')}};var d={unReply:b('#L{由于用户设置，你无法回复评论。}<br><a href="//account.weibo.com/settings/mobile" target="_blank">#L{绑定手机}</a>#L{后可以更多地参与评论。}'),unPower:b("#L{由于用户设置，你无法回复评论。}")};var e=a.common.trans.comment;var f=a.ui.dialog({isHold:true});var g=null,h=null,i=a.common.trans.comment;return function(){var b,j,k,l,m,n,o,p=false,q=true,r=false,s=[];var t=function(){f.setTitle(c.TITLE);f.setContent(c.FRAME);var b=f.getInner();o=a.lib.kit.dom.parseDOM(a.builder(b).list);o.outer=f.getOuter();o.inner=b;u();p=true};var u=function(){n=a.core.evt.delegatedEvent(o.outer);n.add("older","click",b.getDialogueList);n.add("replycomment","click",v.show);a.custEvent.add(f,"hide",b.reset)};var v={show:function(b){var c=b.el;if(a.core.dom.hasClassName(c,"unclick_rep")){if(g){g.anihide&&g.anihide();g.destroy&&g.destroy();g=null}var e=c.getAttribute("isPhone");if(e){g=a.ui.tipAlert({msg:d.unReply,type:"warn"})}else{g=a.ui.tipAlert({msg:d.unPower,type:"warn"})}g.setLayerXY(c);g.aniShow();h&&window.clearTimeout(h);h=window.setTimeout(function(){g.anihide&&g.anihide();g.destroy&&g.destroy();g=null},3e3);return}if(b.data&&b.data.ispower=="1"){console.log(2);i.getTrans("isComment",{onComplete:function(e){if(e.code=="100000"){v.showReply(b)}else{if(g){g.anihide&&g.anihide();g.destroy&&g.destroy();g=null}if(e.code=="100022"){g=a.ui.tipAlert({msg:d.unPower,type:"warn"})}else if(e.code=="100001"){c&&c.setAttribute("isphone","1");g=a.ui.tipAlert({msg:d.unReply,type:"warn"})}else{g=a.ui.tipAlert({msg:e.msg,type:"warn"})}g.setLayerXY(c);g.aniShow();a.addClassName(c,"unclick_rep");h&&window.clearTimeout(h);h=window.setTimeout(function(){g.anihide&&g.anihide();g.destroy&&g.destroy();g=null},3e3)}f.setMiddle()}}).request(b.data)}else{v.showReply(b)}f.setMiddle();return a.preventDefault(b.evt)},showReply:function(b){var c=b.el,d,e,f;while(c.tagName.toLowerCase()!="dl"){c=c.parentNode}d=a.sizzle('[node-type="commentwrap"]',c)[0];var g=b.el;e=g.getAttribute("status");if(a.core.dom.getStyle(d,"display")!="none"&&e=="true"){g.setAttribute("status","false");a.core.dom.setStyle(d,"display","none")}else{g.setAttribute("status","true");a.core.dom.setStyle(d,"display","");if(f){f.focus()}}if(!e){f=a.common.comment.reply(d,b.data);v.funcs.add(f)}},reply:function(b,c){a.common.channel.feed.fire("reply",{obj:b,ret:c});c["data"]&&c.data["content"]&&v.newDialogue(c.data.content)},newDialogue:function(b){a.core.dom.insertHTML(a.lib.kit.dom.firstChild(o.repeat_list),b,"beforeend")},funcs:{add:function(b){var c=v.funcs.get(b);if(!s[c]){s.push(b);a.custEvent.add(b,"reply",v.reply)}},remove:function(b){if(s[b]){a.custEvent.remove(b);s[b]=null;delete s[b]}},get:function(a){var b,c=false;for(var d=0;d<s.length;d++){var e=s[d];if(e==a){b=d;c=true;break}}return b},destroy:function(){for(var a=0;a<s.length;a++){v.funcs.remove(a)}}}};b={show:function(a){!p&&t();q=true;j=a.data["cid"];k=a.data["ouid"];l=a.data["cuid"];m=a.data["type"]||"small";b.display();b.getDialogueList()},getCid:function(){var c=false,d=a.lib.kit.dom.firstChild(o.repeat_list);if(d){var c=d.getAttribute("cid")}if(c){j=c;b.moreArea.show()}else{b.moreArea.hide()}},getDialogueList:function(){var a={cid:j,type:m,ouid:k,cuid:l};q&&(a.is_more=1);if(!r){b.loading.start();e.getTrans("dialogue",{onComplete:function(a){b.loading.end();if(a.code=="100000"){a["data"]&&a.data["html"]&&b.addContent(a.data.html);q=false;b.getCid();b.moreArea.setContent(a.msg?a.msg:c.MOREAREA.DEFAULT)}else if(a.code=="100001"){b.moreArea.setContent(c.MOREAREA.RETRY);b.moreArea.show()}else if(a.code=="100011"){b.moreArea.setContent(c.MOREAREA.DELETEED);b.moreArea.show()}f.setMiddle()}}).request(a)}},loading:{start:function(){r=true;b.moreArea.setContent(c.MOREAREA.LOADING)},end:function(){r=false;b.moreArea.setContent(c.MOREAREA.DEFAULT)}},addContent:function(b){a.core.dom.insertHTML(o.repeat_list,b,"afterbegin")},moreArea:{show:function(){a.setStyle(o.more,"display","")},hide:function(){a.setStyle(o.more,"display","none")},setContent:function(a){o.more.innerHTML=a}},display:function(){b.clear();f.show();f.setMiddle();a.setStyle(o.outer,"top",parseInt(a.getStyle(o.outer,"top"))-30+"px")},clear:function(){o.repeat_list.innerHTML=""},reset:function(){q=true;b.moreArea.show();b.clear();v.funcs.destroy()},destroy:function(){b=null;v=null;v.funcs.destroy();h&&window.clearTimeout(h);g&&g.anihide&&g.anihide();g&&g.destroy&&g.destroy();g=null}};return b}});
STK.register("common.comment.comment",function(a){var b=a.lib.kit.extra.setPlainHash;var c=[],d={},e=a.lib.ui.alert,f=a.lib.kit.extra.language,g=a.custEvent,h=g.fire;var i=null,j=null;var k=a.common.trans.comment;var l={content:f("#L{写点东西吧，评论内容不能为空哦。}"),"delete":f("#L{确定要删除该回复吗}"),reply:f("#L{回复}"),blcok:f("#L{同时将此用户加入黑名单}"),unReply:f('#L{由于用户设置，你无法回复评论。}<br><a href="//account.weibo.com/settings/mobile" target="_blank">#L{绑定手机}</a>#L{后可以更多地参与评论。}'),unPower:f("#L{由于用户设置，你无法回复评论。}")};var m=function(b,c){var d,m,n,o,p,q,r,s,t,u,v,w,x=new RegExp(["^",l["reply"],"@([^:]*):(.*)"].join("")),y="",z=a.core.str;var A=c["isMain"];var B=function(g){q=a.sizzle("textarea",g.el.parentNode.parentNode.previousElementSibling)[0];var h=a.trim(q.value),i=h.match(x);if(h==""||i&&a.trim(i[2])==""){e(l["content"]);return}if(!i||!i[1]||i[1]!=p){o=p=null}if(g&&g.el){g.el.className="s-btn-a disable";g.el.innerHTML="";var j=a.builder('<i class="s-loading"></i><span>'+f("#L{评论中...}")+"</span>");g.el.appendChild(j.box)}else{a.sizzle('[action-type="post"]',b)[0].className="s-btn-a";a.sizzle('a[node-type="btnText"]',b)[0].innerHTML=f("#L{评论}")}y=g.data.ouid;d.post(a.lib.module.getDiss({act:!!i?"reply":"post",cid:o,content:z.leftB(h,280),isroot:s&&s.checked?"1":"0",forward:r&&r.checked?"1":"0",appkey:c.appkey,pageid:g.data.pageid?g.data.pageid:"",dom:a.sizzle('a[node-type="btnText"]',b),ouid:y},g.el),{onRelease:function(){if(g&&g.el){g.el.className="s-btn-a disable";g.el.innerHTML="";var c=a.builder('<i class="s-loading"></i><span>'+f("#L{评论中...}")+"</span>");g.el.appendChild(c.box)}else{a.sizzle('[action-type="post"]',b)[0].className="s-btn-a";a.sizzle('a[node-type="btnText"]',b)[0].innerHTML=f("#L{评论}")}}})};a.core.evt.hotKey.add(b,["ctrl+enter"],B);var C=a.core.evt.delegatedEvent(b);C.add("check","keyup",function(b){var c=a.sizzle('a[action-type="post"]',b.el.parentNode.nextElementSibling),d,e;var f=a.trim(b.el.value),g=f.match(x);if(f==""||g&&a.trim(g[2])==""){e=false}else{e=true}if(c.length!=0){d=c[0];d.className=e?"s-btn-a":"s-btn-a disable"}});C.add("post","click",B);C.add("reply","click",function(c){var d=c.el;q=a.sizzle("textarea",b)[0];if(a.core.dom.hasClassName(d,"unclick_rep")){if(i){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null}var e=d.getAttribute("isPhone");if(e){i=a.lib.ui.tipAlert({msg:l.unReply,type:"warn"})}else{i=a.lib.ui.tipAlert({msg:l.unPower,type:"warn"})}i.setLayerXY(d);i.aniShow();j&&window.clearTimeout(j);j=window.setTimeout(function(){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null},3e3);return}if(c.data&&c.data.ispower=="1"){k.getTrans("isComment",{onComplete:function(b){if(b.code=="100000"){var e,f,g;if((e=c.data)&&(f=e.nick)){g=[l["reply"],"@",f,":"].join("");o=e["cid"];p=f;if(q){q.value=g;setTimeout(function(){a.lib.kit.extra.textareaUtils.selectText(q,g.length,g.length);q.setAttribute("range",g.length+"&0")},30)}}}else{if(i){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null}if(b.code=="100022"){i=a.lib.ui.tipAlert({msg:l.unPower,type:"warn"})}else if(b.code=="100001"){d&&d.setAttribute("isphone","1");i=a.lib.ui.tipAlert({msg:l.unReply,type:"warn"})}else{i=a.lib.ui.tipAlert({msg:b.msg,type:"warn"})}i.setLayerXY(d);i.aniShow();a.addClassName(d,"unclick_rep");j&&window.clearTimeout(j);j=window.setTimeout(function(){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null},3e3)}}}).request(c.data)}else{var f,g,h;if((f=c.data)&&(g=f.nick)){h=[l["reply"],"@",g,":"].join("");o=f["cid"];p=g;y=f["ouid"];if(q){q.value=h;setTimeout(function(){a.lib.kit.extra.textareaUtils.selectText(q,h.length,h.length);q.setAttribute("range",h.length+"&0")},30)}}}});C.add("delete","click",function(b){var c=b.data["block"];var e=b.data["block"]?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',l["blcok"],"</label>"].join(""):"";var f=a.lib.ui.confirm(l["delete"],{OK:function(a){var c=a["block_user"];var e,f;if((e=b.data)&&(f=e.cid)){d.del({act:"delete",cid:f,is_block:c?"1":"0"})}},textComplex:e})});var D=a.common.dialog.commentDialogue();C.add("commentDialogue","click",D.show);a.common.channel.feed.register("reply",function(a){E(a.ret)});var E=function(b){var c=b.data;if(!c){return false}o=p=null;n+=1;typeof A=="undefined"&&c["comment"]&&t&&a.insertHTML(t,c.comment,"afterend");h(m,"count",n);h(m,"comment",{count:n,html:c.comment});if(c["feed"]){h(m,"feed");a.common.channel.feed.fire("forward",{html:c.feed})}F.changeSubmitBtn();return true};var F={changeSubmitBtn:function(){var c=a.sizzle("a[node-type='btnText']",b)[0];var d=a.sizzle("a[action-type='post']",b)[0];d.className="s-btn-a";c.innerHTML=f("#L{评论}")},add_success:function(a,b){if(E(a)){q.value="";q.focus()}},add_fail:function(){F.changeSubmitBtn()},add_error:function(){F.changeSubmitBtn()},delete_success:function(c,d){n=Math.max(n-1,0);h(m,"count",n);var e=a.sizzle(["div[comment_id=",d.cid,"]"].join(""),b)[0];e&&e.parentNode.removeChild(e);h(m,"del",{commont_id:d.cid})},delete_fail:function(a,b){},checkIsEmpty:function(){var c=new RegExp(["^",l["reply"],"@([^:]*):(.*)"].join(""));var d=a.sizzle('a[action-type="post"]',b)[0];var e=a.trim(q.value),f=e.match(c);if(d){if(e==""||f&&a.trim(f[2])==""){!a.hasClassName(d,"disable")&&a.addClassName(d,"disable")}else{a.hasClassName(d,"disable")&&a.removeClassName(d,"disable")}}},smallList_success:function(c,d){var e=c.data;if(!e){return}if(d.smartFlag){var f=STK.core.dom.prev(b);var g=a.builder(e.html);var i=a.sizzle('[node-type="feed_list_smartContent"]',f);if(i.length>0){var j=i[0].cloneNode(true);a.core.dom.insertBefore(j,g.list.commentList[0])}f.style.display="none";b.style.display="";b.innerHTML="";b.appendChild(g.box)}else{e["html"]&&(b.innerHTML=e.html)}h(m,"count",[n=e.count*1||0]);q=a.sizzle("textarea",b)[0];setTimeout(function(){q&&a.lib.kit.dom.autoHeightTextArea({textArea:q,maxHeight:9999,inputListener:function(){var b=a.trim(q.value);if(z.bLength(b)>280){q.value=z.leftB(b,280)}}})},25);r=a.sizzle("input[name=forward]",b)[0];s=a.sizzle("input[name=isroot]",b)[0];t=a.sizzle("div[node-type=commentList]",b)[0];var k={count:"disabled"};if(q){u=a.common.editor.base(b,k);u.widget(a.common.editor.widget.face(),"smileyBtn");w=setInterval(function(){F.checkIsEmpty()},200);d.focus&&a.core.dom.selectText(q,{start:0});d.focus&&q.focus()}}};d=a.common.comment.inter(F,c);m=g.define(d,["count","feed","comment","del"]);d.destroy=function(){u&&u.closeWidget();j&&window.clearTimeout(j);w&&clearInterval(w);i&&i.anihide&&i.anihide();i&&i.destroy&&i.destroy();i=null};return d};var n=function(b,e){var f=a.core.arr.indexOf(b,c);if(!d[f]){c[f=c.length]=b;d[f]=m(b,e)}return d[f]};return function(a,b){if(!a||!a.mid){throw"mid is not defined"}var c=n(b,a);if(b.firstChild&&a.smartFlag==false){b.innerHTML="";b.style.display="none"}else{if(a){a["act"]="list";c.load(a);if(!a.smartFlag){b.style.display=""}}}return c}});
STK.register("lib.kit.extra.require",function(a){var b=window.$CONFIG||{};var c="loaded",d="waiting",e="loading";var f={},g={},h=[],i=[],j=false;var k={maxLine:4,maxRetryTimes:1,baseURL:"https://js.t.sinajs.cn/t4/",version:b["version"],timeout:3e4,urlRule:null};var l=function(a){var b={},c;for(var d=a.length;d--;){c=a[d];if(b[c]){return false}b[c]=1}return true};var m=function(a){var b=/^http[s]?:\/\//ig;return b.test(a)};var n=function(b){var c=a.core.arr.indexOf(b,i);if(c!==-1){return i.splice(c,1)}return false};var o=function(a){if(typeof k["urlRule"]==="function"){return k["urlRule"](k["baseURL"],a,k["version"])}else{a=a.replace(/\./ig,"/");return k["baseURL"]+"apps/search/js/"+a+".js?version="+k["version"]}};var p=function(b){i.push(b);g[b].state=e;var h=function(){var a=g[b].depeKeys,d,e,h;n(b);g[b].state=c;j&&s();for(var i=a.length;i--;){e=a[i];d=f[e];d.unReadyNum-=1;if(d.unReadyNum){return}while(f[e].bindFuns.length){h=d.bindFuns.shift();h["func"].apply({},[].concat(h["data"]))}}};var l=function(){var a=g[b],c,e,h,i;n(b);a.state=d;if(a.retry<k["maxRetryTimes"]){a.retry+=1;return p(b)}j&&s();e=a.depeKeys;for(var l=e.length;l--;){h=e[l];c=f[h];while(c.timeoutFuns.length){i=c.timeoutFuns.shift();i.call({},h)}}};a.core.io.scriptLoader({url:m(b)?b:o(b),timeout:k["timeout"],onComplete:h,onTimeout:l})};var q=function(b,c,e,h){var i=f[b];if(!i){a.log("[STK.kit.extra.require]: The depend "+b+" is undefined!")}if(!i["unReadyNum"]){a.log("依赖关系已加载完成："+b);return c.apply({},[].concat(e))}i["bindFuns"].push({func:c,data:e});if(h&&typeof h["onTimeout"]==="function"){i["timeoutFuns"].push(h["onTimeout"])}for(var j=i["urlList"].length;j--;){aUrl=i["urlList"][j];if(g[aUrl].state===d){g[aUrl].retry=0;p(aUrl)}}};var r=function(b,e,i){(function(){if(a.requirePathMapping){var b=[];for(var c=0,d=e.length;c<d;c++){if(a.requirePathMapping[e[c]]){var f=e[c].split(".");f[f.length-1]=f[f.length-1]+"_"+a.requirePathMapping[e[c]];e[c]=f.join(".");f=null}}}})();if(f[b]!==undefined){a.log("[STK.kit.extra.require]: "+b+" has been registered!")}if(!l(e)){a.log("[STK.kit.extra.require]: The depend URLs is not unique! The depes is ["+e+"]")}var j,k=0;i=a.parseParam({activeLoad:false},i||{});for(var m=e.length;m--;){j=e[m];if(!g[j]){g[j]={depeKeys:[b],state:d,retry:0};i["activeLoad"]&&h.push(j)}else{g[j].depeKeys.push(b);if(g[j].state===c){k+=1}}}f[b]={urlList:e,bindFuns:[],timeoutFuns:[],unReadyNum:e.length-k};return f[b]};var s=function(){if(!h.length){j=false;return}j=true;var a=k["maxLine"]-1-i.length,b;while(a>0&&h.length){b=h.shift();if(g[b].state===d){p(b);a-=1}}};var t=function(b){k=a.core.json.merge(k,b)};var u=function(a,b,c){if(typeof b!=="function"){throw'[STK.kit.extra.require]: The "func" musts be a Function!'}return function(d){q(a,b,[].slice.call(arguments),c)}};q.bind=u;q.config=t;q.register=r;q.activeLoad=s;return q});
STK.register("common.depand.feed",function(a){var b=a.lib.kit.extra.require;b.register("asyn_forward",["common.dialog.forward"],{activeLoad:true});b.register("asyn_comment",["common.comment.comment"],{activeLoad:true});b.register("asyn_addtag",["common.dialog.addTag"],{activeLoad:true});b.register("external_group4weibo_groupsfeed",[$CONFIG["jsPath"]+"apps/group4weibo/js/feed.js?version="+$CONFIG["version"]]);b.register("external_chosen_groupsfeed",[$CONFIG["jsPath"]+"apps/chosen/js/apps/chosen/home/homeChosen.js?version="+$CONFIG["version"]]);b.register("asyn_commentDialogue_tip",["common.dialog.commentDialogueTip"]);return b});
STK.register("common.trans.weiboDetail",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("delete",{url:"/ajax/comment/del",method:"post"});c("deleteWeibo",{url:"/aj/mblog/del",method:"post"});c("delmblog",{url:"/ajax/mblog/del",method:"post"});c("feedlist",{url:"/ajax/comment/big",method:"get"});c("forward",{url:"/ajax/mblog/info/big",method:"get"});c("mediaShow",{url:"//api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("qingShow",{url:"//api.t.sina.com.cn/widget/show.json?source=3818214747",varkey:"callback",method:"get",requestMode:"jsonp"});c("widget",{url:"/ajax/mblog/showinfo",method:"post"});c("third_rend",{url:"/ajax/mblog/renderfeed",method:"post"});return b});
STK.register("lib.kit.extra.parseURL",function(a){return function(){return STK.historyM&&STK.historyM.parseURL?STK.historyM.parseURL():a.core.str.parseURL(location.href)}});
STK.register("common.content.weiboDetail.utils",function(a){return function(){var b=a.core.evt.preventDefault,c=a.lib.kit.extra.language,d=a.lib.kit.dom.firstChild,e=a.lib.kit.dom.parentAttr,f=a.core.util.getUniqueKey,g=a.core.dom.uniqueID,h=a.core.dom.sizzle,i=a.core.dom.next,j=40,k=450,l=c("#L{加载失败}!"),m=c("#L{很抱歉，该内容无法显示，请稍后再试。}"),n,o,p=a.lib.kit.dom.fix,q=a.core.util.easyTemplate,r=a.common.feed.feedList.feedTemps,s=a.core.dom.hasClassName,t=a.core.dom.addClassName,u=a.core.dom.removeClassName,v=a.common.trans.weiboDetail.getTrans,w=a.module.rotateImage,x=a.lib.kit.extra.toFeedText,y=a.lib.kit.extra.parseURL().url,z=$CONFIG["imgPath"]+"/style/images/common/loading.gif",A,B={mediaVideoMusicTEMP:c("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<p class="W_no_border"><a href="${data.short_url}" title="${data.short_url}" class="show_big" target="_blank">${data.title}</a></p>'+'<div node-type="feed_list_media_big${data.type}Div" style="text-align:center;min-height:18px;"><img class="loading_gif" src="'+z+'"/></div>'+"<#if (data.notForward)></dd></#if>"+"</#et>"),widgetTEMP:c("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<p class="W_no_border"><#if (!data.notForward)><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i></#if><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank">${data.title}</a></p>'+'<div node-type="feed_list_media_widgetDiv"><img class="loading_gif" src="'+z+'"/></div>'+"<#if (data.notForward)></dd></#if>"+"</#et>"),qingTEMP:c("<#et temp data>"+'<#if (data.notForward)><dd class="expand"></#if>'+'<p class="W_no_border"><#if (!data.notForward)><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract">#L{收起}</a><i class="W_vline">|</i></#if><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank">${data.title}</a></p>'+'<div node-type="feed_list_media_qingDiv"><img class="loading_gif" src="'+z+'"/></div>'+"<#if (data.notForward)></dd></#if>"+"</#et>")};var C={getMid:function(a,b){return a.mid||(a.mid=e(a,"mid",b))},getFeedNode:function(a){while(a.tagName.toLowerCase()!="dl"){a=a.parentNode}return a},preventDefault:function(a){b(a);return false},tabSwitch:function(a,b,c,d){var e=a.parentNode,f=false,g=c.split(" "),i;if(d){var j=a.getAttribute("action-type"),k=a.getAttribute("action-data");var l=j==="forword_tab_click"&&(k==="privatemsg"||k==="microgroup");d.feed_list.style.display=l?"none":"";d.feed_cate.style.display=l?"none":""}if(!s(a,b)){i=h("."+b,e)[0];for(var m=0;m<g.length;m++){u(i,g[m])}t(a,c);f=true}a.blur();return f},getMediaPDNodes:function(b,c){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle((c?"dd":"dl")+'[node-type="feed_list_media_disp"]',b)[0]}},smallImgFun:function(b){var c=b.el;var d=C.preventDefault(b.evt);if(c.loading){return d}if(c.tagName.toLowerCase()!=="img"){c=a.sizzle("img",c)[0]}c.loading=1;var e=c.src.replace("/thumbnail/","/bmiddle/");var g=c.src.replace("/thumbnail/","/large/");var h=C.getFeedNode(c);var i=h.getAttribute("isForward")?1:"";var j,l;if(!h){a.log("parents attribute mid node is undefined!");return d}h.isForward=i;var m=C.getMediaPDNodes(h,i);if(!m||!m.prev||!m.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return d}var n=function(){c.loading=0;if(j){c.bigImgWidth=j.width;j.onload=null}l&&(l.style.display="none");m.prev.style.display="none";m.disp.innerHTML="";m.disp.appendChild(a.builder(q(r.mediaIMGTEMP,{notForward:!i,uniqueId:f(),bigSrc:e,largeSrc:g,bigWidth:c.bigImgWidth>k?k:c.bigImgWidth,suda:{retract:"key=feed_image_click&value=image_zoomout",showBig:"key=feed_image_click&value=image_open",left:"key=feed_image_click&value=image_turnlift",right:"key=feed_image_click&value=image_turnright",big:"key=feed_image_click&value=image_zoomout"}}).toString()).box);m.disp.style.display=""};if(c.bigImgWidth){n()}else{var o=c.offsetWidth;var p=parseInt(c.offsetHeight/2-8);(l=a.core.dom.next(c)).style.cssText="margin:"+p+"px "+parseInt(o/2-8)+"px "+p+"px -"+parseInt(o/2+8)+"px;";l.style.display="";(j=new Image).onload=n;j.src=e}return d},bigImgFun:function(b,c,d){var e=b.el;var f=C.preventDefault(b.evt);if(!d&&!/(img)|(canvas)/.test(b.evt.target.tagName.toLowerCase()))return f;var g=C.getFeedNode(e);if(!g){a.log("parents attribute mid is undefined!");return}g.disp="";var h=C.getMediaPDNodes(g,g.isForward);if(!h.prev){a.log('media: node-type="feed_list_media_prev" is not be found in feed item');return}if(!h.disp){a.log('media: node-type="feed_list_media_disp" is not be found in feed item');return}if(a.position(h.disp).t<a.scrollPos().top){g.scrollIntoView()}h.prev.style.display="";h.disp.style.display="none";h.disp.innerHTML="";var i=g.getAttribute("mid");i&&a.common.feed.widget.clear(i);return f},toFloatFun:function(b,c,d){o&&a.fireEvent(o,"click");var e=b.el;var f=decodeURIComponent(b.data.title);var g=C.getMid(e,c);var h=d.dispContentNode[g];var i=h.mediaData;var j=a.builder(q(r.mediaVideoMusicFloatTEMP,{title:decodeURIComponent(f)}).toString());var k=j.list["outer"][0],l=j.list["mediaContent"][0];o=j.list["close"][0];document.body.appendChild(k);n=p(k,"rb");if(i){l.innerHTML="";l.appendChild(a.builder(i).box);n.setFixed(true)}else{d.dispContentNode[g]=l}a.addEvent(o,"click",function(){a.removeEvent(o,"click",arguments.callee);n&&n.destroy();a.removeNode(k);n=j=k=o=null});return C.bigImgFun(b,c,true)},newsFeed:function(b,c){var d=b.el;for(;!a.hasClassName(d,"feed_list");d=d.parentNode);var e=a.sizzle("[node-type=feed_list_news]",d)[0];e&&(e.style.display=c?"":"none")},smallVideoMusicClickFun:function(b,c,d,e){try{var f=b.el;var g=b.data;var h=C.getFeedNode(f);var i=h.getAttribute("isForward")?1:"";var j=C.getMid(f,c);var k=C.getMediaPDNodes(h,i);if(!k.prev){a.log('media: node-type="feed_list_media_prev" is not be found in feed item');return}if(h.disp==g.short_url){return}h.disp=g.short_url;h.isForward=i;k.prev.style.display="none";var m=decodeURIComponent(g.title);var o=a.bLength(m)>71?a.leftB(m,70)+"...":m;m=a.bLength(m)>24?a.leftB(m,23)+"...":m;k.disp.innerHTML="";k.disp.appendChild(a.builder(q(i?r.mediaVideoMusicTEMP:B.mediaVideoMusicTEMP,{notForward:!i,short_url:decodeURIComponent(g.short_url),full_url:decodeURIComponent(g.full_url),title:m,fTitle:o,type:d}).toString()).box);if(!k.disp){a.log('media: node-type="feed_list_media_disp" is not be found in feed item');return}k.disp.style.display="";var p=a.sizzle('div[node-type="feed_list_media_big'+d+'Div"]',k.disp)[0];if(!p){a.log('media: note-type="feed_list_media_big'+d+'Div" is not be found in feed_list_media_disp node!');return}e.dispContentNode[j]=p;var s="default";try{if(IE){s="object"}else if(navigator.plugins["Shockwave Flash"]){s="embed"}else{s="html5"}}catch(t){}var u=function(){p.innerHTML=l};var w=function(b){if(!b["result"]||b["error_code"]||b["error"]){u();return}var c=e.dispContentNode[j];c.mediaData=b.result;c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);n&&n.setFixed(true)};v("mediaShow",{onComplete:w,onFail:u}).request({vers:3,lang:$CONFIG["lang"],mid:j,short_url:g.short_url.replace(/(https|http)\:\/\/(t|sinaurl)\.cn\//,""),template_name:s,source:"3818214747"});a.scrollTo(k.disp,{step:1})}catch(t){a.log("video err : ",t.message)}},rotateImg:function(b,c){var d=b.el;var e=C.getFeedNode(d);if(!d.parentNode.uid){var h=a.sizzle('img[action-type="feed_list_media_bigimg"]',e)[0];d.parentNode.uid=g(h)+"_"+f();h.setAttribute("id",d.parentNode.uid)}var i=c==="right"?"rotateRight":"rotateLeft";w[i](d.parentNode.uid,90,function(){},k)},getForwardOptions:function(a){var b=d(a);var c=C.getFeedNode(b);var e=c.getAttribute("mid");var f=h(">dl >dd",a)[0];var g=h('[node-type="feed_list_forwardContent"]',c)[0];var i=h('[action-type="feed_list_media_img"]',a)[0]||h('[action-type="feed_list_media_bigimg"]',a)[0];var j=i&&i.src&&i.src.replace(/^.*?\/([^\/]+).gif$/,"$1");f=h("em",f)[0];var k=x(f.innerHTML);var l=f.getAttribute("nick-name");var m=null;var n=null;if(g){m=k;n=l;k=x(h(">em",g)[0].innerHTML);l=d(g).getAttribute("nick-name")}return{mid:e,appkey:"",url:y,originNick:l,reason:m,origin:k,forwardNick:n,pid:j,styleId:2}},getCount:function(a){var b=a.match(/\(([\d]*)\)/);b=!b?0:parseInt(b[1]);return b},qingExpand:function(b,c,d){var e=b.el;var f=C.getMid(e,c);var g=b.data;var h=C.getFeedNode(e,c);var i=h.getAttribute("isForward")?"1":"";var k=C.getMediaPDNodes(h,i);if(h.disp==g.short_url){return}h.isForward=i;a.common.feed.widget.clear(f);k.disp.innerHTML="";k.disp.appendChild(a.builder(q(B.qingTEMP,{notForward:!i,short_url:decodeURIComponent(g.short_url),full_url:decodeURIComponent(g.full_url),title:decodeURIComponent(g.title),suda:decodeURIComponent(g.suda||"")}).toString()).box);k.prev.style.display="none";k.disp.style.display="";var l=a.sizzle('div[node-type="feed_list_media_qingDiv"]',k.disp)[0];var n=function(b){var c=b.code;if(c+""=="1"){b=b.data;if(!b.result)return;l.innerHTML=b.result;a.common.feed.widget.add(f,k.disp)}else{o(b)}};var o=function(a){l.innerHTML=m};var p=g.template_name;if(!p){p=""}else if(p=="video"){if(a.IE){p="object"}else if(navigator.plugins&&navigator.plugins["Shockwave Flash"]){p="embed"}else{p="html5"}}v("qingShow",{onComplete:n,onFail:o}).request({short_url:g.short_url,lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn",mid:f,vers:3,template_name:p});a.scrollTo(k.disp,{step:1,top:j})},thirdExpand:function(b,c,d){var e=b.el;var f=C.getMid(e,c);var g=b.data;var h=C.getFeedNode(e,c);var i=h.getAttribute("isForward")?"1":"";var j=C.getMediaPDNodes(h,i);if(h.disp==g.short_url){return}h.disp=g.short_url;h.isForward=i;a.common.feed.widget.clear(f);j.disp.innerHTML="";j.disp.appendChild(a.builder(q(B.widgetTEMP,{notForward:!i,short_url:decodeURIComponent(g.short_url),full_url:decodeURIComponent(g.full_url),title:decodeURIComponent(g.title),suda:decodeURIComponent(g.suda||"")}).toString()).box);j.prev.style.display="none";j.disp.style.display="";var k=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',j.disp)[0];v("third_rend",{onSuccess:function(b){b=b.data;if(!b.html)return;k.innerHTML=b.html;a.scrollTo(j.disp,{step:1});a.common.feed.widget.add(f,j.disp)},onFail:function(a){k.innerHTML=a&&a.msg||l},onError:function(a){k.innerHTML=a&&a.msg||l}}).request(a.lib.kit.extra.merge({isforward:i,mid:f},g))},widgetExpand:function(b,c,d){var e=b.el;var f=C.getMid(e,c);var g=b.data;var h=C.getFeedNode(e,c);var i=h.getAttribute("isForward")?"1":"";var j=C.getMediaPDNodes(h,i);if(h.disp==g.short_url){return}h.disp=g.short_url;h.isForward=i;a.common.feed.widget.clear(f);j.disp.innerHTML="";j.disp.appendChild(a.builder(q(B.widgetTEMP,{notForward:!i,short_url:decodeURIComponent(g.short_url),full_url:decodeURIComponent(g.full_url),title:decodeURIComponent(g.title),suda:decodeURIComponent(g.suda||"")}).toString()).box);j.prev.style.display="none";j.disp.style.display="";var k=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',j.disp)[0];v("widget",{onSuccess:function(b){b=b.data;if(!b.html)return;k.innerHTML=b.html;a.scrollTo(j.disp,{step:1});a.common.feed.widget.add(f,j.disp)},onFail:function(a){k.innerHTML=a&&a.msg||l},onError:function(a){k.innerHTML=a&&a.msg||l}}).request({short_url:decodeURIComponent(g.short_url),isforward:i,mid:f})}};return C}});
STK.register("common.trans.versionTip",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("save",{url:"/aj/guide/versiontip",method:"post"});c("userGuider",{url:"/aj/bubble/add",method:"post"});c("closeBubble",{url:"/aj/bubble/closebubble",method:"get"});return b});
STK.register("common.comment.tiplayer",function(a){var b={},c=a.core.dom.getSize,d=1;b.getLayerPosition=function(b,d,e,f){var g=null;if(b.style.display=="none"){b.style.visibility="hidden";b.style.display="";g=a.position(b);b.style.display="none";b.style.visibility="visible"}else{g=a.position(b)}var h=c(b);var i=c(d);var j=f?c(f):{width:0,height:0};e=e||1;var k,l,m={};switch(e){case 1:case"top":k=g.l+h.width/2-i.width/2;l=g.t-i.height;m.className="arrow_down";m.left=(i.width-j.width)/2+"px";m.top="";break;case 2:case"right":k=g.l+h.width;l=g.t-i.height/2;m.className="arrow_left";m.left="";m.top=(i.height-j.height)/2+"px";break;case 3:case"bottom":k=g.l+h.width/2-i.width/2;l=g.t+h.height;m.className="arrow_up";m.left=(i.width-j.width)/2+"px";m.top="";break;case 4:case"left":k=g.l-i.width;l=g.t-i.height/2;m.className="arrow_right";m.left="";m.top=(i.height-j.height)/2+"px";break}return{left:k,top:l,arrow:m}};b.setPosition=function(a,b){var c=[],d=[],e;for(var f in b){if(f=="arrow"){for(var g in b[f]){e=b[f][g];if(typeof e==="number")e+="px";e&&d.push(g+" : "+e)}}else{e=b[f];if(typeof e==="number")e+="px";e&&c.push(f+" : "+e)}}a.arrow.className=b.arrow.className;a.arrow.style.cssText=d.join(";");a.layer.style.cssText=c.join(";")};b.setPositionByOpts=function(a,c){var d=b.getLayerPosition(a.target,a.layer,a.pos,a.arrow);for(var e in c){d[e]+=c[e]}b.setPosition(a,d)};return function(){return b}});
STK.register("common.dialog.commentDialogueTip",function(a){var b=a.common.comment.tiplayer(),c={binded:null,node:null,target:null,tip:null},d,e,f=0,g=a.E("pl_content_versionTip");var h=a.core.evt.delegatedEvent(g);var i={autoinit:function(){if(f)return;if(c.binded){c.binded===c.node&&i.show()}else{d=a.sizzle('[messageTip="20"]',g)[0];if(d){var b=i.getTarget(c.node);if(b){c.binded=c.node;i.createTip();i.show()}}else{f=1}}},getTarget:function(b){return a.sizzle('[action-type="commentDialogue"]',b)[0]},createTip:function(){c.tip=a.lib.kit.dom.parseDOM(a.builder(d).list);c.tip.outer=d;h.add("iKnow","click",i.close);a.addEvent()},close:function(b){i.signKnown(b.data);i.hide();return a.core.evt.preventDefault(b.evt)},show:function(){c.target=i.getTarget(c.binded);a.setStyle(c.tip.outer,"visibility","visible");e=window.setInterval(i.flushLocation,200)},flushLocation:function(){var a={target:c.target,layer:c.tip.outer,pos:"top",arrow:c.tip.arrow};var d=b.getLayerPosition(a.target,a.layer,a.pos,a.arrow);b.setPosition(a,d)},hide:function(){if(c.binded===c.node&&c.tip){a.setStyle(c.tip.outer,"visibility","hidden");e&&window.clearInterval(e)}},signKnown:function(b){a.common.trans.versionTip.getTrans("closeBubble",{onSuccess:function(){f=1}}).request(b)}};return function(a){c.node=a;return{hide:i.hide,show:i.autoinit}}});
STK.register("common.trans.like",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("objectlike",{url:"/Ajax_object/like",method:"post"});c("objectscore",{url:"/Ajax_object/addReview",method:"post"});c("objectpublish",{url:"/Ajax_object/reviewWb",method:"post"});c("objectinfo",{url:"/Ajax_object/objectInfo",method:"post"});c("objectfollow",{url:"/Ajax_object/stopicFollow",method:"post"});return b});
STK.register("common.comment.newLikeEventList",function(a){var b={},c=["likeSuccess","likeError","likeFail"];a.custEvent.define(b,c);return b});
STK.register("common.comment.commentLike",function(a){return function(b){var c={name:"comp.common.newLike"};var d;var e=a.common.comment.newLikeEventList;if(!b){return}var f;var g={like:function(b){a.core.evt.preventDefault();var c=b.data;if(!c){return}c.action_code="33";a.common.trans.like.getTrans("objectlike",{onSuccess:function(c){if(c.code==="100000"){var d=b.el.parentNode,e;if(d==null){return}e=STK.core.dom.builder(d);var f,g={};if(c["data"]["is_del"]&&c["data"]["is_del"]===1){f=false}else{f=true}if(f){g["like-class"]="icon-act icon-act-praised";g["like-title"]="取消赞";g["like-num"]=1}else{g["like-class"]="icon-act icon-act-praise";g["like-title"]="赞";g["like-num"]=-1}var h=a.sizzle("[node-type=likeNum]",d);var i="",j;if(h&&h.length!=0){i=parseInt(h[0].innerHTML.replace(/(\d+)/,"$1"),10);j=(i?i:0)+g["like-num"];h[0].innerHTML=j>0?" "+j:""}else if(h&&h.length==0){h[0].innerHTML="1"}var k=a.sizzle("[node-type=likeImg]",d);if(k&&k.length!=0){k[0].className=g["like-class"]}var l=a.sizzle("[node-type=likeTit]",d);if(l&&l.length!=0){l[0].title=g["like-title"]}}},onError:function(b){a.lib.ui.alert(b.msg)},onFail:function(){a.lib.ui.alert("发送请求失败.")}}).request(c)},findParentNode:function(a,b){for(var c=0;a=a.parentNode;c++){if(a===document.documentElement){return null}if(a&&a.attributes["node-type"]&&a.attributes["node-type"].value===b){return a}}}};var h=function(){};var i=function(){d=a.core.evt.delegatedEvent(b);d.add("comment_object_like","click",g.like)};var j=function(){i()};j();c.destroy=function(){d.remove("comment_object_like","click");delete d};return c}});
STK.register("common.comment.commentReply",function(a){var b=a.lib.kit.extra.setPlainHash;var c=[],d={},e=a.lib.ui.alert,f=a.lib.kit.extra.language,g=a.custEvent,h=g.fire;var i=null,j=null,k="";var l=a.common.trans.comment;var m={content:f("#L{写点东西吧，评论内容不能为空哦。}"),"delete":f("#L{确定要删除该回复吗}"),reply:f("#L{回复}"),blcok:f("#L{同时将此用户加入黑名单}"),unReply:f('#L{由于用户设置，你无法回复评论。}<br><a href="//account.weibo.com/settings/mobile" target="_blank">#L{绑定手机}</a>#L{后可以更多地参与评论。}'),unPower:f("#L{由于用户设置，你无法回复评论。}")};var n=function(b,c){var d,k,n,o,p,q,r,s,t,u,v,w=new RegExp(["^",m["reply"],"@([^:]*):(.*)"].join("")),x=a.core.str;var y=c["isMain"];var z=function(g){q=a.sizzle("textarea",g.el.parentNode.parentNode.previousElementSibling)[0];var h=a.trim(q.value),i=h.match(w);if(h==""||i&&a.trim(i[2])==""){e(m["content"]);return}if(!i||!i[1]||i[1]!=p){o=p=null}if(g&&g.el){g.el.className="s-btn-a disable";g.el.innerHTML="";var j=a.builder('<i class="s-loading"></i><span>'+f("#L{评论中...}")+"</span>");g.el.appendChild(j.box)}else{a.sizzle('[action-type="post"]',b)[0].className="s-btn-a";a.sizzle('a[node-type="btnText"]',b)[0].innerHTML=f("#L{评论}")}d.post(a.lib.module.getDiss({act:!!i?"reply":"post",cid:o||c.cid,content:x.leftB(h,280),isroot:s&&s.checked?"1":"0",forward:r&&r.checked?"1":"0",appkey:c.appkey,isreply:1,pageid:g.data.pageid?g.data.pageid:"",dom:a.sizzle('a[node-type="btnText"]',b),ouid:c.ouid},g.el),{onRelease:function(){if(g&&g.el){g.el.className="s-btn-a disable";g.el.innerHTML="";var c=a.builder('<i class="s-loading"></i><span>'+f("#L{评论中...}")+"</span>");g.el.appendChild(c.box)}else{a.sizzle('[action-type="post"]',b)[0].className="s-btn-a";a.sizzle('a[node-type="btnText"]',b)[0].innerHTML=f("#L{评论}")}}})};a.core.evt.hotKey.add(b,["ctrl+enter"],z);var A=a.core.evt.delegatedEvent(b);A.add("check","keyup",function(b){var c=a.sizzle('a[action-type="post"]',b.el.parentNode.nextElementSibling),d,e;var f=a.trim(b.el.value),g=f.match(w);if(f==""||g&&a.trim(g[2])==""){e=false}else{e=true}if(c.length!=0){d=c[0];d.className=e?"s-btn-a":"s-btn-a disable"}});A.add("post","click",z);A.add("reply","click",function(b){var c=b.el;if(a.core.dom.hasClassName(c,"unclick_rep")){if(i){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null}var d=c.getAttribute("isPhone");if(d){i=a.lib.ui.tipAlert({msg:m.unReply,type:"warn"})}else{i=a.lib.ui.tipAlert({msg:m.unPower,type:"warn"})}i.setLayerXY(c);i.aniShow();j&&window.clearTimeout(j);j=window.setTimeout(function(){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null},3e3);return}if(b.data&&b.data.ispower=="1"){l.getTrans("isComment",{onComplete:function(d){if(d.code=="100000"){var e,f,g;if((e=b.data)&&(f=e.nick)){g=[m["reply"],"@",f,":"].join("");o=e["cid"];p=f;if(q){q.value=g;setTimeout(function(){a.lib.kit.extra.textareaUtils.selectText(q,g.length,g.length);q.setAttribute("range",g.length+"&0")},30)}}}else{if(i){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null}if(d.code=="100022"){i=a.lib.ui.tipAlert({msg:m.unPower,type:"warn"})}else if(d.code=="100001"){c&&c.setAttribute("isphone","1");i=a.lib.ui.tipAlert({msg:m.unReply,type:"warn"})}else{i=a.lib.ui.tipAlert({msg:d.msg,type:"warn"})}i.setLayerXY(c);i.aniShow();a.addClassName(c,"unclick_rep");j&&window.clearTimeout(j);j=window.setTimeout(function(){i.anihide&&i.anihide();i.destroy&&i.destroy();i=null},3e3)}}}).request(b.data)}else{var e,f,g;if((e=b.data)&&(f=e.nick)){g=[m["reply"],"@",f,":"].join("");o=e["cid"];p=f;if(q){q.value=g;setTimeout(function(){a.lib.kit.extra.textareaUtils.selectText(q,g.length,g.length);q.setAttribute("range",g.length+"&0")},30)}}}});A.add("delete","click",function(b){var c=b.data["block"];var e=b.data["block"]?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',m["blcok"],"</label>"].join(""):"";var f=a.lib.ui.confirm(m["delete"],{OK:function(a){var c=a["block_user"];var e,f;if((e=b.data)&&(f=e.cid)){d.del({act:"delete",cid:f,is_block:c?"1":"0"})}},textComplex:e})});var B=a.common.dialog.commentDialogue();A.add("commentDialogue","click",B.show);a.common.channel.feed.register("reply",function(a){C(a.ret)});var C=function(b){var c=b.data;if(!c){return false}o=p=null;n+=1;typeof y=="undefined"&&c["comment"]&&t&&a.insertHTML(t,c.comment,"afterend");h(k,"count",n);h(k,"comment",{count:n,html:c.comment});if(c["feed"]){h(k,"feed");a.common.channel.feed.fire("forward",{html:c.feed})}D.changeSubmitBtn();return true};var D={changeSubmitBtn:function(){a.sizzle("a[node-type='btnText']",b).forEach(function(a,b){a.className="s-btn-a";a.innerHTML=f("#L{评论}")})},add_success:function(c,d){if(C(c)){var e=q;while(e!==document&&e.getAttribute("node-type")!="feed_merge_list_reply_item_input"){e=e.parentNode}if(e===document){return}q.value="";e.style.display="none";e.setAttribute("flag","false")}var f=c.data;if(!f){return}var g=a.builder(f.comment);b.insertBefore(g.box,b.firstChild);h(k,"count",[n=f.count*1||0]);q=a.sizzle("textarea",b)[0];setTimeout(function(){q&&a.lib.kit.dom.autoHeightTextArea({textArea:q,maxHeight:9999,inputListener:function(){var b=a.trim(q.value);if(x.bLength(b)>280){q.value=x.leftB(b,280)}}})},25);r=a.sizzle("input[name=forward]",b)[0];s=a.sizzle("input[name=isroot]",b)[0];t=a.sizzle("div[node-type=commentList]",b)[0];var i={count:"disabled"}},add_fail:function(){D.changeSubmitBtn()},add_error:function(){D.changeSubmitBtn()},delete_success:function(b,c){var d=a.sizzle("[comment_id='"+c.cid+"']")[0];a.removeNode(d)},delete_fail:function(a,b){},smallList_success:function(c,d){var e=c.data;if(!e){return}if(d.smartFlag){var f=STK.core.dom.prev(b);var g=a.builder(e.html);var i=a.sizzle('[node-type="feed_list_smartContent"]',f);if(i.length>0){var j=i[0].cloneNode(true);a.core.dom.insertBefore(j,g.list.commentList[0])}f.style.display="none";b.style.display="";b.innerHTML="";b.appendChild(g.box)}else{e["html"]&&(b.innerHTML=e.html)}h(k,"count",[n=e.count*1||0]);q=a.sizzle("textarea",b)[0];setTimeout(function(){q&&a.lib.kit.dom.autoHeightTextArea({textArea:q,maxHeight:9999,inputListener:function(){var b=a.trim(q.value);if(x.bLength(b)>280){q.value=x.leftB(b,280)}}})},25);r=a.sizzle("input[name=forward]",b)[0];s=a.sizzle("input[name=isroot]",b)[0];t=a.sizzle("div[node-type=commentList]",b)[0];var l={count:"disabled"};if(q){u=a.common.editor.base(b,l);u.widget(a.common.editor.widget.face(),"smileyBtn");!!d.focus&&q.focus();q.select()}},reply_success:function(a,b){}};d=a.common.comment.inter(D,c);k=g.define(d,["count","feed","comment","del"]);d.destroy=function(){u&&u.closeWidget();j&&window.clearTimeout(j);i&&i.anihide&&i.anihide();i&&i.destroy&&i.destroy();i=null};return d};var o=function(b,e){var f=a.core.arr.indexOf(b,c);if(!d[f]){c[f=c.length]=b;d[f]=n(b,e)}return d[f]};return function(a,b){if(!a||!a.mid){throw"mid is not defined"}var c=o(b,a);if(b.firstChild&&a.smartFlag==false){b.innerHTML="";b.style.display="none"}else{}return c}});
STK.register("common.feed.feedList.plugins.commentAgg",function(a){var b=a.common.feed.feedList.utils;var c=a.core.dom.uniqueID;var d=a.common.feed.feedList.feedTemps;var e={};var f=a.common.trans.comment.getTrans;var g=a.lib.kit.extra.language("#L{评论}");var h=a.lib.kit.extra.language("#L{转发}");var i=a.common.depand.feed;var j=a.common.content.weiboDetail.utils();var k=a.lib.kit.extra.language;var l=a.common.trans.comment;var m=null;var n=null,o={};var p=a.lib.kit.extra.setPlainHash;return function(c){var f=false;var g;if(!c){a.log("comment : need object of the baseFeedList Class");return}var l=c.getNode();var m={};var p=false;var q=false;var r=function(c){var m=i.bind("asyn_comment",function(c){p=false;var i=c.el,m=b.getMid(i,l),r=m;var s=e[r];var t=b.getFeedNode(i,l);var u=a.sizzle('div[node-type="feed_list_repeatAgg"]',t)[0];var v;var w=c.data["suda-data"]?c.data["suda-data"]:"";var x=c.data["pageid"]?c.data["pageid"]:"";if(!u){a.log("feedList.plugins.comment: 评论列表的展示区不存在！");return}if(!s){g=a.comp.common.commentLike(u);q=false;if(a.core.dom.prev(u).getAttribute("node-type")=="feed_list_repeat2"){q=true;v=a.core.dom.prev(u)}var y={mid:m,smartFlag:q,smartCardComment:c.data.smartCard||"",appkey:c.data.appkey,isMain:true,"suda-data":w,pageid:x};s=e[r]=a.common.comment.comment(a.lib.module.getDiss(y,c.el),u);a.custEvent.add(s,"count",function(a,b){if(c.data.smartcard&&c.data.smartcard==1){return}if(parseInt(b)<1)return;i.innerHTML=i.innerHTML.replace(/(.*<em>)(\d*)(<\/em>.*)/gi,"$1"+b+"$3");$CONFIG["location"]=="home"&&asynShowCommentDialogueTip(u)});a.custEvent.add(s,"comment",function(b,c){n=a.sizzle('a[node-type="feed_list_commentTabAll"]',t)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',t)[0];var e=c.html,g=parseInt(c.count);var h=a.sizzle('[node-type="feed_list_commentListNum"]',t)[0];if(parseInt(g)>0&&h){h.innerHTML=k("#L{共}")+g+k("#L{条}")}if(!n){e&&a.insertHTML(d,e,"afterbegin")}else{if(!o[m]){e&&a.insertHTML(d,e,"afterbegin")}else{d.innerHTML=o[m];j.tabSwitch(n,"current","current W_texta");f=false;e&&a.insertHTML(d,e,"afterbegin")}}window.setTimeout(function(){o[m]=d.innerHTML},0)});a.custEvent.add(s,"feed",function(){var b=a.sizzle('a[action-type="feed_list_forward"]',i.parentNode)[0];if(!b){a.log("feedList.plugins.comment: 转发按钮节点不存在！");return}var c=b.innerHTML.match(/\(([\d]*)\)/);b.innerHTML=h+"("+(c?parseInt(c[1])+1:1)+")"});a.custEvent.add(s,"del",function(b,c){n=a.sizzle('a[node-type="feed_list_commentTabAll"]',t)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',t)[0];if(o[m]){if(!f){if(d){o[m]=d.innerHTML}}else{var e=document.createElement("div");e.innerHTML=o[m];a.core.util.hideContainer.appendChild(e);var g=a.sizzle(["dl[comment_id=",c.cid,"]"].join(""),e)[0];g&&g.parentNode.removeChild(g);o[m]=e.innerHTML;a.core.util.hideContainer.removeChild(e);e=null}}else if(n){o[m]=d.innerHTML}});if(q==false){u.innerHTML=d.loadingIMG}}else{g.destroy();delete g;a.custEvent.remove(s);s.destroy();delete e[r];u.on=0;u.innerHTML="";u.style.display="none";$CONFIG["location"]=="home"&&hideCommentDialogueTip(u);if(q==true){a.core.dom.prev(u).style.display=""}}return b.preventDefault()},{onTimeout:function(){p=false}});m(c)};var s={openComment:function(b){a.core.evt.preventDefault();if(p){return}p=true;var c;if(b.el.getAttribute("suda-data")){c=b.el.getAttribute("suda-data");if(!/off/.test(c)){c=c.replace(/weibo/,"off_weibo");b.el.setAttribute("suda-data",c)}else{c=c.replace(/off_weibo/,"weibo");b.el.setAttribute("suda-data",c)}}r(b)}};var t=function(){};var u=function(){var a=c.getDEvent();a.add("feed_list_commentAgg","click",s.openComment)};var v=function(){u()};v();m.destroy=function(){};return m}});
STK.register("common.feed.feedList.plugins.commentReply",function(a){var b=a.common.feed.feedList.utils;var c=a.core.dom.uniqueID;var d=a.common.feed.feedList.feedTemps;var e={},f={};var g=a.common.trans.comment.getTrans;var h=a.lib.kit.extra.language("#L{评论}");var i=a.lib.kit.extra.language("#L{转发}");var j=a.common.depand.feed;var k=a.common.content.weiboDetail.utils;var l=a.lib.kit.extra.language;var m=a.common.trans.comment;var n=null,o=null,p={};var q=a.lib.kit.extra.setPlainHash;return function(c){var d=false;if(!c){a.log("comment : need object of the baseFeedList Class");return}var g=c.getNode();var h={};var i=false;var k=false;var m=function(c){var d=j.bind("asyn_comment",function(c){i=false;var d=c.el,h=b.getMid(d,g),j=h;var l=e[j];var m=b.getFeedNode(d,g);var n;var o;var p;var q=c.data["suda-data"]?c.data["suda-data"]:"";var r=c.data["pageid"]?c.data["pageid"]:"";var s=c.el;while(s!==document&&s.getAttribute("node-type")!="feed_merge_list_reply_item"){s=s.parentNode}if(s===document){return}n=s.parentNode;o=a.sizzle('div[node-type="feed_merge_list_reply_item_input"]',s)[0];if(!o){a.log("feedList.plugins.comment: 评论框的展示区不存在！");return}var t=a.sizzle('textarea[node-type="textEl"]',s)[0];var u={count:"disabled"};if(o.getAttribute("flag")=="false"){o.style.display="block";var v="回复@"+c.data.nick+":";t.value=v;setTimeout(function(){a.lib.kit.extra.textareaUtils.selectText(t,v.length,v.length);t.setAttribute("range",v.length+"&0")},30);editor=a.common.editor.base(s,u);editor.widget(a.common.editor.widget.face(),"smileyBtn");o.setAttribute("flag","true");k=true;var w={mid:h,smartFlag:k,smartCardComment:c.data.smartCard||"",appkey:c.data.appkey,isMain:true,"suda-data":q,pageid:r,ouid:c.data.ouid||"",cid:c.data.cid||"",nick:c.data.nick||"",ispower:c.data.ispower||""};l=e[j]=f[j]=a.common.comment.commentReply(a.lib.module.getDiss(w,c.el),n)}else{o.style.display="none";t.value="";o.setAttribute("flag","false");k=false}return b.preventDefault()},{onTimeout:function(){i=false}});d(c)};var n={openComment:function(b){a.core.evt.preventDefault();if(i){return}i=true;var c;if(b.el.getAttribute("suda-data")){c=b.el.getAttribute("suda-data");if(!/off/.test(c)){c=c.replace(/weibo/,"off_weibo");b.el.setAttribute("suda-data",c)}else{c=c.replace(/off_weibo/,"weibo");b.el.setAttribute("suda-data",c)}}m(b)},replyDelete:function(b){var c=b.data["block"];var d=b.data["block"]?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',msg["blcok"],"</label>"].join(""):"";var e=a.lib.ui.confirm(l("#L{确定要删除该回复吗}"),{OK:function(a){var c=a["block_user"];var d,e;if((d=b.data)&&(e=d.cid)){req.del({act:"delete",cid:e,is_block:c?"1":"0"})}},textComplex:d})}};var o=function(){};var p=function(){var a=c.getDEvent();a.add("replyOuter","click",n.openComment)};var q=function(){p()};q();h.destroy=function(){};return h}});
STK.register("common.feed.feedList.plugins.comment",function(a){var b=a.common.feed.feedList.utils;var c=a.common.feed.feedList.feedTemps;var d={};var e=a.common.trans.comment.getTrans;var f=a.lib.kit.extra.language("#L{评论}");var g=a.lib.kit.extra.language("#L{转发}");var h=a.common.depand.feed;var i=a.common.content.weiboDetail.utils;var j=a.common.trans.comment;var k=null;var l=null,m={};var n=a.lib.kit.extra.setPlainHash;return function(f){var n=false;var o;if(!f){a.log("comment : need object of the baseFeedList Class");return}var p=f.getNode();var q={};var r=false;var s=false;var t=h.bind("asyn_comment",function(e){r=false;var f=e.el,h=b.getMid(f,p),j=h,k=d[j],q=b.getFeedNode(f,p),t=a.sizzle('div[node-type="feed_list_repeat"]',q)[0],u=a.sizzle('div[node-type="feed_merge_reply"]',q)[0]||null,v,w=e.data["suda-data"]?e.data["suda-data"]:"",z=e.data["pageid"]?e.data["pageid"]:"";var A=a.sizzle('[node-type="feed_merge_lists"]',q);if(!t){a.log("feedList.plugins.comment: 评论列表的展示区不存在！");return}if(!k){if(u){u.style.display="none"}o=a.common.comment.commentLike(t);s=false;if(a.core.dom.prev(t).getAttribute("node-type")=="feed_list_repeat2"){s=true;v=a.core.dom.prev(t)}k=d[j]=a.common.comment.comment(a.lib.module.getDiss({mid:h,smartFlag:s,smartCardComment:e.data.smartCard||"",appkey:e.data.appkey,isMain:true,"suda-data":w,pageid:z},e.el),t);a.custEvent.add(k,"count",function(a,b){if(e.data.smartcard&&e.data.smartcard==1){return}if(parseInt(b)<1)return;f.innerHTML=f.innerHTML.replace(/(.*<em>)(\d*)(<\/em>.*)/gi,"$1"+b+"$3");$CONFIG["location"]=="home"&&x(t)});a.custEvent.add(k,"comment",function(b,c){l=a.sizzle('a[node-type="feed_list_commentTabAll"]',q)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',q)[0];var e=c.html,f=parseInt(c.count);var g=a.sizzle('[node-type="feed_list_commentListNum"]',q)[0];if(parseInt(f)>0&&g){g.innerHTML=$L("#L{共}")+f+$L("#L{条}")}if(!l){e&&a.insertHTML(d,e,"afterbegin")}else{if(!m[h]){e&&a.insertHTML(d,e,"afterbegin")}else{d.innerHTML=m[h];i().tabSwitch(l,"current","current W_texta");n=false;e&&a.insertHTML(d,e,"afterbegin")}}window.setTimeout(function(){m[h]=d.innerHTML},0)});a.custEvent.add(k,"feed",function(){var b=a.sizzle('a[action-type="feed_list_forward"]',f.parentNode)[0];if(!b){a.log("feedList.plugins.comment: 转发按钮节点不存在！");return}var c=b.innerHTML.match(/\(([\d]*)\)/);b.innerHTML=g+"("+(c?parseInt(c[1])+1:1)+")"});a.custEvent.add(k,"del",function(b,c){l=a.sizzle('a[node-type="feed_list_commentTabAll"]',q)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',q)[0];if(m[h]){if(!n){if(d){m[h]=d.innerHTML}}else{var e=document.createElement("div");e.innerHTML=m[h];a.core.util.hideContainer.appendChild(e);var f=a.sizzle(["dl[comment_id=",c.cid,"]"].join(""),e)[0];f&&f.parentNode.removeChild(f);m[h]=e.innerHTML;a.core.util.hideContainer.removeChild(e);e=null}}else if(l){m[h]=d.innerHTML}});if(s==false){t.innerHTML=c.loadingIMG}if(A.length>0){A[0].style.display="none"}}else{if(u){u.style.display="block"}o.destroy();delete o;a.custEvent.remove(k);k.destroy();delete d[j];t.on=0;t.innerHTML="";t.style.display="none";$CONFIG["location"]=="home"&&y(t);if(s==true){a.core.dom.prev(t).style.display=""}if(A.length>0){A[0].style.display="block"}}return b.preventDefault()},{onTimeout:function(){r=false}});var u=function(b){a.core.evt.preventDefault();if(r){return}r=true;var c;if(b.el.getAttribute("suda-data")){c=b.el.getAttribute("suda-data");if(!/off/.test(c)){c=c.replace(/weibo/,"off_weibo");b.el.setAttribute("suda-data",c)}else{c=c.replace(/off_weibo/,"weibo");b.el.setAttribute("suda-data",c)}}t(b)};var v={getListByType:function(c,d){var f=c.data;var g=f.mid;var h=c.el,j=b.getFeedNode(h,p);var k=i().tabSwitch(c.el,"cur","cur");if(!k)return i().preventDefault();e("smallList",{onSuccess:function(b){d.innerHTML=b.data.html;if(!n)m[g]=b.data.html;var c=a.sizzle('[node-type="feed_list_commentListNum"]',j)[0];if(c&&b.data&&typeof b.data.count!="undefined"){c.innerHTML=$L("#L{共}")+b.data.count+$L("#L{条}")}j=null},onFail:function(b){a.lib.ui.alert(b.msg||a.lib.kit.extra.language("#L{接口返回数据错误}"));j=null},onError:function(b){a.lib.ui.alert(b.msg||a.lib.kit.extra.language("#L{接口返回数据错误}"));j=null}}).request(f);return false}};var w=function(c){a.preventDefault();var d=c.data.mid;n=c.el.getAttribute&&c.el.getAttribute("node-type")=="feed_list_commentTabAll"?false:true;var e=c.el,f=b.getFeedNode(e,p),g=c.data,h=a.sizzle('div[node-type="feed_list_repeat"]',f)[0],i=a.sizzle('[node-type="feed_list_commentList"]',f)[0];if(!m[d]){m[d]=h.innerHTML}if(!h){a.log("feedList.plugins.comment: 评论列表不存在！");return}v.getListByType(c,h)};var x=h.bind("asyn_commentDialogue_tip",function(b){a.common.dialog.commentDialogueTip(b).show()},{onTimeout:function(){}});var y=function(b){a.common.dialog.commentDialogueTip(b).hide()};var z=function(){var b=a.sizzle("[node-type='feed_merge_lists']",p);if(b.length>0){a.common.feed.feedList.plugins.commentAgg(f)}};var A=function(){var b=a.sizzle("[node-type='feed_merge_lists_reply']",p);if(b.length>0){a.common.feed.feedList.plugins.commentReply(f);for(var c=0;c<b.length;c++){a.common.comment.commentLike(b[c])}}};f.getDEvent().add("feed_list_comment","click",u);f.getDEvent().add("feed_list_commentSearch","click",w);f.getDEvent().add("feed_private_tipclose","click",function(c){var d=c.data&&c.data.type;var e=b.getFeedNode(c.el,p);var f=a.sizzle("[node-type='feed_privateset_tip']",e);var g=f.length&&f[0];g&&a.setStyle(g,"display","none");j.getTrans("privateNoMore",{onSuccess:function(){d&&(window.location.href=c.el.getAttribute("href"))},onError:a.funcEmpty}).request({bubbletype:7,time:7*86400});return b.preventDefault()});z();A();q.destroy=function(){for(var a in d){d[a].destroy()}for(var b in m){m[b].destroy()}l=null;m=null;d={};listNumDom=null;k=null};return q}});
STK.register("lib.kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128){b+=String.fromCharCode(d)}else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var b;if(typeof b=="undefined"){b=0}var e=0;var f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;if(i<0){i=4294967296+i}return i}});
STK.register("common.extra.imageURL",function(a){return function(b,c){function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};d=a.core.obj.parseParam(d,c);var e=d.size;var g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large"}};if(b.indexOf("https")!=-1||b.indexOf("http")!=-1){return b}var h=b.charAt(9)=="w"||b.charAt(9)=="y";var i=b.charAt(21)=="g"?".gif":".jpg";var j=h?a.lib.kit.extra.crc32(b)%4+1:f(b.substr(19,2))%16+1;var k="//"+(h?"ww":"ss")+j+".sinaimg.cn/"+(h?g["ww"][e]:e)+"/"+b+(h?i:"")+(h?"":g["ss"][e]);return k}});
STK.register("lib.kit.evt.fixEvent",function(a){var b="clientX clientY pageX pageY screenX screenY".split(" ");return function(b){b=b||a.core.evt.getEvent();if(!b.target){b.target=b.srcElement||document}if(b.pageX==null&&b.clientX!=null){var c=document.documentElement;var d=document.body;b.pageX=b.clientX+(c.scrollLeft||d&&d.scrollLeft||0)-(c.clientLeft||d&&d.clientLeft||0);b.pageY=b.clientY+(c.scrollTop||d&&d.scrollTop||0)-(c.clientTop||d&&d.clientTop||0)}if(!b.which&&b.button){if(b.button&1){b.which=1}else if(b.button&4){b.which=2}else if(b.button&2){b.which=3}}if(b.relatedTarget===undefined){b.relatedTarget=b.fromElement||b.toElement}if(b.layerX==null&&b.offsetX!=null){b.layerX=b.offsetX;b.layerY=b.offsetY}return b}});
STK.register("lib.kit.extra.multiimages",function(a){var b=$CONFIG["imgPath"];var c=""+'<div class="more-pic" node-type="recLayer" style="display:none;">'+'<div class="top">'+'<p>#L{翻完啦！}<a href="javascript:void(0);" node-type="toprofile">看他的更多图片</a></p>'+'<i class="wbicon close" action-type="closeRecLayer">X</i>'+"</div>"+'<ul node-type="recBox">'+"</ul>"+"</div>";var d="<#et recimg data>"+"<#list data.recimgs as list>"+'<li><a target="_blank" href="${list.imgsrc}"><img src="${list.img}"></a></li>'+"</#list>"+"</#et>";var e="<#et images data>"+'<div class="media media-pic-zoom" node-type="imagesBox">'+'<ul class="tab">'+"<#if (data.toSmall == 1)>"+'<li><a action-type="tosmall" href="javascript:void(0);"><i class="wbicon">k</i>收起</a></li>'+"</#if>"+'<li><a href="javascript:void(0);" target = "_blank" action-type="images_view_tobig" node-type="tobig" action-data="pid=${data.currentPid}"><i class="wbicon">f</i>查看大图</a></li>'+'<li><a action-type="turnLeft" href="javascript:void(0);" class="W_texta"><i class="wbicon">m</i>向左旋转</a></li>'+'<li><a action-type="turnRight" href="javascript:void(0);" class="W_texta"><i class="wbicon">n</i>向右旋转</a></li>'+"</ul>"+'<div class="bigpic next" node-type="picShow">'+"<!--根据鼠标所在区域范围选择，向左的鼠标手型类名prve，向右鼠标手型类名next,图片变小smallcursor-->"+'<div node-type="imgBox">'+'<img node-type="imgShow" src="${data.currentUrl}" <#if (data.isheight)>style="height: 280px;width:440px;"</#if>>'+"</div>"+'<div class="media-pay-hint" node-type="paylink"  <#if (data.ispay)>style="display: none;"</#if>>'+"<p>开通Ta的专属会员即可浏览图片和Ta的全部付费内容</p>"+'<a href="https://vipclub.weibo.com/vmember/opendetail?vuid=${data.uid[0]}" target="_blank" class="s-btn-b">立即开通</a>'+"</div>"+'<i node-type="loading" style="display: none;" class="s-loading"></i>'+"</div>"+c+'<div class="choose-pic" >'+'<ul node-type="picChoose">'+"<#list data.picChoose as picChoose>"+'<li <#if (picChoose.pid == data.currentPid)> class="cur"</#if>><img src="${picChoose.url}" node-type="thumbItem" action-type="thumbItem" action-data="pid=${picChoose.pid}"></li>'+"</#list>"+"</ul>"+"</div>"+"</div>"+"</#et>";return function(b){var c={};var f;var g;var h="";var i=0;var j=0;var k="";var l;var m;var n={};var o=450;var p=false;var q=false;var r=false;var s=a.lib.kit.extra.language;var t=[];var u;var v;var w=a.parseParam({currentPid:"",pids:[],picShowWidth:440,sum:7,thumbWidth:59,mid:"",uid:"",isForward:0,toSmall:1},b);var x={getIndex:function(a,b){var c=0;for(var d=0;a[d];d++){if(a[d]==b){c=d;break}}return c},setPic:function(c,d){if(c==k){return}var e="";var g=b.tags;if(g!=null&&g[c]){a.core.arr.foreach(g[c],function(a,b){var c=[];c.push('<a title="'+a.tag_name+'" node-type="multitag" action-type="multitag" ');if(a.url.length!=0){c.push('href="'+a.url+'" target="_blank" ')}else{c.push('href="javascript:void(0)" ')}c.push('" class="tag_showpicL" style="left: '+a.pos_x*100+"%; top: "+a.pos_y*100+'%; white-space: nowrap;display:none;" tag-id="3">');c.push('<span class="inner">');if(a.tag_type==="user"){c.push('<em class="W_autocut">@'+a.tag_name+"</em>")}else if(a.tag_type==="topic"){c.push('<em class="W_autocut">#'+a.tag_name+"#</em>")}else if(a.tag_type==="place"){c.push('<em class="W_autocut">'+a.tag_name+"</em>")}else{c.push('<em class="W_autocut">'+a.tag_name+"</em>")}c.push("</span>");c.push("</a>");e+=c.join("")})}var h=a.common.extra.imageURL(c,{size:"bmiddle"});var j=a.C("img");n[c]=j;k=c;f["loading"].style.display="";j.onload=function(){j.onload=null;x.setpid();f["loading"].style.display="none";var b=a.core.ani.tween(f["imgBox"],{duration:150,end:function(){f["imgBox"].innerHTML="";f["imgBox"].innerHTML=e;(function(){var b=a.sizzle("[node-type=multitag]",f["imgBox"]);if(b.length==0){return}a.core.arr.foreach(b,function(a,b){var c=STK.core.dom.getSize(a);var d=parseFloat(a.style.left,10)/100+c.width/440;if(parseFloat(a.style.top,10)/100>.92){a.style.marginTop="-21px"}if(d>1){a.className="tag_showpicR";a.style.marginLeft=-c.width+"px"}a.style.display=""})})();a.setStyle(f["imgBox"],"height","");f["imgBox"].appendChild(j);a.tween(f["imgBox"],{duration:100,animationType:"easeoutcubic"}).play({opacity:1}).destroy()}});b.play({opacity:.3}).destroy()};j.src=h;if(w.pids.length>1&&!b.ispay){if(i!=0){j.width=440;j.height=280}}for(var l=0;t[l];l++){t[l].onload=null}t.push(j)},setIndex:function(c){switch(c){case"min":i--;break;case"add":i++;break;default:i=c;break}if(i<0){i=0}if(i>j-1){i=j-1;x.showRec()}else if(a.position(f["imagesBox"]).t<a.scrollPos().top){a.scrollTo(f["imagesBox"],{top:120,step:10})}if(i!=0){if(!b.ispay){f["paylink"].style.display="block"}}else{f["paylink"].style.display="none"}if(i>j-3&&$CONFIG["islogin"]==1&&j>1){x.getRecPics()}if(i>=0&&j>1){x.setCurrentThumb();x.scrollList()}},showRec:function(){if(!r){return}var b=a.core.dom.getSize(f["picShow"]);var c=a.core.dom.getSize(f["recLayer"]);if(b.height<c.height){}var d=(b.height-c.height)/2+40;if(d>b.height-c.height){d=b.height-c.height}if(d<0){d=0}f["recLayer"].style.left=(b.width-c.width)/2+"px";f["recLayer"].style.top=d+"px";f["recLayer"].style.display="";p=true},scrollList:function(){return function(a,b){var c=Math.floor(w["sum"]/2);var d=i;if(b){d=a}var e=j;if(e>w["sum"]){var f=d-c;if(f<=0){f=0}else{}if(f>=e-w["sum"]){f=e-w["sum"]}else{}var g=2-w["thumbWidth"]*f;m.play({left:g})}}}(),setCurrentThumb:function(){for(var b in f["thumbItem"]){a.removeClassName(f["thumbItem"][b].parentNode,"cur")}a.addClassName(f["thumbItem"][i].parentNode,"cur")},rotateImg:function(b,c){var d=b.el;var e=a.sizzle("img",f["imgBox"])[0];d.parentNode.uid=a.core.dom.uniqueID(e)+"_"+a.core.util.getUniqueKey();e.setAttribute("id",d.parentNode.uid);a.lib.kit.dom.rotateImage.rotateRight(a.E(d.parentNode.uid),c,o)},getImgsrc:function(a,b,c){var d="https://photo.weibo.com/"+a+"/wbphotos/large/mid/"+b+"/pid/"+c+"?Refer=weibofeedv5";return d},setpid:function(){var a=x.getImgsrc(w.uid,w.mid,k);f["tobig"].setAttribute("href",a)},getRecPics:function(){if(q){return}q=true;a.common.trans.feed.getTrans("recmodlayer",{onSuccess:function(b){var c=b.data.recom_list;var e=c.length;if(e==0){r=false;return}var g=[];var h="//weibo.com/"+w.uid+"/photos#wbphoto_nav";for(var i=0;i<e;i++){g.push({imgsrc:h,img:a.common.extra.imageURL(c[i].pid,{size:"square"})})}f.toprofile.innerHTML=s("#L{去看看%s的图片墙}",b.data.user.gender=="m"?"他":"她");f.toprofile.setAttribute("href",h);f.recBox.innerHTML=a.core.util.easyTemplate(d,{recimgs:g}).toString();r=true},onFail:function(a){r=false;f["recLayer"]&&(f["recLayer"].style.display="none");p=false},onError:function(a){r=false;f["recLayer"]&&(f["recLayer"].style.display="none");p=false}}).request({mid:w.mid,uid:w.uid})}};var y=function(){var c=w.pids;k=w["currentPid"]||c[0];j=c.length;i=x.getIndex(c,k);var d=[];var g=[];for(var h=0;h<j;h++){g.push({pid:c[h],url:a.common.extra.imageURL(c[h],{size:"square"})})}var n=false;if(w.pids.length>1&&!b.ispay){if(i!=0){n=true}}var o=b.ispay;if(i==0){o=!b.ispay}var p=a.core.util.easyTemplate(s(e),{picShow:d,picChoose:g,currentPid:c[i],currentUrl:a.common.extra.imageURL(c[i],{size:"bmiddle"}),isForward:w["isForward"],toSmall:w["toSmall"],tags:b.tags,ispay:o,uid:b.uid,isheight:n}).toString();var q=a.builder(p);f=a.lib.kit.dom.parseDOM(q.list);l=a.delegatedEvent(f["imagesBox"]);m=a.core.ani.tween(f["picChoose"],{duration:150});if(g.length==1){f["picChoose"].style.display="none";v=1}else{f["picChoose"].style.display="block";v=0}x.setIndex(i);x.setpid();(function(){var b=a.sizzle("[node-type=multitag]",f["imgBox"]);if(b.length==0){return}a.core.arr.foreach(b,function(a,b){var c=STK.core.dom.getSize(a);var d=parseFloat(a.style.left,10)/100+c.width/440;if(parseFloat(a.style.top,10)/100>.92){a.style.marginTop="-21px"}if(d>1){a.className="tag_showpicR";a.style.marginLeft=-c.width+"px"}a.style.display=""})})()};var z={gesture:function(b){b=a.fixEvent(b);var c=b.clientX-a.position(f["picShow"]).l;if(c<w["picShowWidth"]*3/10){if(i==0){if(w["toSmall"]==1){f["picShow"].className="bigpic smallcursor";h="small"}else{f["picShow"].className="bigpic";h=""}}else{f["picShow"].className="bigpic prev";h="left"}}else if(c<w["picShowWidth"]*7/10){if(w["toSmall"]==1){f["picShow"].className="bigpic zoom-out";h="small"}else{f["picShow"].className="bigpic";h=""}}else if(c>w["picShowWidth"]*7/10){if(p){if(w["toSmall"]==1){f["picShow"].className="bigpic zoom-out";h="small"}else{f["picShow"].className="bigpic";h=""}}else{if(v){return}f["picShow"].className="bigpic next";h="right"}}},left:function(a){var b=a?a.evt:window.event,c,d;if(b){c=b.target||b.srcElement;d=c.getAttribute("action-type")||c["action-type"];if(d=="multitag"||c.nodeName=="EM")return}x.setIndex("min");x.setPic(w.pids[i],true)},right:function(a){var b=a?a.evt:window.event,c,d;if(b){c=b.target||b.srcElement;d=c.getAttribute("action-type")||c["action-type"];if(d=="multitag"||c.nodeName=="EM")return}x.setIndex("add");x.setPic(w.pids[i])},gestureClick:function(b){switch(h){case"left":if(p){z.closeRecLayer()}z.left();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed","image_feed_next");break;case"small":z.tosmall();break;case"right":b=a.lib.kit.evt.fixEvent(b);u=b.pageY-a.position(f["picShow"]).t;z.right();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed","image_feed_next");break}},prev:function(){var a=i-7;x.scrollList(a,true)},next:function(){var a=i+7;x.scrollList(a,true)},multitag:function(a){},tosmall:function(b){var d=b?b.evt:window.event,e,f;if(d){e=d.target||d.srcElement;f=e.getAttribute("action-type")||e["action-type"];if(f=="multitag"||e.nodeName=="EM")return}if(w["toSmall"]==0){return}a.custEvent.fire(c,"tosmall")},thumbItem:function(a){if(p){z.closeRecLayer()}if(a.data.pid.indexOf("https")!=-1||a.data.pid.indexOf("http")!=-1){var b=a.el.attributes["action-data"].nodeValue;var c=b.indexOf("pid");var d=b.substr(c+4)}else{var d=a.data.pid}var e=x.getIndex(w.pids,d);var f=e<i?true:false;x.setIndex(e);x.setPic(w.pids[i],f);window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed","image_feed_next")},turnRight:function(a){x.rotateImg(a,90)},turnLeft:function(a){x.rotateImg(a,-90)},closeRecLayer:function(){f["picShow"].style.height="auto";f["recLayer"].style.display="none";p=false}};var A=function(){a.addEvent(f["picShow"],"mousemove",z.gesture);a.addEvent(f["picShow"],"click",z.gestureClick);a.addEvent(f["picShow"],"mousemove",z.gesture);a.addEvent(f["picShow"],"mouseover",function(b){var c=a.sizzle("[node-type=multitag]",this);if(c.length==0){return}a.core.arr.foreach(c,function(a,b){var c=STK.core.dom.getSize(a);var d=parseFloat(a.style.left,10)/100+c.width/440;if(d>1){a.className="tag_showpicR";a.style.marginLeft=-c.width+"px"}a.style.display=""})});a.addEvent(f["picShow"],"mouseout",function(b){var c=a.sizzle("[node-type=multitag]",this);if(c.length==0){return}a.core.arr.foreach(c,function(a,b){a.style.display="none"})});l.add("tosmall","click",z.tosmall);l.add("thumbItem","click",z.thumbItem);l.add("turnLeft","click",z.turnLeft);l.add("turnRight","click",z.turnRight);l.add("closeRecLayer","click",z.closeRecLayer);a.core.evt.hotKey.add(document.body,["ctrl+Left"],z.left);a.core.evt.hotKey.add(document.body,["ctrl+Right"],z.right);a.custEvent.define(c,["tosmall"])};var B=function(){y();A()};B();var C=function(){a.removeEvent(f["picShow"],"mousemove",z.gesture);a.removeEvent(f["picShow"],"click",z.gestureClick);a.core.evt.hotKey.remove(document.body,["ctrl+Left"],z.left);a.core.evt.hotKey.remove(document.body,["ctrl+Right"],z.right);l.destroy();a.removeNode(f["imagesBox"])};var D=function(){return f["imagesBox"]};c.destroy=C;c.getOuter=D;return c}});
STK.register("common.feed.feedList.plugins.images",function(a){var b=$CONFIG["imgPath"];return function(c){if(!c){a.log("images : need object of the baseFeedList Class");return}var d=c.getNode();var e=c.getDEvent();var f=a.common.feed.feedList.utils;var g={};var h=false;var i;var j={getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getActionData:function(a,b){if(a.tagName.toLowerCase=="body"){return null}if(a.getAttribute("node-type")==b){return a.getAttribute("action-data")}return arguments.callee(a.parentNode,b)}};var k={fl_pics:function(c){if(h){return}h=true;if(!i){i=a.C("img");i.className="picloading";i.src=b+"style/images/common/loading.gif"}if(c.data.pic_id.indexOf("https")!=-1||c.data.pic_id.indexOf("http")!=-1){var e=c.el.attributes["action-data"].nodeValue;var g=e.indexOf("pic_id");var k=e.substr(g+7)}else{var k=c.data||{}}c.el.parentNode.appendChild(i);i.style.display="";var l=a.C("img");var m=f.getFeedNode(c.el,d);var n=j.getPDNodes(m);var o=a.core.json.queryToJson(j.getActionData(c.el,"fl_pic_list"));var p=o.uid;var q=o.mid?o.mid:f.getMid(c.el,d);var r=true;if(c.data.pic_id.indexOf("https")!=-1||c.data.pic_id.indexOf("http")!=-1){var s=j.getActionData(c.el,"fl_pic_list");var t=s.indexOf("pic_ids");var u=s.substr(t+8);var v=u.split(";");var w=k||v[0];console.log(k);console.log(w);console.log(v);r=c.data.is_paid==1?true:false}else{var v=o.pic_ids.split(",");var w=k.pic_id||v[0]}l.onload=function(){l.onload=null;i.style.display="none";i=null;n.prev.style.display="none";var b=a.lib.kit.extra.multiimages({pids:v,currentPid:w,mid:q,uid:p,ispay:r});n.disp.appendChild(b.getOuter());n.disp.style.display="";h=false;a.custEvent.add(b,"tosmall",function(c,d){if(a.position(n.disp).t<a.scrollPos().top){m.scrollIntoView()}n.disp.style.display="none";n.prev.style.display="";b.destroy()})};var x=a.common.extra.imageURL(w,{size:"bmiddle"});l.src=x;if(v.length>1&&!r){l.width=440;l.height=280}}};var l=function(){e.add("fl_pics","click",k.fl_pics)};var m=function(){l()};m();return g}});
STK.register("common.trans.share",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("share",{url:"/ajax/mblog/repost/web",method:"get"});return b});
STK.register("common.dialog.shareForFeedList",function(a){var b=a.lib.kit.extra.language;var c={title:"#L{分享到微博}"};var d={limitNum:140};return function(e,f,g){var h;e.type==="video"?h="value=direct_video_pub":h="value=weibo_url_pub";e.value==="1"&&(h="value=direct_video_pub_1");var i=e.fwnum;var j=""+'<div class="card card-sender" node-type="outer">'+'<div node-type="wrap">'+'<div class="title no_title" node-type="info"></div>'+'<div class="num" node-type="num"></div>'+'<div class="func">'+'<div class="input-wrap input-wrap-share">'+'<div class="input">'+'<textarea name="" node-type="textEl"></textarea>'+'<p class="succeed" style="display:none" node-type="successTip"><i class="icon-warn icon-ok-l"></i>#L{分享成功}</p>'+"</div>"+'<div class="func">'+'<div class="btn">'+'<a class="s-btn-g" href="javascript:void(0);" node-type="submit" suda-data="key=tblog_search_v4.1&'+h+'">#L{分享}</a></div>'+"</div>"+"</div>"+"</div>"+'<div class="kind" node-type="widget">'+"</div>"+"</div>";if(i&&i!=0){j+='<div class="feed_repeat feed_repeat_share" node-type="shareWrap">'+'<div class="func">'+"#L{当前已分享}"+i+'#L{次，}<a class="W_linkb" title="" href="javascript:;" node-type="showShareList" action-type="show" action-data="">#L{展开}</a>'+'<a class="W_Titarr_off" title="" node-type="arrow" href="javascript:;" action-type="show" action-data=""></a>'+"</div>"+'<div node-type="shareList">'+"</div>"+"</div>"}j=b(j);var l={};var m=false,n,o,p,q,r,s,t,u,v,w,x,y,z="on";var A={};o=a.parseParam({styleId:"1"},e);w=a.custEvent.define(l,"publish");a.custEvent.define(l,"hide");var B=function(){if(q){if(r==="error"){a.common.extra.shine(t["textEl"])}return}var b=u.API.getWords();q=true;r="loading";if(x){if(b.indexOf(x)===-1){b=b+x}}setTimeout(function(){C(b)},200)};var C=function(a){var b={};b["style_type"]=o["styleId"];b["content"]=a;b["action_code"]=11;if(u.API.getExtra()){b["pic_id"]=u.API.getExtra()||""}v.request(b)};var D=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){B();u.API.blur()}};var E=function(a,c){var d=c["isOver"];if(!d){q=false;r="";t["submit"].className="s-btn-g";t["num"].innerHTML=b("#L{还可以输入}<strong>"+(140-c.count)+"</strong>#L{字}")}else{q=true;r="error";t["submit"].className="s-btn-g disable"}};var F=function(b,c){t["submit"].className="s-btn-g";q=true;r="";t["successTip"].style.display="";t["textEl"].value="";setTimeout(function(){t["successTip"].style.display="none";s.hide()},2*1e3);a.custEvent.fire(w,"publish",function(b,c){a.custEvent.fire(l,"publish",c)});a.custEvent.fire(w,"publish",[b["data"],params]);a.common.channel.feed.fire("publish",[b["data"],params])};var G=function(b,c){q=false;if(b.code=="100027"||b.code=="100004"){var d=a.common.dialog.validateCode();d.validateIntercept(b,c,{requestAjax:v,param:c});return}r="";a.lib.ui.alert(b["msg"])};var H=function(b,c){q=false;r="";a.lib.ui.alert()};var I=function(a){t["textEl"].value="";u.API.insertText(a["content"]);if(a["content"]){q=false;r="";t["submit"].className="s-btn-g"}else{q=true;r="error";t["submit"].className="s-btn-g disable"}};var J=function(){q=false};var K=function(){A=a.lib.kit.dom.parseDOM(a.builder(j).list);u=a.common.editor.base(a.lib.kit.extra.language(j),d);t=u.nodeList;if($CONFIG.lang=="en-us"){a.addClassName(t["wrap"],"send_weibo_en")}};var L={changeShareList:function(c){var d=c.el;if(m==false){var e=a.common.trans.share.getTrans("share",{onSuccess:function(a,c){t["shareList"].innerHTML=a.data.html;t["arrow"].className="W_Titarr_on";t["showShareList"].innerHTML=b("#L{收起分享记录}");m=true},onError:function(b,c){a.lib.ui.alert(b.msg)}});e.request({url_short:g,fwnum:i})}else{t["shareList"].innerHTML="";t["showShareList"].innerHTML=b("展开");t["arrow"].className="W_Titarr_off";m=false}}};var M=function(){a.addEvent(t["submit"],"click",B);a.addEvent(t["textEl"],"keypress",D);if(t["shareWrap"]){n=a.core.evt.delegatedEvent(t["shareWrap"]);n.add("show","click",L.changeShareList)}};var N=function(){a.custEvent.add(u,"textNum",E)};var O=function(){v=a.common.trans.publisher.getTrans("publish",{onSuccess:F,onError:G,onFail:H})};var P=function(){K();M();N();O()};var Q=function(d){if(!u){P()}var e=a.parseParam({content:"",defaultValue:"",info:"",title:b(c["title"])},d);s=a.lib.ui.dialog();s.setTitle(e["title"]);s.appendChild(t["outer"]);s.show();s.setMiddle();I(e);u.API.focus();a.custEvent.add(s,"hide",function(){a.custEvent.remove(s,"hide",arguments.callee);u.closeWidget();J();a.custEvent.fire(w,"hide")});x=e["defaultValue"]};var R=function(){s.hide();s=null};var S=function(){if(s){s.hide()}a.removeEvent(t["submit"],"click",B);a.removeEvent(t["textEl"],"keypress",D);a.custEvent.remove(u,"textNum",E);a.custEvent.undefine(w,"publish");t=null;v=null;q=false;for(k in l){delete l[k]}l=null};l.show=Q;l.hide=R;l.destroy=S;return l}});
STK.register("common.feed.feedList.plugins.share",function(a){var b=a.common.feed.feedList.utils;var c=a.lib.kit.extra.language;var d=c("#L{分享}");return function(e,f,g){if(!e){a.log("share : need object of the baseFeedList Class");return}f=a.parseParam({forwardStyleId:"1"},f);var g=e.getNode();var h={};var i;var j;a.custEvent.add(j,"publish",function(a,b){if(!i)return;var c=i.innerHTML.match(/\(([\d]*)\)/);i.innerHTML=d+"("+(c?parseInt(c[1])+1:1)+")";i=undefined});a.custEvent.add(j,"hide",function(){i=undefined});e.getDEvent().add("web_share","click",function(d){j=a.common.dialog.shareForFeedList(d.data,g,d.data.surl);var e="",f="";if(d.data.title){e=decodeURIComponent(d.data.title)}if(d.data.lurl){f=d.data.lurl}i=d.el;j.show({content:e+" "+f,title:c("#L{分享到微博}")});return b.preventDefault()});h.destroy=function(){a.custEvent.remove(j);j.destroy();j=i=e=g=null};return h}});
STK.register("common.trans.attitude",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("feedSmall",{url:"/aj/attitude/small?_wv=5",method:"get"});c("add",{url:"/ajax_Mblog/likeAdd",method:"post"});c("big",{url:"/aj/attitude/big?_wv=5",method:"get"});c("in",{url:"/aj/attitude/in?_wv=5",method:"get"});c("del",{url:"/ajax/mblog/like/del",method:"post"});c("miniadd",{url:"/ajax_Mblog/likeAdd",method:"post"});c("minismall",{url:"/ajax/mblog/like/small",method:"get"});c("likein",{url:"/aj/like/in?_wv=5",method:"get"});c("likebig",{url:"/aj/like/big?_wv=5",method:"get"});c("minidel",{url:"/ajax/mblog/like/del",method:"post"});c("morethan140",{url:"/ajax/direct/morethan140",method:"get"});return b});
STK.register("common.feed.feedList.plugins.attitudeMini",function(a){return function(b){var c=a.common.trans.attitude;var d=b.getNode(),e=false,f,g={},h=[],i=a.common.feed.feedList.utils,j=b.getDEvent(),k,l=true,m=[],n={},o,p=true;var q,r,s=600,t=350;var u='<div class="W_layer" style="left: 670.5px; top: 2580px; display:none;" node-type="outer">'+' <div class="bg">'+'<table border="0" cellspacing="0" cellpadding="0">'+" <tbody><tr>"+"<td>"+' <div class="content layer_emotion" node-type="inner">'+'<ul class="emotion_list clearfix" node-type="faceList">'+"</ul>"+" </div>"+"</td>"+"</tr>"+"</tbody></table>"+'<div class="arrow arrow_t"></div>'+"</div>"+"</div>";f=a.lib.kit.dom.parseDOM(a.builder(u).list);document.body.appendChild(f.outer);q=a.delegatedEvent(f.outer);var v,w;var x={go:function(a){w=a.el;v=parseInt(w.innerHTML.replace(/^.*\((\d+)\)$/,"$1"))||0;if(a.data&&a.data.iscomment&&a.data.iscomment==="1"){v=parseInt(w.innerHTML.replace(/.*?(\d+).*/,function(a,b){return b.length>0?b:"0"}))}if(v===0){return}e=true;x.stop(a,true);r=setTimeout(function(){x.trans(a)},s)},fill:function(b){if(!l){return}l=false;var d=a.core.json.merge(b.data,{location:$CONFIG["location"]});d.action_code="13";c.getTrans("miniadd",{onSuccess:function(c){v=parseInt(b.el.innerHTML.replace(/^.*<em>(\d+)<\/em>.*$/i,"$1"))||0;var d=c.data.is_del?true:false;var e="icon-act icon-act-praise"+(d?"":"d");if(d){if(v>0){v--}}else{v++}b.el.innerHTML='<i class="'+e+'"></i> <em>'+(v<=0?"":v)+"</em>";if(!d&&c.data.html&&f){if(k){k.style.display="none"}b.el.title=a.lib.kit.extra.language("#L{取消赞}");a.insertHTML(f.faceList,c.data.html,"afterbegin")}else{b.el.title=a.lib.kit.extra.language("#L{赞}");a.removeNode(a.sizzle('[uid="'+$CONFIG["uid"]+'"]',f.faceList)[0]);if(k){k.style.display=""}if(a.sizzle("[uid]",f.faceList).length<=0){x.stop(b,true)}}var g=b.el.getAttribute("suda-data");if(d){g=g.replace(/act:del/g,"act:add");b.el.setAttribute("suda-data",g)}else{g=g.replace(/act:add/g,"act:del");b.el.setAttribute("suda-data",g)}setTimeout(function(){l=true},1e3)},onFail:function(b){a.lib.ui.alert(b.msg);setTimeout(function(){l=true},1e3)},onError:function(b){a.lib.ui.alert(b.msg);setTimeout(function(){l=true},1e3)}}).request(d)},trans:function(b){if(f&&o&&f.mid==o&&f.mid==b.data.mid&&b.data&&!b.data.iscomment){if(f.outer.style.display=="none"&&a.sizzle("[uid]",f.outer).length){var e=a.position(b.el);f.outer.style.display="";a.setXY(f.outer,{t:e.t+b.el.offsetHeight+6,l:e.l+b.el.offsetWidth/2-36})}return}f&&f.outer&&(f.outer.style.display="none");var g={location:$CONFIG["location"]};if(b.data&&b.data.iscomment&&b.data.iscomment==="1"){g.mid=b.data.mid;g.iscomment=b.data.iscomment}else{g.mid=i.getMid(b.el,d)}c.getTrans("minismall",{onSuccess:function(c){z();v=c.data.total_number;o=b.data.mid;if(b.data&&b.data.iscomment&&b.data.iscomment!="1"){b.el&&(b.el.innerHTML=b.el.innerHTML.replace(/\((.*?)\)/m,"")+(c.data.total_number?"("+c.data.total_number+")":""))}if(c.data.total_number=="0"){return}var d=a.lib.kit.dom.parseDOM(a.builder(c.data.html).list);f.faceList.innerHTML=d.faceList.innerHTML;var e=a.sizzle("[uid]",f.faceList);if(!a.sizzle('[uid="'+$CONFIG["uid"]+'"]',f.faceList)[0]){k=e[3]}f.mid=b.data.mid;document.body.appendChild(f.outer);f.outer.style.display="";var g=a.position(b.el);a.setXY(f.outer,{t:g.t+b.el.offsetHeight+6,l:g.l+b.el.offsetWidth/2-36});x.checkPosition(b.el)},onFail:function(){},onError:function(){}}).request(g)},stop:function(a,b){e=false;if(b){y();return}z();h.push(setTimeout(y,t))},checkPosition:function(b){n=a.position(f.outer);clearInterval(m);m=setInterval(function(){var c=a.position(b);if(n.l!=parseInt(c.l+b.offsetWidth/2-36)||n.t!=parseInt(c.t+b.offsetHeight+6)){x.stop()}},500)},cancelLike:function(b){a.preventDefault();v--;a.removeNode(a.lib.kit.dom.parents(b.el,{expr:"li",maxLength:1})[0]);if(b.data&&b.data.iscomment&&b.data.iscomment==="1"){a.core.evt.fireEvent(w.parentNode,"click");return}w.title=a.lib.kit.extra.language("#L{赞}");w.innerHTML='<em class="'+"W_ico12 icon_praised_b"+'"></em>('+v+")";if(k){k.style.display=""}if(a.sizzle("[uid]",f.faceList).length<=0){f.outer.style.display="none"}c.getTrans("minidel",{onSuccess:a.core.func.empty,onError:a.core.func.empty}).request(b.data)},showMore:function(b){STK.core.evt.preventDefault();var c=b.el.parentNode;var d=a.core.dom.next(c)||null;if(c&&d&&c.nodeName=="P"&&d.nodeName=="P"&&d.getAttribute("node-type")=="feed_list_content_full"){a.core.dom.setStyle(c,"display","none");a.core.dom.setStyle(d,"display","")}},hideMore:function(b){var c=b.el.parentNode;var d=a.core.dom.prev(c);if(d&&c&&d.nodeName=="P"&&c.nodeName=="P"&&c.getAttribute("node-type")=="feed_list_content_full"){a.core.dom.setStyle(d,"display","");a.core.dom.setStyle(c,"display","none")}},showSimple:function(b){var c=b.el.parentNode||null;var d=a.core.dom.prev(b.el.parentNode)||null;if(d&&c&&d.nodeName=="P"&&c.nodeName=="P"){a.core.dom.setStyle(d,"display","");a.core.dom.setStyle(c,"display","none")}}};var y=function(){clearTimeout(r);z();clearInterval(m);f&&(f.outer.style.display="none");n=undefined};var z=function(){while(h.length){clearTimeout(h.pop())}};var A=function(){j.add("feed_list_like","click",x.fill);j.add("comment_list_like","mouseover",x.go);j.add("comment_list_like","mouseout",x.stop);j.add("comment_list_like","click",x.stop);j.add("fl_unfold","click",x.showMore);j.add("fl_fold","click",x.hideMore);q.add("like_del","click",x.cancelLike)};var B=function(){A();a.addEvent(f.outer,"mouseover",function(){clearTimeout(h)});a.addEvent(f.outer,"mouseout",function(){x.stop()})};B();g.destroy=function(){j.remove("feed_list_like","click",x.fill);j.remove("fl_unfold","click",x.showMore);q.destroy();a.removeEvent(f.outer,"mouseover");a.removeEvent(f.outer,"mouseout")};return g}});
STK.register("common.feed.feedList.plugins.rightMenu",function(a){var b=a.core.evt.addEvent;var c=a.core.evt.removeEvent;return function(b){if(!b){a.log(" rightMenu : need object of the baseFeedList Class");return}var c={},d,e,f=b.getNode(),g=b.getDEvent(),h=a.common.feed.feedList.utils;var i={getStyleDis:function(a){return window.getComputedStyle?window.getComputedStyle(a,null).display:a.currentStyle.display},getTarget:function(a){return!a||a==document.body?!1:a.getAttribute&&a.getAttribute("action-type")=="fl_menu"?a:arguments.callee(a.parentNode)},showFMenu:function(b){var c=h.getFeedNode(b.el);var d=a.sizzle('[node-type="fl_menu_right"]',c)[0]||null;if(e&&e!=d&&i.getStyleDis(e)!="none"){e.style.display="none"}d.style.display=i.getStyleDis(d)=="none"?"block":"none";e=d},hideMenu:function(b){var c=a.fixEvent().target;if(!i.getTarget(c)&&e&&i.getStyleDis(e)!="none"){e.style.display="none"}},weiboAct:function(b){var c=b.data;a.common.trans.global.getTrans("weiboActs",{onSuccess:function(b,c){if(b.code=="100000"){var d=document.createElement("div");d.id="J_WB_layer";if(b.data.url){d.innerHTML='<div class="m-outer"></div><div class="m-layer" style="position:fixed;z-index:1000;left:40%;top:400px;"><div class="inner"><div class="m-alert"><p class="para">'+b.msg+'</p><div class="btn-box"><a href="javascript:;" title="确定" class="s-btn-g" action-type="suretopweibo" action-data="'+b.data.params+'">确认置顶</a></div></div></div></div>'}else{d.innerHTML='<div class="m-outer"></div><div class="m-layer" style="position:fixed;z-index:1000;left:45%;top:400px;"><div class="inner"><div class="m-alert"><p class="para"><i class="icon-warn icon-ok-m"></i>'+b.msg+"</p></div></div></div>"}f.appendChild(d);if(b.data.url==undefined){setTimeout(function(){f.removeChild(document.getElementById("J_WB_layer"))},1e3)}}else{a.lib.ui.alert(b.msg)}},onError:function(b){a.lib.ui.alert(b.msg)}}).request(c)},suretop:function(b){var c=b.data;a.common.trans.global.getTrans("weibotop",{onSuccess:function(b,c){if(b.code=="100000"){f.removeChild(document.getElementById("J_WB_layer"));var d=document.createElement("div");d.id="J_WB_layer2";d.innerHTML='<div class="m-outer"></div><div class="m-layer" style="position:fixed;z-index:1000;left:45%;top:400px;"><div class="inner"><div class="m-alert"><p class="para"><i class="icon-warn icon-ok-m"></i>'+b.msg+"</p></div></div></div>";f.appendChild(d);setTimeout(function(){f.removeChild(document.getElementById("J_WB_layer2"))},1e3)}else{a.lib.ui.alert(b.msg)}},onError:function(b){a.lib.ui.alert(b.msg)}}).request(c)}};var j=function(){k();l();m();n();o()};var k=function(){d=a.builder(f);if(!d){throw"Lack of necessary nodes  -> path : comp.filter.filtertab"}};var l=function(){};var m=function(){g.add("fl_menu","click",i.showFMenu);g.add("topicweibo","click",i.weiboAct);g.add("suretopweibo","click",i.suretop)};var n=function(){a.addEvent(document.body,"click",i.hideMenu)};var o=function(){};var p=function(){};j();c.destroy=function(){g.remove("fl_menu","click",i.showFMenu);g.remove("topicweibo","click",i.weiboAct);g.remove("suretopweibo","click",i.suretop);a.removeEvent(document.body,"click")};return c}});
STK.register("lib.module.editorPlugin.tab",function(a){return function(b,c){function s(b,c){var e={evtType:"click",tNodes:"",dNodes:"",className:"cur",cb:function(){},defaultIdx:0};e=a.core.obj.parseParam(e,c);l=e.cb;n=e.className;p=e.defaultIdx;m=e.evtType;j=typeof e.tNodes=="string"?a.sizzle(e.tNodes,b):e.tNodes;o=j.length;if(e.dNodes!==""){k=typeof e.dNodes=="string"?a.sizzle(e.dNodes,b):e.dNodes;r()}for(var f=0;f<o;f++){d(j[f],m,function(a){return function(){h();q(a)}}(f))}}function r(){if(!g(j)){throw"module.editorPlugin.tab needs tNodes as Array!"}if(!g(k)){throw"module.editorPlugin.tab needs tNodes as Array!"}if(j.length!=k.length){throw"module.editorPlugin.tab needs tNodes'length equal to dNodes'length!"}}function q(a){var b=g(l)?l[a]:l,c=j[a],d=g(k)?k[a]:null;otNode=j[p],odNode=g(k)?k[p]:null;if(d){i(k[p],"display","none");i(k[a],"display","")}f(j[p],n);e(j[a],n);if(a==p){return}b({idx:a,node:d});p=a}var d=a.core.evt.addEvent,e=a.core.dom.addClassName,f=a.core.dom.removeClassName,g=a.core.arr.isArray,h=a.core.evt.preventDefault,i=a.core.dom.setStyle,j,k,l,m,n,o,p;var t={};t.initView=function(a){a=a||c["defaultIdx"];i(k[a],"display","");e(j[a],n);var b=g(l)?l[a]:l,d=g(k)?k[a]:null;b({idx:a,node:d});p=a};t.refresh=function(b){j[b]&&a.fireEvent(j[b],"click")};s(b,c);return t}});
STK.register("lib.kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/;var d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!y){return}var c=b?"visible":"hidden";if(u&&Q(a)){Q(a).style.visibility=c}else{U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(z.ie&&z.mac){return}var g=j.getElementsByTagName("head")[0];if(!g){return}var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);if(z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0){w=j.styleSheets[j.styleSheets.length-1]}x=h}if(z.ie&&z.win){if(w&&typeof w.addRule==c){w.addRule(b,d)}}else{if(w&&typeof j.createTextNode!=a){w.appendChild(j.createTextNode(b+" {"+d+"}"))}}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?true:false}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null}}b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT"){if(z.ie&&z.win){b.style.display="none";(function(){if(b.readyState==4){P(a)}else{setTimeout(arguments.callee,10)}})()}else{b.parentNode.removeChild(b)}}}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312){return g}if(h){if(typeof b.id==a){b.id=e}if(z.ie&&z.win){var i="";for(var j in b){if(b[j]!=Object.prototype[j]){if(j.toLowerCase()=="data"){d.movie=b[j]}else{if(j.toLowerCase()=="styleclass"){i+=' class="'+b[j]+'"'}else{if(j.toLowerCase()!="classid"){i+=" "+j+'="'+b[j]+'"'}}}}}var k="";for(var l in d){if(d[l]!=Object.prototype[l]){k+='<param name="'+l+'" value="'+d[l]+'" />'}}h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b){if(b[n]!=Object.prototype[n]){if(n.toLowerCase()=="styleclass"){m.setAttribute("class",b[n])}else{if(n.toLowerCase()!="classid"){m.setAttribute(n,b[n])}}}}for(var p in d){if(d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"){N(m,p,d[p])}}h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie){b.innerHTML=a.innerHTML}else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++){if(!(e[g].nodeType==1&&e[g].nodeName=="PARAM")&&!(e[g].nodeType==8)){b.appendChild(e[g].cloneNode(true))}}}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(L(a),a)}}function J(b,c,d,e){v=true;s=e||null;t={success:false,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310){b.width="310"}if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137){b.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;if(typeof c.flashvars!=a){c.flashvars+="&"+k}else{c.flashvars=k}if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){if(f.readyState==4){f.parentNode.removeChild(f)}else{setTimeout(arguments.callee,10)}})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null;var e=Q(b);if(e&&e.nodeName=="OBJECT"){if(typeof e.SetVariable!=a){d=e}else{var f=e.getElementsByTagName(c)[0];if(f){d=f}}}return d}function G(){var b=n.length;if(b>0){for(var c=0;c<b;c++){var d=n[c].id;var e=n[c].callbackFn;var f={success:false,id:d};if(z.pv[0]>0){var g=Q(d);if(g){if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,true);if(e){f.success=true;f.ref=H(d);e(f)}}else{if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";if(g.getAttribute("class")){h.styleclass=g.getAttribute("class")}if(g.getAttribute("align")){h.align=g.getAttribute("align")}var i={};var j=g.getElementsByTagName("param");var k=j.length;for(var l=0;l<k;l++){if(j[l].getAttribute("name").toLowerCase()!="movie"){i[j[l].getAttribute("name")]=j[l].getAttribute("value")}}J(h,i,d,e)}else{K(g);if(e){e(f)}}}}}else{V(d,true);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=true;f.ref=m}e(f)}}}}}function F(){var b=j.getElementsByTagName("body")[0];var d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else{if(g<10){g++;setTimeout(arguments.callee,10);return}}b.removeChild(d);e=null;G()})()}else{G()}}function E(){if(l){F()}else{G()}}function D(b){if(typeof i.addEventListener!=a){i.addEventListener("load",b,false)}else{if(typeof j.addEventListener!=a){j.addEventListener("load",b,false)}else{if(typeof i.attachEvent!=a){S(i,"onload",b)}else{if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else{i.onload=b}}}}}function C(a){if(u){a()}else{m[m.length]=a}}function B(){if(u){return}try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=true;var c=m.length;for(var d=0;d<c;d++){m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=false,m=[E],n=[],o=[],p=[],q,r,s,t,u=false,v=false,w,x,y=true,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,p=!+"1",q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&!(typeof k.mimeTypes!=a&&k.mimeTypes[f]&&!k.mimeTypes[f].enabledPlugin)){l=true;p=false;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof i.ActiveXObject!=a){try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=true;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}}}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!z.w3){return}if(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body)){B()}if(!u){if(typeof j.addEventListener!=a){j.addEventListener("DOMContentLoaded",B,false)}if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});if(i==top){(function(){if(u){return}try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()})()}}if(z.wk){(function(){if(u){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()})()}D(B)}}();var X=function(){if(z.ie&&z.win){window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++){p[c][0].detachEvent(p[c][1],p[c][2])}var d=o.length;for(var e=0;e<d;e++){O(o[e])}for(var f in z){z[f]=null}z=null;for(var g in b){b[g]=null}b=null})}}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,false)}else{if(d){d({success:false,id:a})}}},getObjectById:function(a){if(z.w3){return H(a)}},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:false,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,false);C(function(){e+="";f+="";var n={};if(k&&typeof k===c){for(var o in k){n[o]=k[o]}}n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c){for(var q in j){p[q]=j[q]}}if(i&&typeof i===c){for(var r in i){if(typeof p.flashvars!=a){p.flashvars+="&"+r+"="+i[r]}else{p.flashvars=r+"="+i[r]}}}if(T(g)){var s=M(n,p,d);if(n.id==d){V(d,true)}m.success=true;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}else{V(d,true)}}if(l){l(m)}})}else{if(l){l(m)}}},switchOffAutoHideShow:function(){y=false},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){if(z.w3){return M(a,b,c)}else{return undefined}},showExpressInstall:function(a,b,c,d){if(z.w3&&I()){J(a,b,c,d)}},removeSWF:function(a){if(z.w3){O(a)}},createCSS:function(a,b,c,d){if(z.w3){U(a,b,c,d)}},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){if(/\?/.test(b)){b=b.split("?")[1]}if(a==null){return W(b)}var c=b.split("&");for(var d=0;d<c.length;d++){if(c[d].substring(0,c[d].indexOf("="))==a){return W(c[d].substring(c[d].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,true);if(z.ie&&z.win){q.style.display="block"}}if(s){s(t)}}v=false}}}}();return b});
STK.register("common.flash.imgUpload",function(a){var b=document.documentElement,c=document.body;var d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}};var e=function(a){var b={cn:"zh_CN",tw:"zh_TW"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG["version"],swf_path:$CONFIG["jsPath"]+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"};var h={},i,j;var k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){if(!a.IE){m.getFlash(g.id_swf).height=b}},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}};var l={version:g.version,language:e($CONFIG["lang"]),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"};var m={init:function(){if(!b.id){return}i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";if(!m.getFlash(g.id_swf)){m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!(c[a]&&c[a][b])},bindEvt:function(a){for(key in a){k[a[key]]&&!m.checkAction(g.channel,a[key])&&STK.core.util.listener.register(g.channel,a[key],k[a[key]])}},build:function(){var c={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path};var d={id:b.id};m.bindEvt(l);a.lib.kit.extra.swfobject.embedSWF(g.swf_path+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,c,d)},getFlash:function(){if(navigator.appName.indexOf("Microsoft")!=-1){return window[b.id]}else{return document[b.id]}},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px");m.autoScroll(j.t,j.t+(c-f))},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++){e[f]=h=h/2}clearInterval(d);d=setInterval(function(){if(e.length){window.scrollTo(0,b+e.shift());return}clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){if(a.IE){for(key in l){k[l[key]]&&STK.core.util.listener.remove(g.channel,l[key],k[l[key]])}i.innerHTML=""}};m.init();return h}});
STK.register("common.trans.editor",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("face",{url:"/aj/mblog/face?type=face"});c("magicFace",{url:"/ajax/mblog/face?type=ani"});c("getTopic",{url:"/aj/mblog/trend"});c("cartoon",{url:"/ajax/mblog/face?type=cartoon"});c("suggestMusic",{url:"/aj/mblog/music/suggest",requestMode:"jsonp"});c("searchMusic",{url:"/aj/mblog/music/search",requestMode:"jsonp"});c("addMusic",{url:"/aj/mblog/music/submit",requestMode:"jsonp"});c("parseMusic",{url:"/aj/mblog/music/parse",requestMode:"jsonp"});c("parseVideo",{url:"/aj/mblog/video"});c("waterMark",{url:"/ajax/account/watermark"});c("publishToWeiqun",{url:"/aj/weiqun/add",method:"post"});c("rectopic",{url:"/aj/mblog/rectopic"});c("interactive",{url:"/aj/mblog/interactive",method:"post"});c("plugin",{url:"/aj/publishplug/plug",method:"post"});c("favSongSearch",{url:"//music.weibo.com/yueku/port/sina_t_getcollect.php",method:"get",requestMode:"jsonp"});c("getOutlinkInfo",{url:"//api.weibo.com/widget/info.json",varkey:"callback",method:"get",requestMode:"jsonp"});c("tabLog",{url:"//music.weibo.com/t/port/ajax_log_action.php",method:"get",requestMode:"jsonp"});return b});
STK.register("common.bubble.image",function(a){var b=window.$CONFIG;var c=""+'<div node-type="outer">'+'<div class="layer_send_pic" node-type="wrap">'+'<div node-type="inner">'+'<div class="tab W_textb">'+"<p>"+'<a class="current" href="javascript:void(0);" node-type="tab">#L{本地上传}</a>'+'<a href="javascript:void(0);" node-type="tab">#L{推荐配图}</a>'+"</p>"+"</div>"+'<div node-type="content"></div>'+"</div>"+'<div node-type="uploaded" style="display:none">'+'<div class="laPic_tit">'+'<span node-type="pName"></span><span class="right"></span></div>'+'<div node-type="picWrap" class="laPic_Pic"></div>'+'<div class="lapic_edit">'+'<a class="beautify" href="javascript:void(0);" node-type="beautify" action-type="beautify" suda-data="key=meitu&value=v4||publish||editor">#L{编辑}</a>'+'<a class="delete" href="javascript:void(0);" action-type="delete">#L{删除}</a>'+"</div>"+"</div>"+"</div>"+'<div node-type="flashPanel"></div>';var d=""+'<div node-type="uppic">'+'\t<div class="laPic_btnBox clearfix">'+'\t\t<div class="laPic_btnmore">'+'\t\t\t<a href="javascript:void(0);" class="S_btn_b choose_pic" node-type="inputCover">'+'\t\t\t\t<span><em class="ico_one"></em>#L{单张图片}</span>'+'\t\t\t\t<form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action="">'+'\t\t\t\t\t<input class="input_f" type="file" hidefoucs="true" style="" node-type="fileBtn" name="pic1"/>'+"\t\t\t\t</form></a>"+"\t\t</div>"+'\t\t<div class="laPic_btnmore">'+'\t\t\t<a href="javascript:void(0);" class="S_btn_b choose_pic" node-type="inputCover">'+'\t\t\t\t<span action-type="more" suda-data="key=meitu&value=v4||publish||more"><em class="ico_ones"></em>#L{多张图片}</span>'+"\t\t\t</a>"+"\t\t</div>"+"\t</div>"+'\t<div class="laPic_con W_textb"  node-type="info">#L{支持上传单张5M以下的gif、jpg、png文件}</div>'+"</div>"+'<div node-type="loading"  style="width:230px;display:none">'+'<div class="laPic_con">'+'<div><i class="W_loading S_loading"></i><span>#L{图片正在上传，请等待}...</span></div>'+"</div>"+'<div class="laPic_btn">'+'<a href="javascript:void(0);" class="Sbtn_a" action-type="cancel"><span>#L{取消上传}</span></a>'+"</div>"+"</div>";var e=""+'<p class="tab_kind W_linkb">'+'<span class="right"><a class="pre_d" action-type="prev" node-type="prev" href="javascript:void(0);"></a><a class="next" action-type="next" node-type="next" href="javascript:void(0);"></a></span>'+'<em node-type="categorys"></em>'+"</p>"+'<div node-type="loading"></div>'+'<div class="detail">'+'<ul node-type="list" class="faces_magic_list clearfix"></ul>'+'<div node-type="page" class="W_pages_minibtn"></div>'+"</div>";var f='<div><i class="W_loading S_loading"></i><span>正在加载，请稍候...</span></div>';var g='<a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{item}">#{item}</a>';var h='<a href="javascript:void(0);"  onclick="return false;" action-type="category" action-data="category=#{item}" class="current W_texta">#{item}</a>';var i='<li><a action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}" class="img" href="javascript:void(0);"><img src="#{thumb}" original="#{original}" title="#{value}" alt="#{phrase}" /></a><span title="#{value}"  action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}">#{phrase}</span></li>';var j='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" >#{label}</a>';var k='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);"  class="current"  onclick="return false;">#{label}</a>';var l='<em class="W_vline">|</em>';var m="默认";var n="#L{分享图片}";var o=5;var p="weibo.com/";var q,r,s,t,u,v,w,x;var y,z,A;var B={};var C={page:0,cache:null,cPoniter:0,categorys:[],currentCategory:m,itemNumber:10};var D,E;var F=a.core.dom.position;var G=a.core.evt.addEvent;var H=a.core.evt.removeEvent;var I=a.lib.kit.extra.language;var J=function(){a.custEvent.define(B,"uploaded");a.custEvent.define(B,"hide");a.custEvent.define(B,"insert");a.custEvent.define(B,"deletePIC");a.custEvent.define(B,"picLoad");a.custEvent.add(q,"hide",function(b){return function(){a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(B,"hide",{})}}(q));a.lib.module.editorPlugin.tab(r,{evtType:"click",tNodes:'[node-type="tab"]',className:"current",cb:[K.init,L.init]});A=a.core.evt.delegatedEvent(r);K.bind()};var K={init:function(){K.initDom();K.bind()},initDom:function(){var b;v=K;D["wrap"].className="layer_send_pic";D["content"].innerHTML=I(d);D["close"]=q.getDomList().close[0];b=a.lib.kit.dom.parseDOM(a.core.dom.builder(r).list);D=a.lib.kit.extra.merge(D,b);K.exchangeInput()},bind:function(){G(D.inputCover,"mousemove",K.ajust);G(D.fileBtn,"change",M.upload);A.add("delete","click",K.deletePic);A.add("cancel","click",K.cancelUpload);A.add("more","click",K.morePic);A.add("beautify","click",K.beautify)},destroy:function(){H(D.inputCover,"mousemove",K.ajust);H(D.fileBtn,"change",M.upload)},handle:function(b){if(!b||b.ret<0){var c="";switch(Math.abs(b.ret)){case 1:c="#L{没有登录}";break;case 4:c="#L{请上传5M以内的JPG、GIF、PNG图片。}";break;default:c="#L{上传图片超时}"}b?K.sendError({ret:b.ret}):K.sendError({ret:"none"});a.lib.ui.alert(I(c),{OK:function(){if(b.ret==-1){window.location.reload()}q.hide()}})}else{K.stopUpload();if(u){D.uppic.style.display="";u=false}else{K.rendSucc(b)}}},sendError:function(b){var c=new Image,d=encodeURIComponent(window.navigator.userAgent);var e=a.lib.kit.extra.merge(b,{ua:d,rnd:(new Date).getTime(),uid:$CONFIG?$CONFIG["uid"]:0,referer:encodeURIComponent(E)});e=a.core.json.jsonToQuery(e);e="//ww1.sinaimg.cn/do_not_delete/fc.html"+"?"+e;c.setAttribute("src",e)},rendLoad:function(){q.stopBoxClose();D.uppic.style.display="none";D.loading.style.display=""},ajust:function(b){var c=a.fixEvent(b);var d=D.inputCover;var e=D.fileBtn;var f=F(d);var g=a.scrollPos();var h=g.top+c.clientY;var i=g.left+c.clientX;var j=parseInt(e.offsetWidth/2),k=parseInt(e.offsetHeight/2);var l=h-f.t;var m=i-f.l;var n=[];n.push("left:"+(m-j)+"px");n.push("top:"+(l-k)+"px");e.style.cssText=n.join(";")},rendSucc:function(b){var c=a.common.extra.imageURL(b.pid);var d=[],e,f;y=y||b.pid;d=y.split(/\/|\\/);e=d[d.length-1];d=e.split(".");if(d.length>1&&a.bLength(d[0])>20){d[0]=a.leftB(d[0],20);f=[d[0],"...",d[1]].join("")}else{f=e}x=b.pid;M.loadPic({url:c,value:f,pid:b.pid});D["beautify"]&&(D["beautify"].style.display="")},deletePic:function(){D.close.style.display="";D.inner.style.display="";D.wrap.style.width="";D.uploaded.style.display="none";D.picWrap.innerHTML="";D.fileBtn.value="";v.destroy();v.init();q.startBoxClose();a.custEvent.fire(B,"deletePIC",{text:I(n)})},stopUpload:function(){D.loading.style.display="none";D.uppic.style.display=""},cancelUpload:function(){u=true;q.startBoxClose();K.stopUpload()},exchangeInput:function(){var b=D.fileBtn;var c=b.parentNode;var d=b.className;var e=b.name;var f=a.C("input");f.className=d;f.name=e;f.type="file";f.hidefocus="true";D.fileBtn=f;c.removeChild(b);c.appendChild(f)},beautifySucess:function(a){y=a;K.handle({pid:a})},morePic:function(){q.stopBoxClose();var c=function(c){var d=c.nickname!="0"||c.logo!="0"||c.domain!="0";var e=b&&b.nick||"";var f="//picupload.service.weibo.com/interface/pic_upload.php?app=miniblog"+"&marks="+(d?"1":"0")+(c.logo=="1"?"&logo=1":"")+(c.nickname=="1"?"&nick="+(e?encodeURIComponent("@"+e):""):"")+(c.domain=="1"?"&url="+p+(b&&b.watermark||b.domain):"")+(c.position?"&markpos="+c.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1";var g={id:"photo_merge",pos:q.getPosition(),service:f,sucess:K.beautifySucess,h:470,w:528,swf:"SinaCollage.swf"};a.common.flash.imgUpload(g,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){q.startBoxClose()},100)}}).show()};w?c(w):M.getWaterMark(c)},beautify:function(){var b={id:"photo_editor",pos:q.getPosition(),service:"//picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:K.beautifySucess,h:385,w:528,swf:"PhotoEditor.swf"};a.common.flash.imgUpload(b,{init:function(b,c){b.setPars(a.common.extra.imageURL(x,{size:"large"}))},close:function(a,b){}}).show()}};var L={init:function(){var b;D.wrap.className="content layer_faces";v=L;K.destroy();D["content"].innerHTML=I(e);b=a.lib.kit.dom.parseDOM(a.core.dom.builder(r).list);D=a.lib.kit.extra.merge(D,b);if(!z){D["loading"].innerHTML=I(f)}L.cartoonStart();L.bind()},bind:function(){A.add("insertSmiley","click",function(a){STK.core.evt.preventDefault();D["beautify"]&&(D["beautify"].style.display="none");var b=a.data.url;var c=a.data.pid;var d=a.data.value;M.loadPic({url:b,value:d,pid:c})});A.add("category","click",function(a){C.page=0;C.currentCategory=a.data.category;L.rend();setTimeout(function(){L.rendCategory(C);L.rendPage(C)},0)});A.add("prev","click",function(a){var b=C.cPoniter;if(b<=0){return false}C.cPoniter-=o;L.rendCategory(C)});A.add("next","click",function(a){var b=C.cPoniter;var c=C.categorys;if(b>=c.length-o){return false}C.cPoniter+=o;L.rendCategory(C)});A.add("page","click",function(a){C.page=parseInt(a.data.num,10);L.rend();setTimeout(function(){L.rendPage(C)},0);return STK.preventDefault(a.evt)})},cartoonStart:function(){a.common.trans.editor.getTrans("cartoon",{onSuccess:function(a,b){C.cache=a.data.more||{};C.categorys=[m];for(var c in C.cache){C.categorys.push(c)}C.cache[m]=a.data.usual.norm;L.cartoonStart=function(){C.page=0;C.cPoniter=0;C.currentCategory=m;L.rend();L.rendCategory(C);L.rendPage(C)};L.cartoonStart()}}).request({})},rend:function(b,c){var d=C.currentCategory;var e=C.cache[d];var f=C.page;var g=C.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){if(a.bLength(b.phrase)>8){b.phrase=[a.leftB(b.phrase,6),"..."].join("")}return a.templet(I(i),b)});D["loading"].innerHTML="";D["list"].innerHTML=e.join("")},rendCategory:function(b){var c=b.cPoniter;var d=b.categorys;var e=b.currentCategory;var f=d.slice(c,c+o);f=a.foreach(f,function(b,c){if(e===b){return a.templet(I(h),{item:b})}else{return a.templet(I(g),{item:b})}});D["categorys"].innerHTML=f.join(l);if(c+6>=d.length){["next"].className="next_d"}else{D["next"].className="next"}if(c<=0){D["prev"].className="pre_d"}else{D["prev"].className="pre"}},rendPage:function(b){var c=b.page;var d=b.cache[b.currentCategory];var e=d.length/b.itemNumber;var f=[];for(var g=0;g<e;g+=1){if(c==g){f.push(a.templet(I(k),{number:g,label:g+1}))}else{f.push(a.templet(I(j),{number:g,label:g+1}))}}D["page"].innerHTML=f.join("")},destroy:function(){}};var M={trans:function(c){a.core.io.ijax({url:"//picupload.service.weibo.com/interface/pic_upload.php",form:STK.E("pic_upload"),abaurl:"//"+document.domain+"/static/upimgback.html",abakey:"cb",timeout:1800*1e3,onComplete:K.handle,onTimeout:K.handle,args:{marks:1,app:"miniblog",s:"rdxt",url:c.domain=="1"?p+(b&&b.watermark||b.domain):0,markpos:c.position||"",logo:c.logo||"",nick:c.nickname=="1"?"@"+(b&&b.nick):0}})},getWaterMark:function(b){a.common.trans.editor.getTrans("waterMark",{onSuccess:function(a,c){w=a.data;b&&b(w)}}).request()},upload:function(){y=D.fileBtn.value;if(a.core.str.trim(y)===""){return}K.rendLoad();w?M.trans(w):M.getWaterMark(M.trans)},loadPic:function(b){D.picWrap.innerHTML="";var c=b.url;var d=D.close;var e=a.C("img");if(b.value){D.pName.innerHTML=b.value}e.src=c;q.stopBoxClose();a.core.evt.custEvent.fire(B,"uploaded",{text:I(n),pid:b.pid});D.wrap.style.display="";D.wrap.className="layer_send_pic";D.wrap.style.width="240px";D.inner.style.display="none";D.uploaded.style.display="";d.style.display="none";D.picWrap.appendChild(e)}};var N={};(function(){if(b&&b.bigpipe==="true"){a.historyM.onpopstate(function(a,b){if(b){q.stopBoxClose();q.hide()}})}})();B.getBub=function(){return q};return function(b,d){if(!a.isNode(b)){throw"common.bubble.image need el as first parameter!"}E=window.location.href;D=a.lib.kit.dom.parseDOM(a.core.dom.builder(I(c)).list);r=D.outer;q=a.lib.ui.bubble();K.initDom();if(d&&d.pid){var e=a.common.extra.imageURL(d.pid);M.loadPic({url:e,pid:d.pid})}J();q.setContent(r);q.setLayout(b,{offsetX:-29,offsetY:5});B.bubble=q;B.setPic=function(a){K.rendSucc({pid:a})};q.show();return B}});
STK.register("common.editor.widget.image",function(a){return function(b){a.log(b);var c={};var d,e,f,g,h;var i=function(a,b){d.API.insertText(b.value);e.getBub().hide()};var j=function(b,c){a.log("upload");var e=d.API.getWords();if(e.length==0){d.API.insertText(c.text)}d.API.addExtraInfo(c.pid);g=true};var k=function(a,b){d.API.delWords(b.text);d.API.addExtraInfo("");clearInterval(h)};var l=function(b){if(g){return}e=a.common.bubble.image(d.nodeList[f]);a.custEvent.add(e,"uploaded",j);a.custEvent.add(e,"insert",i);a.custEvent.add(e,"deletePIC",k);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"uploaded",j);a.custEvent.remove(e,"insert",i);a.custEvent.remove(e,"deletePIC",k);a.custEvent.remove(e,"changeType");g=false});if(typeof b=="string"){e.setPic(b)}};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",l);if(e&&e.pid){l(e.pid)}};c.clear=function(){};c.show=function(){};c.hide=function(){if(e){e.getBub().hide()}};c.resetBubble=function(a){if(e){e.bubble.setLayout(a,{offsetX:-29,offsetY:5})}};c.destroy=function(){d=null};return c}});
STK.register("common.dialog.objPublish",function(a){var b=a.lib.kit.extra.language;var c={limitNum:140};var d={movie:"movie",book:"book",space:"poi"};return function(){function s(a,b){var c=a;var d=window.event||b;var e=a.offsetLeft;while(c=c.offsetParent){e+=c.offsetLeft}var f=d.clientX-e+document.documentElement.scrollLeft||document.body.scrollLeft;var g=n;if(f<=16){return g[1]}else if(16<f&&f<=32){return g[2]}else if(32<f&&f<=48){return g[3]}else if(48<f&&f<=64){return g[4]}else if(f>64){return g[5]}else{return false}}var d={},e,f,g=false,h,i=true,j,l=false,m;var n=[{score:0,width:"0%",text:""},{score:2,width:"20%",text:"很差"},{score:4,width:"40%",text:"一般"},{score:6,width:"60%",text:"还行"},{score:8,width:"80%",text:"不错"},{score:10,width:"100%",text:"怒赞"}];var o=function(a){return'<div node-type="outer" >'+'<div node-type="wrap">'+'<div class="card card-sender">'+'<div class="top">'+'<div class="grade s-fl">#L{我的评分：}'+'<a href="javascript: void(0);" class="starbar" node-type="starArea">'+'<em class="starbar-stars" style="width:'+a.user_score+'0%;" node-type="starScore"></em>'+"</a>"+'<span class="aftertext W_f14 S_txt2" node-type="starText"></span>'+"</div>"+'<div class="num S_txt2"  node-type="num">#L{还可以输入}<span>140</span>#L{字}</div>'+'<div class="key S_textb">'+"</div>"+"</div>"+'<div class="func">'+'<div class="input-wrap input-wrap-share">'+'<div class="input">'+'<textarea node-type="textEl"></textarea>'+'<p class="succeed" node-type="successTip" style="display:none"><i class="icon-warn icon-ok-l"></i>#L{点评成功}</p>'+'<form style="display:none;">'+'<input name="object_id" value="">'+'<input name="prefixtext" value="">'+'<input name="show_review" value="">'+'<input name="score" value="0">'+"</form>"+"</div>"+'<div class="func"> '+'<div class="face" node-type="widget">'+'<a href="javascript:;" node-type="smileyBtn"><i class="wbicon icon-face">o</i></a>'+"</div> "+'<div class="btn">'+'<a href="javascript:;" class="s-btn-g" node-type="submit">#L{点评}</a>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"};var p=function(b){if(!g.score){f["starText"].innerHTML="亲，先打个分吧";var c=f["starScore"];f["starScore"].style.width="100%";var d=setTimeout(function(){f["starScore"].style.width="0%";setTimeout(function(){f["starScore"].style.width="100%";setTimeout(function(){f["starScore"].style.width="0%";f["starText"].innerHTML=""},400)},200)},200);return}if(i){if(j==="error"){a.common.extra.shine(f["textEl"])}return}if(a.core.dom.hasClassName(f["submit"],"disable")){return}var k=e.API.getWords();i=true;j="loading";var l={status:k,title:"",object_id:h.object_id,style_type:1,pic_id:null,text:k,pdetail:h.object_id,show_review:true,score:g.score,pub_type:"dialog",action_code:71};a.common.trans.like.getTrans("objectpublish",{onSuccess:function(a){f["successTip"].style.display="";f["textEl"].value="";setTimeout(function(){f["successTip"].style.display="none";dialog.hide()},2e3);i=false},onError:function(b){a.lib.ui.alert(b.msg);i=false},onFail:function(b){a.lib.ui.alert("系统繁忙，请稍后再试");i=false}}).request(l)};var q=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){p();e.API.blur()}};var r=function(c,d){var e;if(d.count>0){d.count=d.count+25;if(d.count>140){d.isOver=true}}if(!d.isOver){i=false;if(g.score){a.core.dom.removeClassName(f["submit"],"disable")}f["num"].innerHTML=b("#L{还可以输入}<strong>"+(140-d.count)+"</strong>#L{字}")}else{i=true;j="error";a.core.dom.addClassName(f["submit"],"disable");if(d.count>0){f["num"].innerHTML=b('#L{已经超过}<strong class="warn">'+(140-d.count)+"</strong>#L{字}")}}};var t=function(a){f["starScore"].style.width=a.width;f["starText"].innerHTML=a.text};var u=function(a){var b=s(f["starArea"],a);t(b)};var v=function(a){var b=g;if(!b){b=n[0]}t(b)};var w=function(b){var c=s(f["starArea"],b);var d={score:c.score,object_id:h.object_id,user_id:h.user_id};a.common.trans.like.getTrans("objectscore",{onSuccess:function(b){g=c;f["textEl"].value.length>0&&a.core.dom.addClassName(f["submit"],"s-btn-g")},onError:function(b){a.lib.ui.alert(b.msg);i=false},onFail:function(b){a.lib.ui.alert("系统繁忙，请稍后再试");i=false}}).request(d)};var x=function(){e=a.common.editor.base(f["outer"],c);e.widget(a.common.editor.widget.face(),"smileyBtn");if($CONFIG.lang=="en-us"){a.addClassName(f["wrap"],"send_weibo_en")}};var y=function(){a.addEvent(f["submit"],"click",p);a.addEvent(f["textEl"],"keypress",q);a.addEvent(f["starArea"],"mouseenter",u);a.addEvent(f["starArea"],"mousemove",u);a.addEvent(f["starArea"],"mouseout",v);a.addEvent(f["starArea"],"click",w)};var z=function(){a.custEvent.add(e,"textNum",r)};var A=function(){x();y();z()};var B=function(c,d){var i=a.parseParam({content:"",defaultValue:"",title:b("#L{写点评}"),pid:"",suda:"key=tblog_search_v4.1&value=direct_rel_pub"},d);h=c;m=i.pid||"";if(d.user_score){var j=parseInt(d.user_score/2);g=n[j]}dialog=a.lib.ui.dialog();dialog.setTitle(i["title"]);var k=o(d);var l=a.builder(a.lib.kit.extra.language(k));f=a.lib.kit.dom.parseDOM(l.list);dialog.appendChild(f["outer"]);dialog.show();i["suda"]&&f["submit"].setAttribute("suda-data",i["suda"]);dialog.setMiddle();if(!e){A()}e.API.focus();a.custEvent.add(dialog,"hide",function(){a.custEvent.remove(dialog,"hide",arguments.callee);e.closeWidget();unrend();dialog=null;a.custEvent.fire(cKey,"hide")})};var C=function(){dialog.hide()};var D=function(){if(dialog){dialog.hide()}a.removeEvent(f["submit"],"click",p);a.removeEvent(f["textEl"],"keypress",q);a.removeEvent(f["starArea"],"mouseenter",u);a.removeEvent(f["starArea"],"mousemove",u);a.removeEvent(f["starArea"],"mouseout",v);a.removeEvent(f["starArea"],"click",w);a.custEvent.remove(e,"textNum",r);e=null;f=null;g=null;h=null;i=null;j=null;m=null;for(k in d){delete d[k]}d=null};d.show=B;d.hide=C;d.destroy=D;return d}});
STK.register("common.dialog.objPublishSimple",function(a){var b=a.lib.kit.extra.language;var c={limitNum:140};var d={movie:"movie",book:"book",space:"poi"};return function(){var d={},e,f,g=false,h,i=true,j,l;var m=function(a){return'<div node-type="outer" class="detail">'+'<div class="PCD_layer_remark" node-type="wrap">'+'<div class="layer_content">'+'<div class="send_weibo send_weibo_simple clearfix">'+'<div class="title_area clearfix">'+'<div class="num S_txt2"  node-type="num">#L{还可以输入}<span>140</span>#L{字}</div>'+'<div class="key S_textb">'+"</div>"+"</div>"+'<div class="input">'+'<textarea class="W_input" style="margin: 0px; padding: 0px; border-style: none; border-width: 0px; font-size: 14px; word-wrap: break-word; line-height: 18px; overflow-y: auto; overflow-x: hidden; outline: none;"  node-type="textEl" ></textarea>'+'<div class="send_succpic" style="display: none" node-type="successTip"></div>'+"</div>"+'<div class="func_area clearfix">'+'<div class="func">'+'<a href="javascript: void(0);" class="btn_30px W_btn_a_disable" node-type="submit">#L{发布}</a>'+"</div>"+'<div class="kind"style="position:relative;" node-type="widget">'+'<a href="javascript: void(0);" class="S_txt1" node-type="smileyBtn"><em class="W_ficon ficon_face">o</em></a>'+'<a href="javascript: void(0);" class="S_txt1" node-type="picBtn" style="display: none"><em class="W_ficon ficon_image">p</em></a>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"};var n=function(b){if(i){return}if(j==="error"){a.common.extra.shine(f["textEl"]);return}var c=e.API.getWords();var d={style_type:1,pic_id:null,text:c,follow:0};i=true;j="loading";a.common.trans.publisher.getTrans("publish",{onSuccess:function(a){f["successTip"].style.display="";f["textEl"].value="";setTimeout(function(){f["successTip"].style.display="none";dialog.hide()},2e3);i=false},onError:function(b){a.lib.ui.alert(b.msg);i=false},onFail:function(b){a.lib.ui.alert("系统繁忙，请稍后再试");i=false}}).request(d)};var o=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){n();e.API.blur()}};var p=function(c,d){var e=d["isOver"];if(!e){j="";a.core.dom.addClassName(f["submit"],"W_btn_a");f["num"].innerHTML=b("#L{还可以输入}<span>"+(140-d.count)+"</span>#L{字}")}else{j="error";a.core.dom.removeClassName(f["submit"],"W_btn_a")}};var q=function(b){f["textEl"].value="";e.API.insertText(b["content"]);if(b["content"]){i=false;j="";a.core.dom.addClassName(f["submit"],"W_btn_a")}else{i=true;j="error";a.core.dom.removeClassName(f["submit"],"W_btn_a")}};var r=function(){e=a.common.editor.base(f["outer"],c);e.widget(a.common.editor.widget.face(),"smileyBtn");if($CONFIG.lang=="en-us"){a.addClassName(f["wrap"],"send_weibo_en")}};var s=function(){a.addEvent(f["submit"],"click",n);a.addEvent(f["textEl"],"keypress",o)};var t=function(){a.custEvent.add(e,"textNum",p)};var u=function(){r();s();t()};var v=function(c,d){var g=a.parseParam({content:"",defaultValue:"",title:b("#L{分享}"),info:"",pid:"",suda:"key=tblog_search_v4.1&value=direct_rel_pub"},d);h=c;l=g.pid||"";dialog=a.lib.ui.dialog();dialog.setTitle(g["title"]);var i=m(d);var j=a.builder(a.lib.kit.extra.language(i));f=a.lib.kit.dom.parseDOM(j.list);dialog.appendChild(f["outer"]);dialog.show();g["suda"]&&f["submit"].setAttribute("suda-data",g["suda"]);dialog.setMiddle();if(!e){u()}q(g);e.API.focus();a.custEvent.add(dialog,"hide",function(){a.custEvent.remove(dialog,"hide",arguments.callee);e.closeWidget();unrend();dialog=null;a.custEvent.fire(cKey,"hide")})};var w=function(){dialog.hide()};var x=function(){if(dialog){dialog.hide()}a.removeEvent(f["submit"],"click",n);a.removeEvent(f["textEl"],"keypress",o);a.custEvent.remove(e,"textNum",p);e=null;f=null;g=null;h=null;i=null;j=null;l=null;for(k in d){delete d[k]}d=null};d.show=v;d.hide=w;d.destroy=x;return d}});
STK.register("common.feed.feedList.plugins.review",function(a){return function(b){var c;var d=false;var e,f;var g=a.E("pl_feedlist_index");var h={review:function(b){if(d){return}d=true;e=b.data;if(e.object_type=="music"){var c={content:e.intro};a.common.dialog.objPublishSimple().show(e,c);d=false}else if(e.object_type=="super_topic"){var c={object_id:e.object_id};a.common.trans.like.getTrans("objectfollow",{onSuccess:function(a){b.el.innerHTML='<i class="wbicon icon-add">Y</i> 已关注';b.el.setAttribute("action-type","");d=false},onError:function(b){a.lib.ui.alert(b.msg);d=false},onFail:function(){a.lib.ui.alert("系统繁忙，请稍后再试");d=false}}).request(c)}else{a.common.trans.like.getTrans("objectinfo",{onSuccess:function(b){a.common.dialog.objPublish().show(e,b.data);d=false},onError:function(b){a.lib.ui.alert(b.msg);d=false},onFail:function(){a.lib.ui.alert("系统繁忙，请稍后再试");d=false}}).request(e)}},like:function(b){if(d){return}d=true;a.core.evt.preventDefault();var c=b.data;if(!c){return}c.action_code=13;a.common.trans.like.getTrans("objectlike",{onSuccess:function(c){if(c.code==="100000"){var e=b.el.parentNode;if(e==null){return}var f,g={};if(c["data"]["is_del"]&&c["data"]["is_del"]===1){f=false}else{f=true}if(f){g["like-class"]="";g["like-title"]="取消赞";g["like-num"]=1;g["i-class"]="icon-act icon-act-praised"}else{g["like-class"]="";g["like-title"]="赞";g["like-num"]=-1;g["i-class"]="icon-act icon-act-praise"}var h=a.sizzle("[node-type=likeNum]",b.el),i;if(h&&h.length!=0){var j=a.trim(h[0].innerHTML);j=j==""?0:parseInt(j,10);var k=j+g["like-num"];i=k==0||k=="-1"||k==""?" ":k;h[0].innerHTML=i}var l=a.sizzle("[node-type=likeImg]",e);if(l&&l.length!=0){l[0].className=g["like-class"]}var m=a.sizzle("[node-type=likeTit]",e);if(m&&m.length!=0){m[0].title=g["like-title"]}if(h[0]&&h[0].getAttribute("is_like")=="true"){h[0].parentNode.style.display=i==" "||i<1?"none":"inline-block"}var n=a.sizzle("i",m[0]);if(n&&n.length!=0){n[0].className=g["i-class"]}setTimeout(function(a){d=false},400)}},onError:function(b){a.lib.ui.alert(b.msg);d=false},onFail:function(){a.lib.ui.alert("发送请求失败.");d=false}}).request(c)}};var i=function(){j();k();m();l()};var j=function(){if(!b){a.log("agrsCheck Error in comp.common.sassfilter: no such a node")}};var k=function(){f=a.lib.kit.dom.parseDOM(a.builder(g).list);c=a.core.evt.delegatedEvent(g)};var l=function(){c.add("widget_publish","click",h.review)};var m=function(){};var n=function(){a.core.evt.removeEvent("widget_publish","click",h.review)};i();var o={};o.destroy=n;return o}});
STK.register("lib.kit.extra.supportVideo",function(a){var b={};b.video=function(){var b=navigator.userAgent.toLowerCase();var c=function(){return b.indexOf("bidubrowser")>-1?!!1:!1}();var d=function(){return b.indexOf("firefox")>-1?!!1:!1}();if(a.core.util.browser.IE6||a.core.util.browser.IE7||a.core.util.browser.IE8||c){return false}if(!!document.createElement("video").canPlayType){var e=document.createElement("video");var f=e.canPlayType('video/ogg; codecs="theora, vorbis"');if(!f){var g=e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');if(!g){return false}else{if(g=="probably"){return true}else{return false}}}else{if(f==="probably"){return true}else{return false}}}else{return false}};b.live=function(){window.MediaSource=window.MediaSource||window.WebKitMediaSource;return window.MediaSource&&typeof window.MediaSource.isTypeSupported==="function"&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')};return b});
STK.register("common.channel.video",function(a){var b=["scroll","resize","docChange","showPicLayer","hidePicLayer","showPicDis","hidePicDis","vplusOne"];return a.common.channel.listener.define("conf.channel.video",b)});
STK.register("lib.kit.extra.sparkMD5",function(a){return function(a){"use strict";var b=function(a,b){return a+b&4294967295},c=function(a,c,d,e,f,g){c=b(b(c,a),b(e,g));return b(c<<f|c>>>32-f,d)},d=function(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)},e=function(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)},f=function(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)},g=function(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)},h=function(a,c){var h=a[0],i=a[1],j=a[2],k=a[3];h=d(h,i,j,k,c[0],7,-680876936);k=d(k,h,i,j,c[1],12,-389564586);j=d(j,k,h,i,c[2],17,606105819);i=d(i,j,k,h,c[3],22,-1044525330);h=d(h,i,j,k,c[4],7,-176418897);k=d(k,h,i,j,c[5],12,1200080426);j=d(j,k,h,i,c[6],17,-1473231341);i=d(i,j,k,h,c[7],22,-45705983);h=d(h,i,j,k,c[8],7,1770035416);k=d(k,h,i,j,c[9],12,-1958414417);j=d(j,k,h,i,c[10],17,-42063);i=d(i,j,k,h,c[11],22,-1990404162);h=d(h,i,j,k,c[12],7,1804603682);k=d(k,h,i,j,c[13],12,-40341101);j=d(j,k,h,i,c[14],17,-1502002290);i=d(i,j,k,h,c[15],22,1236535329);h=e(h,i,j,k,c[1],5,-165796510);k=e(k,h,i,j,c[6],9,-1069501632);j=e(j,k,h,i,c[11],14,643717713);i=e(i,j,k,h,c[0],20,-373897302);h=e(h,i,j,k,c[5],5,-701558691);k=e(k,h,i,j,c[10],9,38016083);j=e(j,k,h,i,c[15],14,-660478335);i=e(i,j,k,h,c[4],20,-405537848);h=e(h,i,j,k,c[9],5,568446438);k=e(k,h,i,j,c[14],9,-1019803690);j=e(j,k,h,i,c[3],14,-187363961);i=e(i,j,k,h,c[8],20,1163531501);h=e(h,i,j,k,c[13],5,-1444681467);k=e(k,h,i,j,c[2],9,-51403784);j=e(j,k,h,i,c[7],14,1735328473);i=e(i,j,k,h,c[12],20,-1926607734);h=f(h,i,j,k,c[5],4,-378558);k=f(k,h,i,j,c[8],11,-2022574463);j=f(j,k,h,i,c[11],16,1839030562);i=f(i,j,k,h,c[14],23,-35309556);h=f(h,i,j,k,c[1],4,-1530992060);k=f(k,h,i,j,c[4],11,1272893353);j=f(j,k,h,i,c[7],16,-155497632);i=f(i,j,k,h,c[10],23,-1094730640);h=f(h,i,j,k,c[13],4,681279174);k=f(k,h,i,j,c[0],11,-358537222);j=f(j,k,h,i,c[3],16,-722521979);i=f(i,j,k,h,c[6],23,76029189);h=f(h,i,j,k,c[9],4,-640364487);k=f(k,h,i,j,c[12],11,-421815835);j=f(j,k,h,i,c[15],16,530742520);i=f(i,j,k,h,c[2],23,-995338651);h=g(h,i,j,k,c[0],6,-198630844);k=g(k,h,i,j,c[7],10,1126891415);j=g(j,k,h,i,c[14],15,-1416354905);i=g(i,j,k,h,c[5],21,-57434055);h=g(h,i,j,k,c[12],6,1700485571);k=g(k,h,i,j,c[3],10,-1894986606);j=g(j,k,h,i,c[10],15,-1051523);i=g(i,j,k,h,c[1],21,-2054922799);h=g(h,i,j,k,c[8],6,1873313359);k=g(k,h,i,j,c[15],10,-30611744);j=g(j,k,h,i,c[6],15,-1560198380);i=g(i,j,k,h,c[13],21,1309151649);h=g(h,i,j,k,c[4],6,-145523070);k=g(k,h,i,j,c[11],10,-1120210379);j=g(j,k,h,i,c[2],15,718787259);i=g(i,j,k,h,c[9],21,-343485551);a[0]=b(h,a[0]);a[1]=b(i,a[1]);a[2]=b(j,a[2]);a[3]=b(k,a[3])},i=function(a){var b=[],c;for(c=0;c<64;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b},j=function(a){var b=[],c;for(c=0;c<64;c+=4)b[c>>2]=a[c]+(a[c+1]<<8)+(a[c+2]<<16)+(a[c+3]<<24);return b},k=function(a){var b=a.length,c=[1732584193,-271733879,-1732584194,271733878],d,e,f,g,j,k;for(d=64;d<=b;d+=64)h(c,i(a.substring(d-64,d)));a=a.substring(d-64);e=a.length;f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<e;d+=1)f[d>>2]|=a.charCodeAt(d)<<(d%4<<3);f[d>>2]|=128<<(d%4<<3);if(d>55){h(c,f);for(d=0;d<16;d+=1)f[d]=0}g=b*8;g=g.toString(16).match(/(.*?)(.{0,8})$/);j=parseInt(g[2],16);k=parseInt(g[1],16)||0;f[14]=j;f[15]=k;h(c,f);return c},l=function(a){var b=a.length,c=[1732584193,-271733879,-1732584194,271733878],d,e,f,g,i,k;for(d=64;d<=b;d+=64)h(c,j(a.subarray(d-64,d)));a=d-64<b?a.subarray(d-64):new Uint8Array(0);e=a.length;f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<e;d+=1)f[d>>2]|=a[d]<<(d%4<<3);f[d>>2]|=128<<(d%4<<3);if(d>55){h(c,f);for(d=0;d<16;d+=1)f[d]=0}g=b*8;g=g.toString(16).match(/(.*?)(.{0,8})$/);i=parseInt(g[2],16);k=parseInt(g[1],16)||0;f[14]=i;f[15]=k;h(c,f);return c},m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=function(a){var b="",c;for(c=0;c<4;c+=1)b+=m[a>>c*8+4&15]+m[a>>c*8&15];return b},o=function(a){var b;for(b=0;b<a.length;b+=1)a[b]=n(a[b]);return a.join("")},p=function(a){return o(k(a))},q=function(){this.reset()};p("hello")!=="5d41402abc4b2a76b9719d911017c592"&&(b=function(a,b){var c=(a&65535)+(b&65535),d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535});q.prototype.append=function(a){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));this.appendBinary(a);return this};q.prototype.appendBinary=function(a){this._buff+=a;this._length+=a.length;var b=this._buff.length,c;for(c=64;c<=b;c+=64)h(this._state,i(this._buff.substring(c-64,c)));this._buff=this._buff.substr(c-64);return this};q.prototype.end=function(a){var b=this._buff,c=b.length,d,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f;for(d=0;d<c;d+=1)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);this._finish(e,c);f=!a?o(this._state):this._state;this.reset();return f};q.prototype._finish=function(a,b){var c=b,d,e,f;a[c>>2]|=128<<(c%4<<3);if(c>55){h(this._state,a);for(c=0;c<16;c+=1)a[c]=0}d=this._length*8;d=d.toString(16).match(/(.*?)(.{0,8})$/);e=parseInt(d[2],16);f=parseInt(d[1],16)||0;a[14]=e;a[15]=f;h(this._state,a)};q.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};q.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};q.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=k(a);return!b?o(c):c};q.hashBinary=function(a,b){var c=k(a);return!b?o(c):c};q.ArrayBuffer=function(){this.reset()};q.ArrayBuffer.prototype.append=function(a){var b=this._concatArrayBuffer(this._buff,a),c=b.length,d;this._length+=a.byteLength;for(d=64;d<=c;d+=64)h(this._state,j(b.subarray(d-64,d)));this._buff=d-64<c?b.subarray(d-64):new Uint8Array(0);return this};q.ArrayBuffer.prototype.end=function(a){var b=this._buff,c=b.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e,f;for(e=0;e<c;e+=1)d[e>>2]|=b[e]<<(e%4<<3);this._finish(d,c);f=!a?o(this._state):this._state;this.reset();return f};q.ArrayBuffer.prototype._finish=q.prototype._finish;q.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};q.ArrayBuffer.prototype.destroy=q.prototype.destroy;q.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);d.set(a);d.set(new Uint8Array(b),c);return d};q.ArrayBuffer.hash=function(a,b){var c=l(new Uint8Array(a));return!b?o(c):c};return q}()});
STK.register("lib.kit.extra.sendImage",function(a){var b={};return function(c,d){c=[].concat(c);d=a.core.json.merge({wb_time:+(new Date)},d);var e;while(e=c.shift()){var f=a.getUniqueKey(),g=b[f]=new Image;g.onload=g.onerror=function(){g.onload=g.onerror=null;delete b[f];g=null};g.src=e+(e.indexOf("?")>-1?"&":"?")+a.jsonToQuery(d)}}});
STK.register("lib.kit.extra.HashTable",function(a){return function(){function a(){this.ObjArr={};this.Count=0;this.Add=function(a,b){if(this.ObjArr.hasOwnProperty(a)){return false}else{this.ObjArr[a]=b;this.Count++;return true}};this.Contains=function(a){return this.ObjArr.hasOwnProperty(a)};this.GetValue=function(a){if(this.Contains(a)){return this.ObjArr[a]}else{throw Error("Hashtable not cotains the key: "+String(a))}};this.Remove=function(a){if(this.Contains(a)){delete this.ObjArr[a];this.Count--}};this.Clear=function(){this.ObjArr={};this.Count=0}}return new a}});
STK.register("lib.kit.extra.getWantTime",function(a){return function(a,b){function c(a,b){var c={"M+":b.getMonth()+1,"d+":b.getDate(),"h+":b.getHours(),"m+":b.getMinutes(),"s+":b.getSeconds(),"q+":Math.floor((b.getMonth()+3)/3),S:b.getMilliseconds()};if(/(y+)/.test(a))a=a.replace(RegExp.$1,(b.getFullYear()+"").substr(4-RegExp.$1.length));for(var d in c)if((new RegExp("("+d+")")).test(a))a=a.replace(RegExp.$1,RegExp.$1.length==1?c[d]:("00"+c[d]).substr((""+c[d]).length));return a}if(!a&&isNaN(a)){throw"differDay: differDay need a int number"}if(b&&typeof b!="string"){throw"formal: formal need a string like yyyy-MM-dd hh:mm:ss"}a=parseInt(a)||0;var d={};var e=1e3*60*60*24;var f=new Date;var g=new Date(f.getTime()+a*e);d.Today={time:f.getTime(),day:f.getDay(),year:f.getFullYear(),quarter:Math.floor((f.getMonth()+3)/3),month:f.getMonth()+1,date:f.getDate(),hour:f.getHours(),minute:f.getMinutes(),second:f.getSeconds(),MSecond:f.getMinutes(),Format:b&&c(b,f)||f.toLocaleString()};d.WantDay={time:g.getTime(),day:g.getDay(),year:g.getFullYear(),quarter:Math.floor((g.getMonth()+3)/3),month:g.getMonth()+1,date:g.getDate(),hour:g.getHours(),minute:g.getMinutes(),second:g.getSeconds(),MSecond:g.getMinutes(),Format:b&&c(b,g)||g.toLocaleString()};f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0);var h=new Date(f.getTime()+a*e);d.ZeroToday={time:f.getTime(),day:f.getDay(),year:f.getFullYear(),quarter:Math.floor((f.getMonth()+3)/3),month:f.getMonth()+1,date:f.getDate(),hour:f.getHours(),minute:f.getMinutes(),second:f.getSeconds(),MSecond:f.getMinutes(),Format:b&&c(b,f)||f.toLocaleString()};d.ZeroWantDay={time:h.getTime(),day:h.getDay(),year:h.getFullYear(),quarter:Math.floor((h.getMonth()+3)/3),month:h.getMonth()+1,date:h.getDate(),hour:h.getHours(),minute:h.getMinutes(),second:h.getSeconds(),MSecond:h.getMinutes(),Format:b&&c(b,h)||h.toLocaleString()};return d}});
STK.register("lib.kit.extra.scrollMethod",function(a){var b={};var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){a()};var d={debounce:function(a,b,c){var d;return function(){var e=this,f=arguments;var g=function(){d=null;if(!c)a.apply(e,f)};var h=c&&!d;clearTimeout(d);d=setTimeout(g,b);if(h)a.apply(e,f)}},throttle:function(a,b,c){var d,e=new Date;return function(){var f=this,g=arguments,h=new Date;clearTimeout(d);if(h-e>=c){a.apply(f,g);e=h}else{d=setTimeout(a,b)}}},rAF:function(a){return function(){var b=false;if(!b){c(a);b=true}}}};b.debounce=d.debounce;b.throttle=d.throttle;b.rAF=d.rAF;return b});
STK.register("lib.kit.extra.storageLog",function(a){var b=a.conf.trans.storage,c=a.lib.kit.extra.sparkMD5,d={canStore:function(){return window.localStorage?!0:!1},count:0,getUniqueKey:function(){return Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+d.count++},resetID:function(a,b){return a+"_"+(b?b:d.getUniqueKey())},isString:function(a){return typeof a=="string"&&a.constructor==String},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},expTest:function(a,b){var c=new RegExp("^"+a+"_");return c.test(b)},md5Log:function(a,b,d){var e={};e.data=a;e.key=b;e.sig=a&&b&&d&&a+b+d;e.sig=c.hash(e.sig);return e},comLog:function(a,b){var c={};c.data=a;c.key=b;return c}},e={debug:!1,session:!1,str:"",uniqueID:"",resetID:!1,clear:!0,separator:"||",isEncode:!1,logLength:20,logTime:18e4,tabLength:30,trans:b,transKey:"",MD5:!0,MD5str:"encryptedString",params:{timeout:3e4,onComplete:function(){},onTimeout:function(){},onFail:function(){}}};return function(b){b.debug&&console.log(b);if(!!b&&b instanceof Object){if(!b.str||!d.isString(b.str)){console.log("storageLog : need str in parameters object");return}if(!b.transKey||!d.isString(b.transKey)){console.log("storageLog : need transKey in parameters object");return}if(b.separator=="&"){console.log("storageLog : separator can not be &");return}var c,f,g,h,i,j,k,l,m,n,o,p,q,r;p={setFlagTimer:function(){n&&clearTimeout(n);n=null;n=setTimeout(function(){l=!1},0)},setLogTimer:function(){g||(g=setTimeout(function(){p.timeout()},c.logTime))},genValue:function(a){a=d.isJSON(a)?JSON.stringify(a):a;a=c.isEncode?encodeURIComponent(a):a;c.debug&&console.log(a+"........is generated");return a},reset:function(){g&&clearTimeout(g);g=null;l=!1;i=[];k="";c.clear?p.remove():h.setItem(j,k);j=c.resetID?d.resetID(c.str,c.uniqueID):j;c.debug&&console.log("reset........"+j);p.setFlagTimer();p.setLogTimer()},onComplete:function(a){p.reset();c.params.onComplete&&c.params.onComplete(a)},request:function(){c.debug&&console.log(j+"in storage is"+h.hasOwnProperty(j));g&&clearTimeout(g);g=null;var a;if(!(!h.hasOwnProperty(j)&&i.length>1))if(k){if(k.split(c.separator).length>=c.logLength*2){p.onComplete();return}a=c.MD5&&c.MD5str?d.md5Log(k,j,c.MD5str):d.comLog(k,j);c.debug&&console.log("send log is .........","\n",a);c.trans.request(c.transKey,{timeout:c.params.timeout||5e4,onComplete:p.onComplete,onTimeout:c.params.onTimeout||function(){p.onComplete()},onFail:c.params.onFail||function(){p.onComplete()}},a)}else{c.debug&&console.log("logTimer is ......."+g);p.setLogTimer()}},timeout:function(){c.debug&&console.log("running logTimer");if(l&&m<=3){c.debug&&console.log("now is setting storage");p.timeout();m++}else{p.request();m=1}},get:function(){return j&&h.getItem(j)},remove:function(){j&&h.removeItem(j)},set:function(a){l=!0;i.push(p.genValue(a));k=i.join(c.separator);if(i.length>=c.logLength){c.debug&&console.log("arrValue.length is ....."+i.length);p.request()}else{h.setItem(j,k);p.setFlagTimer();p.setLogTimer()}},compOne:function(a){return function(b){h.removeItem(a);c.params.onComplete&&c.params.onComplete(b)}},clearOne:function(a,b){if(!!h.hasOwnProperty(a)){var e;if(b){if(b.split(c.separator).length>=c.logLength*2){p.compOne(a)();return}e=c.MD5&&c.MD5str?d.md5Log(b,a,c.MD5str):d.comLog(b,a);c.debug&&console.log("send clearlog is .........","\n",e);c.trans.request(c.transKey,{timeout:c.params.timeout||8e3,onComplete:p.compOne(a),onTimeout:c.params.onTimeout||function(){p.compOne(a)()},onFail:c.params.onFail||function(){p.compOne(a)()}},e);c.debug&&console.log("clear send success")}else h.removeItem(a)}},clear:function(){c.debug&&console.log("clear start");var b=c.str&&h.getItem(c.str);if(!!b){b=b.split(c.separator);a.foreach(b,function(a){p.clearOne(a,h.getItem(a))});h.removeItem(c.str);c.debug&&console.log("clear end")}},unload:function(){a.custEvent.fire(f,"onbeforeunload");var b=c&&c.str&&h&&h.getItem(c.str);b?h.setItem(c.str,b+c.separator+j):h.setItem(c.str,j);c.debug&&console.log("set key is...."+j)},destroy:function(){p.unload();a.custEvent.undefine(f);a.removeEvent(window,"beforeunload",p.unload);f=null;c=null;p=null;n&&clearTimeout(n);n=null;g&&clearTimeout(g);g=null;l=!1;i=null;j=null;k=null;h=null;m=null}};o=function(){c=a.parseParam(e,b);h=c.session?window.sessionStorage:window.localStorage;l=!1;n&&clearTimeout(n);n=null;g&&clearTimeout(g);g=null;i=[];m=1;f={};j=d.resetID(c.str,c.uniqueID);c.debug&&console.log("init key is ......."+j)};q=function(){a.custEvent.define(f,["onbeforeunload"]);f.get=p.get;f.set=p.set;f.remove=p.remove;f.clear=p.clear;f.destroy=p.destroy;p.clear();a.addEvent(window,"beforeunload",p.unload);g=setTimeout(function(){p.timeout()},c.logTime)};r=function(){if(d.canStore()){o();q();c.debug&&console.log("can storage")}else a.log("browser does not support storage")};r();return f}console.log("storageLog : need object of the spec Class");return}});
STK.register("lib.kit.extra.arrayRemove",function(a){return function(b,c){if(!a.isArray(c)){throw"aSource: need an array as second parameter"}var d=a.arrIndexOf(b,c);if(d<0){throw"oElememt: array does not contain this element"}return c.slice(0,d).concat(c.slice(d+1,c.length))}});
STK.register("lib.feed.plugins.video.utils",function(a){var b=document.documentElement;var c=document.body;var d={domHalf:false,sensitiveHeight:0,initBuff:600,topHeight:50,count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+this.count++},hideInput:function(){var b;b=document.getElementById("H5_video_url_input");if(b)return b;b=a.C("input");b.style.cssText="position:absolute;top:-9999px;left:-9999px;";b.id="H5_video_url_input";b.type="text";b.readonly="readonly";a.setStyle(b,"opacity",1);document.getElementsByTagName("body")[0].appendChild(b);return b},sendSuda:function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},getAttrData:function(b,c){if(!b||!c)return;var d=b.getAttribute(c);var e=d&&a.queryToJson(d)||false;return e},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))},formateJson:function(a){if(!this.isJSON(a))return;var b=[];for(var c in a){b.push(a[c])}return b.join(";")},setStyles:function(b,c){a.foreach(c,function(c,d){a.setStyle(b,d,c)})},removeTarget:function(b,c){if(!a.isArray(c))return;var d=a.arrIndexOf(b,c);if(d<0)return;return c.splice(d,1)},getDocHeight:function(){return Math.max(c.scrollHeight,b.scrollHeight,c.offsetHeight,b.offsetHeight,b.clientHeight)},isOutClient:function(a,b,c,d){var e;e=a-b;if(e>=d||e<=0-(c-this.topHeight)){return true}else{return false}},isOutPlayZone:function(a,b,c,d){var e,f;e=a-b;f=this.domHalf&&c?parseInt(c/2):0;if(e>=d-f||e<=0-(c-f-this.topHeight)){return true}else{return false}},isInAutoPauseClient:function(a,b,c,d){var e,f;e=a-b;f=this.domHalf&&c?parseInt(c/2):0;if(e>=d-c+f+this.sensitiveHeight&&e<=d+f+this.sensitiveHeight||e>=0-c-f-this.sensitiveHeight+this.topHeight&&e<=0-f-this.sensitiveHeight+this.topHeight){return true}else{return false}},isInAutoClinet:function(a,b,c,d){var e,f;e=a-b;f=this.domHalf&&c?parseInt(c/2):0;if(e>=0-f-this.sensitiveHeight+this.topHeight&&e<=d-c+f+this.sensitiveHeight){return true}else{return false}},getOneDomCenter:function(a,b,c){var d=a-b;var e=c/2;return d+e},getOneDomAbsCenter:function(a,b,c,d){return Math.abs(this.getOneDomCenter(a,b,c)-d/2)},isInBuff:function(a,b,c){var d=a-b;if(d>=0-2*this.initBuff&&d<=c+4*this.initBuff){return true}else{return false}},filterAutoVideo:function(b,c,d){var e=[],f;var g=this;a.foreach(b,function(a,b){e[b]=g.getOneDomAbsCenter(a.top,c,a.height,d)});f=Math.min.apply(Math,e);return b[a.core.arr.indexOf(f,e)]},CONauto:function(){if(true){return $CONFIG&&$CONFIG.isAuto=="1"?false:true}else{return false}}};return d});
STK.register("lib.feed.plugins.video.log",function(a){var b=a.lib.kit.extra.parseURL;var c={};var d={play_time:"",uid:null,object_id:null,mid:null,mid_uid:null,rootmid:null,rootuid:null,duration:null,isautoplay:"0",playduration:"",firstframe_status:"",quit_status:"",firstframe_time:"",startplay_time:"",valid_play_duration:"",download_size:"",bitrate:"",encode_mode:null,extend:""};var e={vf:"following",sid:0};var f={profile:["100505","100306","100406","103505","100205","100605","100606","101106","100206","100106","230267","101806"],page:["100101","101515","100202","100404","100120","100707","100117","100135","100153"],topic:["100808"]};var g={count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+g.count++},isString:function(a){return typeof a=="string"&&a.constructor==String},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},extendToJson:function(b,c){var d=a.core.str.trim(b).split(",");var e={};var f=function(a){if(c){return decodeURIComponent(a)}else{return a}};for(var g=0,h=d.length;g<h;g++){if(d[g]){var i=d[g].split("=>");var j=i[0];var k=i[1];if(i.length<2){k=j;j="$nullName"}if(!e[j]){e[j]=f(k)}else{if(a.core.arr.isArray(e[j])!=true){e[j]=[e[j]]}e[j].push(f(k))}}}return e},jsonToExtend:function(b,c){var d=function(b,c){b=b==null?"":b;b=a.core.str.trim(b.toString());if(c){return encodeURIComponent(b)}return b};var e=[];if(typeof b=="object"){for(var f in b){if(f==="$nullName"){e=e.concat(b[f]);continue}if(b[f]instanceof Array){for(var g=0,h=b[f].length;g<h;g++){e.push(f+"=>"+d(b[f][g],c))}}else{if(typeof b[f]!="function"){e.push(f+"=>"+d(b[f],c))}}}}if(e.length){return e.join(",")}return""},changeVF:function(b){var c=b&&b.host;var d=b&&b.path;var e=window.$CONFIG&&window.$CONFIG.location;if(/s\.weibo\.com/.test(c)){return"s"}else if(/d\.weibo\.com/.test(c)){return"hot"}else if(/weibo\.com/.test(c)){if(/^v6_/.test(e)){if(/(friends|mygroups|fav|like)/.test(d)){return"group"}else{return"following"}}else if(/^page_/.test(e)){if(/_single_weibo/.test(e)){return"detail"}else{var g,h=/^page_(\d*)_/g.exec(e)[1];for(var i in f){if(a.inArray(h,f[i])){g=i;break}}return g?g:"page"}}}}};var h={getVF:function(a){if(a&&!g.isString(a)){throw"str : need string as a parameter"}return a||g.changeVF(b())},getSid:function(a){if(a&&!g.isString(a)){throw"str : need string as a parameter"}return a||g.getUniqueKey()},setExtend:function(b,c){if(!b||!c||!g.isJSON(b)||!g.isJSON(c)){throw"logObj || extend: need json as parameter"}b.extend=g.jsonToExtend(a.core.json.merge(g.extendToJson(b.extend),c));return b}};return function(){c.vf=h.getVF;c.sid=h.getSid;c.Obj=h.setExtend(d,a.parseParam(e,{vf:h.getVF(),sid:h.getSid()}));c.setExtend=h.setExtend;c.destory=function(){c=null;d=null;e=null};return c}});
STK.register("lib.feed.plugins.video.vplus",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.common.channel.video,e={icon:c(b("<#et icon data><span></span></#et>")),tip:c(b('<#et tip data><div class="inner" node-type="h5_video_vplus_tip">#L{试看部分视频，}<a href="javascript:void(0);" action-type="h5_video_vplus_tip" action-data="uniqueKey=${data.uniqueKey}&mid=${data.mid}&vuid=${data.vuid}&oid=${data.oid}">#L{开通Ta的专属会员}</a>#L{可观看完整视频及Ta的全部付费内容。}</div></#et>')),layer:c(b('<#et tip data><div class="inner" node-type="h5_video_vplus_layer" action-data="uniqueKey=${data.uniqueKey}&mid=${data.mid}&vuid=${data.vuid}&isFake=${data.isFake}&oUrl=${data.oUrl}&oid=${data.oid}"><div class="tip W_autocut" node-type="h5_video_vplus_txt"></div><div class="btn hv-center" node-type="h5_video_vplus_btn"><div node-type="h5_video_vplus_replay"><a href="javascript:void(0);" action-type="h5_video_vplus_replay"><span class="hv-ring"><i class="hv-icon hv-icon-replay"></i></span>#L{重播}</a></div><div node-type="h5_video_vplus_right"></div></div></div></#et>'))},f={tip:[b("#L{如果付费成功，可以观看完成视频；如果付费失败，只能试看部分视频。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_goon"><span class="hv-ring"><i class="hv-icon hv-icon-play"></i></span>#L{继续播放}</a>')],end:[b("#L{试看结束，开通Ta的专属会员可观看Ta的全部付费内容。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_open"><span class="hv-ring"><i class="hv-icon hv-icon-open"></i></span>#L{立即开通}</a>')],open:[b("#L{如果付费成功，请点击播放按钮继续观看。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_goon"><span class="hv-ring"><i class="hv-icon hv-icon-play"></i></span>#L{继续播放}</a>')],fake:[b("#L{请去原博主的微博查看完整视频。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_goto"><span class="hv-ring"><i class="hv-icon hv-icon-goto"></i></span>#L{去原微博}</a>')]},g={getAttrNode:function(b,c,d){return a.core.dom.dir(b,{expr:c,endpoint:d||document.body})[0]}};return function(b){if(!b)a.log("node : need object of the baseFeedList Class");else{var c={},h,i=["tip","replay"],j,k,l,m,n;k={tip:function(b,c){if(!!c.obj){var d,e,f,g,h,i,k,l,m=c.obj.action.data;e=m.hId;if(a.hasClassName(e,"hv-s3-12b"))return;h=m.vplusLayer;d=m.media;i=a.builder(h).list;if(!i)return;k=i.h5_video_vplus_txt[0];l=i.h5_video_vplus_right[0];if(c.layer=="tip"){c.obj.action.media.pause();window.__WBH5VideoUtils__("togglePlay",{uniqueKey:c.obj.key,paused:!0})}j.show(c.layer,{vTxt:k,vRight:l,vLayer:h,vBox:e})}},replay:function(b,c){if(!!c.obj){var d,e,f,g,h=c.obj.action.data;d=h.hId;e=h.vplusTip1;f=h.vplusTip2;g=h.vplusLayer;if(!a.hasClassName(d,"hv-s3-12b"))return;j.hide(c.open,{vBox:d,vLayer:g,vTip1:e,vTip2:f})}}};j={init:function(b){b=a.parseParam({video:"",uniqueKey:"",mid:"",oid:"",vuid:"",isPay:"",isOpen:"",isFake:"",oUrl:""},b);if(!!b.video){var c,d,f,g;c=b.video.data.vplusIcon;d=b.video.data.vplusTip1;f=b.video.data.vplusTip2;g=b.video.data.vplusLayer;if(b.isPay&&c&&!b.isFake){c.innerHTML=e.icon(b).toString();a.addClassName(c,"hv-show")}if(d&&f&&g&&!b.isOpen){var h,i=e.tip(b).toString();g.innerHTML=e.layer(b).toString();if(b.isFake)return;d.innerHTML=i;f.innerHTML=i}}},tipClick:function(a){var b=a.data,c=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+b.vuid+"&F=video_"+b.oid;window.open(c,"_blank");b.type="tip";b.layer="tip";d.fire("vplusOne",b)},replay:function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data"));e.replay=!0;window.__WBH5VideoUtils__("reset",e)},open:function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data")),f=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+e.vuid+"&F=video_"+e.oid;window.open(f,"_blank");var h=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),i=a.builder(h).list,k=i.h5_video_vplus_txt[0],l=i.h5_video_vplus_right[0];j.show("open",{vLayer:h,vTxt:k,vRight:l})},goon:function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data"));e.goon=!0;window.__WBH5VideoUtils__("reset",e)},"goto":function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data"));e.oUrl&&window.open(decodeURIComponent(e.oUrl))},show:function(b,c){if(!!b&&!!c){if(!c.vTxt||!c.vRight||!c.vLayer)return;c.vTxt.innerHTML=f[b][0];c.vRight.innerHTML=f[b][1];c.vBox&&a.addClassName(c.vBox,"hv-s3-12b")}},hide:function(b,c){if(!!c){c.vBox&&a.removeClassName(c.vBox,"hv-s3-12b");if(b){c.vLayer&&(c.vLayer.innerHTML="");c.vTip1&&(c.vTip1.innerHTML="");c.vTip2&&(c.vTip2.innerHTML="")}}},destroy:function(){h.remove("h5_video_vplus_tip","click",j.tipClick);h.remove("h5_video_vplus_replay","click",j.replay);h.remove("h5_video_vplus_open","click",j.open);h.remove("h5_video_vplus_goon","click",j.goon);h.remove("h5_video_vplus_goto","click",j.goto);h&&h.destroy&&h.destroy();a.custEvent.undefine(c);c=null},initCust:function(){for(var b in k)a.custEvent.add(c,b,k[b])},initplugins:function(){c.init=j.init;c.destroy=j.destroy}};l=function(){h=a.delegatedEvent(b)};m=function(){a.custEvent.define(c,i);j.initCust();h.add("h5_video_vplus_tip","click",j.tipClick);h.add("h5_video_vplus_replay","click",j.replay);h.add("h5_video_vplus_open","click",j.open);h.add("h5_video_vplus_goon","click",j.goon);h.add("h5_video_vplus_goto","click",j.goto)};n=function(){l();m();j.initplugins()};n();return c}}});
(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?module.exports=b():typeof define==="function"&&define.amd?define(b):a.V=b()})(this,function(){function eD(a,b,c){var d=void 0;if(typeof a==="string"){var e=eD.getPlayers();if(a.indexOf("#")===0){a=a.slice(1)}if(e[a]){if(b){X.warn('Player "'+a+'" is already initialised. Options will not be applied.')}if(c){e[a].ready(c)}return e[a]}if(b.container&&be(b.container)){var f=k.createElement("video");f.id=a;f.className=b.defaultClassName||"WB_h5video_v2";b.container.appendChild(f);d=e[a]=f}else{d=bC("#"+a)}}else{d=a}if(!d||!d.nodeName){throw new TypeError("The element or ID supplied is not valid. (V)")}if(d.player||dT.players[d.playerId]){return d.player||dT.players[d.playerId]}b=b||{};eD.hooks("beforesetup").forEach(function(a){var c=a(d,ck(b));if(!R(c)||Array.isArray(c)){X.error("please return an object in beforesetup hooks");return}b=ck(b,c)});var g=cl.getComponent("Player");var h=new g(d,b,c);eD.hooks("setup").forEach(function(a){return a(h)});return h}function eC(){}function eB(a){if(a.responseType==="document"){return a.responseXML}var b=a.responseXML&&a.responseXML.documentElement.nodeName==="parsererror";if(a.responseType===""&&!b){return a.responseXML}return null}function eA(a){function g(){if(j)return;var b;clearTimeout(q);if(a.useXDR&&h.status===undefined){b=200}else{b=h.status===1223?204:h.status}var d=r;var f=null;if(b!==0){d={body:e(),statusCode:b,method:l,headers:{},url:k,rawRequest:h};if(h.getAllResponseHeaders){d.headers=er(h.getAllResponseHeaders())}}else{f=new Error("Internal XMLHttpRequest Error")}return c(f,d,d.body)}function f(a){clearTimeout(q);if(!(a instanceof Error)){a=new Error(""+(a||"Unknown XMLHttpRequest Error"))}a.statusCode=0;return c(a,r)}function e(){var a=undefined;if(h.response){a=h.response}else{a=h.responseText||eB(h)}if(p){try{a=JSON.parse(a)}catch(b){}}return a}function d(){if(h.readyState===4){setTimeout(g,0)}}if(typeof a.callback==="undefined"){throw new Error("callback argument missing")}var b=false;var c=function s(c,d,e){if(!b){b=true;a.callback(c,d,e)}};var h=a.xhr||null;if(!h){if(a.cors||a.useXDR){h=new ez.XDomainRequest}else{h=new ez.XMLHttpRequest}}var i;var j;var k=h.url=a.uri||a.url;var l=h.method=a.method||"GET";var m=a.body||a.data;var n=h.headers=a.headers||{};var o=!!a.sync;var p=false;var q;var r={body:undefined,headers:{},statusCode:0,method:l,url:k,rawRequest:h};if("json"in a&&a.json!==false){p=true;n["accept"]||n["Accept"]||(n["Accept"]="application/json");if(l!=="GET"&&l!=="HEAD"){n["content-type"]||n["Content-Type"]||(n["Content-Type"]="application/json");m=JSON.stringify(a.json===true?m:a.json)}}h.onreadystatechange=d;h.onload=g;h.onerror=f;h.onprogress=function(){};h.onabort=function(){j=true};h.ontimeout=f;h.open(l,k,!o,a.username,a.password);if(!o){h.withCredentials=!!a.withCredentials}if(!o&&a.timeout>0){q=setTimeout(function(){if(j)return;j=true;h.abort("timeout");var a=new Error("XMLHttpRequest timeout");a.code="ETIMEDOUT";f(a)},a.timeout)}if(h.setRequestHeader){for(i in n){if(n.hasOwnProperty(i)){h.setRequestHeader(i,n[i])}}}else if(a.headers&&!ex(a.headers)){throw new Error("Headers cannot be set on an XDomainRequest object")}if("responseType"in a){h.responseType=a.responseType}if("beforeSend"in a&&typeof a.beforeSend==="function"){a.beforeSend(h)}h.send(m||null);return h}function ez(a,b,c){b=ey(a,b,c);return eA(b)}function ey(a,b,c){var d=a;if(ef(b)){c=b;if(typeof a==="string"){d={uri:a}}}else{d=es(b,{uri:a})}d.callback=c;return d}function ex(a){for(var b in a){if(a.hasOwnProperty(b))return false}return true}function ew(a,b){for(var c=0;c<a.length;c++){b(a[c])}}function eu(){var a={};for(var b=0;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(et.call(c,d)){a[d]=c[d]}}}return a}function ep(a,b,c){for(var d in a){if(el.call(a,d)){b.call(c,a[d],d,a)}}}function eo(a,b,c){for(var d=0,e=a.length;d<e;d++){b.call(c,a.charAt(d),d,a)}}function en(a,b,c){for(var d=0,e=a.length;d<e;d++){if(el.call(a,d)){b.call(c,a[d],d,a)}}}function em(a,b,c){if(!ef(b)){throw new TypeError("iterator must be a function")}if(arguments.length<3){c=this}if(ek.call(a)==="[object Array]")en(a,b,c);else if(typeof a==="string")eo(a,b,c);else ep(a,b,c)}function eh(a){var b=eg.call(a);return b==="[object Function]"||typeof a==="function"&&b!=="[object RegExp]"||typeof window!=="undefined"&&(a===window.setTimeout||a===window.alert||a===window.confirm||a===window.prompt)}function cS(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a;a=a<0?0:a;var c=Math.floor(a%60);var d=Math.floor(a/60%60);var e=Math.floor(a/3600);var f=Math.floor(b/60%60);var g=Math.floor(b/3600);if(isNaN(a)||a===Infinity){e=d=c="-"}e=e>0||g>0?e+":":"";d=((e||f>=10)&&d<10?"0"+d:d)+":";c=c<10?"0"+c:c;return e+d+c}function cO(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var c=arguments[2];var d=arguments[3];var e=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];var f=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var g=b[0],h=b.slice(1);if(typeof g==="string"){cO(a,cF[g],c,d,e,f)}else if(g){var i=g(d);i.setSource(Q({},a),function(b,g){if(b){return cO(a,h,c,d,e,f)}e.push(i);cO(g,a.type===g.type?h:cF[g.type],c,d,e,f)})}else if(h.length){cO(a,h,c,d,e,f)}else if(f){c(a,e)}else{cO(a,cF["*"],c,d,e,true)}}function cN(a){return function(b,c){if(c[a]){return c[a](b)}return b}}function cK(a,b,c,d){return b[c](a.reduce(cN(c),d))}function cJ(a,b,c){return a.reduceRight(cN(c),b[c]())}function cI(a,b){a.forEach(function(a){return a.setTech&&a.setTech(b)})}function cH(a,b,c){a.setTimeout(function(){return cO(b,cF[b.type],c,a)},1)}function cG(a,b){cF[a]=cF[a]||[];cF[a].push(b)}function cA(a,b){var c;var d=null;try{c=JSON.parse(a,b)}catch(e){d=e}return[d,c]}function cx(a){if(a instanceof cx){return a}if(typeof a==="number"){this.code=a}else if(typeof a==="string"){this.message=a}else if(R(a)){if(typeof a.code==="number"){this.code=a.code}Q(this,a)}if(!this.message){this.message=cx.defaultMessages[this.code]||""}}function cq(a,b){var c=0;var d=void 0;var e=void 0;if(!b){return 0}if(!a||!a.length){a=cp(0,0)}for(var f=0;f<a.length;f++){d=a.start(f);e=a.end(f);if(e>b){e=b}c+=e-d}return c/b}function cp(a,b){if(Array.isArray(a)){return co(a)}else if(a===undefined||b===undefined){return co()}return co([[a,b]])}function co(a){if(a===undefined||a.length===0){return{length:0,start:function b(){throw new Error("This TimeRanges object is empty")},end:function c(){throw new Error("This TimeRanges object is empty")}}}return{length:a.length,start:cn.bind(null,"start",0,a),end:cn.bind(null,"end",1,a)}}function cn(a,b,c,d){cm(a,d,c.length-1);return c[d][b]}function cm(a,b,c){if(typeof b!=="number"||b<0||b>c){throw new Error("Failed to execute '"+a+"' on 'TimeRanges': The index provided ("+b+") is non-numeric or out of bounds (0-"+c+").")}}function ck(){var a={};for(var b=arguments.length,c=Array(b),d=0;d<b;d++){c[d]=arguments[d]}c.forEach(function(b){if(!b){return}P(b,function(b,c){if(!S(b)){a[c]=b;return}if(!S(a[c])){a[c]={}}a[c]=ck(a[c],b)})});return a}function cj(a,b){return ci(a)===ci(b)}function ci(a){if(typeof a!=="string"){return a}return a.charAt(0).toUpperCase()+a.slice(1)}function ch(a,b){Q(a,cg);a.state=Q({},a.state,b);if(typeof a.handleStateChanged==="function"&&bZ(a)){a.on("statechanged",a.handleStateChanged)}return a}function cf(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=b.eventBusKey;if(c){if(!a[c].nodeName){throw new Error('The eventBusKey "'+c+'" does not refer to an element.')}a.eventBusEl_=a[c]}else{a.eventBusEl_=bg("span",{className:"wbv-event-bus"})}Q(a,ce);a.on("dispose",function(){return a.off()});return a}function bU(a,b,c){if(Array.isArray(b)){return bN(bU,a,b,c)}var d=function e(){bS(a,b,e);c.apply(this,arguments)};d.guid=c.guid=c.guid||bG();bR(a,b,d)}function bT(a,b,c){var d=bK(a)?bJ(a):{};var e=a.parentNode||a.ownerDocument;if(typeof b==="string"){b={type:b,target:a}}b=bO(b);if(d.dispatcher){d.dispatcher.call(a,b,c)}if(e&&!b.isPropagationStopped()&&b.bubbles===true){bT.call(null,e,b,c)}else if(!e&&!b.defaultPrevented){var f=bJ(b.target);if(b.target[b.type]){f.disabled=true;if(typeof b.target[b.type]==="function"){b.target[b.type]()}f.disabled=false}}return!b.defaultPrevented}function bS(a,b,c){if(!bK(a)){return}var d=bJ(a);if(!d.handlers){return}if(Array.isArray(b)){return bN(bS,a,b,c)}var e=function i(b){d.handlers[b]=[];bM(a,b)};if(!b){for(var f in d.handlers){e(f)}return}var g=d.handlers[b];if(!g){return}if(!c){e(b);return}if(c.guid){for(var h=0;h<g.length;h++){if(g[h].guid===c.guid){g.splice(h--,1)}}}bM(a,b)}function bR(a,b,c){if(Array.isArray(b)){return bN(bR,a,b,c)}var d=bJ(a);if(!d.handlers){d.handlers={}}if(!d.handlers[b]){d.handlers[b]=[]}if(!c.guid){c.guid=bG()}d.handlers[b].push(c);if(!d.dispatcher){d.disabled=false;d.dispatcher=function(b,c){if(d.disabled){return}b=bO(b);var e=d.handlers[b.type];if(e){var f=e.slice(0);for(var g=0,h=f.length;g<h;g++){if(b.isImmediatePropagationStopped()){break}else{try{f[g].call(a,b,c)}catch(i){X.error(i)}}}}}}if(d.handlers[b].length===1){if(a.addEventListener){var e=false;if(bP&&bQ.indexOf(b)>-1){e={passive:true}}a.addEventListener(b,d.dispatcher,e)}else if(a.attachEvent){a.attachEvent("on"+b,d.dispatcher)}}}function bO(a){function c(){return false}function b(){return true}if(!a||!a.isPropagationStopped){var d=a||e.event;a={};for(var f in d){if(f!=="layerX"&&f!=="layerY"&&f!=="keyLocation"&&f!=="webkitMovementX"&&f!=="webkitMovementY"){if(!(f==="returnValue"&&d.preventDefault)){a[f]=d[f]}}}if(!a.target){a.target=a.srcElement||k}if(!a.relatedTarget){a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement}a.preventDefault=function(){if(d.preventDefault){d.preventDefault()}a.returnValue=false;d.returnValue=false;a.defaultPrevented=true};a.defaultPrevented=false;a.stopPropagation=function(){if(d.stopPropagation){d.stopPropagation()}a.cancelBubble=true;d.cancelBubble=true;a.isPropagationStopped=b};a.isPropagationStopped=c;a.stopImmediatePropagation=function(){if(d.stopImmediatePropagation){d.stopImmediatePropagation()}a.isImmediatePropagationStopped=b;a.stopPropagation()};a.isImmediatePropagationStopped=c;if(a.clientX!==null&&a.clientX!==undefined){var g=k.documentElement;var h=k.body;a.pageX=a.clientX+(g&&g.scrollLeft||h&&h.scrollLeft||0)-(g&&g.clientLeft||h&&h.clientLeft||0);a.pageY=a.clientY+(g&&g.scrollTop||h&&h.scrollTop||0)-(g&&g.clientTop||h&&h.clientTop||0)}a.which=a.charCode||a.keyCode;if(a.button!==null&&a.button!==undefined){a.button=a.button&1?0:a.button&4?1:a.button&2?2:0}}return a}function bN(a,b,c,d){c.forEach(function(c){a(b,c,d)})}function bM(a,b){var c=bJ(a);if(c.handlers[b].length===0){delete c.handlers[b];if(a.removeEventListener){a.removeEventListener(b,c.dispatcher,false)}else if(a.detachEvent){a.detachEvent("on"+b,c.dispatcher)}}if(Object.getOwnPropertyNames(c.handlers).length<=0){delete c.handlers;delete c.dispatcher;delete c.disabled}if(Object.getOwnPropertyNames(c).length===0){bL(a)}}function bL(a){var b=a[bI];if(!b){return}delete bH[b];try{delete a[bI]}catch(c){if(a.removeAttribute){a.removeAttribute(bI)}else{a[bI]=null}}}function bK(a){var b=a[bI];if(!b){return false}return!!Object.getOwnPropertyNames(bH[b]).length}function bJ(a){var b=a[bI];if(!b){b=a[bI]=bG()}if(!bH[b]){bH[b]={}}return bH[b]}function bG(){return bF++}function bB(a,b){return bA(by(a),b)}function bA(a,b){bz(b).forEach(function(b){return a.appendChild(b)});return a}function bz(a){if(typeof a==="function"){a=a()}return(Array.isArray(a)?a:[a]).map(function(a){if(typeof a==="function"){a=a()}if(be(a)||bx(a)){return a}if(typeof a==="string"&&/\S/.test(a)){return k.createTextNode(a)}}).filter(function(a){return a})}function by(a){while(a.firstChild){a.removeChild(a.firstChild)}return a}function bx(a){return R(a)&&a.nodeType===3}function bw(a,b){var c={};var d=bv(a);var e=a.offsetWidth;var f=a.offsetHeight;var g=d.top;var h=d.left;var i=b.pageY;var j=b.pageX;if(b.changedTouches){j=b.changedTouches[0].pageX;i=b.changedTouches[0].pageY}c.y=Math.max(0,Math.min(1,(g-i+f)/f));c.x=Math.max(0,Math.min(1,(j-h)/e));return c}function bv(a){var b=void 0;if(a.getBoundingClientRect&&a.parentNode){b=a.getBoundingClientRect()}if(!b){return{left:0,top:0}}var c=k.documentElement;var d=k.body;var f=c.clientLeft||d.clientLeft||0;var g=e.pageXOffset||d.scrollLeft;var h=b.left+g-f;var i=c.clientTop||d.clientTop||0;var j=e.pageYOffset||d.scrollTop;var l=b.top+j-i;return{left:Math.round(h),top:Math.round(l)}}function bu(a){if(a&&a.getBoundingClientRect&&a.parentNode){var b=a.getBoundingClientRect();var c={};["bottom","height","left","right","top","width"].forEach(function(a){if(b[a]!==undefined){c[a]=b[a]}});if(!c.height){c.height=parseFloat($(a,"height"))}if(!c.width){c.width=parseFloat($(a,"width"))}return c}}function bt(){k.onselectstart=function(){return true}}function bs(){k.body.focus();k.onselectstart=function(){return false}}function br(a,b){a.removeAttribute(b)}function bq(a,b,c){a.setAttribute(b,c)}function bp(a,b){return a.getAttribute(b)}function bo(a){var b={};var c=","+"autoplay,controls,playsinline,loop,muted,default,defaultMuted"+",";if(a&&a.attributes&&a.attributes.length>0){var d=a.attributes;for(var e=d.length-1;e>=0;e--){var f=d[e].name;var g=d[e].value;if(typeof a[f]==="boolean"||c.indexOf(","+f+",")!==-1){g=g!==null?true:false}b[f]=g}}return b}function bn(a,b){Object.getOwnPropertyNames(b).forEach(function(c){var d=b[c];if(d===null||typeof d==="undefined"||d===false){a.removeAttribute(c)}else{a.setAttribute(c,d===true?"":d)}})}function bm(a,b,c){var d=bj(a,b);if(typeof c==="function"){c=c(a,b)}if(typeof c!=="boolean"){c=!d}if(c===d){return}if(c){bk(a,b)}else{bl(a,b)}return a}function bl(a,b){if(a.classList){a.classList.remove(b)}else{bb(b);a.className=a.className.split(/\s+/).filter(function(a){return a!==b}).join(" ")}return a}function bk(a,b){if(a.classList){a.classList.add(b)}else if(!bj(a,b)){a.className=(a.className+" "+b).trim()}return a}function bj(a,b){bb(b);if(a.classList){return a.classList.contains(b)}return bc(b).test(a.className)}function bi(a,b){if(b.firstChild){b.insertBefore(a,b.firstChild)}else{b.appendChild(a)}}function bh(a,b){if(typeof a.textContent==="undefined"){a.innerText=b}else{a.textContent=b}return a}function bg(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var d=arguments[3];var e=k.createElement(a);Object.getOwnPropertyNames(b).forEach(function(a){var c=b[a];if(a.indexOf("aria-")!==-1||a==="role"||a==="type"){X.warn(Z(_,a,c));e.setAttribute(a,c)}else if(a==="textContent"){bh(e,c)}else{e[a]=c}});Object.getOwnPropertyNames(c).forEach(function(a){e.setAttribute(a,c[a])});if(d){bA(e,d)}return e}function bf(a){return function(b,c){if(!ba(b)){return k[a](null)}if(ba(c)){c=k.querySelector(c)}var d=be(c)?c:k;return d[a]&&d[a](b)}}function be(a){return R(a)&&a.nodeType===1}function bd(){return k===e.document&&typeof k.createElement!=="undefined"}function bc(a){return new RegExp("(^|\\s)"+a+"($|\\s)")}function bb(a){if(/\s/.test(a)){throw new Error("class has illegal whitespace characters")}}function ba(a){return typeof a==="string"&&/\S/.test(a)}function $(a,b){if(!a||!b){return""}if(typeof e.getComputedStyle==="function"){var c=e.getComputedStyle(a);return c?c[b]:""}return a.currentStyle[b]||""}function Y(a){return a.replace(/\n\r?\s*/g,"")}function S(a){return R(a)&&N.call(a)==="[object Object]"&&a.constructor===Object}function R(a){return!!a&&(typeof a==="undefined"?"undefined":I(a))==="object"}function Q(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++){c[d-1]=arguments[d]}if(Object.assign){return Object.assign.apply(Object,[a].concat(c))}c.forEach(function(b){if(!b){return}P(b,function(b,c){a[c]=b})});return a}function P(a,b){O(a).forEach(function(c){return b(a[c],c)})}function c(a,b){return b={exports:{}},a(b,b.exports),b.exports}var a="6.2.8";var b=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var d;if(typeof window!=="undefined"){d=window}else if(typeof b!=="undefined"){d=b}else if(typeof self!=="undefined"){d=self}else{d={}}var e=d;var f={};var g=(Object.freeze||Object)({"default":f});var h=g&&f||g;var i=typeof b!=="undefined"?b:typeof window!=="undefined"?window:{};var j;if(typeof document!=="undefined"){j=document}else{j=i["__GLOBAL_DOCUMENT_CACHE@4"];if(!j){j=i["__GLOBAL_DOCUMENT_CACHE@4"]=h}}var k=j;var l=e.navigator&&e.navigator.userAgent||"";var m=/AppleWebKit\/([\d.]+)/i.exec(l);var n=m?parseFloat(m.pop()):null;var o=/iPad/i.test(l);var p=/iPhone/i.test(l)&&!o;var q=/iPod/i.test(l);var r=p||o||q;var s=function(){var a=l.match(/OS (\d+)_/i);if(a&&a[1]){return a[1]}return null}();var t=/Android/i.test(l);var u=function(){var a=l.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!a){return null}var b=a[1]&&parseFloat(a[1]);var c=a[2]&&parseFloat(a[2]);if(b&&c){return parseFloat(a[1]+"."+a[2])}else if(b){return b}return null}();var v=t&&/webkit/i.test(l)&&u<2.3;var w=t&&u<5&&n<537;var x=/Firefox/i.test(l);var y=/Edge/i.test(l);var z=!y&&/Chrome/i.test(l);var A=function(){var a=l.match(/Chrome\/(\d+)/);if(a&&a[1]){return parseFloat(a[1])}return null}();var B=/MSIE\s8\.0/.test(l);var C=function(){var a=/MSIE\s(\d+)\.\d/.exec(l);var b=a&&parseFloat(a[1]);if(!b&&/Trident\/7.0/i.test(l)&&/rv:11.0/.test(l)){b=11}return b}();var D=/Safari/i.test(l)&&!z&&!t&&!y;var E=D||r;var F=bd()&&("ontouchstart"in e||e.DocumentTouch&&e.document instanceof e.DocumentTouch);var G=bd()&&"backgroundSize"in e.document.createElement("video").style;var H=(Object.freeze||Object)({IS_IPAD:o,IS_IPHONE:p,IS_IPOD:q,IS_IOS:r,IOS_VERSION:s,IS_ANDROID:t,ANDROID_VERSION:u,IS_OLD_ANDROID:v,IS_NATIVE_ANDROID:w,IS_FIREFOX:x,IS_EDGE:y,IS_CHROME:z,CHROME_VERSION:A,IS_IE8:B,IE_VERSION:C,IS_SAFARI:D,IS_ANY_SAFARI:E,TOUCH_ENABLED:F,BACKGROUND_SIZE_SUPPORTED:G});var I=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var J=function(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}};var K=function(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof b)}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b)Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b};var L=function(a,b){if(!a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return b&&(typeof b==="object"||typeof b==="function")?b:a};var M=function(a,b){a.raw=b;return a};var N=Object.prototype.toString;var O=function eE(a){return R(a)?Object.keys(a):[]};var T=void 0;var U="all";var V=[];var W=function eF(a,b){var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:!!C&&C<11;var d=T.levels[U];var f=new RegExp("^("+d+")$");if(a!=="log"){b.unshift(a.toUpperCase()+":")}if(V){V.push([].concat(b))}b.unshift("V:");var g=e.console&&e.console[a];if(!g||!d||!f.test(a)){return}if(c){b=b.map(function(a){if(R(a)||Array.isArray(a)){try{return JSON.stringify(a)}catch(b){return String(a)}}return String(a)}).join(" ")}if(!g.apply){g(b)}else{};};T=function eG(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++){b[c]=arguments[c]}W("log",b)};T.levels={all:"log|warn|error",error:"error",off:"",warn:"warn|error",DEFAULT:U};T.level=function(a){if(typeof a==="string"){if(!T.levels.hasOwnProperty(a)){throw new Error('"'+a+'" in not a valid log level')}U=a}return U};T.history=function(){return V?[].concat(V):[]};T.history.clear=function(){if(V){V.length=0}};T.history.disable=function(){if(V!==null){V.length=0;V=null}};T.history.enable=function(){if(V===null){V=[]}};T.error=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++){b[c]=arguments[c]}return W("error",b)};T.warn=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++){b[c]=arguments[c]}return W("warn",b)};var X=T;var Z=function eH(a){var b="",c=0;for(;c<arguments.length;c++)b+=Y(a[c])+(arguments[c+1]||"");return b};var _=M(["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."],["Setting attributes in the second argument of createEl()\n                has been deprecated. Use the third argument instead.\n                createEl(type, properties, attributes). Attempting to set "," to ","."]);var bC=bf("querySelector");var bD=bf("querySelectorAll");var bE=(Object.freeze||Object)({isReal:bd,isEl:be,createEl:bg,textContent:bh,prependTo:bi,hasClass:bj,addClass:bk,removeClass:bl,toggleClass:bm,setAttributes:bn,getAttributes:bo,getAttribute:bp,setAttribute:bq,removeAttribute:br,blockTextSelection:bs,unblockTextSelection:bt,getBoundingClientRect:bu,findPosition:bv,getPointerPosition:bw,isTextNode:bx,emptyEl:by,normalizeContent:bz,appendContent:bA,insertContent:bB,$:bC,$$:bD});var bF=1;var bH={};var bI="vdata"+(new Date).getTime();var bP=false;(function(){try{var a=Object.defineProperty({},"passive",{get:function c(){bP=true}});e.addEventListener("test",null,a)}catch(b){}})();var bQ=["touchstart","touchmove"];var bV=(Object.freeze||Object)({fixEvent:bO,on:bR,off:bS,trigger:bT,one:bU});var bW=function eI(a,b,c){if(!b.guid){b.guid=bG()}var d=function e(){return b.apply(a,arguments)};d.guid=c?c+"_"+b.guid:b.guid;return d};var bX=function eJ(a,b){var c=Date.now();var d=function e(){var d=Date.now();if(d-c>=b){a.apply(undefined,arguments);c=d}};return d};var bY=function eK(){};bY.prototype.allowedEvents_={};bY.prototype.on=function(a,b){var c=this.addEventListener;this.addEventListener=function(){};bR(this,a,b);this.addEventListener=c};bY.prototype.addEventListener=bY.prototype.on;bY.prototype.off=function(a,b){bS(this,a,b)};bY.prototype.removeEventListener=bY.prototype.off;bY.prototype.one=function(a,b){var c=this.addEventListener;this.addEventListener=function(){};bU(this,a,b);this.addEventListener=c};bY.prototype.trigger=function(a){var b=a.type||a;if(typeof a==="string"){a={type:b}}a=bO(a);if(this.allowedEvents_[b]&&this["on"+b]){this["on"+b](a)}bT(this,a)};bY.prototype.dispatchEvent=bY.prototype.trigger;var bZ=function eL(a){return a instanceof bY||!!a.eventBusEl_&&["on","one","off","trigger"].every(function(b){return typeof a[b]==="function"})};var b$=function eM(a){return typeof a==="string"&&/\S/.test(a)||Array.isArray(a)&&!!a.length};var b_=function eN(a){if(!a.nodeName&&!bZ(a)){throw new Error("Invalid target; must be a DOM node or evented object.")}};var ca=function eO(a){if(!b$(a)){throw new Error("Invalid event type; must be a non-empty string or array.")}};var cb=function eP(a){if(typeof a!=="function"){throw new Error("Invalid listener; must be a function.")}};var cc=function eQ(a,b){var c=b.length<3||b[0]===a||b[0]===a.eventBusEl_;var d=void 0;var e=void 0;var f=void 0;if(c){d=a.eventBusEl_;if(b.length>=3){b.shift()}e=b[0];f=b[1]}else{d=b[0];e=b[1];f=b[2]}b_(d);ca(e);cb(f);f=bW(a,f);return{isTargetingSelf:c,target:d,type:e,listener:f}};var cd=function eR(a,b,c,d){b_(a);if(a.nodeName){bV[b](a,c,d)}else{a[b](c,d)}};var ce={on:function eS(){var a=this;for(var b=arguments.length,c=Array(b),d=0;d<b;d++){c[d]=arguments[d]}var e=cc(this,c),f=e.isTargetingSelf,g=e.target,h=e.type,i=e.listener;cd(g,"on",h,i);if(!f){var j=function l(){return a.off(g,h,i)};j.guid=i.guid;var k=function m(){return a.off("dispose",j)};k.guid=i.guid;cd(this,"on","dispose",j);cd(g,"on","dispose",k)}},one:function eT(){var a=this;for(var b=arguments.length,c=Array(b),d=0;d<b;d++){c[d]=arguments[d]}var e=cc(this,c),f=e.isTargetingSelf,g=e.target,h=e.type,i=e.listener;if(f){cd(g,"one",h,i)}else{var j=function k(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++){c[d]=arguments[d]}a.off(g,h,k);i.apply(null,c)};j.guid=i.guid;cd(g,"one",h,j)}},off:function eU(a,b,c){if(!a||b$(a)){bS(this.eventBusEl_,a,b)}else{var d=a;var e=b;b_(d);ca(e);cb(c);c=bW(this,c);this.off("dispose",c);if(d.nodeName){bS(d,e,c);bS(d,"dispose",c)}else if(bZ(d)){d.off(e,c);d.off("dispose",c)}}},trigger:function eV(a,b){return bT(this.eventBusEl_,a,b)}};var cg={state:{},setState:function eW(a){var b=this;if(typeof a==="function"){a=a()}var c=void 0;P(a,function(a,d){if(b.state[d]!==a){c=c||{};c[d]={from:b.state[d],to:a}}b.state[d]=a});if(c&&bZ(this)){this.trigger({changes:c,type:"statechanged"})}return c}};var cl=function(){function a(b,c,d){J(this,a);if(!b&&this.play){this.player_=b=this}else{this.player_=b}this.options_=ck({},this.options_);c=this.options_=ck(this.options_,c);this.id_=c.id||c.el&&c.el.id;if(!this.id_){var e=b&&b.id&&b.id()||"no_player";this.id_=e+"_component_"+bG()}this.name_=c.name||null;if(c.el){this.el_=c.el}else if(c.createEl!==false){this.el_=this.createEl()}cf(this,{eventBusKey:this.el_?"el_":null});ch(this,this.constructor.defaultState);this.children_=[];this.childIndex_={};this.childNameIndex_={};if(c.initChildren!==false){this.initChildren()}this.ready(d);if(c.reportTouchActivity!==false){this.enableTouchActivity()}}a.prototype.dispose=function b(){this.trigger({type:"dispose",bubbles:false});if(this.children_){for(var a=this.children_.length-1;a>=0;a--){if(this.children_[a].dispose){this.children_[a].dispose()}}}this.children_=null;this.childIndex_=null;this.childNameIndex_=null;if(this.el_){if(this.el_.parentNode){this.el_.parentNode.removeChild(this.el_)}bL(this.el_);this.el_=null}};a.prototype.player=function c(){return this.player_};a.prototype.options=function d(a){if(!a){return this.options_}this.options_=ck(this.options_,a);return this.options_};a.prototype.el=function f(){return this.el_};a.prototype.createEl=function g(a,b,c){c=Q({disabletitle:"true"},c);return bg(a,b,c)};a.prototype.localize=function h(a,b){var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:a;var d=this.player_.language&&this.player_.language();var e=this.player_.languages&&this.player_.languages();var f=e&&e[d];var g=d&&d.split("-")[0];var h=e&&e[g];var i=c;if(f&&f[a]){i=f[a]}else if(h&&h[a]){i=h[a]}if(b){i=i.replace(/\{(\d+)\}/g,function(a,c){var d=b[c-1];var e=d;if(typeof d==="undefined"){e=a}return e})}return i};a.prototype.contentEl=function i(){return this.contentEl_||this.el_};a.prototype.id=function j(){return this.id_};a.prototype.name=function k(){return this.name_};a.prototype.children=function l(){return this.children_};a.prototype.getChildById=function m(a){return this.childIndex_[a]};a.prototype.getChild=function n(a){if(!a){return}a=ci(a);return this.childNameIndex_[a]};a.prototype.addChild=function o(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.children_.length;var e=void 0;var f=void 0;if(typeof b==="string"){f=ci(b);var g=c.componentClass||f;c.name=f;var h=a.getComponent(g);if(!h){throw new Error("Component "+g+" does not exist")}if(typeof h!=="function"){return null}e=new h(this.player_||this,c)}else{e=b}this.children_.splice(d,0,e);if(typeof e.id==="function"){this.childIndex_[e.id()]=e}f=f||e.name&&ci(e.name());if(f){this.childNameIndex_[f]=e}if(typeof e.el==="function"&&e.el()){var i=this.contentEl().children;var j=i[d]||null;this.contentEl().insertBefore(e.el(),j)}return e};a.prototype.removeChild=function p(a){if(typeof a==="string"){a=this.getChild(a)}if(!a||!this.children_){return}var b=false;for(var c=this.children_.length-1;c>=0;c--){if(this.children_[c]===a){b=true;this.children_.splice(c,1);break}}if(!b){return}this.childIndex_[a.id()]=null;this.childNameIndex_[a.name()]=null;var d=a.el();if(d&&d.parentNode===this.contentEl()){this.contentEl().removeChild(a.el())}};a.prototype.initChildren=function q(){var b=this;var c=this.options_.children;if(c){var d=this.options_;var e=function h(a){var c=a.name;var e=a.opts;if(d[c]!==undefined){e=d[c]}if(e===false){return}if(e===true){e={}}e.playerOptions=b.options_.playerOptions;var f=b.addChild(c,e);if(f){b[c]=f}};var f=void 0;var g=a.getComponent("Tech");if(Array.isArray(c)){f=c}else{f=Object.keys(c)}f.concat(Object.keys(this.options_).filter(function(a){return!f.some(function(b){if(typeof b==="string"){return a===b}return a===b.name})})).map(function(a){var d=void 0;var e=void 0;if(typeof a==="string"){d=a;e=c[d]||b.options_[d]||{}}else{d=a.name;e=a}return{name:d,opts:e}}).filter(function(b){var c=a.getComponent(b.opts.componentClass||ci(b.name));return c&&!g.isTech(c)}).forEach(e)}};a.prototype.buildCSSClass=function r(){return""};a.prototype.ready=function s(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(a){if(this.isReady_){if(b){a.call(this)}else{this.setTimeout(a,1)}}else{this.readyQueue_=this.readyQueue_||[];this.readyQueue_.push(a)}}};a.prototype.triggerReady=function t(){this.isReady_=true;this.setTimeout(function(){var a=this.readyQueue_;this.readyQueue_=[];if(a&&a.length>0){a.forEach(function(a){a.call(this)},this)}this.trigger("ready")},1)};a.prototype.$=function u(a,b){return bC(a,b||this.contentEl())};a.prototype.$$=function v(a,b){return bD(a,b||this.contentEl())};a.prototype.hasClass=function w(a){return bj(this.el_,a)};a.prototype.addClass=function x(a){bk(this.el_,a)};a.prototype.removeClass=function y(a){bl(this.el_,a)};a.prototype.toggleClass=function z(a,b){bm(this.el_,a,b)};a.prototype.show=function A(){this.removeClass("wbv-hidden")};a.prototype.hide=function B(){this.addClass("wbv-hidden")};a.prototype.lockShowing=function C(){this.addClass("wbv-lock-showing")};a.prototype.unlockShowing=function D(){this.removeClass("wbv-lock-showing")};a.prototype.getAttribute=function E(a){return bp(this.el_,a)};a.prototype.setAttribute=function F(a,b){bq(this.el_,a,b)};a.prototype.removeAttribute=function G(a){br(this.el_,a)};a.prototype.width=function H(a,b){return this.dimension("width",a,b)};a.prototype.height=function I(a,b){return this.dimension("height",a,b)};a.prototype.dimensions=function K(a,b){this.width(a,true);this.height(b)};a.prototype.dimension=function L(a,b,c){if(b!==undefined){if(b===null||b!==b){b=0}if((""+b).indexOf("%")!==-1||(""+b).indexOf("px")!==-1){this.el_.style[a]=b}else if(b==="auto"){this.el_.style[a]=""}else{this.el_.style[a]=b+"px"}if(!c){this.trigger("componentresize")}return}if(!this.el_){return 0}var d=this.el_.style[a];var e=d.indexOf("px");if(e!==-1){return parseInt(d.slice(0,e),10)}return parseInt(this.el_["offset"+ci(a)],10)};a.prototype.currentDimension=function M(a){var b=0;if(a!=="width"&&a!=="height"){throw new Error("currentDimension only accepts width or height value")}if(typeof e.getComputedStyle==="function"){var c=e.getComputedStyle(this.el_);b=c.getPropertyValue(a)||c[a]}b=parseFloat(b);if(b===0){var d="offset"+ci(a);b=this.el_[d]}return b};a.prototype.currentDimensions=function N(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}};a.prototype.currentWidth=function O(){return this.currentDimension("width")};a.prototype.currentHeight=function P(){return this.currentDimension("height")};a.prototype.focus=function R(){this.el_.focus()};a.prototype.blur=function S(){this.el_.blur()};a.prototype.emitTapEvents=function T(){var a=0;var b=null;var c=10;var d=200;var e=void 0;this.on("touchstart",function(c){if(c.touches.length===1){b={pageX:c.touches[0].pageX,pageY:c.touches[0].pageY};a=(new Date).getTime();e=true}});this.on("touchmove",function(a){if(a.touches.length>1){e=false}else if(b){var d=a.touches[0].pageX-b.pageX;var f=a.touches[0].pageY-b.pageY;var g=Math.sqrt(d*d+f*f);if(g>c){e=false}}});var f=function g(){e=false};this.on("touchleave",f);this.on("touchcancel",f);this.on("touchend",function(c){b=null;if(e===true){var f=(new Date).getTime()-a;if(f<d){c.preventDefault();this.trigger("tap")}}})};a.prototype.enableTouchActivity=function U(){if(!this.player()||!this.player().reportUserActivity){return}var a=bW(this.player(),this.player().reportUserActivity);var b=void 0;this.on("touchstart",function(){a();this.clearInterval(b);b=this.setInterval(a,250)});var c=function d(c){a();this.clearInterval(b)};this.on("touchmove",a);this.on("touchend",c);this.on("touchcancel",c)};a.prototype.setTimeout=function V(a,b){a=bW(this,a);var c=e.setTimeout(a,b);var d=function f(){this.clearTimeout(c)};d.guid="wbv-timeout-"+c;this.on("dispose",d);return c};a.prototype.clearTimeout=function W(a){e.clearTimeout(a);var b=function c(){};b.guid="wbv-timeout-"+a;this.off("dispose",b);return a};a.prototype.setInterval=function X(a,b){a=bW(this,a);var c=e.setInterval(a,b);var d=function f(){this.clearInterval(c)};d.guid="wbv-interval-"+c;this.on("dispose",d);return c};a.prototype.clearInterval=function Y(a){e.clearInterval(a);var b=function c(){};b.guid="wbv-interval-"+a;this.off("dispose",b);return a};a.prototype.requestAnimationFrame=function Z(a){var b=this;if(this.supportsRaf_){a=bW(this,a);var c=e.requestAnimationFrame(a);var d=function f(){return b.cancelAnimationFrame(c)};d.guid="wbv-raf-"+c;this.on("dispose",d);return c}return this.setTimeout(a,1e3/60)};a.prototype.cancelAnimationFrame=function $(a){if(this.supportsRaf_){e.cancelAnimationFrame(a);var b=function c(){};b.guid="wbv-raf-"+a;this.off("dispose",b);return a}return this.clearTimeout(a)};a.registerComponent=function _(b,c){if(typeof b!=="string"||!b){throw new Error('Illegal component name, "'+b+'"; must be a non-empty string.')}var d=a.getComponent("Tech");var e=d&&d.isTech(c);var f=a===c||a.prototype.isPrototypeOf(c.prototype);if(e||!f){var g=void 0;if(e){g="techs must be registered using Tech.registerTech()"}else{g="must be a Component subclass"}throw new Error('Illegal component, "'+b+'"; '+g+".")}b=ci(b);if(!a.components_){a.components_={}}var h=a.getComponent("Player");if(b==="Player"&&h&&h.players){var i=h.players;var j=Object.keys(i);if(i&&j.length>0&&j.map(function(a){return i[a]}).every(Boolean)){throw new Error("Can not register Player component after player has been created.")}}a.components_[b]=c;return c};a.getComponent=function ba(b){if(!b){return}b=ci(b);if(a.components_&&a.components_[b]){return a.components_[b]}};return a}();cl.prototype.supportsRaf_=typeof e.requestAnimationFrame==="function"&&typeof e.cancelAnimationFrame==="function";cl.registerComponent("Component",cl);var cr={};var cs=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];var ct=cs[0];var cu=void 0;for(var cv=0;cv<cs.length;cv++){if(cs[cv][1]in k){cu=cs[cv];break}}if(cu){for(var cw=0;cw<cu.length;cw++){cr[ct[cw]]=cu[cw]}}cx.prototype.code=0;cx.prototype.message="";cx.prototype.status=null;cx.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"];cx.defaultMessages={1:"用户中止了播放",2:"您的网络不太好，建议更换网络",3:"抱歉，视频无法播放，去看看其他视频",4:"抱歉，视频无法播放，去看看其他视频",5:"视频格式错误，无法播放"};for(var cy=0;cy<cx.errorTypes.length;cy++){cx[cx.errorTypes[cy]]=cy;cx.prototype[cx.errorTypes[cy]]=cy}var cz=cA;var cB="wbv-modal-dialog";var cC=27;var cD=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.opened_=e.hasBeenOpened_=e.hasBeenFilled_=false;e.closeable(!e.options_.uncloseable);e.content(e.options_.content);if(!!!e.options_.withoutContent){e.contentEl_=bg("div",{className:cB+"-content"},{});e.descEl_=bg("p",{className:cB+"-description wbv-control-text",id:e.el().getAttribute("aria-describedby")});bh(e.descEl_,e.description());e.el_.appendChild(e.descEl_);e.el_.appendChild(e.contentEl_)}return e}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:this.buildCSSClass()},{})};b.prototype.buildCSSClass=function d(){return cB+" wbv-hidden "+a.prototype.buildCSSClass.call(this)};b.prototype.handleKeyPress=function f(a){if(a.which===cC&&this.closeable()){this.close()}};b.prototype.label=function g(){return this.localize(this.options_.label||"Modal Window")};b.prototype.description=function h(){var a=this.options_.description||this.localize("Modal Window");if(this.closeable()){a+=" "}return a};b.prototype.open=function i(){if(!this.opened_){var a=this.player();this.trigger("beforemodalopen");this.opened_=true;if(this.options_.fillAlways||!this.hasBeenOpened_&&!this.hasBeenFilled_){this.fill()}this.wasPlaying_=!a.paused();if(this.options_.pauseOnOpen&&this.wasPlaying_){a.pause()}if(this.closeable()){this.on(this.el_.ownerDocument,"keydown",bW(this,this.handleKeyPress))}a.controls(false);this.show();this.conditionalFocus_();this.player_.bigPlayButton&&this.player_.bigPlayButton.hide();this.trigger("modalopen");this.hasBeenOpened_=true}};b.prototype.opened=function j(a){if(typeof a==="boolean"){this[a?"open":"close"]()}return this.opened_};b.prototype.close=function l(){if(!this.opened_){return}var a=this.player();this.trigger("beforemodalclose");this.opened_=false;if(this.wasPlaying_&&this.options_.pauseOnOpen){a.play()}if(this.closeable()){this.off(this.el_.ownerDocument,"keydown",bW(this,this.handleKeyPress))}a.controls(true);this.hide();this.player_.bigPlayButton&&this.player_.bigPlayButton.show();this.trigger("modalclose");this.conditionalBlur_();if(this.options_.temporary){this.dispose()}};b.prototype.closeable=function m(a){if(typeof a==="boolean"){var m=this.closeable_=!!a;var b=this.getChild("closeButton");if(m&&!b){var c=this.contentEl_;this.contentEl_=this.el_;b=this.addChild("closeButton",{controlText:"关闭对话框"});this.contentEl_=c;this.on(b,"close",this.close)}if(!m&&b){this.off(b,"close",this.close);this.removeChild(b);b.dispose()}}return this.closeable_};b.prototype.fill=function n(){this.fillWith(this.content())};b.prototype.fillWith=function o(a){var b=this.contentEl();var c=b.parentNode;var d=b.nextSibling;this.trigger("beforemodalfill");this.hasBeenFilled_=true;c.removeChild(b);this.empty();bB(b,a);this.trigger("modalfill");if(d){c.insertBefore(b,d)}else{c.appendChild(b)}var e=this.getChild("closeButton");if(e){c.appendChild(e.el_)}};b.prototype.empty=function p(){this.trigger("beforemodalempty");by(this.contentEl());this.trigger("modalempty")};b.prototype.content=function q(a){if(typeof a!=="undefined"){this.content_=a}return this.content_};b.prototype.conditionalFocus_=function r(){var a=k.activeElement;var b=this.player_.el_;this.previouslyActiveEl_=null;if(b.contains(a)||b===a){this.previouslyActiveEl_=a;this.focus();this.on(k,"keydown",this.handleKeyDown)}};b.prototype.conditionalBlur_=function s(){if(this.previouslyActiveEl_){this.previouslyActiveEl_.focus();this.previouslyActiveEl_=null}this.off(k,"keydown",this.handleKeyDown)};b.prototype.handleKeyDown=function t(a){if(a.which!==9){return}var b=this.focusableEls_();var c=this.el_.querySelector(":focus");var d=void 0;for(var e=0;e<b.length;e++){if(c===b[e]){d=e;break}}if(k.activeElement===this.el_){d=0}if(a.shiftKey&&d===0){b[b.length-1].focus();a.preventDefault()}else if(!a.shiftKey&&d===b.length-1){b[0].focus();a.preventDefault()}};b.prototype.focusableEls_=function u(){var a=this.el_.querySelectorAll("*");return Array.prototype.filter.call(a,function(a){return(a instanceof e.HTMLAnchorElement||a instanceof e.HTMLAreaElement)&&a.hasAttribute("href")||(a instanceof e.HTMLInputElement||a instanceof e.HTMLSelectElement||a instanceof e.HTMLTextAreaElement||a instanceof e.HTMLButtonElement)&&!a.hasAttribute("disabled")||a instanceof e.HTMLIFrameElement||a instanceof e.HTMLObjectElement||a instanceof e.HTMLEmbedElement||a.hasAttribute("tabindex")&&a.getAttribute("tabindex")!==-1||a.hasAttribute("contenteditable")})};return b}(cl);cD.prototype.options_={pauseOnOpen:true,temporary:true};cl.registerComponent("ModalDialog",cD);var cE=function(a){function b(){var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};J(this,b);c.reportTouchActivity=false;var e=L(this,a.call(this,null,c,d));e.hasStarted_=false;e.on("playing",function(){this.hasStarted_=true});e.on("loadstart",function(){this.hasStarted_=false});if(!e.featuresProgressEvents){e.manualProgressOn()}if(!e.featuresTimeupdateEvents){e.manualTimeUpdatesOn()}["Video"].forEach(function(a){if(c["native"+a+"Tracks"]===false){e["featuresNative"+a+"Tracks"]=false}});if(c.nativeCaptions===false||c.nativeTextTracks===false){e.featuresNativeTextTracks=false}else if(c.nativeCaptions===true||c.nativeTextTracks===true){e.featuresNativeTextTracks=true}if(!c.nativeControlsForTouch){e.emitTapEvents()}if(e.constructor){e.name_=e.constructor.name||"Unknown Tech"}return e}K(b,a);b.prototype.manualProgressOn=function c(){this.on("durationchange",this.onDurationChange);this.manualProgress=true};b.prototype.manualProgressOff=function d(){this.manualProgress=false;this.off("durationchange",this.onDurationChange)};b.prototype.onDurationChange=function f(a){this.duration_=this.duration()};b.prototype.buffered=function g(){return cp(0,0)};b.prototype.bufferedPercent=function h(){return cq(this.buffered(),this.duration_)};b.prototype.manualTimeUpdatesOn=function i(){this.manualTimeUpdates=true;this.on("play",this.trackCurrentTime);this.on("pause",this.stopTrackingCurrentTime)};b.prototype.manualTimeUpdatesOff=function j(){this.manualTimeUpdates=false;this.stopTrackingCurrentTime();this.off("play",this.trackCurrentTime);this.off("pause",this.stopTrackingCurrentTime)};b.prototype.trackCurrentTime=function k(){if(this.currentTimeInterval){this.stopTrackingCurrentTime()}this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:true})},250)};b.prototype.stopTrackingCurrentTime=function l(){this.clearInterval(this.currentTimeInterval);this.trigger({type:"timeupdate",target:this,manuallyTriggered:true})};b.prototype.dispose=function m(){if(this.manualProgress){this.manualProgressOff()}if(this.manualTimeUpdates){this.manualTimeUpdatesOff()}a.prototype.dispose.call(this)};b.prototype.reset=function n(){};b.prototype.error=function o(a){if(a!==undefined){this.error_=new cx(a);this.trigger("error")}return this.error_};b.prototype.played=function p(){if(this.hasStarted_){return cp(0,0)}return cp()};b.prototype.setCurrentTime=function q(){if(this.manualTimeUpdates){this.trigger({type:"timeupdate",target:this,manuallyTriggered:true})}};b.prototype.getVideoPlaybackQuality=function r(){return{}};b.prototype.setPoster=function s(){};b.prototype.playsinline=function t(){};b.prototype.setPlaysinline=function u(){};b.prototype.canPlayType=function v(){return""};b.canPlayType=function w(){return""};b.canPlaySource=function x(a,c){return b.canPlayType(a.type)};b.isTech=function y(a){return a.prototype instanceof b||a instanceof b||a===b};b.registerTech=function z(a,c){if(!b.techs_){b.techs_={}}if(!b.isTech(c)){throw new Error("Tech "+a+" must be a Tech")}if(!b.canPlayType){throw new Error("Techs must have a static canPlayType method on them")}if(!b.canPlaySource){throw new Error("Techs must have a static canPlaySource method on them")}a=ci(a);b.techs_[a]=c;if(a!=="Tech"){b.defaultTechOrder_.push(a)}return c};b.getTech=function A(a){if(!a){return}a=ci(a);if(b.techs_&&b.techs_[a]){return b.techs_[a]}if(e&&e.V&&e.V[a]){X.warn("The "+a+" tech was added to the V object when it should be registered using V.registerTech(name, tech)");return e.V[a]}};return b}(cl);cE.prototype.featuresVolumeControl=true;cE.prototype.featuresFullscreenResize=false;cE.prototype.featuresPlaybackRate=false;cE.prototype.featuresProgressEvents=false;cE.prototype.featuresTimeupdateEvents=false;cE.prototype.featuresNativeTextTracks=false;cE.withSourceHandlers=function(a){a.registerSourceHandler=function(b,c){var d=a.sourceHandlers;if(!d){d=a.sourceHandlers=[]}if(c===undefined){c=d.length}d.splice(c,0,b)};a.canPlayType=function(b){var c=a.sourceHandlers||[];var d=void 0;for(var e=0;e<c.length;e++){d=c[e].canPlayType(b);if(d){return d}}return""};a.selectSourceHandler=function(b,c){var d=a.sourceHandlers||[];var e=void 0;for(var f=0;f<d.length;f++){e=d[f].canHandleSource(b,c);if(e){return d[f]}}return null};a.canPlaySource=function(b,c){var d=a.selectSourceHandler(b,c);if(d){return d.canHandleSource(b,c)}return""};var b=["seekable","duration"];b.forEach(function(a){var b=this[a];if(typeof b!=="function"){return}this[a]=function(){if(this.sourceHandler_&&this.sourceHandler_[a]){return this.sourceHandler_[a].apply(this.sourceHandler_,arguments)}return b.apply(this,arguments)}},a.prototype);a.prototype.setSource=function(b){var c=a.selectSourceHandler(b,this.options_);if(!c){if(a.nativeSourceHandler){c=a.nativeSourceHandler}else{X.error("No source hander found for the current source.")}}this.disposeSourceHandler();this.off("dispose",this.disposeSourceHandler);if(c!==a.nativeSourceHandler){this.currentSource_=b}this.sourceHandler_=c.handleSource(b,this,this.options_);this.on("dispose",this.disposeSourceHandler)};a.prototype.disposeSourceHandler=function(){if(this.currentSource_){this.currentSource_=null}if(this.sourceHandler_){if(this.sourceHandler_.dispose){this.sourceHandler_.dispose()}this.sourceHandler_=null}}};cl.registerComponent("Tech",cE);cE.registerTech("Tech",cE);cE.defaultTechOrder_=[];var cF={};var cL={buffered:1,currentTime:1,duration:1,seekable:1,played:1};var cM={setCurrentTime:1};var cP=function eX(a){if(Array.isArray(a)){var b=[];a.forEach(function(a){a=eX(a);if(Array.isArray(a)){b=b.concat(a)}else if(R(a)){b.push(a)}});a=b}else if(typeof a==="string"&&a.trim()){a=[{src:a}]}else if(R(a)&&typeof a.src==="string"&&a.src&&a.src.trim()){a=[a]}else{a=[]}return a};var cQ=function(a){function b(c,d,e){J(this,b);var f=ck({createEl:false},d);var g=L(this,a.call(this,c,f,e));if(!d.playerOptions.sources||d.playerOptions.sources.length===0){for(var h=0,i=d.playerOptions.techOrder;h<i.length;h++){var j=ci(i[h]);var k=cE.getTech(j);if(!j){k=cl.getComponent(j)}if(k&&k.isSupported()){c.loadTech_(j);break}}}else{c.src(d.playerOptions.sources)}return g}K(b,a);return b}(cl);cl.registerComponent("MediaLoader",cQ);var cR=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.enable();return e}K(b,a);b.prototype.createEl=function c(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div";var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c=Q({innerHTML:'<span aria-hidden="true" class="wbv-icon-placeholder"></span>',className:this.buildCSSClass()},c);if(b==="button"){X.error("Creating a ClickableComponent with an HTML element of "+b+" is not supported; use a Button instead.")}d=Q({role:"button","aria-live":"polite"},d);this.tabIndex_=c.tabIndex;var e=a.prototype.createEl.call(this,b,c,d);this.createControlTextEl(e);return e};b.prototype.createControlTextEl=function d(a){this.controlTextEl_=bg("span",{className:"wbv-control-text"});if(a){a.appendChild(this.controlTextEl_)}this.controlText(this.controlText_,a);return this.controlTextEl_};b.prototype.controlText=function e(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.el();if(!a){return this.controlText_||"Need Text"}var c=this.localize(a);this.controlText_=a;bh(this.controlTextEl_||b,c)};b.prototype.buildCSSClass=function f(){return"wbv-control wbv-button "+a.prototype.buildCSSClass.call(this)};b.prototype.enable=function g(){if(!this.enabled_){this.enabled_=true;this.removeClass("wbv-disabled");this.el_.setAttribute("aria-disabled","false");this.on("click",this.handleBeforeClick);this.on("click",this.handleClick);this.on("click",this.handleAfterClick);this.on("mouseenter",this.handleMouseEnter);this.on("mouseleave",this.handleMouseLeave);this.on("focus",this.handleFocus);this.on("blur",this.handleBlur)}};b.prototype.disable=function h(){this.enabled_=false;this.addClass("wbv-disabled");this.el_.setAttribute("aria-disabled","true");this.off("click",this.handleBeforeClick);this.off("click",this.handleClick);this.off("click",this.handleAfterClick);this.off("mouseenter",this.handleMouseEnter);this.off("mouseleave",this.handleMouseLeave);this.off("focus",this.handleFocus);this.off("blur",this.handleBlur)};b.prototype.handleBeforeClick=function i(a){};b.prototype.handleClick=function j(a){};b.prototype.handleAfterClick=function l(a){};b.prototype.handleMouseEnter=function m(a){var b=this.el().getAttribute("disabletitle");if(!b){bk(this.el_,"wbv-button-title")}};b.prototype.handleMouseLeave=function n(a){var b=this.el().getAttribute("disabletitle");if(!b){bl(this.el_,"wbv-button-title")}};b.prototype.handleFocus=function o(a){bR(k,"keydown",bW(this,this.handleKeyPress))};b.prototype.handleBeforeKeyPress=function p(a){};b.prototype.handleKeyPress=function q(b){if(b.which===32||b.which===13){b.preventDefault();this.trigger("click")}else if(a.prototype.handleKeyPress){a.prototype.handleKeyPress.call(this,b)}};b.prototype.handleAfterKeyPress=function r(a){};b.prototype.handleBlur=function s(a){bS(k,"keydown",bW(this,this.handleKeyPress))};return b}(cl);cl.registerComponent("ClickableComponent",cR);var cT=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.update();c.on("posterchange",bW(e,e.update));return e}K(b,a);b.prototype.dispose=function c(){this.player().off("posterchange",this.update);a.prototype.dispose.call(this)};b.prototype.createEl=function d(){var a=bg("div",{className:"wbv-poster",tabIndex:-1},{disabletitle:"true"});if(!G||this.options().fallbackImg_){this.fallbackImg_=bg("img");a.appendChild(this.fallbackImg_)}if(this.options().playCount&&this.options().duration){this.playInfoEl_=bg("div",{className:"wbv-poster-info clearfix",innerHTML:'<div class="W_fl">'+this.options().playCount+'次播放</div><div class="W_fr">'+cS(this.options().duration)+"</div>"});a.appendChild(this.playInfoEl_)}return a};b.prototype.update=function e(a){var b=this.player().poster();this.setSrc(b);if(b){this.show()}else{this.hide()}};b.prototype.setSrc=function f(a){if(this.fallbackImg_){this.fallbackImg_.src=a}else{var b="";if(a){b='url("'+a+'")'}this.el_.style.backgroundImage=b}};b.prototype.handleClick=function g(a){if(!this.player_.controls()){return}if(!this.player_.hasClicked()){this.player_.hasClicked(true)}if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};return b}(cR);cl.registerComponent("PosterImage",cT);var cU=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-loading-spinner",innerHTML:'<i class="W_loading_big"></i>'})};return b}(cl);cl.registerComponent("LoadingSpinner",cU);var cV=function(a){function b(c,d){J(this,b);return L(this,a.call(this,c,d))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-ending-layer"})};b.prototype.show=function d(){this.addClass("wbv-lock-showing")};b.prototype.hide=function e(){this.removeClass("wbv-lock-showing")};return b}(cl);cl.registerComponent("EndDisplay",cV);var cW=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};a="button";b=Q({innerHTML:'<span aria-hidden="true" class="wbv-icon-placeholder"></span>',className:this.buildCSSClass()},b);c=Q({type:"button","aria-live":"polite"},c);var d=cl.prototype.createEl.call(this,a,b,c);this.createControlTextEl(d);return d};b.prototype.addChild=function d(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=this.constructor.name;X.warn("Adding an actionable (user controllable) child to a Button ("+c+") is not supported; use a ClickableComponent instead.");return cl.prototype.addChild.call(this,a,b)};b.prototype.enable=function e(){a.prototype.enable.call(this);this.el_.removeAttribute("disabled")};b.prototype.disable=function f(){a.prototype.disable.call(this);this.el_.setAttribute("disabled","disabled")};b.prototype.handleKeyPress=function g(b){if(b.which===32||b.which===13){return}a.prototype.handleKeyPress.call(this,b)};return b}(cR);cl.registerComponent("Button",cW);var cX=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.mouseused_=false;e.on("mousedown",e.handleMouseDown);return e}K(b,a);b.prototype.createEl=function c(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};d=Q({disabletitle:"true"},d);var e=a.prototype.createEl.call(this,b,c,d);return e};b.prototype.buildCSSClass=function d(){return"wbv-big-play-button"};b.prototype.handleBeforeClick=function e(a){this.options_.handleBeforeClick&&typeof this.options_.handleBeforeClick==="function"&&this.options_.handleBeforeClick(a)};b.prototype.handleAfterClick=function f(a){this.options_.handleAfterClick&&typeof this.options_.handleAfterClick==="function"&&this.options_.handleAfterClick(a)};b.prototype.handleClick=function g(a){if(!this.player_.hasClicked()){this.player_.hasClicked(true)}var b=this.player_.play();if(this.mouseused_&&a.clientX&&a.clientY){return}var c=this.player_.getChild("controlBar");var d=c&&c.getChild("playToggle");if(!d){this.player_.focus();return}var e=function g(){return d.focus()};if(b&&b.then){var f=function h(){};b.then(e,f)}else{this.setTimeout(e,1)}};b.prototype.handleKeyPress=function h(b){this.mouseused_=false;a.prototype.handleKeyPress.call(this,b)};b.prototype.handleMouseDown=function i(a){this.mouseused_=true};return b}(cW);cX.prototype.controlText_="Play";cl.registerComponent("BigPlayButton",cX);var cY=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.on(c,"play",e.handlePlay);e.on(c,"pause",e.handlePause);return e}K(b,a);b.prototype.createEl=function c(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"li";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c=Q({disabletitle:"true"},c,this.options_.attrs);var d=bg(a,Q({className:"wbv-menu-item"},this.options_,b),c);this.contentEl_=bg("a",{},{href:"javascript:void(0);"});d.appendChild(this.contentEl_);return d};b.prototype.handleClick=function d(a){if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}this.player_.trigger("dispatchHidemenu")};b.prototype.handlePlay=function e(a){this.controlText("暂停",this.contentEl())};b.prototype.handlePause=function f(a){this.controlText("播放",this.contentEl())};b.prototype.handleEnded=function g(a){this.controlText("重播",this.contentEl())};return b}(cR);cY.prototype.controlText_="播放";cl.registerComponent("TogglePlayItem",cY);var cZ=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.updateControlText_();e.on(c,["loadedmetadata","volumechange"],e.updateControlText_);return e}K(b,a);b.prototype.createEl=function c(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"li";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c=Q({disabletitle:"true"},c,this.options_.attrs);var d=bg(a,Q({className:"wbv-menu-item"},this.options_,b),c);this.contentEl_=bg("a",{},{href:"javascript:void(0);"});d.appendChild(this.contentEl_);return d};b.prototype.handleClick=function d(a){var b=this.player_.volume();var c=this.player_.lastVolume_();if(b===0){var d=c<.1?.1:c;this.player_.volume(d);this.player_.muted(false)}else{this.player_.muted(this.player_.muted()?false:true)}this.player_.trigger("dispatchHidemenu")};b.prototype.updateControlText_=function e(){var a=this.player_.muted()||this.player_.volume()===0;var b=a?"音量":"静音";if(this.controlText()!==b){this.controlText(b,this.contentEl())}};return b}(cR);cZ.prototype.controlText_="音量";cl.registerComponent("ToggleMuteItem",cZ);var c$=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.controlText("视频地址",e.contentEl());return e}K(b,a);b.prototype.createEl=function c(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"li";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c=Q({disabletitle:"true"},c,this.options_.attrs);var d=bg(a,Q({className:"wbv-menu-item"},this.options_,b),c);this.contentEl_=bg("a",{},{href:"javascript:void(0);"});d.appendChild(this.contentEl_);return d};b.prototype.handleClick=function d(a){this.player_.trigger("dispatchHidemenu");this.player_.trigger("showUrlLayer")};return b}(cR);c$.prototype.controlText_="视频地址";cl.registerComponent("CopyUrlItem",c$);var c_=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.canShowMenu_=false;e.on(c,"contextmenu",e.showContextmenu_);e.on(c,"firstplay",e.canShowMenu);e.on(c,["pause","dispatchHidemenu"],e.hideContextmenu_);return e}K(b,a);b.prototype.createEl=function c(){var b=this.options_.contentElType||"ul";this.contentEl_=bg(b,{className:"wbv-menu-content"});this.contentEl_.setAttribute("role","list");var c=a.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"wbv-right-pop wbv-hidden"});c.appendChild(this.contentEl_);bR(c,"click",function(a){a.preventDefault();a.stopImmediatePropagation()});return c};b.prototype.canShowMenu=function d(a){this.canShowMenu_=true};b.prototype.showContextmenu_=function e(a){a.preventDefault();a.stopImmediatePropagation();if(this.player_.preventDefaultMenu_||!this.canShowMenu_)return;var b=this.player_.el().getBoundingClientRect();var c={x:a.clientX-b.left+"px",y:a.clientY-b.top+"px"};var d=this.el().style;d.top=c.y;d.left=c.x;this.show();this.player_.fixContextmenu(false);this.player_.trigger("showContextMenu")};b.prototype.hideContextmenu_=function f(){this.hide();this.player_.fixContextmenu(true);this.player_.trigger("hideContextMenu")};return b}(cl);c_.prototype.options_={children:["togglePlayItem","toggleMuteItem","copyUrlItem"]};cl.registerComponent("ContextMenu",c_);var da=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.setCopyUrl(null,{url:d.copyUrl||e.player_.cache_.copyUrl_});e.on("resetCopyUrl",e.setCopyUrl);e.on("selectCopyUrl",e.selectUrl);return e}K(b,a);b.prototype.createEl=function c(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"input";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c=Q({type:"text",readonly:"readonly"},c,this.options_.attrs);return bg(a,Q(this.options_,b),c)};b.prototype.setCopyUrl=function d(a,b){var c=decodeURIComponent(b.url);this.player_.cache_.copyUrl_=this.el().value=c};b.prototype.selectUrl=function e(a){this.el().focus();this.el().select()};return b}(cl);cl.registerComponent("CopyUrlInput",da);var db=function(a){function b(c,d){J(this,b);return L(this,a.call(this,c,d))}K(b,a);b.prototype.createEl=function c(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"a";var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return bg(a,{className:"V_ficon V_ficon_close"})};b.prototype.handleClick=function d(a){this.trigger("closeUrlLayer")};return b}(cR);cl.registerComponent("CopyUrlClose",db);var dc=function(a){function b(c,d){J(this,b);if(d.copyUrl){d.copyUrl=d.copyUrl}else{X.warn("need pass a copyUrl : "+c.id()+" ")}var e=L(this,a.call(this,c,d));e.copyUrl_(d.copyUrl);e.on(e.copyUrlClose,"closeUrlLayer",e.hideLayer);e.on(c,"showUrlLayer",e.showLayer);return e}K(b,a);b.prototype.createEl=function c(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"div";var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var e=this.options_.contentElType||"div";this.contentEl_=bg(e,{className:"ipt"});var f=a.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"wbv-right-layer wbv-hidden"});f.appendChild(this.contentEl_);bR(f,"click",function(a){a.preventDefault();a.stopImmediatePropagation()});return f};b.prototype.copyUrl_=function d(a){if(a!==undefined){this.player_.cache_.copyUrl_=this.copyUrl_=decodeURIComponent(a);this.copyUrlInput.trigger("resetCopyUrl",{url:this.copyUrl_})}return this.copyUrl_||this.player_.cache_.copyUrl_};b.prototype.showLayer=function e(a){this.show();this.copyUrlInput.trigger("selectCopyUrl")};b.prototype.hideLayer=function f(a){this.hide()};return b}(cl);dc.prototype.options_={children:["copyUrlInput","copyUrlClose"]};cl.registerComponent("CopyUrlLayer",dc);var dd=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.controlText(d&&d.controlText||e.localize("Close"));return e}K(b,a);b.prototype.buildCSSClass=function c(){return"wbv-close-button "+a.prototype.buildCSSClass.call(this)};b.prototype.handleClick=function d(a){this.trigger({type:"close",bubbles:false})};return b}(cW);cl.registerComponent("CloseButton",dd);var de=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.on(c,"play",e.handlePlay);e.on(c,"pause",e.handlePause);e.on(c,"ended",e.handleEnded);return e}K(b,a);b.prototype.buildCSSClass=function c(){return"wbv-play-control "+a.prototype.buildCSSClass.call(this)};b.prototype.handleClick=function d(a){if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};b.prototype.handleBeforeClick=function e(a){this.options_.handleBeforeClick&&typeof this.options_.handleBeforeClick==="function"&&this.options_.handleBeforeClick(a)};b.prototype.handleAfterClick=function f(a){this.options_.handleAfterClick&&typeof this.options_.handleAfterClick==="function"&&this.options_.handleAfterClick(a)};b.prototype.handleSeeked=function g(a){this.removeClass("wbv-ended");if(this.player_.paused()){this.handlePause(a)}else{this.handlePlay(a)}};b.prototype.handlePlay=function h(a){if(this.hasClass("wbv-ended")){this.player_.trigger("replay")}this.removeClass("wbv-paused");this.addClass("wbv-playing");this.controlText("暂停")};b.prototype.handlePause=function i(a){this.removeClass("wbv-playing");this.addClass("wbv-paused");this.controlText("播放")};b.prototype.handleEnded=function j(a){this.removeClass("wbv-playing");this.addClass("wbv-ended");this.controlText("重播");this.one(this.player_,"seeked",this.handleSeeked)};return b}(cW);de.prototype.controlText_="播放";cl.registerComponent("PlayToggle",de);var df=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.throttledUpdateContent=bX(bW(e,e.updateContent),25);e.on(c,"timeupdate",e.throttledUpdateContent);return e}K(b,a);b.prototype.createEl=function c(){var b=a.prototype.createEl.call(this,"div",{className:"wbv-current-time wbv-time-control wbv-control"});this.contentEl_=bg("div",{className:"wbv-current-time-display"},{},bg("span",{className:"wbv-control-text",textContent:this.localize("Current Time")}));this.updateTextNode_();b.appendChild(this.contentEl_);return b};b.prototype.updateTextNode_=function d(){if(this.textNode_){this.contentEl_.removeChild(this.textNode_)}this.textNode_=k.createTextNode(" "+(this.formattedTime_||"0:00"));this.contentEl_.appendChild(this.textNode_)};b.prototype.updateContent=function e(a){var b=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();var c=cS(b,this.player_.duration());if(c!==this.formattedTime_){this.formattedTime_=c;this.requestAnimationFrame(this.updateTextNode_)}};return b}(cl);cl.registerComponent("CurrentTimeDisplay",df);var dg=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.throttledUpdateContent=bX(bW(e,e.updateContent),25);e.on(c,["durationchange","loadedmetadata","timeupdate"],e.throttledUpdateContent);return e}K(b,a);b.prototype.createEl=function c(){var b=a.prototype.createEl.call(this,"div",{className:"wbv-duration wbv-time-control wbv-control"});this.contentEl_=bg("div",{className:"wbv-duration-display"},{"aria-live":"off"},bg("span",{className:"wbv-control-text",textContent:this.localize("Duration Time")}));this.updateTextNode_();b.appendChild(this.contentEl_);return b};b.prototype.updateTextNode_=function d(){if(this.textNode_){this.contentEl_.removeChild(this.textNode_)}this.textNode_=k.createTextNode(" "+(this.formattedTime_||"0:00"));this.contentEl_.appendChild(this.textNode_)};b.prototype.updateContent=function e(a){var b=this.player_.duration();if(b&&this.duration_!==b){this.duration_=b;this.formattedTime_=cS(b);this.requestAnimationFrame(this.updateTextNode_)}};return b}(cl);cl.registerComponent("DurationDisplay",dg);var dh=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-time-control wbv-time-divider",innerHTML:"<div><span>/</span></div>"})};return b}(cl);cl.registerComponent("TimeDivider",dh);var di=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.throttledUpdateContent=bX(bW(e,e.updateContent),25);e.on(c,["timeupdate","durationchange"],e.throttledUpdateContent);return e}K(b,a);b.prototype.createEl=function c(){var b=a.prototype.createEl.call(this,"div",{className:"wbv-remaining-time wbv-time-control wbv-control"});this.contentEl_=bg("div",{className:"wbv-remaining-time-display"},{},bg("span",{className:"wbv-control-text",textContent:this.localize("Remaining Time")}));this.updateTextNode_();b.appendChild(this.contentEl_);return b};b.prototype.updateTextNode_=function d(){if(this.textNode_){this.contentEl_.removeChild(this.textNode_)}this.textNode_=k.createTextNode(" -"+(this.formattedTime_||"0:00"));this.contentEl_.appendChild(this.textNode_)};b.prototype.updateContent=function e(a){if(this.player_.duration()){var b=cS(this.player_.remainingTime());if(b!==this.formattedTime_){this.formattedTime_=b;this.requestAnimationFrame(this.updateTextNode_)}}};return b}(cl);cl.registerComponent("RemainingTimeDisplay",di);var dj=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-box-col",innerHTML:"<div></div>"})};return b}(cl);cl.registerComponent("controlDivider",dj);var dk=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.updateShowing();e.on(e.player(),"durationchange",e.updateShowing);return e}K(b,a);b.prototype.createEl=function c(){var b=a.prototype.createEl.call(this,"div",{className:"wbv-live-control wbv-control"});this.contentEl_=bg("div",{className:"wbv-live-display",innerHTML:'<span class="wbv-control-text">'+this.localize("Stream Type")+"</span>"+this.localize("LIVE")},{"aria-live":"off"});b.appendChild(this.contentEl_);return b};b.prototype.updateShowing=function d(a){if(this.player().duration()===Infinity){this.show()}else{this.hide()}};return b}(cl);cl.registerComponent("LiveDisplay",dk);var dl=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.bar=e.getChild(e.options_.barName);e.vertical(!!e.options_.vertical);e.on("mousedown",e.handleMouseDown);e.on("touchstart",e.handleMouseDown);e.on("focus",e.handleFocus);e.on("blur",e.handleBlur);e.on("click",e.handleClick);e.on(c,"controlsvisible",e.update);if(e.playerEvent){e.on(c,e.playerEvent,e.update)}return e}K(b,a);b.prototype.createEl=function c(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};c.className=c.className+" wbv-slider";d=Q({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100},d);return a.prototype.createEl.call(this,b,c,d)};b.prototype.handleMouseDown=function d(a){var b=this.bar.el_.ownerDocument;a.preventDefault();bs();this.addClass("wbv-sliding");this.trigger("slideractive");this.on(b,"mousemove",this.handleMouseMove);this.on(b,"mouseup",this.handleMouseUp);this.on(b,"touchmove",this.handleMouseMove);this.on(b,"touchend",this.handleMouseUp);this.handleMouseMove(a)};b.prototype.handleMouseMove=function e(a){this.trigger("sliderinactive");this.update()};b.prototype.handleMouseUp=function f(){var a=this.bar.el_.ownerDocument;bt();this.removeClass("wbv-sliding");this.trigger("sliderinactive");this.off(a,"mousemove",this.handleMouseMove);this.off(a,"mouseup",this.handleMouseUp);this.off(a,"touchmove",this.handleMouseMove);this.off(a,"touchend",this.handleMouseUp);this.update()};b.prototype.update=function g(){if(!this.el_){return}var a=this.getPercent();var b=this.bar;if(!b){return}if(typeof a!=="number"||a!==a||a<0||a===Infinity){a=0}var c=(a*100).toFixed(2)+"%";var d=b.el().style;if(this.vertical()){d.height=c}else{d.width=c}return a};b.prototype.calculateDistance=function h(a){var b=bw(this.el_,a);if(this.vertical()){return b.y}return b.x};b.prototype.handleFocus=function i(){this.on(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)};b.prototype.handleKeyPress=function j(a){if(a.which===37||a.which===40){a.preventDefault();this.stepBack()}else if(a.which===38||a.which===39){a.preventDefault();this.stepForward()}};b.prototype.handleBlur=function k(){this.off(this.bar.el_.ownerDocument,"keydown",this.handleKeyPress)};b.prototype.handleClick=function l(a){a.stopImmediatePropagation();a.preventDefault()};b.prototype.vertical=function m(a){if(a===undefined){return this.vertical_||false}this.vertical_=!!a;if(this.vertical_){this.addClass("wbv-slider-vertical")}else{this.addClass("wbv-slider-horizontal")}};return b}(cl);cl.registerComponent("Slider",dl);var dm=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.partEls_=[];e.on(c,"progress",e.update);return e}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-load-progress",innerHTML:'<span class="wbv-control-text"><span>'+this.localize("Loaded")+"</span>: 0%</span>"})};b.prototype.update=function d(a){var b=this.player_.buffered();var c=this.player_.duration();var d=this.player_.bufferedEnd();var e=this.partEls_;var f=function l(a,b){var c=a/b||0;return(c>=1?1:c)*100+"%"};this.el_.style.width=f(d,c);for(var g=0;g<b.length;g++){var h=b.start(g);var i=b.end(g);var j=e[g];if(!j){j=this.el_.appendChild(bg());e[g]=j}j.style.left=f(h,d);j.style.width=f(i-h,d)}for(var k=e.length;k>b.length;k--){this.el_.removeChild(e[k-1])}e.length=b.length};return b}(cl);cl.registerComponent("LoadProgressBar",dm);var dn=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-time-tooltip"})};b.prototype.update=function d(a,b,c){var d=bu(this.el_);var e=bu(this.player_.el());var f=a.width*b;if(!e||!d){return}var g=a.left-e.left+f;var h=a.width-f+(e.right-a.right);var i=d.width/2;if(g<i){i+=i-g}else if(h<i){i=h}if(i<0){i=0}else if(i>d.width){i=d.width}this.el_.style.right="-"+i+"px";bh(this.el_,c)};return b}(cl);cl.registerComponent("TimeTooltip",dn);var dp=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-play-progress wbv-slider-bar wbv-slider-handle",innerHTML:'<span class="wbv-control-text"><span>'+this.localize("Progress")+"</span>: 0%</span>"})};b.prototype.update=function d(a,b){var c=this;if(this.rafId_){this.cancelAnimationFrame(this.rafId_)}this.rafId_=this.requestAnimationFrame(function(){var d=c.player_.scrubbing()?c.player_.getCache().currentTime:c.player_.currentTime();var e=cS(d,c.player_.duration());var f=c.getChild("timeTooltip");if(f){f.update(a,b,e)}})};return b}(cl);dp.prototype.options_={children:[]};cl.registerComponent("PlayProgressBar",dp);var dq=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.update=bX(bW(e,e.update),25);return e}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-mouse-display"})};b.prototype.update=function d(a,b){var c=this;if(this.rafId_){this.cancelAnimationFrame(this.rafId_)}this.rafId_=this.requestAnimationFrame(function(){var d=c.player_.duration();var e=cS(b*d,d);c.el_.style.left=a.width*b+"px";c.getChild("timeTooltip").update(a,b,e)})};return b}(cl);dq.prototype.options_={children:["timeTooltip"]};cl.registerComponent("MouseTimeDisplay",dq);var dr=5;var ds=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.update=bX(bW(e,e.update),50);e.on(c,["timeupdate","ended"],e.update);return e}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-progress-holder"},{"aria-label":this.localize("Progress Bar")})};b.prototype.update=function d(){var b=a.prototype.update.call(this);var c=this.player_.duration();var d=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("aria-valuenow",(b*100).toFixed(2));this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[cS(d,c),cS(c,c)],"{1} of {2}"));this.bar.update(bu(this.el_),b);return b};b.prototype.getPercent=function e(){var a=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();var b=a/this.player_.duration();return b>=1?1:b};b.prototype.handleMouseDown=function f(b){this.player_.scrubbing(true);this.videoWasPlaying=!this.player_.paused();this.player_.pause();a.prototype.handleMouseDown.call(this,b)};b.prototype.handleMouseMove=function g(b){a.prototype.handleMouseMove.call(this,b);this.player_.scrubbing(false);var c=this.calculateDistance(b)*this.player_.duration();if(this.player_.setFakeDuration()&&c>=this.player_.techGet_("duration")){this.player_.currentTime(this.player_.techGet_("duration")-.02);this.setFake_=true;return}this.setFake_=false;if(c>=this.player_.duration()){c=c-.1}this.player_.currentTime(c)};b.prototype.handleMouseUp=function h(b){a.prototype.handleMouseUp.call(this,b);this.player_.setLastPlayTime();this.player_.scrubbing(false);if(this.setFake_){this.player_.pause();this.player_.trigger("seekedfakeduration");return}if(this.videoWasPlaying){this.player_.play()}};b.prototype.stepForward=function i(){this.player_.currentTime(this.player_.currentTime()+dr)};b.prototype.stepBack=function j(){this.player_.currentTime(this.player_.currentTime()-dr)};b.prototype.handleAction=function k(a){if(this.player_.paused()){this.player_.play()}else{this.player_.pause()}};b.prototype.handleKeyPress=function l(b){if(b.which===32||b.which===13){b.preventDefault();this.handleAction(b)}else if(a.prototype.handleKeyPress){a.prototype.handleKeyPress.call(this,b)}};return b}(dl);ds.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"};ds.prototype.playerEvent="timeupdate";cl.registerComponent("SeekBar",ds);var dt=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.handleMouseMove=bX(bW(e,e.handleMouseMove),25);e.on(e.el_,"mousemove",e.handleMouseMove);e.throttledHandleMouseSeek=bX(bW(e,e.handleMouseSeek),25);e.on(["mousedown","touchstart"],e.handleMouseDown);return e}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-progress-control wbv-control"})};b.prototype.handleMouseMove=function d(a){var b=this.getChild("seekBar");var c=b.getChild("mouseTimeDisplay");var d=b.el();var e=bu(d);var f=bw(d,a).x;if(f>1){f=1}else if(f<0){f=0}if(c){c.update(e,f)}};b.prototype.handleMouseSeek=function e(a){var b=this.getChild("seekBar");b.handleMouseMove(a)};b.prototype.handleMouseDown=function f(a){var b=this.el_.ownerDocument;this.on(b,"mousemove",this.throttledHandleMouseSeek);this.on(b,"touchmove",this.throttledHandleMouseSeek);this.on(b,"mouseup",this.handleMouseUp);this.on(b,"touchend",this.handleMouseUp)};b.prototype.handleMouseUp=function g(a){var b=this.el_.ownerDocument;this.off(b,"mousemove",this.throttledHandleMouseSeek);this.off(b,"touchmove",this.throttledHandleMouseSeek);this.off(b,"mouseup",this.handleMouseUp);this.off(b,"touchend",this.handleMouseUp)};return b}(cl);dt.prototype.options_={children:["seekBar"]};cl.registerComponent("ProgressControl",dt);var du=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.on(c,"fullscreenchange",e.handleFullscreenChange);return e}K(b,a);b.prototype.buildCSSClass=function c(){return"wbv-fullscreen-control "+a.prototype.buildCSSClass.call(this)};b.prototype.handleFullscreenChange=function d(a){if(this.player_.isFullscreen()){this.controlText("退出全屏")}else{this.controlText("进入全屏")}};b.prototype.handleClick=function e(a){if(!this.player_.isFullscreen()){this.player_.requestFullscreen()}else{this.player_.exitFullscreen()}};return b}(cW);du.prototype.controlText_="进入全屏";cl.registerComponent("FullscreenToggle",du);var dv=function eY(a,b){if(b.tech_&&!b.tech_.featuresVolumeControl){a.addClass("wbv-hidden")}a.on(b,"loadstart",function(){if(!b.tech_.featuresVolumeControl){a.addClass("wbv-hidden")}else{a.removeClass("wbv-hidden")}})};var dw=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-volume-level wbv-volume-handle",innerHTML:'<span class="wbv-control-text"></span>'})};return b}(cl);cl.registerComponent("VolumeLevel",dw);var dx=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.on("slideractive",e.updateLastVolume_);e.on(c,"volumechange",e.updateARIAAttributes);c.ready(function(){return e.updateARIAAttributes()});return e}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-volume-bar wbv-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})};b.prototype.handleMouseMove=function d(a){this.checkMuted();this.player_.volume(this.calculateDistance(a))};b.prototype.checkMuted=function e(){if(this.player_.muted()){this.player_.muted(false)}};b.prototype.getPercent=function f(){if(this.player_.muted()){return 0}return this.player_.volume()};b.prototype.stepForward=function g(){this.checkMuted();this.player_.volume(this.player_.volume()+.1)};b.prototype.stepBack=function h(){this.checkMuted();this.player_.volume(this.player_.volume()-.1)};b.prototype.updateARIAAttributes=function i(a){var b=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",b);this.el_.setAttribute("aria-valuetext",b+"%")};b.prototype.volumeAsPercentage_=function j(){return Math.round(this.player_.volume()*100)};b.prototype.updateLastVolume_=function k(){var a=this;var b=this.player_.volume();this.one("sliderinactive",function(){if(a.player_.volume()===0){a.player_.lastVolume_(b)}})};return b}(dl);dx.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"};dx.prototype.playerEvent="volumechange";cl.registerComponent("VolumeBar",dx);var dy=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};J(this,b);d.vertical=d.vertical||true;if(typeof d.volumeBar==="undefined"||S(d.volumeBar)){d.volumeBar=d.volumeBar||{};d.volumeBar.vertical=d.vertical}var e=L(this,a.call(this,c,d));dv(e,c);e.throttledHandleMouseMove=bX(bW(e,e.handleMouseMove),25);e.on("mousedown",e.handleMouseDown);e.on("touchstart",e.handleMouseDown);e.on(e.volumeBar,["focus","slideractive"],function(){e.volumeBar.addClass("wbv-slider-active");e.addClass("wbv-slider-active");e.trigger("slideractive")});e.on(e.volumeBar,["blur","sliderinactive"],function(){e.volumeBar.removeClass("wbv-slider-active");e.removeClass("wbv-slider-active");e.trigger("sliderinactive")});return e}K(b,a);b.prototype.createEl=function c(){var b="wbv-volume-horizontal";var c="";if(this.options_.vertical){b="wbv-volume-vertical"}if(this.options_.hideVolumeControl){c="wbv-hidden"}return a.prototype.createEl.call(this,"div",{className:"wbv-volume-control "+c+" wbv-control "+b})};b.prototype.handleMouseDown=function d(a){var b=this.el_.ownerDocument;this.on(b,"mousemove",this.throttledHandleMouseMove);this.on(b,"touchmove",this.throttledHandleMouseMove);this.on(b,"mouseup",this.handleMouseUp);this.on(b,"touchend",this.handleMouseUp)};b.prototype.handleMouseUp=function e(a){var b=this.el_.ownerDocument;this.off(b,"mousemove",this.throttledHandleMouseMove);this.off(b,"touchmove",this.throttledHandleMouseMove);this.off(b,"mouseup",this.handleMouseUp);this.off(b,"touchend",this.handleMouseUp)};b.prototype.handleMouseMove=function f(a){this.volumeBar.handleMouseMove(a)};return b}(cl);dy.prototype.options_={children:["volumeBar"]};cl.registerComponent("VolumeControl",dy);var dz=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));dv(e,c);e.on(c,["loadstart","volumechange"],e.update);return e}K(b,a);b.prototype.buildCSSClass=function c(){return"wbv-mute-control "+a.prototype.buildCSSClass.call(this)};b.prototype.handleBeforeClick=function d(a){this.options_.handleBeforeClick&&typeof this.options_.handleBeforeClick==="function"&&this.options_.handleBeforeClick(a)};b.prototype.handleAfterClick=function e(a){this.options_.handleAfterClick&&typeof this.options_.handleAfterClick==="function"&&this.options_.handleAfterClick(a)};b.prototype.handleClick=function f(a){var b=this.player_.volume();var c=this.player_.lastVolume_();if(b===0){var d=c<.1?.1:c;this.player_.volume(d);this.player_.muted(false)}else{this.player_.muted(this.player_.muted()?false:true)}};b.prototype.update=function g(a){this.updateIcon_();this.updateControlText_()};b.prototype.updateIcon_=function h(){var a=this.player_.volume();var b=3;if(a===0||this.player_.muted()){b=0}else if(a<.5){b=1}else if(a<1){b=2}for(var c=0;c<4;c++){bl(this.el_,"wbv-vol-"+c)}bk(this.el_,"wbv-vol-"+b)};b.prototype.updateControlText_=function i(){var a=this.player_.muted()||this.player_.volume()===0;var b=a?"音量":"静音";if(this.controlText()!==b){this.controlText(b)}};return b}(cW);dz.prototype.controlText_="音量";cl.registerComponent("MuteToggle",dz);var dA=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};J(this,b);if(typeof d.inline!=="undefined"){d.inline=d.inline}else{d.inline=false}if(typeof d.volumeControl==="undefined"||S(d.volumeControl)){d.volumeControl=d.volumeControl||{};d.volumeControl.vertical=!d.inline;d.volumeControl.hideVolumeControl=!!d.hideVolumeControl}var e=L(this,a.call(this,c,d));dv(e,c);!!d.hideVolumeControl&&e.on(c,"loadstart",e.hideVolumeBar_);e.on(e.volumeControl,["slideractive"],e.sliderActive_);e.on(e.muteToggle,"focus",e.sliderActive_);e.on("mouseover",e.showVolumeBar_);e.on("mouseleave",e.hideVolumeBar_);e.on(e.volumeControl,["sliderinactive"],e.sliderInactive_);e.on(e.muteToggle,"blur",e.sliderInactive_);return e}K(b,a);b.prototype.sliderActive_=function c(){this.addClass("wbv-slider-active")};b.prototype.sliderInactive_=function d(){this.removeClass("wbv-slider-active")};b.prototype.showVolumeBar_=function e(){this.volumeControl.show();this.player_.trigger("controlsvisible")};b.prototype.hideVolumeBar_=function f(){this.volumeControl.hide()};b.prototype.createEl=function g(){var b="wbv-volume-panel-horizontal";if(!this.options_.inline){b="wbv-volume-panel-vertical"}return a.prototype.createEl.call(this,"div",{className:"wbv-volume-panel wbv-control "+b})};return b}(cl);dA.prototype.options_={children:["muteToggle","volumeControl"]};cl.registerComponent("VolumePanel",dA);var dB=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-logo"})};return b}(cl);cl.registerComponent("Logo",dB);var dC=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));if(d){e.menuButton_=d.menuButton}e.focusedChild_=-1;e.on("keydown",e.handleKeyPress);return e}K(b,a);b.prototype.addItem=function c(a){this.addChild(a);a.on("click",bW(this,function(b){if(this.menuButton_){this.menuButton_.unpressButton();if(a.name()!=="CaptionSettingsMenuItem"){this.menuButton_.focus()}}}))};b.prototype.createEl=function d(){var b=this.options_.contentElType||"ul";this.contentEl_=bg(b,{className:"wbv-menu-content"});this.contentEl_.setAttribute("role","menu");var c=a.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"wbv-menu"});c.appendChild(this.contentEl_);bR(c,"click",function(a){a.preventDefault();a.stopImmediatePropagation()});return c};b.prototype.handleKeyPress=function e(a){if(a.which===37||a.which===40){a.preventDefault();this.stepForward()}else if(a.which===38||a.which===39){a.preventDefault();this.stepBack()}};b.prototype.stepForward=function f(){var a=0;if(this.focusedChild_!==undefined){a=this.focusedChild_+1}this.focus(a)};b.prototype.stepBack=function g(){var a=0;if(this.focusedChild_!==undefined){a=this.focusedChild_-1}this.focus(a)};b.prototype.focus=function h(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var b=this.children().slice();var c=b.length&&b[0].className&&/wbv-menu-title/.test(b[0].className);if(c){b.shift()}if(b.length>0){if(a<0){a=0}else if(a>=b.length){a=b.length-1}this.focusedChild_=a;b[a].el_.focus()}};return b}(cl);cl.registerComponent("Menu",dC);var dD=function(a){function b(c){var d=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};J(this,b);var e=L(this,a.call(this,c,d));e.menuButton_=new cW(c,d);e.menuButton_.controlText(e.controlText_);e.menuButton_.el_.setAttribute("aria-haspopup","true");e.menuButton_.el_.setAttribute("disabletitle","true");var f=cW.prototype.buildCSSClass();e.menuButton_.el_.className=e.buildCSSClass()+" "+f;e.menuButton_.removeClass("wbv-control");e.addChild(e.menuButton_);e.update();e.enabled_=true;e.on(e.menuButton_,"tap",e.handleClick);e.on(e.menuButton_,"click",e.handleClick);e.on(e.menuButton_,"focus",e.handleFocus);e.on(e.menuButton_,"blur",e.handleBlur);e.on("keydown",e.handleSubmenuKeyPress);return e}K(b,a);b.prototype.update=function c(){var a=this.createMenu();if(this.menu){this.removeChild(this.menu)}this.menu=a;this.addChild(a);this.buttonPressed_=false;this.menuButton_.el_.setAttribute("aria-expanded","false");if(this.items&&this.items.length<=this.hideThreshold_){this.hide()}else{this.show()}};b.prototype.createMenu=function d(){var a=new dC(this.player_,{menuButton:this});this.hideThreshold_=0;if(this.options_.title){var b=bg("li",{className:"wbv-menu-title",innerHTML:ci(this.options_.title),tabIndex:-1});this.hideThreshold_+=1;a.children_.unshift(b);bi(b,a.contentEl())}this.items=this.createItems();if(this.items){for(var c=0;c<this.items.length;c++){a.addItem(this.items[c])}}return a};b.prototype.createItems=function e(){};b.prototype.createEl=function f(){return a.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})};b.prototype.buildWrapperCSSClass=function g(){var b="wbv-menu-button";if(this.options_.inline===true){b+="-inline"}else{b+="-popup"}var c=cW.prototype.buildCSSClass();return"wbv-menu-button "+b+" "+c+" "+a.prototype.buildCSSClass.call(this)};b.prototype.buildCSSClass=function h(){var b="wbv-menu-button";if(this.options_.inline===true){b+="-inline"}else{b+="-popup"}return"wbv-menu-button "+b+" "+a.prototype.buildCSSClass.call(this)};b.prototype.controlText=function i(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.menuButton_.el();return this.menuButton_.controlText(a,b)};b.prototype.handleClick=function j(a){this.one(this.menu.contentEl(),"mouseleave",bW(this,function(a){this.unpressButton();this.el_.blur()}));if(this.buttonPressed_){this.unpressButton()}else{this.pressButton()}};b.prototype.handleMouseEnter=function l(){};b.prototype.focus=function m(){this.menuButton_.focus()};b.prototype.blur=function n(){this.menuButton_.blur()};b.prototype.handleFocus=function o(){bR(k,"keydown",bW(this,this.handleKeyPress))};b.prototype.handleBlur=function p(){bS(k,"keydown",bW(this,this.handleKeyPress))};b.prototype.handleKeyPress=function q(a){if(a.which===27||a.which===9){if(this.buttonPressed_){this.unpressButton()}if(a.which!==9){a.preventDefault();this.menuButton_.el_.focus()}}else if(a.which===38||a.which===40){if(!this.buttonPressed_){this.pressButton();a.preventDefault()}}};b.prototype.handleSubmenuKeyPress=function r(a){if(a.which===27||a.which===9){if(this.buttonPressed_){this.unpressButton()}if(a.which!==9){a.preventDefault();this.menuButton_.el_.focus()}}};b.prototype.pressButton=function s(){if(this.enabled_){this.buttonPressed_=true;this.menu.lockShowing();this.menuButton_.el_.setAttribute("aria-expanded","true");this.menu.focus()}};b.prototype.unpressButton=function t(){if(this.enabled_){this.buttonPressed_=false;this.menu.unlockShowing();this.menuButton_.el_.setAttribute("aria-expanded","false")}};b.prototype.disable=function u(){this.unpressButton();this.enabled_=false;this.addClass("wbv-disabled");this.menuButton_.disable()};b.prototype.enable=function v(){this.enabled_=true;this.removeClass("wbv-disabled");this.menuButton_.enable()};return b}(cl);cl.registerComponent("MenuButton",dD);var dE=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.selectable=d.selectable;e.selected(d.selected);if(e.selectable){e.el_.setAttribute("role","menuitemcheckbox")}else{e.el_.setAttribute("role","menuitem")}return e}K(b,a);b.prototype.createEl=function c(b,c,d){this.nonIconControl=true;d=Q({disabletitle:"true"},d,this.options_.attrs);return a.prototype.createEl.call(this,"li",Q({className:"wbv-menu-item",innerHTML:'<span class="wbv-menu-item-text">'+this.localize(this.options_.label)+"</span>",tabIndex:-1},c),d)};b.prototype.handleClick=function d(a){this.selected(true)};b.prototype.selected=function e(a){if(a){this.addClass("wbv-selected");this.el_.setAttribute("aria-checked","true");this.controlText(", selected")}else{this.removeClass("wbv-selected");this.el_.setAttribute("aria-checked","false");this.controlText(" ")}};return b}(cR);cl.registerComponent("MenuItem",dE);var dF=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.buildCSSClass=function c(){return"wbv-spacer "+a.prototype.buildCSSClass.call(this)};b.prototype.createEl=function d(){return a.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})};return b}(cl);cl.registerComponent("Spacer",dF);var dG=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.buildCSSClass=function c(){return"wbv-custom-control-spacer "+a.prototype.buildCSSClass.call(this)};b.prototype.createEl=function d(){var b=a.prototype.createEl.call(this,{className:this.buildCSSClass()});b.innerHTML="&nbsp;";return b};return b}(dF);cl.registerComponent("CustomControlSpacer",dG);var dH=function(a){function b(){J(this,b);return L(this,a.apply(this,arguments))}K(b,a);b.prototype.createEl=function c(){return a.prototype.createEl.call(this,"div",{className:"wbv-control-bar",dir:"ltr"},{role:"group"})};return b}(cl);dH.prototype.options_={children:["playToggle","progressControl","currentTimeDisplay","timeDivider","durationDisplay","volumePanel","fullscreenToggle","logo"]};cl.registerComponent("ControlBar",dH);var dI=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));e.on(c,"error",e.open);return e}K(b,a);b.prototype.createEl=function c(){var b=a.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-hidden":"true",role:"dialog"});this.wrapperEl_=bg("div",{className:"box"});this.loadingEl_=bg("h3",{innerHTML:'<i class="W_loading_big"></i>'});this.errorInfoEl_=bg("h4");this.contentEl_=bg("span",{innerHTML:"视频无法播放，请您稍后再试"});this.errorInfoEl_.appendChild(this.contentEl_);this.wrapperEl_.appendChild(this.loadingEl_);this.wrapperEl_.appendChild(this.errorInfoEl_);b.appendChild(this.wrapperEl_);return b};b.prototype.buildCSSClass=function d(){return"wbv-error-display "+a.prototype.buildCSSClass.call(this)};b.prototype.content=function e(){var a=this.player().error();return a?this.localize(a.message):""};return b}(cD);dI.prototype.options_=ck(cD.prototype.options_,{pauseOnOpen:false,fillAlways:true,temporary:false,uncloseable:true,withoutContent:true});cl.registerComponent("ErrorDisplay",dI);var dJ=function eZ(a){var b=["protocol","hostname","port","pathname","search","hash","host"];var c=k.createElement("a");c.href=a;var d=c.host===""&&c.protocol!=="file:";var e=void 0;if(d){e=k.createElement("div");e.innerHTML='<a href="'+a+'"></a>';c=e.firstChild;e.setAttribute("style","display:none; position:absolute;");k.body.appendChild(e)}var f={};for(var g=0;g<b.length;g++){f[b[g]]=c[b[g]]}if(f.protocol==="http:"){f.host=f.host.replace(/:80$/,"")}if(f.protocol==="https:"){f.host=f.host.replace(/:443$/,"")}if(d){k.body.removeChild(e)}return f};var dK=function e$(a){if(!a.match(/^https?:\/\//)){var b=k.createElement("div");b.innerHTML='<a href="'+a+'">x</a>';a=b.firstChild.href}return a};var dL=function e_(a){if(typeof a==="string"){var b=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/i;var c=b.exec(a);if(c){return c.pop().toLowerCase()}}return""};var dM=function fa(a){var b=e.location;var c=dJ(a);var d=c.protocol===":"?b.protocol:c.protocol;var f=d+c.host!==b.protocol+b.host;return f};var dN=(Object.freeze||Object)({parseUrl:dJ,getAbsoluteURL:dK,getFileExtension:dL,isCrossOrigin:dM});var dO=function(a){function b(c,d){J(this,b);var e=L(this,a.call(this,c,d));var f=c.source;var g=false;if(f&&(e.el_.currentSrc!==f.src||c.tag&&c.tag.initNetworkState_===3)){e.setSource(f)}else{e.handleLateInit_(e.el_)}if(e.el_.hasChildNodes()){var h=e.el_.childNodes;var i=h.length;var j=[];while(i--){var k=h[i];var l=k.nodeName.toLowerCase()}for(var m=0;m<j.length;m++){e.el_.removeChild(j[m])}}e.proxyWebkitFullscreen_();e.triggerReady();return e}K(b,a);b.prototype.dispose=function c(){b.disposeMediaElement(this.el_);a.prototype.dispose.call(this)};b.prototype.createEl=function d(){var a=this.options_.tag;if(!a||!(this.options_.playerElIngest||this.movingMediaElementInDOM)){if(a){var c=a.cloneNode(true);if(a.parentNode){a.parentNode.insertBefore(c,a)}b.disposeMediaElement(a);a=c}else{a=k.createElement("video");var d=this.options_.tag&&bo(this.options_.tag);var e=ck({},d);if(!F||this.options_.nativeControlsForTouch!==true){delete e.controls}bn(a,Q(e,{id:this.options_.techId,"class":"wbv-tech"}))}a.playerId=this.options_.playerId}if(typeof this.options_.preload!=="undefined"){bq(a,"preload",this.options_.preload)}var f=["loop","muted","playsinline","autoplay"];for(var g=f.length-1;g>=0;g--){var h=f[g];var i=this.options_[h];if(typeof i!=="undefined"){if(i){bq(a,h,h)}else{br(a,h)}a[h]=i}}return a};b.prototype.handleLateInit_=function f(a){if(a.networkState===0||a.networkState===3){return}if(a.readyState===0){var b=false;var c=function f(){b=true};this.on("loadstart",c);var d=function g(){if(!b){this.trigger("loadstart")}};this.on("loadedmetadata",d);this.ready(function(){this.off("loadstart",c);this.off("loadedmetadata",d);if(!b){this.trigger("loadstart")}});return}var e=["loadstart"];e.push("loadedmetadata");if(a.readyState>=2){e.push("loadeddata")}if(a.readyState>=3){e.push("canplay")}if(a.readyState>=4){e.push("canplaythrough")}this.ready(function(){e.forEach(function(a){this.trigger(a)},this)})};b.prototype.setCurrentTime=function g(a){try{this.el_.currentTime=a}catch(b){X(b,"Video is not ready. (V.js)")}};b.prototype.duration=function h(){var a=this;if(this.el_.duration===Infinity&&t&&z&&this.el_.currentTime===0){var b=function c(){if(a.el_.currentTime>0){if(a.el_.duration===Infinity){a.trigger("durationchange")}a.off("timeupdate",c)}};this.on("timeupdate",b);return NaN}return this.el_.duration||NaN};b.prototype.width=function i(){return this.el_.offsetWidth};b.prototype.height=function j(){return this.el_.offsetHeight};b.prototype.proxyWebkitFullscreen_=function l(){var a=this;if(!("webkitDisplayingFullscreen"in this.el_)){return}var b=function d(){this.trigger("fullscreenchange",{isFullscreen:false})};var c=function e(){if("webkitPresentationMode"in this.el_&&this.el_.webkitPresentationMode!=="picture-in-picture"){this.one("webkitendfullscreen",b);this.trigger("fullscreenchange",{isFullscreen:true})}};this.on("webkitbeginfullscreen",c);this.on("dispose",function(){a.off("webkitbeginfullscreen",c);a.off("webkitendfullscreen",b)})};b.prototype.supportsFullScreen=function m(){if(typeof this.el_.webkitEnterFullScreen==="function"){var a=e.navigator&&e.navigator.userAgent||""}return false};b.prototype.enterFullScreen=function n(){var a=this.el_;if(a.paused&&a.networkState<=a.HAVE_METADATA){this.el_.play()}else{a.webkitEnterFullScreen()}};b.prototype.exitFullScreen=function o(){this.el_.webkitExitFullScreen()};b.prototype.src=function p(a){if(a===undefined){return this.el_.src}this.setSrc(a)};b.prototype.reset=function q(){b.resetMediaElement(this.el_)};b.prototype.currentSrc=function r(){if(this.currentSource_){return this.currentSource_.src}return this.el_.currentSrc};b.prototype.setControls=function s(a){this.el_.controls=!!a};b.prototype.getVideoPlaybackQuality=function u(){if(typeof this.el().getVideoPlaybackQuality==="function"){return this.el().getVideoPlaybackQuality()}var a={};if(typeof this.el().webkitDroppedFrameCount!=="undefined"&&typeof this.el().webkitDecodedFrameCount!=="undefined"){a.droppedVideoFrames=this.el().webkitDroppedFrameCount;a.totalVideoFrames=this.el().webkitDecodedFrameCount}if(e.performance&&typeof e.performance.now==="function"){a.creationTime=e.performance.now()}else if(e.performance&&e.performance.timing&&typeof e.performance.timing.navigationStart==="number"){a.creationTime=e.Date.now()-e.performance.timing.navigationStart}return a};return b}(cE);if(bd()){dO.TEST_VID=k.createElement("video");var dP=k.createElement("track");dP.kind="captions";dP.srclang="en";dP.label="English";dO.TEST_VID.appendChild(dP)}dO.isSupported=function(){try{dO.TEST_VID.volume=.5}catch(a){return false}return!!(dO.TEST_VID&&dO.TEST_VID.canPlayType)};dO.canPlayType=function(a){return dO.TEST_VID.canPlayType(a)};dO.canPlaySource=function(a,b){return dO.canPlayType(a.type)};dO.canControlVolume=function(){try{var a=dO.TEST_VID.volume;dO.TEST_VID.volume=a/2+.1;return a!==dO.TEST_VID.volume}catch(b){return false}};dO.canControlPlaybackRate=function(){if(t&&z&&A<58){return false}try{var a=dO.TEST_VID.playbackRate;dO.TEST_VID.playbackRate=a/2+.1;return a!==dO.TEST_VID.playbackRate}catch(b){return false}};dO.supportsNativeTextTracks=function(){return E};dO.supportsNativeVideoTracks=function(){return!!(dO.TEST_VID&&dO.TEST_VID.videoTracks)};dO.supportsNativeAudioTracks=function(){return!!(dO.TEST_VID&&dO.TEST_VID.audioTracks)};dO.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"];dO.prototype.featuresVolumeControl=dO.canControlVolume();dO.prototype.featuresPlaybackRate=dO.canControlPlaybackRate();dO.prototype.movingMediaElementInDOM=true;dO.prototype.featuresFullscreenResize=true;dO.prototype.featuresProgressEvents=true;dO.prototype.featuresTimeupdateEvents=true;dO.prototype.featuresNativeVideoTracks=dO.supportsNativeVideoTracks();dO.prototype.featuresNativeAudioTracks=dO.supportsNativeAudioTracks();var dQ=dO.TEST_VID&&dO.TEST_VID.constructor.prototype.canPlayType;dO.patchCanPlayType=function(){};dO.unpatchCanPlayType=function(){var a=dO.TEST_VID.constructor.prototype.canPlayType;dO.TEST_VID.constructor.prototype.canPlayType=dQ;return a};dO.patchCanPlayType();dO.disposeMediaElement=function(a){if(!a){return}if(a.parentNode){a.parentNode.removeChild(a)}while(a.hasChildNodes()){a.removeChild(a.firstChild)}a.removeAttribute("src");if(typeof a.load==="function"){(function(){try{a.load()}catch(b){}})()}};dO.resetMediaElement=function(a){if(!a){return}var b=a.querySelectorAll("source");var c=b.length;while(c--){a.removeChild(b[c])}a.removeAttribute("src");if(typeof a.load==="function"){(function(){try{a.load()}catch(b){}})()}};["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(a){dO.prototype[a]=function(){return this.el_[a]||this.el_.hasAttribute(a)}});["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(a){dO.prototype["set"+ci(a)]=function(b){this.el_[a]=b;if(b){this.el_.setAttribute(a,a)}else{this.el_.removeAttribute(a)}}});["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","played","networkState","readyState","videoWidth","videoHeight"].forEach(function(a){dO.prototype[a]=function(){return this.el_[a]}});["volume","src","poster","preload","playbackRate","defaultPlaybackRate"].forEach(function(a){dO.prototype["set"+ci(a)]=function(b){this.el_[a]=b}});["pause","load","play"].forEach(function(a){dO.prototype[a]=function(){return this.el_[a]()}});cE.withSourceHandlers(dO);dO.nativeSourceHandler={};dO.nativeSourceHandler.canPlayType=function(a){try{return dO.TEST_VID.canPlayType(a)}catch(b){return""}};dO.nativeSourceHandler.canHandleSource=function(a,b){if(a.type){return dO.nativeSourceHandler.canPlayType(a.type)}else if(a.src){var c=dL(a.src);return dO.nativeSourceHandler.canPlayType("video/"+c)}return""};dO.nativeSourceHandler.handleSource=function(a,b,c){b.setSrc(a.src)};dO.nativeSourceHandler.dispose=function(){};dO.registerSourceHandler(dO.nativeSourceHandler);cE.registerTech("Html5",dO);var dR=M(["safety?"],["safety?"]);var dS=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","ratechange","resize","volumechange"];var dT=function(a){function b(c,d,e){J(this,b);c.id=c.id||"vjs_video_$ {\n      Guid.newGUID()\n    }";d=Q(b.getTagSettings(c),d);d.initChildren=false;d.createEl=false;d.reportTouchActivity=false;d.width=d.width?d.width:"100%";d.height=d.height?d.height:"100%";var f=L(this,a.call(this,null,d,e));f.isReady_=false;if(!f.options_||!f.options_.techOrder||!f.options_.techOrder.length){throw new Error("No techOrder specified")}f.tag=c;f.tagAttributes=c&&bo(c);f.cache_={};f.poster_=d.poster||"";f.controls_=!!d.controls;f.cache_.lastVolume=1;f.cache_.validTime=0;f.cache_.lastPlayTime=0;f.fixContextmenu_=true;f.extraListeners_=!!d.extraEvents;c.controls=false;f.scrubbing_=false;f.doubleToFullScreen_=!!d.doubleToFullScreen;f.preventDefaultMenu_=!!d.preventDefaultMenu;f.el_=f.createEl();cf(f,{eventBusKey:"el_"});var g=ck(f.options_);if(d.plugins){var h=d.plugins;Object.keys(h).forEach(function(a){if(typeof this[a]==="function"){this[a](h[a])}else{throw new Error('plugin "'+a+'"\n          does not exist')}},f)}f.options_.playerOptions=g;f.middleware_=[];f.initChildren();f.isAudio(c.nodeName.toLowerCase()==="audio");if(f.controls()){f.addClass("wbv-controls-enabled")}else{f.addClass("wbv-controls-disabled")}if(f.options_.className){while(f.options_.className.length){f.addClass(f.options_.className.pop())}}f.el_.setAttribute("role","region");if(f.isAudio()){f.el_.setAttribute("aria-label",f.localize("Audio Player"))}else{f.el_.setAttribute("aria-label",f.localize("Video Player"))}if(f.isAudio()){f.addClass("wbv-audio")}if(f.flexNotSupported_()){f.addClass("wbv-no-flex")}if(!r){f.addClass("wbv-workinghover")}b.players[f.id_]=f;f.userActive(true);f.reportUserActivity();f.listenForUserActivity_();f.on("fullscreenchange",f.handleFullscreenChange_);f.on("stageclick",f.handleStageClick_);f.changingSrc_=false;return f}K(b,a);b.prototype.dispose=function c(){this.trigger("dispose");this.off("dispose");if(this.styleEl_&&this.styleEl_.parentNode){this.styleEl_.parentNode.removeChild(this.styleEl_)}b.players[this.id_]=null;if(this.tag&&this.tag.player){this.tag.player=null}if(this.el_&&this.el_.player){this.el_.player=null}if(this.tech_){this.tech_.dispose()}a.prototype.dispose.call(this)};b.prototype.createEl=function d(){var b=this.tag;var c=void 0;var d=this.playerElIngest_=b.parentNode&&b.parentNode.hasAttribute&&b.parentNode.hasAttribute("data-wbv-player");if(d){c=this.el_=b.parentNode}else{c=this.el_=a.prototype.createEl.call(this,"div")}b.setAttribute("tabindex","-1");b.removeAttribute("width");b.removeAttribute("height");var e=bo(b);Object.getOwnPropertyNames(e).forEach(function(a){if(a==="class"){c.className+=" "+e[a]}else{c.setAttribute(a,e[a])}});b.playerId=b.id;b.id+="_html5_api";b.className="wbv-tech";b.player=c.player=this;this.addClass("wbv-paused");this.width(this.options_.width);this.height(this.options_.height);this.fluid(this.options_.fluid);this.aspectRatio(this.options_.aspectRatio);var f=b.getElementsByTagName("a");for(var g=0;g<f.length;g++){var h=f.item(g);bk(h,"wbv-hidden");h.setAttribute("hidden","hidden")}b.initNetworkState_=b.networkState;if(b.parentNode&&!d){b.parentNode.insertBefore(c,b)}bi(b,c);this.children_.unshift(b);this.el_=c;return c};b.prototype.width=function e(a){return this.dimension("width",a)};b.prototype.height=function f(a){return this.dimension("height",a)};b.prototype.dimension=function g(a,b){var c=a+"_";if(b===undefined){return this[c]||0}var d=void 0;if(b===""){this[c]=undefined}else{try{if(b.toString().indexOf("%")>0||b.toString().indexOf("px")>0){d=b}else{d=parseFloat(b);if(isNaN(d)){return}d=parseFloat(b)+"px"}}catch(e){X.error(e)}this[c]=d}this.updateStyleEl_()};b.prototype.fluid=function h(a){if(a===undefined){return!!this.fluid_}this.fluid_=!!a;if(a){this.addClass("wbv-fluid")}else{this.removeClass("wbv-fluid")}this.updateStyleEl_()};b.prototype.aspectRatio=function i(a){if(a===undefined){return this.aspectRatio_}if(!/^\d+\:\d+$/.test(a)){throw new Error(" The format should be width:height, for example 16:9.")}this.aspectRatio_=a;this.fluid(true);this.updateStyleEl_()};b.prototype.updateStyleEl_=function j(){var a=void 0;var b=void 0;var c=void 0;var d=void 0;if(this.aspectRatio_!==undefined&&this.aspectRatio_!=="auto"){c=this.aspectRatio_}else if(this.videoWidth()>0){c=this.videoWidth()+":"+this.videoHeight()}else{c="16:9"}var e=c.split(":");var f=e[1]/e[0];if(this.width_!==undefined){a=this.width_}else if(this.height_!==undefined){a=this.height_/f}else{a=this.videoWidth()||300}if(this.height_!==undefined){b=this.height_}else{b=a*f}this.el_.style.width=a;this.el_.style.height=b};b.prototype.loadTech_=function l(a,b){var c=this;if(this.tech_){this.unloadTech_()}var d=ci(a);var e=a.charAt(0).toLowerCase()+a.slice(1);if(d!=="Html5"&&this.tag){cE.getTech("Html5").disposeMediaElement(this.tag);this.tag.player=null;this.tag=null}this.techName_=d;this.isReady_=false;var f={source:b,nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+d+"_api",autoplay:this.options_.autoplay,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,muted:this.options_.muted,poster:this.poster(),playerElIngest:this.playerElIngest_||false};Q(f,this.options_[d]);Q(f,this.options_[e]);Q(f,this.options_[a.toLowerCase()]);if(this.tag){f.tag=this.tag}if(b&&b.src===this.cache_.src&&this.cache_.currentTime>0){f.startTime=this.cache_.currentTime}var g=cE.getTech(a);if(!g){throw new Error("No Tech named '"+d+"' exists! '"+d+"' should be registered using Vjs.registerTech()'")}this.tech_=new g(f);this.tech_.ready(bW(this,this.handleTechReady_),true);dS.forEach(function(a){c.on(c.tech_,a,c["handleTech"+ci(a)+"_"])});this.on(this.tech_,"loadstart",this.handleTechLoadStart_);this.on(this.tech_,"waiting",this.handleTechWaiting_);this.on(this.tech_,"canplay",this.handleTechCanPlay_);this.on(this.tech_,"canplaythrough",this.handleTechCanPlayThrough_);this.on(this.tech_,"playing",this.handleTechPlaying_);this.on(this.tech_,"ended",this.handleTechEnded_);this.on(this.tech_,"seeking",this.handleTechSeeking_);this.on(this.tech_,"seeked",this.handleTechSeeked_);this.on(this.tech_,"play",this.handleTechPlay_);this.on(this.tech_,"firstplay",this.handleTechFirstPlay_);this.on(this.tech_,"pause",this.handleTechPause_);this.on(this.tech_,"durationchange",this.handleTechDurationChange_);this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_);this.on(this.tech_,"error",this.handleTechError_);this.on(this.tech_,"loadedmetadata",this.updateStyleEl_);this.on(this.tech_,"posterchange",this.handleTechPosterChange_);this.on(this.tech_,"textdata",this.handleTechTextData_);this.usingNativeControls(this.techGet_("controls"));if(this.controls()&&!this.usingNativeControls()){this.addTechControlsListeners_()}if(this.extraListeners()&&!this.usingNativeControls()){this.addExtraListeners_()}if(this.tech_.el().parentNode!==this.el()&&(d!=="Html5"||!this.tag)){bi(this.tech_.el(),this.el())}if(this.tag){this.tag.player=null;this.tag=null}};b.prototype.tech=function m(a){if(a===undefined){X.warn(Z(dR))}return this.tech_};b.prototype.addTechControlsListeners_=function n(){this.removeTechControlsListeners_();this.on(this.tech_,"dblclick",this.handleTechDblclick_);this.on(this.tech_,"mousedown",this.handleTechClick_);this.on(this.tech_,"touchstart",this.handleTechTouchStart_);this.on(this.tech_,"touchmove",this.handleTechTouchMove_);this.on(this.tech_,"touchend",this.handleTechTouchEnd_);this.on(this.tech_,"tap",this.handleTechTap_)};b.prototype.addExtraListeners_=function o(){this.removeExtraListeners_();this.on(this.tech_,"mousedown",this.handleTechClick_)};b.prototype.removeTechControlsListeners_=function p(){this.off(this.tech_,"dblclick",this.handleTechDblclick_);this.off(this.tech_,"tap",this.handleTechTap_);this.off(this.tech_,"mousedown",this.handleTechClick_);this.off(this.tech_,"touchstart",this.handleTechTouchStart_);this.off(this.tech_,"touchmove",this.handleTechTouchMove_);this.off(this.tech_,"touchend",this.handleTechTouchEnd_)};b.prototype.removeExtraListeners_=function q(){this.off(this.tech_,"mousedown",this.handleTechClick_)};b.prototype.handleTechReady_=function s(){this.triggerReady();if(this.cache_.volume){this.techCall_("setVolume",this.cache_.volume)}this.handleTechPosterChange_();this.handleTechDurationChange_();if((this.src()||this.currentSrc())&&this.tag&&this.options_.autoplay&&this.paused()){try{delete this.tag.poster}catch(a){X("deleting tag.poster throws in some browsers",a)}}};b.prototype.handleTechLoadStart_=function t(){this.removeClass("wbv-ended");this.removeClass("wbv-seeking");this.error(null);if(!this.paused()){this.trigger("loadstart");this.trigger("firstplay")}else{this.hasStarted(false);this.trigger("loadstart")}};b.prototype.hasStarted=function u(a){if(a!==undefined){if(this.hasStarted_!==a){this.hasStarted_=a;if(a){this.addClass("wbv-has-started");this.trigger("firstplay")}else{this.removeClass("wbv-has-started")}}return}return!!this.hasStarted_};b.prototype.hasClicked=function v(a){if(a!==undefined){if(this.hasClicked_!==a){this.hasClicked_=a;if(a){this.addClass("wbv-has-clicked");this.trigger("firstclick")}else{this.removeClass("wbv-has-clicked")}}return}return!!this.hasClicked_};b.prototype.setFakeDuration=function w(a){if(a!==undefined){if(this.setFakeDuration_!==a){this.setFakeDuration_=a;if(a){this.addClass("wbv-set-fakeduration");this.trigger("setfakeduration")}else{this.removeClass("wbv-set-fakeduration")}}return}return!!this.setFakeDuration_};b.prototype.handleTechPlay_=function x(){this.removeClass("wbv-ended");this.removeClass("wbv-paused");this.addClass("wbv-playing");this.hasStarted(true);this.trigger("play")};b.prototype.handleTechWaiting_=function y(){var a=this;this.addClass("wbv-waiting");this.trigger("waiting");this.one("timeupdate",function(){return a.removeClass("wbv-waiting")})};b.prototype.handleTechCanPlay_=function z(){this.removeClass("wbv-waiting");this.trigger("canplay")};b.prototype.handleTechCanPlayThrough_=function A(){this.removeClass("wbv-waiting");this.trigger("canplaythrough")};b.prototype.handleTechPlaying_=function B(){this.removeClass("wbv-waiting");this.trigger("playing")};b.prototype.handleTechSeeking_=function C(){this.addClass("wbv-seeking");this.trigger("seeking")};b.prototype.handleTechSeeked_=function D(){this.removeClass("wbv-seeking");this.trigger("seeked")};b.prototype.handleTechFirstPlay_=function E(){if(this.options_.starttime){X.warn("Passing the `starttime` option to the player will be deprecated in 6.0");this.currentTime(this.options_.starttime)}this.addClass("wbv-has-started");this.trigger("firstplay")};b.prototype.handleTechPause_=function F(){this.removeClass("wbv-playing");this.addClass("wbv-paused");this.trigger("pause")};b.prototype.handleTechEnded_=function G(){this.addClass("wbv-ended");if(this.options_.loop){this.currentTime(0);this.play()}else if(!this.paused()){this.pause()}this.trigger("ended")};b.prototype.handleTechDurationChange_=function H(){if(this.setFakeDuration())return;this.duration(this.techGet_("duration"))};b.prototype.handleTechClick_=function I(a){if(a.button!==0){return}if(this.extraListeners()&&!this.preventDefaultMenu_&&!this.fixContextmenu_){this.trigger("dispatchHidemenu");return}if(!this.hasClicked()){this.hasClicked(true)}if(this.controls()){if(this.paused()){this.play()}else{this.pause()}}};b.prototype.handleTechDblclick_=function M(a){if(!this.dblToFullScreen())return;if(this.isFullscreen()){this.exitFullscreen()}else{this.requestFullscreen()}};b.prototype.handleTechTap_=function N(){this.userActive(!this.userActive())};b.prototype.handleTechTouchStart_=function O(){this.userWasActive=this.userActive()};b.prototype.handleTechTouchMove_=function P(){if(this.userWasActive){this.reportUserActivity()}};b.prototype.handleTechTouchEnd_=function R(a){a.preventDefault()};b.prototype.handleFullscreenChange_=function S(){if(this.isFullscreen()){this.addClass("wbv-fullscreen")}else{this.removeClass("wbv-fullscreen")}};b.prototype.handleStageClick_=function T(){this.reportUserActivity()};b.prototype.handleTechFullscreenChange_=function U(a,b){if(b){this.isFullscreen(b.isFullscreen)}this.trigger("fullscreenchange")};b.prototype.handleTechError_=function V(){var a=this.tech_.error();this.error(a)};b.prototype.handleTechTextData_=function W(){var a=null;if(arguments.length>1){a=arguments[1]}this.trigger("textdata",a)};b.prototype.getCache=function Y(){return this.cache_};b.prototype.fixContextmenu=function $(a){if(a!==undefined){a=!!a;if(this.fixContextmenu_!==a){this.fixContextmenu_=a;if(a){this.trigger("fixContextmenu")}else{this.trigger("unFixContextmenu")}}return}return!!this.fixContextmenu_};b.prototype.techCall_=function _(a,b){this.ready(function(){if(a in cM){return cK(this.middleware_,this.tech_,a,b)}try{if(this.tech_){this.tech_[a](b)}}catch(c){X(c);throw c}},true)};b.prototype.techGet_=function ba(a){if(this.tech_&&this.tech_.isReady_){if(a in cL){return cJ(this.middleware_,this.tech_,a)}try{return this.tech_[a]()}catch(b){if(this.tech_[a]===undefined){X("Vjs: "+a+" method not defined for "+this.techName_+" playback technology.",b)}else if(b.name==="TypeError"){X("Vjs: "+a+" unavailable on "+this.techName_+" playback technology element.",b);this.tech_.isReady_=false}else{X(b)}throw b}}return};b.prototype.play=function bb(){if(this.changingSrc_){this.ready(function(){var a=this.techGet_("play");if(a!==undefined&&typeof a.then==="function"){a.then(null,function(a){})}})}else if(this.isReady_&&(this.src()||this.currentSrc())){return this.techGet_("play")}else{this.ready(function(){this.tech_.one("loadstart",function(){var a=this.play();if(a!==undefined&&typeof a.then==="function"){a.then(null,function(a){})}})})}};b.prototype.pause=function bc(){this.techCall_("pause");this.getValidTime()};b.prototype.paused=function bd(){return this.techGet_("paused")===false?false:true};b.prototype.played=function be(){return this.techGet_("played")||cp(0,0)};b.prototype.scrubbing=function bf(a){if(typeof a==="undefined"){return this.scrubbing_}this.scrubbing_=!!a;if(a){this.addClass("wbv-scrubbing")}else{this.removeClass("wbv-scrubbing")}};b.prototype.setLastPlayTime=function bg(){this.cache_.lastPlayTime=this.currentTime()};b.prototype.getValidTime=function bh(){var a=this.cache_.validTime;var b=this.currentTime();if(b<this.cache_.lastPlayTime)return a;a+=b-this.cache_.lastPlayTime;this.cache_.lastPlayTime=b;this.cache_.validTime=a;return a};b.prototype.resetValidTime=function bm(){this.setLastPlayTime();this.cache_.validTime=0};b.prototype.currentTime=function bn(a){if(typeof a!=="undefined"){this.techCall_("setCurrentTime",a);return}this.cache_.currentTime=this.techGet_("currentTime")||0;return this.cache_.currentTime};b.prototype.duration=function bp(a){if(a===undefined){return this.cache_.duration!==undefined?this.cache_.duration:NaN}a=parseFloat(a);if(a<0){a=Infinity}if(a!==this.cache_.duration){this.cache_.duration=a;if(a===Infinity){this.addClass("wbv-live")}else{this.removeClass("wbv-live")}this.trigger("durationchange")}};b.prototype.remainingTime=function bq(){return this.duration()-this.currentTime()};b.prototype.buffered=function br(){var br=this.techGet_("buffered");if(!br||!br.length){br=cp(0,0)}return br};b.prototype.bufferedPercent=function bs(){return cq(this.buffered(),this.duration())};b.prototype.bufferedEnd=function bt(){var a=this.buffered();var b=this.duration();var c=a.end(a.length-1);if(c>b){c=b}return c};b.prototype.volume=function bu(a){var b=void 0;if(a!==undefined){b=Math.max(0,Math.min(1,parseFloat(a)));this.cache_.volume=b;this.techCall_("setVolume",b);if(b>0){this.lastVolume_(b)}return}b=parseFloat(this.techGet_("volume"));return isNaN(b)?1:b};b.prototype.muted=function bv(a){if(a!==undefined){this.techCall_("setMuted",a);return}return this.techGet_("muted")||false};b.prototype.defaultMuted=function bw(a){if(a!==undefined){return this.techCall_("setDefaultMuted",a)}return this.techGet_("defaultMuted")||false};b.prototype.lastVolume_=function bx(a){if(a!==undefined&&a!==0){this.cache_.lastVolume=a;return}return this.cache_.lastVolume};b.prototype.lastPauseTime_=function by(a){if(a!==undefined&&a!==0){this.cache_.lastPauseTime=a;return}return this.cache_.lastPauseTime};b.prototype.supportsFullScreen=function bz(){return this.techGet_("supportsFullScreen")||false};b.prototype.isFullscreen=function bA(a){if(a!==undefined){this.isFullscreen_=!!a;return}return!!this.isFullscreen_};b.prototype.requestFullscreen=function bB(){var a=cr;this.isFullscreen(true);if(a.requestFullscreen){bR(k,a.fullscreenchange,bW(this,function b(c){this.isFullscreen(k[a.fullscreenElement]);if(this.isFullscreen()===false){bS(k,a.fullscreenchange,b)}this.trigger("fullscreenchange")}));this.el_[a.requestFullscreen]()}else if(this.tech_.supportsFullScreen()){this.techCall_("enterFullScreen")}else{this.enterFullWindow();this.trigger("fullscreenchange")}};b.prototype.exitFullscreen=function bC(){var a=cr;this.isFullscreen(false);if(a.requestFullscreen){k[a.exitFullscreen]()}else if(this.tech_.supportsFullScreen()){this.techCall_("exitFullScreen")}else{this.exitFullWindow();this.trigger("fullscreenchange")}};b.prototype.enterFullWindow=function bD(){this.isFullWindow=true;this.docOrigOverflow=k.documentElement.style.overflow;bR(k,"keydown",bW(this,this.fullWindowOnEscKey));k.documentElement.style.overflow="hidden";bk(k.body,"wbv-full-window");this.trigger("enterFullWindow")};b.prototype.fullWindowOnEscKey=function bE(a){if(a.keyCode===27){if(this.isFullscreen()===true){this.exitFullscreen()}else{this.exitFullWindow()}}};b.prototype.exitFullWindow=function bF(){this.isFullWindow=false;bS(k,"keydown",this.fullWindowOnEscKey);k.documentElement.style.overflow=this.docOrigOverflow;bl(k.body,"wbv-full-window");this.trigger("exitFullWindow")};b.prototype.canPlayType=function bG(a){var b=void 0;for(var c=0,d=this.options_.techOrder;c<d.length;c++){var e=d[c];var f=cE.getTech(e);if(!f){f=cl.getComponent(e)}if(!f){X.error('The "'+e+'" tech is undefined. Skipped browser support check for that tech.');continue}if(f.isSupported()){b=f.canPlayType(a);if(b){return b}}}return""};b.prototype.selectSource=function bH(a){var b=this;var c=this.options_.techOrder.map(function(a){return[a,cE.getTech(a)]}).filter(function(a){var b=a[0],c=a[1];if(c){return c.isSupported()}X.error('The "'+b+'" tech is undefined. Skipped browser support check for that tech.');return false});var d=function h(a,b,c){var d=void 0;a.some(function(a){return b.some(function(b){d=c(a,b);if(d){return true}})});return d};var e=void 0;var f=function i(a){return function(b,c){return a(c,b)}};var g=function j(a,c){var d=a[0],e=a[1];if(e.canPlaySource(c,b.options_[d.toLowerCase()])){return{source:c,tech:d}}};if(this.options_.sourceOrder){e=d(a,c,f(g))}else{e=d(c,a,g)}return e||false};b.prototype.src=function bI(a){var b=this;if(typeof a==="undefined"){return this.cache_.src}var c=cP(a);if(!c.length){this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0);return}this.cache_.sources=c;this.changingSrc_=true;this.cache_.source=c[0];cH(this,c[0],function(a,d){b.middleware_=d;var e=b.src_(a);if(e){if(c.length>1){return b.src(c.slice(1))}b.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0);b.triggerReady();return}b.changingSrc_=false;b.cache_.src=a.src;cI(d,b.tech_)})};b.prototype.src_=function bJ(a){var b=this.selectSource([a]);if(!b){return true}if(!cj(b.tech,this.techName_)){this.changingSrc_=true;this.loadTech_(b.tech,b.source);return false}this.ready(function(){if(this.tech_.constructor.prototype.hasOwnProperty("setSource")){this.techCall_("setSource",a)}else{this.techCall_("src",a.src)}if(this.options_.preload==="auto"){this.load()}},true);return false};b.prototype.load=function bK(){this.techCall_("load")};b.prototype.reset=function bL(){this.loadTech_(this.options_.techOrder[0],null);this.techCall_("reset")};b.prototype.resetDefault=function bM(){this.currentTime(0);this.pause();this.hasStarted(false);this.resetValidTime()};b.prototype.currentSources=function bN(){var a=this.currentSource();var b=[];if(Object.keys(a).length!==0){b.push(a)}return this.cache_.sources||b};b.prototype.currentSource=function bO(){return this.cache_.source||{}};b.prototype.currentSrc=function bP(){return this.currentSource()&&this.currentSource().src||""};b.prototype.currentType=function bQ(){return this.currentSource()&&this.currentSource().type||""};b.prototype.preload=function bT(a){if(a!==undefined){this.techCall_("setPreload",a);this.options_.preload=a;return}return this.techGet_("preload")};b.prototype.autoplay=function bU(a){if(a!==undefined){this.techCall_("setAutoplay",a);this.options_.autoplay=a;return}return this.techGet_("autoplay",a)};b.prototype.playsinline=function bV(a){if(a!==undefined){this.techCall_("setPlaysinline",a);this.options_.playsinline=a;return this}return this.techGet_("playsinline")};b.prototype.loop=function bX(a){if(a!==undefined){this.techCall_("setLoop",a);this.options_.loop=a;return}return this.techGet_("loop")};b.prototype.poster=function bY(a){if(a===undefined){return this.poster_}if(!a){a=""}this.poster_=a;this.techCall_("setPoster",a);this.trigger("posterchange")};b.prototype.handleTechPosterChange_=function bZ(){if(!this.poster_&&this.tech_&&this.tech_.poster){this.poster_=this.tech_.poster()||"";this.trigger("posterchange")}};b.prototype.controls=function b$(a){if(a!==undefined){a=!!a;if(this.controls_!==a){this.controls_=a;if(this.usingNativeControls()){this.techCall_("setControls",a)}if(a){this.removeClass("wbv-controls-disabled");this.addClass("wbv-controls-enabled");this.trigger("controlsenabled");if(!this.usingNativeControls()){this.addTechControlsListeners_()}}else{this.removeClass("wbv-controls-enabled");this.addClass("wbv-controls-disabled");this.trigger("controlsdisabled");if(!this.usingNativeControls()){this.removeTechControlsListeners_()}}}return}return!!this.controls_};b.prototype.dblToFullScreen=function b_(a){if(a!==undefined){a=!!a;if(this.doubleToFullScreen_!==a){this.doubleToFullScreen_=a}return}return!!this.doubleToFullScreen_};b.prototype.extraListeners=function ca(a){if(a!==undefined){a=!!a;if(this.extraListeners_!==a){this.extraListeners_=a;if(a){if(!this.usingNativeControls()){this.addExtraListeners_()}}else{if(!this.usingNativeControls()){this.removeExtraListeners_()}}}return}return!!this.extraListeners_};b.prototype.usingNativeControls=function cb(a){if(a!==undefined){a=!!a;if(this.usingNativeControls_!==a){this.usingNativeControls_=a;if(a){this.addClass("wbv-using-native-controls");this.trigger("usingnativecontrols")}else{this.removeClass("wbv-using-native-controls");this.trigger("usingcustomcontrols")}}return}return!!this.usingNativeControls_};b.prototype.error=function cc(a){if(a===undefined){return this.error_||null}if(a===null){this.error_=a;this.removeClass("wbv-error");if(this.errorDisplay){this.errorDisplay.close()}return}this.error_=new cx(a);this.addClass("wbv-error");X.error("(CODE:"+this.error_.code+" "+cx.errorTypes[this.error_.code]+")",this.error_.message,this.error_);this.trigger("error");return};b.prototype.reportUserActivity=function cd(a){this.userActivity_=true};b.prototype.userActive=function ce(a){if(a!==undefined){a=!!a;if(a!==this.userActive_){this.userActive_=a;if(a){this.userActivity_=true;this.removeClass("wbv-user-inactive");this.addClass("wbv-user-active");this.trigger("useractive")}else{this.userActivity_=false;if(this.tech_){this.tech_.one("mousemove",function(a){a.stopPropagation();a.preventDefault()})}this.removeClass("wbv-user-active");this.addClass("wbv-user-inactive");this.trigger("userinactive")}}return}return this.userActive_};b.prototype.fixUserActivity=function cg(a){if(a!==undefined){a=!!a;if(a!==this.fixUserActivity_){this.fixUserActivity_=a;if(a){this.trigger("fixuseractive")}else{this.trigger("unfixuseractive")}}return}return!!this.fixUserActivity_};b.prototype.listenForUserActivity_=function ch(){var a=void 0;var b=void 0;var c=void 0;var d=bW(this,this.reportUserActivity);var e=function j(a){if(a.screenX!==b||a.screenY!==c){b=a.screenX;c=a.screenY;d()}};var f=function k(){d();this.clearInterval(a);a=this.setInterval(d,250)};var g=function l(b){if(!this.options_.controls)return;d();this.clearInterval(a)};var h=function m(){if(this.fixUserActivity())return;this.clearTimeout(i);this.userActivity_=false;this.userActive(false)};this.on("mousedown",f);this.on("mousemove",e);this.on("mouseleave",h);this.on("mouseup",g);this.on("keydown",d);this.on("keyup",d);var i=void 0;this.setInterval(function(){if(this.userActivity_){if(this.fixUserActivity()){this.userActive(true);this.clearTimeout(i);return}this.userActivity_=false;this.userActive(true);this.clearTimeout(i);var a=this.options_.inactivityTimeout;if(a>0){i=this.setTimeout(function(){if(!this.userActivity_){this.userActive(false)}},a)}}},250)};b.prototype.playbackRate=function cm(a){if(a!==undefined){this.techCall_("setPlaybackRate",a);return}if(this.tech_&&this.tech_.featuresPlaybackRate){return this.techGet_("playbackRate")}return 1};b.prototype.defaultPlaybackRate=function cn(a){if(a!==undefined){return this.techCall_("setDefaultPlaybackRate",a)}if(this.tech_&&this.tech_.featuresPlaybackRate){return this.techGet_("defaultPlaybackRate")}return 1};b.prototype.isAudio=function co(a){if(a!==undefined){this.isAudio_=!!a;return}return!!this.isAudio_};b.prototype.getVideoPlaybackQuality=function cs(){return this.techGet_("getVideoPlaybackQuality")};b.prototype.videoWidth=function ct(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0};b.prototype.videoHeight=function cu(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0};b.prototype.language=function cv(a){if(a===undefined){return this.language_}this.language_=String(a).toLowerCase()};b.prototype.languages=function cw(){return ck(b.prototype.options_.languages,this.languages_)};b.prototype.createModal=function cy(a,b){var c=this;b=b||{};b.content=a||"";var d=new cD(this,b);this.addChild(d);d.on("dispose",function(){c.removeChild(d)});d.open();return d};b.getTagSettings=function cA(a){var b={sources:[]};var c=bo(a);var d=c["data-setup"];if(bj(a,"wbv-fluid")){c.fluid=true}if(d!==null){var e=cz(d||"{}"),f=e[0],g=e[1];if(f){X.error(f)}Q(c,g)}Q(b,c);if(a.hasChildNodes()){var h=a.childNodes;for(var i=0,j=h.length;i<j;i++){var k=h[i];var l=k.nodeName.toLowerCase();if(l==="source"){b.sources.push(bo(k))}}}return b};b.prototype.flexNotSupported_=function cB(){var a=k.createElement("i");return!("flexBasis"in a.style||"webkitFlexBasis"in a.style||"mozFlexBasis"in a.style||"msFlexBasis"in a.style||"msFlexOrder"in a.style)};return b}(cl);dT.players={};var dU=e.navigator;dT.prototype.options_={techOrder:cE.defaultTechOrder_,html5:{},flash:{},inactivityTimeout:3e3,playbackRates:[.5,1,1.5,2],children:["mediaLoader","posterImage","loadingSpinner","EndDisplay","controlBar","errorDisplay","contextMenu","copyUrlLayer"],language:dU&&(dU.languages&&dU.languages[0]||dU.userLanguage||dU.language)||"en",languages:{},notSupportedMessage:"对不起，找不到该视频，去看看其他视频"};["ended","seeking","seekable","networkState","readyState"].forEach(function(a){dT.prototype[a]=function(){return this.techGet_(a)}});dS.forEach(function(a){dT.prototype["handleTech"+ci(a)+"_"]=function(){return this.trigger(a)}});cl.registerComponent("Player",dT);var dV="plugin";var dW="activePlugins_";var dX={};var dY=function fb(a){return dX.hasOwnProperty(a)};var dZ=function fc(a){return dY(a)?dX[a]:undefined};var d$=function fd(a,b){a[dW]=a[dW]||{};a[dW][b]=true};var d_=function fe(a,b,c){var d=(c?"before":"")+"pluginsetup";a.trigger(d,b);a.trigger(d+":"+b.name,b)};var ea=function ff(a,b){var c=function d(){d_(this,{name:a,plugin:b,instance:null},true);var c=b.apply(this,arguments);d$(this,a);d_(this,{name:a,plugin:b,instance:c});return c};Object.keys(b).forEach(function(a){c[a]=b[a]});return c};var eb=function fg(a,b){b.prototype.name=a;return function(){d_(this,{name:a,plugin:b,instance:null},true);for(var c=arguments.length,d=Array(c),e=0;e<c;e++){d[e]=arguments[e]}var f=new(Function.prototype.bind.apply(b,[null].concat([this].concat(d))));this[a]=function(){return f};d_(this,f.getEventHash());return f}};var ec=function(){function a(b){J(this,a);if(this.constructor===a){throw new Error("Plugin must be sub-classed; not directly instantiated.")}this.player=b;cf(this);delete this.trigger;ch(this,this.constructor.defaultState);d$(b,this.name);this.dispose=bW(this,this.dispose);b.on("dispose",this.dispose)}a.prototype.getEventHash=function b(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};a.name=this.name;a.plugin=this.constructor;a.instance=this;return a};a.prototype.trigger=function c(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return bT(this.eventBusEl_,a,this.getEventHash(b))};a.prototype.handleStateChanged=function d(a){};a.prototype.dispose=function e(){var a=this.name,b=this.player;this.trigger("dispose");this.off();b.off("dispose",this.dispose);b[dW][a]=false;this.player=this.state=null;b[a]=eb(a,dX[a])};a.isBasic=function f(b){var c=typeof b==="string"?dZ(b):b;return typeof c==="function"&&!a.prototype.isPrototypeOf(c.prototype)};a.registerPlugin=function g(b,c){if(typeof b!=="string"){throw new Error('Illegal plugin name, "'+b+'", must be a string, was '+(typeof b==="undefined"?"undefined":I(b))+".")}if(dY(b)){X.warn('A plugin named "'+b+'" already exists. You may want to avoid re-registering plugins!')}else if(dT.prototype.hasOwnProperty(b)){throw new Error('Illegal plugin name, "'+b+'", cannot share a name with an existing player method!')}if(typeof c!=="function"){throw new Error('Illegal plugin for "'+b+'", must be a function, was '+(typeof c==="undefined"?"undefined":I(c))+".")}dX[b]=c;if(b!==dV){if(a.isBasic(c)){dT.prototype[b]=ea(b,c)}else{dT.prototype[b]=eb(b,c)}}return c};a.deregisterPlugin=function h(a){if(a===dV){throw new Error("Cannot de-register base plugin.")}if(dY(a)){delete dX[a];delete dT.prototype[a]}};a.getPlugins=function i(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Object.keys(dX);var b=void 0;a.forEach(function(a){var c=dZ(a);if(c){b=b||{};b[a]=c}});return b};a.getPluginVersion=function j(a){var b=dZ(a);return b&&b.VERSION||""};return a}();ec.getPlugin=dZ;ec.BASE_PLUGIN_NAME=dV;ec.registerPlugin(dV,ec);dT.prototype.usingPlugin=function(a){return!!this[dW]&&this[dW][a]===true};dT.prototype.hasPlugin=function(a){return!!dY(a)};var ed=function fh(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof b==="undefined"?"undefined":I(b)))}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:false,writable:true,configurable:true}});if(b){a.super_=b}};var ee=function fi(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=function f(){a.apply(this,arguments)};var d={};if((typeof b==="undefined"?"undefined":I(b))==="object"){if(b.constructor!==Object.prototype.constructor){c=b.constructor}d=b}else if(typeof b==="function"){c=b}ed(c,a);for(var e in d){if(d.hasOwnProperty(e)){c.prototype[e]=d[e]}}return c};var ef=eh;var eg=Object.prototype.toString;var ei=c(function(a,b){function c(a){return a.replace(/^\s*|\s*$/g,"")}b=a.exports=c;b.left=function(a){return a.replace(/^\s*/,"")};b.right=function(a){return a.replace(/\s*$/,"")}});var ej=em;var ek=Object.prototype.toString;var el=Object.prototype.hasOwnProperty;var eq=function(a){return Object.prototype.toString.call(a)==="[object Array]"};var er=function(a){if(!a)return{};var b={};ej(ei(a).split("\n"),function(a){var c=a.indexOf(":"),d=ei(a.slice(0,c)).toLowerCase(),e=ei(a.slice(c+1));if(typeof b[d]==="undefined"){b[d]=e}else if(eq(b[d])){b[d].push(e)}else{b[d]=[b[d],e]}});return b};var es=eu;var et=Object.prototype.hasOwnProperty;var ev=ez;ez.XMLHttpRequest=e.XMLHttpRequest||eC;ez.XDomainRequest="withCredentials"in new ez.XMLHttpRequest?ez.XMLHttpRequest:e.XDomainRequest;ew(["get","put","post","patch","head","delete"],function(a){ez[a==="delete"?"del":a]=function(b,c,d){c=ey(b,c,d);c.method=a.toUpperCase();return eA(c)}});if(typeof HTMLVideoElement==="undefined"&&bd()){k.createElement("video")}eD.hooks_={};eD.hooks=function(a,b){eD.hooks_[a]=eD.hooks_[a]||[];if(b){eD.hooks_[a]=eD.hooks_[a].concat(b)}return eD.hooks_[a]};eD.hook=function(a,b){eD.hooks(a,b)};eD.removeHook=function(a,b){var c=eD.hooks(a).indexOf(b);if(c<=-1){return false}eD.hooks_[a]=eD.hooks_[a].slice();eD.hooks_[a].splice(c,1);return true};eD.VERSION=a;eD.options=dT.prototype.options_;eD.getPlayers=function(){return dT.players};eD.players=dT.players;eD.getComponent=cl.getComponent;eD.registerComponent=function(a,b){if(cE.isTech(b)){X.warn("The "+a+" tech was registered as a component. It should instead be registered using V.registerTech(name, tech)")}cl.registerComponent.call(cl,a,b)};eD.getTech=cE.getTech;eD.registerTech=cE.registerTech;eD.use=cG;eD.browser=H;eD.TOUCH_ENABLED=F;eD.extend=ee;eD.mergeOptions=ck;eD.bind=bW;eD.registerPlugin=ec.registerPlugin;eD.plugin=function(a,b){X.warn("V.plugin() is deprecated; use V.registerPlugin() instead");return ec.registerPlugin(a,b)};eD.getPlugins=ec.getPlugins;eD.getPlugin=ec.getPlugin;eD.getPluginVersion=ec.getPluginVersion;eD.log=X;eD.createTimeRange=eD.createTimeRanges=cp;eD.formatTime=cS;eD.parseUrl=dJ;eD.isCrossOrigin=dM;eD.EventTarget=bY;eD.on=bR;eD.one=bU;eD.off=bS;eD.trigger=bT;eD.xhr=ev;["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(a){eD[a]=function(){X.warn("V."+a+"() is deprecated; use V.dom."+a+"() instead");return bE[a].apply(null,arguments)}});eD.computedStyle=$;eD.dom=bE;eD.url=dN;return eD});
STK.register("lib.feed.plugins.video.video",function(a){var b=a.core.func.empty();var c=a.core.json.merge;var d=a.lib.kit.extra.language;var e=a.core.util.easyTemplate;var f=a.common.trans.global;var g=a.lib.feed.plugins.video.utils;var h=a.lib.kit.extra.getWantTime;return function(d){if(!d.sources||!d.container){a.log("video : need src and box and log of the base Class");return}var e,i;var j,k,l,m,n;e=c({id:"",obj:"",width:"100%",height:"100%",controls:true,doubleToFullScreen:false,extraEvents:true,container:"",className:["wbv-deployable"],poster:"",sources:"",loop:false,autoplay:false,muted:true,cb:b},d,{isDeep:0});j={initMedia:function(){return V(e.id,{container:e.container,width:e.width,height:e.height,controls:true,extraEvents:true,doubleToFullScreen:e.doubleToFullScreen,initChildren:true,children:["mediaLoader","posterImage","loadingSpinner","bigPlayButton","EndDisplay","errorDisplay","controlBar","contextMenu",{name:"copyUrlLayer",copyUrl:e.obj.actionData.short_url}],posterImage:{fallbackImg_:true,playCount:e.obj.actionData.play_count,duration:e.obj.actionData.duration},controlBar:{children:["playToggle","progressControl","currentTimeDisplay","timeDivider","durationDisplay","fullscreenToggle","logo",{name:"volumePanel",hideVolumeControl:true}]},className:e.className,poster:e.poster,loop:e.loop,autoplay:e.autoplay,muted:e.muted,sources:e.sources},e.cb)},onListen:function(){if(!i)return;for(var a in k){i.on(a,k[a])}},offListen:function(){if(!i)return;for(var a in k){i.off(a,k[a])}}};k={loadstart:function(a){this.firstframe_=false;if(this.log_){this.log_.firstframe_time=+(new Date).getTime()}},loadeddata:function(a){if(this.log_&&!this.firstframe_){this.log_.firstframe_time=+(new Date).getTime()-this.log_.firstframe_time;this.log_.firstframe_status="success";this.firstframe_=true}},error:function(a){if(this.log_&&!this.firstframe_){this.log_.firstframe_time=+(new Date).getTime()-this.log_.firstframe_time;this.log_.firstframe_status="error";this.firstframe_=true}if(this.log_&&this.firstframe_){this.log_.quit_status="error"}this.trigger("sendLog");var b=this.error_;var c=b.code;var d=this.networkState();if(c==4||c==2&&d==1){if(this.errorSrc_)return;this.errorSrc_=true;this.trigger("resetSrc",{type:"error"})}},abort:function(a){if(this.log_&&!this.firstframe_){this.log_.firstframe_time=+(new Date).getTime()-this.log_.firstframe_time;this.log_.firstframe_status="cancel";this.firstframe_=true}if(this.log_&&this.firstframe_){this.log_.quit_status="cancel"}this.trigger("sendLog")},canplay:function(a){this.log_&&(this.log_.duration=this.duration().toFixed(2));this.errorSrc_=false;this.trigger("sendLog")},firstplay:function(a){this.trigger("playCount")},play:function(a){if(this.log_){this.log_.play_time=h(0,"yyyy-MM-dd hh:mm:ss").Today.Format;this.log_.startplay_time=(this.currentTime()*1e3).toFixed(0)}this.fixUserActivity(false)},pause:function(a){if(this.log_&&this.firstframe_){this.log_.quit_status="not_complete"}this.trigger("sendLog");this.reportUserActivity();this.fixUserActivity(true)},replay:function(a){this.trigger("playCount")},ended:function(a){if(this.log_&&this.firstframe_){this.log_.quit_status="complete"}this.trigger("sendLog")},timeupdate:function(a){if(Math.floor(this.currentTime())===3&&this.getValidTime()>1||this.currentTime()>3&&Math.round(this.currentTime())%30===0&&this.getValidTime()>1){this.trigger("sendLog")}},fullscreenchange:function(a){this.trigger("dispatchHidemenu")},dispose:function(a){this.trigger("sendLog");j.offListen();var b=this.id();var c=V.keys_;if(!c)return;g.removeTarget(b,c.paused);b==c.play?c.play="":null;V.isAuto_&&c.auto==b?c.auto="":null;delete V.players[b]},resetSrc:function(a,b){if(this.requesting_)return;this.requesting_=true;var c,d,e,g;var h,i,j,k,l,m,n,o;c=this;j=c.log_;i=c.obj_;h=c.cache_;k=i.actionData;l=k.mid;m=k.objectid;o=c.currentTime();b&&(b.curTime=o);if(h.vData&&h.vData.isPay){n=+h.vData.isOpen}d={object_id:m,mid:l,isOpen:n};e=function(a){var d,e;e=a.data&&a.data.video_size;if(!e)return;e=V.mergeOptions(h.vSrcs||{qType:"480"},e);c.trigger("refreshSrcs",e);d=decodeURIComponent(e[e.qType||"fluency"]).replace(/^https?:/,"");if(a.data.infos&&a.data.infos.id==m){h.vData.isOpen=true;V.setExtend(j,{pay:"l"})}if(b&&b.type!="error"&&!n&&h.vData&&!h.vData.isOpen){c.trigger("hidepaylayer",{action:"success",data:a.data,raw:b});c.requesting_=false;return}c.src(d);c.ready(function(){this.requesting_=false;if(h.vData&&h.vData.isPay&&!n){this.trigger("hidepaylayer",{action:"success",data:a.data,raw:b})}else{this.currentTime(o);this.play()}},false)};g=function(a){if(h.vData&&h.vData.isPay==1&&!n){this.trigger("hidepaylayer",{action:"fail",data:a.data,raw:b})}};f.request("newVideoUrl",{onSuccess:e,onError:g},d)}};parseDOM=function(){i=j.initMedia()};m=function(){j.onListen()};n=function(){parseDOM();m()};n();return i}});
STK.register("common.third.search.followBtn",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.common.trans.global,e=a.common.dialog.validateCode(),f=c('<#et followBtn data><div action-type="h5_author_img"><div class="img"><img src="${data.avatar_large}" title="${data.fnick}" class="W_face_radius"></div><div class="add" node-type="h5_author_info" style="display:none"><div class="inner"><div class="name W_autocut">${data.fnick}</div><div class="btn"><a href="javascript:void(0);" class="W_btn_b btn_22px" suda-uatrack="key=wb_PC_H5_player&value=video_profile_addatten" action-type="h5_author_follow" action-data="uid=${data.uid}&fnick=${data.fnick}&refer_flag=${data.refer_flag}"><em class="W_ficon ficon_add S_ficon">+</em>关注</a></div></div></div></div></#et>');return function(b){if(!b)a.log("media : need object of the baseFeedList Class");else{var c={},e,g,h,i,j,k;h={isMouseLeaveOrEnter:function(a,b){if(a&&a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},show:function(b){if(!!h.isMouseLeaveOrEnter(b.evt,b.el)){var c=a.sizzle("[node-type=h5_author_info]",b.el)[0];e&&clearTimeout(e);c&&a.setStyle(c,"display","");c&&a.removeClassName(c,"hv-ani-addb");c&&a.addClassName(c,"hv-ani-adda")}},hide:function(b){if(!!h.isMouseLeaveOrEnter(b.evt,b.el)){var c=a.sizzle("[node-type=h5_author_info]",b.el)[0];e&&clearTimeout(e);c&&a.addClassName(c,"hv-ani-addb");e=setTimeout(function(){c&&a.setStyle(c,"display","none");c&&a.removeClassName(c,"hv-ani-addb")},200)}},initBtn:function(b){if(!!b){b.avatar_large=b.avatar_large&&decodeURIComponent(b.avatar_large);b=a.parseParam({uid:"",fnick:"",avatar_large:"",refer_flag:""},b);return f(b).toString()}},follow:function(b){var c=b.el;if(!!c){var e=c.parentNode,f,g;c.removeAttribute("action-type");a.addClassName(c,"hv-ani-add");f=setTimeout(function(){if(a.hasClassName(e,"con-9")){a.addClassName(e,"hv-s3-9b");g=setTimeout(function(){c&&a.removeNode(c);g&&clearTimeout(g);g=null},500)}f&&clearTimeout(f);f=null},1e3);var h=function(a){},i=function(a){},j=function(){f&&clearTimeout(f);f=null;c&&a.removeClassName(c,"hv-ani-add");c&&c.setAttribute("action-type","author_follow");e&&c&&(e.innerHTML=c);a.removeClassName(e,"hv-s3-9b")},k=d.getTrans("follows",{onComplete:function(a,b){var c={onSuccess:h,onError:i,requestAjax:k,param:b,onRelease:j};validCodeLayer.validateIntercept(a,b,c)}});k.request(b.data)}},follows:function(b){var c=b.el;if(!!c){var e=c.parentNode,f,g;c.removeAttribute("action-type");c.removeAttribute("suda-uatrack");c.innerHTML="已关注";a.addClassName(c,"W_btn_b_disable");var h=function(a){},i=function(a){},j=function(){c&&a.removeClassName(c,"W_btn_b_disable");c&&c.setAttribute("action-type","h5_author_follow");c&&c.setAttribute("suda-uatrack","key=wb_PC_H5_player&value=video_profile_addatten");c&&(c.innerHTML='<em class="W_ficon ficon_add S_ficon">+</em>关注')},k=d.getTrans("follows",{onComplete:function(a,b){var c={onSuccess:h,onError:i,requestAjax:k,param:b,onRelease:j};validCodeLayer.validateIntercept(a,b,c)}});k.request(b.data)}},destroy:function(){c=null;g.remove("h5_author_follow","click",h.follows);g.remove("h5_author_img","mouseover",h.show);g.remove("h5_author_img","mouseout",h.hide);g&&g.destroy&&g.destroy()},initplugins:function(){c.btn=h.initBtn;c.destroy=h.destroy}};i=function(){g=a.delegatedEvent(b)};j=function(){g.add("h5_author_follow","click",h.follows);g.add("h5_author_img","mouseover",h.show);g.add("h5_author_img","mouseout",h.hide)};k=function(){i();j();h.initplugins()};k();return c}}});
STK.register("common.third.search.ad",function(a){var b=a.lib.kit.extra.language;var c=a.common.trans.global;var d=a.lib.kit.extra.scrollMethod;var e=a.lib.feed.plugins.video.utils;var f={},g,h,i,j,k,l;var m,n;h={replay:function(b){if(V.flag_&&V.flag_.fullScreen)return;var c=this;var d=this.obj_.adData;if(!d||!d.fUrl||!d.fCount||!this.obj_.ad)return;setTimeout(function(){c.pause()},200);var e=this.id();V.isAuto_&&!a.inArray(e,V.keys_.paused)&&V.keys_.paused.push(e);this.obj_.ad.trigger("dispatchPlay","pread")},play:function(b){if(V.flag_&&V.flag_.fullScreen)return;var c=this.obj_.adData;if(!c||!c.fUrl||c.type!="pread"||!c.fCount||!this.obj_.ad)return;this.pause();var d=this.id();V.isAuto_&&!a.inArray(d,V.keys_.paused)&&V.keys_.paused.push(d);this.obj_.ad.trigger("dispatchPlay","pread")},ended:function(a){if(V.flag_&&V.flag_.fullScreen)return;var b=this.obj_.adData;if(!b||!b.eUrl||!b.eCount||!this.obj_.ad)return;this.obj_.ad.trigger("dispatchPlay","endad")},dispose:function(a){g.offListen(this,h)}};i={sendCode:function(a,b){var d,e;d=this.obj_.actionData.mid;if(b=="pread"){e=this.adData_.fMark}else{e=this.adData_.eMark}sendData={mid:d,mark:e,type:b};c.request("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}},sendData)},ended:function(b){var c=this;var d=this.adData_;var f=this.obj_&&this.obj_.media;if(!f)return;this.hide();if(!f)return;var i=f.id();if(i==V.keys_.auto||i==V.keys_.play)!f.ended()&&f.play();V.isAuto_&&a.inArray(i,V.keys_.paused)&&e.removeTarget(i,V.keys_.paused);V.flag_.layer&&d.type=="pread"&&f.play();this.trigger("adEnded",d.type);if(!d.eCount&&!d.fCount){setTimeout(function(){g.offListen(f,h);c.dispose();c.obj_.ad=null;c.obj_.adData=null},100)}},dispatchPlay:function(a,b){var c=this.adData_;var d=this.obj_.media;if(!c)return;var e,f;if(b=="pread"){e="fCount";f="fUrl"}else{e="eCount";f="eUrl"}if(!c[e]||!c[f])return;this.show();if(c.type!=b){this.src(c[f])}this.play();c.type=b;c[e]-=1;this.trigger("sendCode",b)},dispose:function(a){g.offListen(this,i)}};g={onListen:function(a,b,c){for(var d in b){if(c&&a==c&&d=="play"){a.one(d,b[d]);continue}a.on(d,b[d])}},offListen:function(a,b){for(var c in b){a.off(c,b[c])}},initCount:function(){var a,c,e,f,g;a=function(a,b){n.apply(this,arguments);this.countTime_=b.countTime_||this.player_.duration();this.throttledUpdateContent_=d.throttle(V.bind(this,this.updateContent),25);this.on(this.player_,"timeupdate",this.throttledUpdateContent_)};c=function(){var a=m.createEl("div",{className:"wbv-ad-countdown"});this.remainedTime_=5;this.countNode_=m.createEl("em");this.contentEl_=m.createEl("span",{},{},this.countNode_);this.contentEl_.appendChild(document.createTextNode(b("秒后关闭广告")));this.updateTextNode_();a.appendChild(this.contentEl_);return a};e=function(){if(this.textNode_){this.countNode_.removeChild(this.textNode_)}this.textNode_=document.createTextNode(this.remainedTime_);this.countNode_.appendChild(this.textNode_)};f=function(){var a=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();var b=Math.ceil(this.countTime_-a);if(b!==this.remainedTime_){this.remainedTime_=b;this.requestAnimationFrame(this.updateTextNode_)}};g=V.extend(n,{constructor:a,createEl:c,updateTextNode_:e,updateContent:f});n.registerComponent("AdCountDown",g)},initAdData:function(a){var b;b=a.adData;b.fUrl=b.fUrl&&decodeURIComponent(b.fUrl);b.eUrl=b.eUrl&&decodeURIComponent(b.eUrl);b.type=b.fUrl?"pread":"endad";return a},initMedia:function(a){var b,c;c=function(){this.hide();this.obj_=a;this.adData_=a.adData};b=V(a.key+"_ad",{container:a.container,controls:false,extraEvents:false,doubleToFullScreen:false,preventDefaultMenu:true,initChildren:true,children:["mediaLoader"],adCountDown:{countTime_:5},controlBar:{children:["volumePanel"],volumePanel:{children:["muteToggle"]}},contextMenu:{children:[]},className:["wbv-ad","wbv-hidden"],loop:false,autoplay:false,muted:true,sources:[{src:a.adData.type=="pread"?a.adData.fUrl:a.adData.eUrl,type:"video/mp4"}]},c);a.ad=b;g.onListen(b,i)}};j=function(){m=V.dom;n=V.getComponent("Component")};k=function(){g.initCount()};l=function(){j();k()};l();f={init:function(a,b){if(!a||!b)return;b=g.initAdData(b);g.initMedia(b);g.onListen(a,h,a)}};return f});
STK.register("lib.feed.plugins.video.quality",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d={quality:c(b('<#et quality data><i suda-uatrack="key=wb_PC_H5_player&value=quality_click" action-type="h5_video_qShow" action-data="show=0&qType=${data["qType"]}">#L{${data["select"]}}</i><span node-type="h5_video_qMenu" style="display:none"><#if (data["1080"] && data["uniqueKey"])><a suda-uatrack="key=wb_PC_H5_player&value=quality_1080p" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=1080&src=${data["1080"]}"><em class="W_ficon ficon_video_v3"></em>#L{1080P}</a></#if><#if (data["720"] && data["uniqueKey"])><a suda-uatrack="key=wb_PC_H5_player&value=quality_720p" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=720&src=${data["720"]}">#L{高清}</a></#if><#if (data["480"] && data["uniqueKey"])><a suda-uatrack="key=wb_PC_H5_player&value=quality_480p" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=480&src=${data["480"]}">#L{标清}</a></#if><#if (data["fluency"] && data["uniqueKey"] && data["qType"] == "fluency")><a suda-uatrack="key=wb_PC_H5_player&value=quality_fluency" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=fluency&src=${data["fluency"]}">#L{流畅}</a></#if></span></#et>'))},e={480:"标清",720:"高清",1080:"1080P",fluency:"流畅"};return function(b){if(!b)a.log("media : need object of the baseFeedList Class");else{var c={},f,g,h,i,j;g={select:function(b){var c=b.el,d=b.data,e=a.core.dom.dir.parent(c,{expr:"[node-type=h5_video_qMenu]"})[0];a.setStyle(e,"display","none");if(d.qType=="1080")window.__WBH5VideoUtils__("jumpUrl",d);else{var f=a.core.dom.prev(e),g=a.queryToJson(f.getAttribute("action-data")).qType,h={show:0,qType:d.qType};f.setAttribute("action-data",a.jsonToQuery(h));if(g==d.qType)return;f.innerHTML=c.innerHTML;window.__WBH5VideoUtils__("reset",d)}},show:function(b){var c=b.el,d=b.data,e=a.core.dom.next(c);if(d.show==1){d.show=0;c.setAttribute("action-data",a.jsonToQuery(d));a.setStyle(e,"display","none")}else{d.show=1;c.setAttribute("action-data",a.jsonToQuery(d));a.setStyle(e,"display","block")}},btn:function(a){if(!!a){a.select=a.qType&&e[a.qType]||"标清";return d.quality(a).toString()}},destroy:function(){c=null;f.remove("h5_video_qSelect","click",g.select);f.remove("h5_video_qShow","click",g.show);f&&f.destroy&&f.destroy()},initplugins:function(){c.btn=g.btn;c.destroy=g.destroy}};h=function(){f=a.delegatedEvent(b)};i=function(){f.add("h5_video_qSelect","click",g.select);f.add("h5_video_qShow","click",g.show)};j=function(){h();i();g.initplugins()};j();return c}}});
STK.register("common.third.search.init",function(a){var b=a.lib.kit.dom.parseDOM;var c=a.common.trans.global;var d=a.common.channel.video;var e=a.lib.kit.extra.merge;var f=a.lib.kit.extra.language;var g=a.lib.kit.extra.sparkMD5;var h=a.lib.kit.extra.sendImage;var i=a.lib.kit.extra.HashTable;var j=a.lib.kit.extra.getWantTime;var k=a.lib.kit.extra.scrollMethod;var l=a.lib.kit.extra.storageLog;var m=a.lib.kit.extra.arrayRemove;var n=a.lib.kit.extra.supportVideo;var o=a.lib.feed.plugins.video.utils;var p=a.lib.feed.plugins.video.video;var q=a.lib.feed.plugins.video.log;var r=a.common.third.search.followBtn;var s=a.lib.feed.plugins.video.quality;var t=a.lib.feed.plugins.video.vplus;var u=a.common.third.search.ad;var v={str:"Log_h5play",transKey:"h5playlog"};var w="WB_video_h5_v2";var x="WB_video_h5_v2_h";var y="yixiong&zhaolong5";var z={80000002:2,80000008:1};o=e(o,{domHalf:false,sensitiveHeight:270,initBuff:300,md5Data:function(b,c,d){var e={};e.data=a.jsonToStr(b);e.key=c;e.sig=e.data&&c&&d&&e.data+c+d;e.sig=g.hash(e.sig);return e},sendAnalysisRequest:function(b,d){var e=b.getAttribute("data-mark")||"";var f=a.queryToJson(e);var g=z[d];var i=function(a){var b=[];for(var c=0;c<a.attributes.length;c++){if(a.attributes[c].name.indexOf(d===80000008&&o.CONauto()&&f.monitor_mask?"auto-data-mark-third-analysis":"data-mark-third-analysis")===0){b.push(a.attributes[c].value)}}return b}(b);if(f.monitor_mask&&f.monitor_mask&g){h(i,{action_id:d,autoplay:o.CONauto()?1:0});c.request("setADMonitor",{},{action_id:d,monitor:a.foreach(i,function(a){return encodeURIComponent(a)}).join("|"),mark:f.mark})}}});return function(b,e){if(!b){a.log("media : need object of the baseFeedList Class");return}var f={},g,h,j,l,m;var v,x,y,z,A,B;var C,D,E,F,G,H,I={},J;var K={auto:"",play:"",paused:[]};var L={layer:false,fullScreen:false,scroll:false};g={canplay:function(a){var b=this.obj_;C&&K.auto&&this.id()==K.auto&&this.play()},play:function(a){var b=this.id();if(!C||!this.muted()){if(K.play&&K.play!=b){var c=J.ObjArr[K.play];if(c.type=="live"){c.media.destroy();c.init=false}else{V.players[K.play].pause()}}K.play=b}C&&o.removeTarget(b,K.paused)},pause:function(b){var c=this.id();if(!C)return;if(!this.muted()){!a.inArray(c,K.paused)&&K.paused.push(c);c==K.play?K.play="":null}},volumechange:function(b){var c=this.id();z.setExtend(this.log_,{clicked:1});if(this.muted()){if(!C)return;if(this.paused()){o.removeTarget(c,K.paused)}else{c==K.play?K.play="":null;!K.auto?K.auto=c:null}}else{if(this.paused()){if(!C)return;!a.inArray(c,K.paused)&&K.paused.push(c)}else{if(c==K.play)return;if(K.play&&K.play!=c){var d=J.ObjArr[K.play];if(d.type=="live"){d.media.destroy();d.init=false}else{V.players[K.play].pause()}}K.play=c;C&&K.auto==c?K.auto="":null}}},fullscreenchange:function(a){if(this.isFullscreen()){L.fullScreen=true}else{L.fullScreen=false}},firstclick:function(b){if(!this.obj_||L.layer)return;var c=this.obj_.actionData;if(!c)return;var d=parseInt(c.card_width)||this.videoWidth();var e=parseInt(c.card_height)||this.videoHeight();var f=d/e;var g=+f.toFixed(2);var h;if(g>1&&g<1.77){h=parseInt(500/f)}else if(g<=1){h="auto"}this.height(h);this.deployTimer_=this.setTimeout(function(){this.removeClass("wbv-deployable");this.clearTimeout(this.deployTimer_);a.setStyle(this.obj_.node,"height",h+"px");this.height("100%")},300);z.setExtend(this.log_,{clicked:1});this.feedClicked_=true;if(C){this.muted(false);if(!this.paused()){this.pause()}}},sendLog:function(a){if(this.getValidTime()<=0)return;var b;this.log_.playduration=Math.round(this.currentTime()*1e3);this.log_.valid_play_duration=Math.round(this.getValidTime()*1e3);this.resetValidTime();this.log_&&(b=o.formateJson(this.log_));b&&B.set(b)},playCount:function(b,d){var e=d||this.obj_;var f=e.node;var g=e.actionData;var h=y.getFeedNode(f,v);if(h&&h.getAttribute("data-mark")){o.sendAnalysisRequest(h,80000008);c.request("adDeal",{},{mid:g.mid,short_url:g.short_url,mark:a.queryToJson(h.getAttribute("data-mark")).mark})}}};h={onListen:function(a){if(!a)return;for(var b in g){a.on(b,g[b])}},offListen:function(a){if(!a)return;for(var b in g){a.off(b,g[b])}},initMedia:function(b){if(b&&b.media)return;var c,d,e;e=b.actionData;d=function(){this.log_=b.logObj;this.obj_=b;if(a.hasClassName(b.node.parentNode.parentNode,"WB_feed_spec")){a.addClassName(b.node.parentNode.parentNode,w)}else{a.addClassName(b.node,w)}b.image&&a.setStyle(b.image,"display","none");b.container&&a.setStyle(b.container,"display","");b.adData&&u.init(this,b);if(b.vSrcs&&!b.vSrcs.noQuality){s.init(this,b.vSrcs)}else{this.cache_.vSrcs=b.vSrcs}b.follow&&b.follow.need_follow==1&&r.init(this,b.follow);b.vData&&(b.vData.isPay==1||b.vData.isFake==1)&&t(this,b.vData)};c=p({obj:b,id:b.key,container:b.container,muted:C?true:false,className:["wbv-deployable"],poster:e.cover_img&&decodeURIComponent(e.cover_img),sources:[{src:e.video_src&&decodeURIComponent(e.video_src),type:"video/mp4"}],cb:d});b.media=c;h.onListen(c);c.on("dispose",function(a){h.offListen(c)})},getLogData:function(b,c,d){if(!a.isNode(b))return;var e=b&&y.getFeedNode(b,v);var f=e&&e.getAttribute("tbinfo")&&a.queryToJson(e.getAttribute("tbinfo"));var g=e&&e.getAttribute("minfo")&&a.queryToJson(e.getAttribute("minfo"));var h=e&&e.getAttribute("mid");d.uid=$CONFIG&&$CONFIG.uid||"";d.mid=h?h:"";d.mid_uid=f&&f.ouid?f.ouid:"";d.rootuid=g&&g.ru||f&&f.ouid;d.rootmid=g&&g.rm&&g.rm||h&&h;d.object_id=c&&c.objectid;d.duration=c&&c.duration;d.encode_mode=c&&c.encode_mode;d.bitrate=c&&c.bitrate;d.isautoplay=C?"1":"0";return d},getInitData:function(b){if(!b||!a.isNode(b.node)||!a.isNode(b.dom))return;var c,d,e;e=a.jsonClone(A);d=b.actionData;if(!d)return;if(d.type==="feedlive"){c={logObj:{},uid:window.$CONFIG&&window.$CONFIG.uid||"",objectId:d.objectid,thumbnail:d.cover_img&&decodeURIComponent(d.cover_img),videoH:d.card_height&&d.card_height+"px",videoW:d.card_width&&d.card_width+"px",dom:b.dom,playCount:d.play_count,duration:d.duration,liveStatus:d.liveStatus,cTime:d.cTime,allowMouseRight:false,isWBLive:true,uniqueKey:b.key,extend:{is_premium:d.is_premium&&d.is_premium==1?true:false}}}else{e=z.setExtend(e,{sid:z.sid(),qType:"480"});if(b.vData&&(b.vData.isPay==1&&b.vData.isOpen==0||b.vData.isFake==1)){e=z.setExtend(e,{pay:"s"})}if(b.vSrcs&&b.vSrcs.qType){e=z.setExtend(e,{qType:b.vSrcs.qType})}e=h.getLogData(b.node,d,e);c={logObj:e}}return c},initOne:function(b,c,d){if(!b)return;var e,f,g,i,j,k,l,m,p,q,r,s,t;e=o.getUniqueKey();g=y.getMid(b);i=o.getAttrData(b,"action-data");if(!i)return;if(i.type==="feedlive"&&!n.live())return;i.mid=g;m=o.getAttrData(b,"follow-data");p=o.getAttrData(b,"video-sources");p.key=e;if(p&&p.qType&&p.qType!="720"&&p.qType!="1080"){!i.video_src&&p[p.qType]&&(i.video_src=p[p.qType]);p.noQuality=true}q=o.getAttrData(b,"vplus-data");r=o.getAttrData(b,"ad-data");b.setAttribute("unique-video",e);j=a.sizzle('[node-type="fl_h5_video_pre"]',b)[0];k=a.sizzle('[node-type="fl_h5_video_disp"]',b)[0];a.removeNode(a.sizzle('[action-type="feed_list_smallPlayer"]',j)[0]);l=h.getInitData({key:e,node:b,dom:k,actionData:i,vData:q,vSrcs:p});if(i.type=="feedlive"){a.addClassName(b,"WB_video_h5");f=new HlsPlayer(l);j.style.display="none";k.style.display="block"}s={media:f,type:i.type=="feedlive"?"live":"video",key:e,node:b,container:k,image:j,top:c,height:d,actionData:i,logObj:l.logObj,vSrcs:p,follow:m,vData:q,adData:r};!I.hasOwnProperty(e)&&(I[e]=c);!J.Contains(e)&&J.Add(e,s)},resetOne:function(a,b,c){var d=J.ObjArr[a];if(!d)return;var e=d.top;var f=d.domHeight;if(e!=b){d.top=I[a]=b}if(f!=c){d.domHeight=c}},initVideos:function(){if(L.fullScreen||L.layer)return;var b=a.sizzle('[node-type="fl_h5_video"]',v);b&&a.foreach(b,function(b){if(!b)return;var c=a.position(b).t;var d=a.core.dom.getSize(b).height;var e=b.getAttribute("unique-video");if(e){h.resetOne(e,c,d)}else{h.initOne(b,c,d)}})},thirdRend:function(a){var b=a.data;var c=a.el;if(c.getAttribute("node-type")!=="fl_h5_video"||b&&b.type==="feedlive"&&!n.live()){e&&e(a);return y.preventDefault(a.evt)}if(b&&b.type!="feedlive")return;var d=c&&c.getAttribute("unique-video");var f=d&&J.ObjArr[d];if(f.init)return;f.media.expandPlay();f.init=true;if(K.play){var h=J.ObjArr[K.play];if(h.type=="live"){h.media.destroy();h.init=false}else{h.media.pause()}}K.play=d;g.playCount(a.evt,f)},outBuff:function(a){if(!a.media)return;if(a.type=="live"){a.media.destroy();a.init=false}else{a.media.pause()}},inBuff:function(b,c){var d=b.media;if(b.type=="video"&&!d){h.initMedia(b);if(C&&o.isInAutoClinet(b.top,c,b.height,D))return true;return}if(b.type=="video"&&d.ended()||a.inArray(b.key,K.paused))return;if(!o.isInAutoClinet(b.top,c,b.height,D)){if(b.type=="live"){b.media.destroy();b.init=false}else{b.media.pause()}}else{if(b.key==K.play||!C||b.type=="live")return;if(K.auto==b.key)return true;d.pause();return true}},changeStatus:function(){E=a.scrollPos().top;var b=[];var c;var d=J&&J.ObjArr;I&&a.foreach(I,function(a,c){var e=d[c];if(!e)return;if(!o.isInBuff(a,E,D)){h.outBuff(e)}else{h.inBuff(e,E)&&b.push(e)}});if(!C)return;if(b&&b.length===1){c=b[0]}if(b&&b.length>1){c=o.filterAutoVideo(b,E,D);K.auto&&c.key!=K.auto&&V.players[K.auto]&&V.players[K.auto].pause()}if(!c)return;K.auto=c.key;if(!c.media)initMedia(c);c.media.isReady_&&c.media.play()},checkWinHeight:function(){if(L.fullScreen||L.layer)return;D=a.winSize().height;d.fire("resize")},checkDocHeight:function(){if(L.scroll||L.fullScreen||L.layer)return;var b=a.pageSize().page.height;if(b==H)return;H=b;h.initVideos();h.changeStatus();d.fire("docChange")},scroll:function(){if(L.scroll||L.fullScreen||L.layer)return;L.scroll=true;h.changeStatus();d.fire("scroll");clearTimeout(G);G=setTimeout(function(){L.scroll=false},0)},debounce:k.debounce(function(){h.scroll()},300),throttle:k.throttle(function(){h.scroll()},500,600),rAF:k.rAF(function(){h.scroll()}),initPlugins:function(){h.checkWinHeight();h.initVideos();h.changeStatus()},dispose:function(){V.players&&a.foreach(V.players,function(a,b){a&&a.dispose&&a.dispose()});V.players={}}};j=function(){C=o.CONauto();v=b.getNode();x=b.getDEvent();y=a.common.feed.feedList.utils;H=a.pageSize().page.height;J=J&&J.Clear()||i();z=q();V.keys_=K;V.flag_=L;V.isAuto_=C;!V.setExtend&&(V.setExtend=z.setExtend);A=z.Obj};l=function(){h.initPlugins();F=setInterval(h.checkDocHeight,1e3);a.addEvent(window,"scroll",h.debounce);a.addEvent(window,"resize",h.checkWinHeight);x.add("feed_list_third_rend","click",h.thirdRend)};m=function(){j();l()};m();f.destroy=function(){V.keys_=K=null;V.flag_=L=null;F&&clearInterval(F);G&&clearInterval(G);a.removeEvent(window,"scroll",h.debounce);a.removeEvent(window,"resize",h.checkWinHeight);x.remove("feed_list_third_rend","click",h.thirdRend);x&&x.destroy&&x.destroy();J&&J.Clear();I=null;h.dispose();h=null;g=null;B&&B.destroy&&B.destroy()};return f}});
STK.register("common.feed.feedList.plugins.media",function(a){var b=a.common.feed.feedList.utils;var c=a.common.feed.feedList.feedTemps;var d=a.core.util.easyTemplate;var e=a.lib.kit.extra.language;var f=a.lib.kit.extra.supportVideo;var g=a.common.trans.global;var h=e("#L{加载失败}!");var i=e("#L{很抱歉，该内容无法显示，请稍后再试。}");var j=e("#L{操作失败，请稍候重试。}");var k=a.core.util.browser.IE;var l=false;var m;if(f.video()){l=true}var n=function(b,c){console.log();return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}};var o=function(a){if(a==document.body){return false}if(a.getAttribute("feedtype")=="ad"){return a}return arguments.callee(a.parentNode)};return function(c){if(!c){a.log("media : need object of the baseFeedList Class");return}var d=c;var e=c.getDEvent();var g={};var h={dispContentNode:{},voteObj:{}};var i=function(){a.custEvent.fire(c,"clearTips","media")};var j=function(a){i();thirdExpand(a,d,h);return b.preventDefault(a.evt)};if(f.video(true)&&l){m=a.common.third.search.init(c,j)}return g}});
STK.register("common.feed.formatFeedTime",function(a){var b=a.lib.kit.extra.language;var c=b("#L{月}");var d=b("#L{日}");var e=b("#L{今天}");var f=b("#L{秒前}");var g=b("#L{分钟前}");return function(a,b){var h=a.getFullYear();var i=b.getFullYear();var j=a.getMonth()+1;var k=b.getMonth()+1;var l=a.getDate();var m=b.getDate();var n=a.getHours();var o=b.getHours();if(o<10)o="0"+o;var p=b.getMinutes();if(p<10)p="0"+p;var q=a-b;q=q>0?q:0;q=q/1e3;if(h!=i){return i+"-"+k+"-"+m+" "+o+":"+p}else if(j!=k||l!=m){return k+c+m+d+o+":"+p}else if(n!=o&&q>60*60){return e+o+":"+p}else if(q<51){q=q<1?1:q;return Math.floor((q-1)/10)+1+"0"+f}else{return Math.floor(q/60+1)+g}return""}});
STK.register("common.feed.feedList.plugins.updateTime",function(a){var b=a.common.feed.formatFeedTime;var c=typeof $CONFIG!="undefined"&&"timeDiff"in $CONFIG?$CONFIG.timeDiff:0;var d=function(d){var e=a.sizzle('a[node-type="feed_list_item_date"]',d);var f=new Date;f.setTime(f.getTime()-c);var g;for(var h=0;h<e.length;h++){var i=e[h];var j=i.getAttribute("date");if(!/^\s*\d+\s*$/.test(j)){continue}var k=new Date;k.setTime(parseInt(j,10));i.innerHTML=b(f,k);if(g==undefined){g=f.getTime()-k.getTime()<6e4}}return g};return function(b){if(!b){a.log("updateTime : need object of the baseFeedList Class");return}var c=b.getNode(),e,f=function(a){clearTimeout(e);e=setTimeout(function(){if(d(c)){f(1e4)}else{f(6e4)}},a)},g=function(){f(1e4)};f(1e4);a.custEvent.add(b,"updateFeed",g);var h={destroy:function(){clearTimeout(e);a.custEvent.remove(b,"updateFeed",g);h=b=c=e=f=g=null}};return h}});
STK.register("common.feed.feedList.simpleFeedList",function(a){return function(b,c){if(!b){a.log("in homeFeedList: node is not defined!");return}var d=a.common.feed.feedList,e,f,g=[];var h=d.baseFeedList(b,c);g.push((d=d.plugins).forward(h));g.push(f=d.favorite(h));g.push(d.images(h));g.push(d.share(h));g.push(d.comment(h));g.push(d.attitudeMini(h));g.push(d.rightMenu(h));g.push(d.review(h));g.push(d.media(h));g.push(d.updateTime(h));var i=h.destroy;h.destroy=function(){a.custEvent.remove(h,"clearTips");for(var b=0;b<g.length;b++){try{g[b].destroy()}catch(c){}}i();h=d=e=f=g=i=undefined};return h}});
STK.register("common.channel.newLikeEventList",function(a){var b={},c=["likeSuccess","likeError","likeFail"];a.custEvent.define(b,c);return b});
STK.register("pl.feedlist.newLike",function(a){return function(b){var c={name:"pl.feedlist.newLike"};var d=a.common.channel.newLikeEventList,e=true;if(!b){return}var f;var g={like:function(b){if(!e){return}e=false;a.core.evt.preventDefault();var c=b.data;if(!c){return}c.action_code=13;a.common.trans.like.getTrans("objectlike",{onSuccess:function(d){if(d.code==="100000"){var f=b.el.parentNode;if(f==null){return}var g,h={};if(d["data"]["is_del"]&&d["data"]["is_del"]===1){g=false}else{g=true}if(g){h["like-class"]="";h["like-title"]="取消赞";h["like-num"]=1;if(c.object_type&&c.object_type=="poi"){h["i-class"]="icon-btn icon-praised"}else{h["i-class"]="icon-act icon-act-praised"}}else{h["like-class"]="";h["like-title"]="赞";h["like-num"]=-1;if(c.object_type&&c.object_type=="poi"){h["i-class"]="icon-btn icon-praise"}else{h["i-class"]="icon-act icon-act-praise"}}var i=a.sizzle("[node-type=likeNum]",b.el),j;if(i&&i.length!=0){var k=a.trim(i[0].innerHTML);k=k==""?0:parseInt(k,10);var l=k+h["like-num"];j=l==0||l=="-1"||l==""?" ":l;i[0].innerHTML=j}var m=a.sizzle("[node-type=likeImg]",f);if(m&&m.length!=0){m[0].className=h["like-class"]}var n=a.sizzle("[node-type=likeTit]",f);if(n&&n.length!=0){n[0].title=h["like-title"]}if(i[0]&&i[0].getAttribute("is_like")=="true"){i[0].parentNode.style.display=j==" "||j<1?"none":"inline-block"}var o=a.sizzle("i",n[0]);if(o&&o.length!=0){o[0].className=h["i-class"]}setTimeout(function(a){e=true},400)}},onError:function(b){a.lib.ui.alert(b.msg);e=true},onFail:function(){a.lib.ui.alert("发送请求失败.");e=true}}).request(c)},findParentNode:function(a,b){for(var c=0;a=a.parentNode;c++){if(a===document.documentElement){return null}if(a&&a.attributes["node-type"]&&a.attributes["node-type"].value===b){return a}}}};var h=function(){};var i=function(){var c=a.core.evt.delegatedEvent(b);c.add("object_like","click",g.like)};var j=function(){i()};j();return c}});
STK.register("common.filter.calendarTemp",function(a){var b=""+"<#et userlist data>"+'<div class="selector">'+'<select action-type="month" class="month">'+"<option value=\"0\" ${data.showDate.month==0?'selected=\"\"':''}>#L{一月}</option>"+"<option value=\"1\" ${data.showDate.month==1?'selected=\"\"':''}>#L{二月}</option>"+"<option value=\"2\" ${data.showDate.month==2?'selected=\"\"':''}>#L{三月}</option>"+"<option value=\"3\" ${data.showDate.month==3?'selected=\"\"':''}>#L{四月}</option>"+"<option value=\"4\" ${data.showDate.month==4?'selected=\"\"':''}>#L{五月}</option>"+"<option value=\"5\" ${data.showDate.month==5?'selected=\"\"':''}>#L{六月}</option>"+"<option value=\"6\" ${data.showDate.month==6?'selected=\"\"':''}>#L{七月}</option>"+"<option value=\"7\" ${data.showDate.month==7?'selected=\"\"':''}>#L{八月}</option>"+"<option value=\"8\" ${data.showDate.month==8?'selected=\"\"':''}>#L{九月}</option>"+"<option value=\"9\" ${data.showDate.month==9?'selected=\"\"':''}>#L{十月}</option>"+"<option value=\"10\" ${data.showDate.month==10?'selected=\"\"':''}>#L{十一月}</option>"+"<option value=\"11\" ${data.showDate.month==11?'selected=\"\"':''}>#L{十二月}</option>"+"</select>"+'<select action-type="year" class="year">'+"<#list data.years as year>"+'<option value="${year}"${(data.showDate.year==year)?\' selected=""\':""}>${year}</option>'+"</#list>"+"</select>"+"</div>"+'<ul class="weeks">'+"<li>#L{日}</li><li>#L{一}</li><li>#L{二}</li><li>#L{三}</li><li>#L{四}</li><li>#L{五}</li><li>#L{六}</li>"+"</ul>"+'<ul class="days">'+"<#list data.dates as list>"+"<li>"+'<#if (list!="")>'+"<#if ("+"(data.start.year<data.showDate.year&&data.showDate.year<data.end.year)"+"||(data.start.year==data.showDate.year&&data.showDate.year<data.end.year&&data.start.month<data.showDate.month)"+"||(data.start.year==data.showDate.year&&data.showDate.year<data.end.year&&data.start.month==data.showDate.month&&data.start.date<=list&&list<=data.start.max)"+"||(data.start.year<data.showDate.year&&data.showDate.year==data.end.year&&data.showDate.month<data.end.month)"+"||(data.start.year<data.showDate.year&&data.showDate.year==data.end.year&&data.showDate.month==data.end.month&&list<=data.end.date)"+"||(data.start.year==data.showDate.year&&data.showDate.year==data.end.year&&data.start.month<data.showDate.month&&data.showDate.month<data.end.month)"+"||(data.start.year==data.showDate.year&&data.showDate.year==data.end.year&&data.start.month<data.showDate.month&&data.showDate.month==data.end.month&&list<=data.end.date)"+"||(data.start.year==data.showDate.year&&data.showDate.year==data.end.year&&data.start.month==data.showDate.month&&data.start.date<=list&&list<=data.start.max&&data.showDate.month<data.end.month)"+"||(data.start.year==data.showDate.year&&data.showDate.year==data.end.year&&data.start.month==data.showDate.month&&data.start.date<=list&&list<=data.start.max&&data.showDate.month==data.end.month&&list<=data.end.date)"+")>"+'<a action-type="date" href="#date" onclick="return false;" '+'title="${data.showDate.year}-${data.showDate.month+1}-${list}"'+'year="${data.showDate.year}" month="${data.showDate.month+1}" day="${list}"'+"${(data.today.year==data.showDate.year&&data.today.month==data.showDate.month&&list==data.showDate.date)?' class=\"day\"':''}><strong>${list}</strong></a>"+"<#else>"+"${list}"+"</#if>"+"</#if>"+"</li>"+"</#list>"+"</ul>";return b});
STK.register("common.filter.calendar",function(a){function e(){var b=arguments;this.today=this.getDefaultDate.apply(this,b);this.showDate={};for(var c in this.today){this.showDate[c]=this.today[c]}this.getKeyPoint.apply(this,b);this.getCurrentMonthInfo();a.custEvent.define(this,"close");a.custEvent.define(this,"show")}function d(){a.core.evt.stopEvent()}function c(){b.node.style.display="none";a.core.evt.removeEvent(document,"click",c);a.custEvent.fire(b,"close")}var b;e.prototype={data:{},defaultStartDate:new Date(2009,7,16,0,0,0,0),solarMonth:[31,28,31,30,31,30,31,31,30,31,30,31],maxMonthDay:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],solarDays:function(a,b){if(b==1){return a%4==0&&a%100!=0||a%400==0?29:28}else{return this.solarMonth[b]}},getDefaultDate:function(){var a=arguments;var b;var c;var d;var e;var f=/^(\d{4})[-\/](\d{1,2})[-\/](\d{1,2})$/;var g;var h;if(a.length==0){b=new Date}else if(f.test(a[0])){b=a[0].match(f);c=b[1]*1;d=b[2]*1-1;e=b[3]*1;b=new Date(c,d,e,0,0,0,0)}else if(a[0].constructor==Date){b=a[0]}else if(a.length==3){b=new Date(a[0],a[1],a[2],0,0,0,0)}else if(a[0]!=""&&typeof a[0]=="string"){b=new Date(a[0])}else{b=new Date}h={year:b.getFullYear(),month:b.getMonth(),date:b.getDate()};g=this.solarDays(h.year,h.month);h.max=g;return h},getKeyPoint:function(){var b=arguments;var c=b.length;var d;if(c>1){d=b[c-1];this.start=d.start!=null?d.start:this.defaultStartDate;this.end=d.end!=null?d.end:new Date;this.callback=d.callback;this.source=d.source;if(typeof this.start=="string"&&a.core.util.browser.IE6)this.start=this.start.replace("-","/");this.defaultStartDate=new Date(this.start)}else{this.start=this.defaultStartDate;this.end=new Date}this.start=this.getDefaultDate.call(this,this.start);this.end=this.getDefaultDate.call(this,this.end)},getCurrentMonthInfo:function(){var b=this.showDate;var c=b.year;var d=b.month;var e=b.date;var f=new Date(c,d,1,0,0,0,0);this.count=this.solarDays(c,d);this.firstWeek=f.getDay();var g=a.core.arr.copy(this.maxMonthDay);var h=this.firstWeek==0?[]:(new Array(this.firstWeek)).join().split(",");h=h.concat(g.splice(0,this.count));var i=$CONFIG!=null&&$CONFIG.timeDiff!=null?$CONFIG.timeDiff:0;var j=[];var k=this.defaultStartDate.getFullYear();var l=(new Date((new Date(this.end.year,this.end.month,this.end.date)).getTime()-i)).getFullYear();var m=l-k;var n=0;while(n<=m){j.push(k+n);n++}this.data={today:this.today,showDate:this.showDate,start:this.start,end:this.end,dates:h,years:j};this.showUI()},showUI:function(){var d=a.core;var e;var f;var g;var h;var i=this.getContainer();var j;if(this.source!=null){j=a.core.dom.position(this.source);j.t+=this.source.clientHeight}if(i==null){e=a.common.filter.calendarTemp;e='<div node-type="calendar" class="m-caldr" style="top:'+j.t+"px;left:"+j.l+'px;z-index:99999999">'+e+"</div>";f=d.util.easyTemplate(e);g=f(this.data).toString();g=a.lib.kit.extra.language(g);h=d.dom.builder(g);document.body.appendChild(h.box);i=this.getContainer();b=this;this.delegate(i);a.core.evt.addEvent(document,"click",c)}else{e=a.common.filter.calendarTemp;f=d.util.easyTemplate(e);g=f(this.data).toString();g=a.lib.kit.extra.language(g);i.innerHTML=g;i.style.cssText="display:block; top:"+j.t+"px;left:"+j.l+"px;z-index:99999999";if(i.style.display=="block"){a.core.evt.addEvent(document,"click",c)}b=this}this.node=i;a.custEvent.fire(b,"show");a.core.evt.stopEvent()},getContainer:function(){var b=a.core.dom.sizzle('[node-type="calendar"]',document.body);b=b.length>0?b[0]:null;return b},setYear:function(a){this.showDate.year=a;this.getCurrentMonthInfo();this.showUI()},setMonth:function(a){this.showDate.month=a*1;this.getCurrentMonthInfo();this.showUI()},setDate:function(a){a=a.replace(/(\d+)/g,function(a,b){return b.length==1?"0"+b:b});this.source.value=a;c();if(this.callback&&typeof this.callback=="function"){this.callback(a)}},delegate:function(c){var e=a.core.evt.delegatedEvent(c);e.add("month","change",function(a){var c=a.el.value;if(c!=b.showDate.month){b.setMonth(a.el.value)}});e.add("month","click",function(a){var c=a.el.value;if(c!=b.showDate.month){b.setMonth(a.el.value)}});e.add("year","change",function(a){var c=a.el.value;if(c!=b.showDate.year){b.setYear(c)}});e.add("year","click",function(a){var c=a.el.value;if(c!=b.showDate.year){b.setYear(c)}});e.add("date","click",function(a){b.setDate(a.el.title)});a.core.evt.addEvent(c,"click",d)}};return e});
STK.register("common.filter.getConfig",function(a){return{s_search:function(b){var c="",d=[];if(!b){return c}c=decodeURIComponent(b);if(c.indexOf("+")>-1){c=c.split("+");a.core.arr.foreach(c,function(a,b){d.push(decodeURIComponent(a))});c=d.join(" ")}else{c=decodeURIComponent(decodeURIComponent(b))}return c},htmlspecialchars:function b(a){a=a.replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/"/g,"&quot;");a=a.replace(/'/g,"&#039;");return a}}});
STK.register("common.filter.parseSearchParam",function(a){var b=window.location.href;return function(){var c;var d,e;var f=b.substr(b.indexOf("&")+1);var g="nickname"+"=";var h=b.indexOf(g);var i;var j=b.indexOf("Refer");var k=a.queryToJson(f);if(k.region){c=k.region.split(":");k.prov=c[1];k.city=c[2];delete k.region}if(k.timescope){if(k.timescope.indexOf("%3A")>-1){k.timescope=k.timescope.replace(/%3A/g,":")}c=k.timescope.split(":");if(c[1]){d=c[1].split("-");k.stime=d[0]+"-"+d[1]+"-"+d[2];if(d[3]){k.startHour=d[3]}}if(c[2]){e=c[2].split("-");k.etime=e[0]+"-"+e[1]+"-"+e[2];if(e[3]){k.endHour=e[3]}}delete k.timescope}if(k.userscope){k.userscope=k.userscope.replace(/custom%253A|custom%3A|custom:/,"")}if(h>-1){i=decodeURIComponent(decodeURIComponent(b.substring(h+g.length)))}else{if(j>-1)i=decodeURIComponent(decodeURIComponent(b.substring(b.indexOf("user/")+5,b.indexOf("&"))));else i=""}k.nickName=i;return k}});
STK.register("common.filter.cityList",function(a){var b={"省/直辖市":{code:0,city:{"城市/地区":0}},"安徽":{code:34,city:{"合肥":1,"芜湖":2,"蚌埠":3,"淮南":4,"马鞍山":5,"淮北":6,"铜陵":7,"安庆":8,"黄山":10,"滁州":11,"阜阳":12,"宿州":13,"巢湖":14,"六安":15,"亳州":16,"池州":17,"宣城":18}},"北京":{code:11,city:{"东城区":1,"西城区":2,"崇文区":3,"宣武区":4,"朝阳区":5,"丰台区":6,"石景山区":7,"海淀区":8,"门头沟区":9,"房山区":11,"通州区":12,"顺义区":13,"昌平区":14,"大兴区":15,"怀柔区":16,"平谷区":17,"密云县":28,"延庆县":29}},"重庆":{code:50,city:{"万州区":1,"涪陵区":2,"渝中区":3,"大渡口区":4,"江北区":5,"沙坪坝区":6,"九龙坡区":7,"南岸区":8,"北碚区":9,"万盛区":10,"双桥区":11,"渝北区":12,"巴南区":13,"黔江区":14,"长寿区":15,"綦江县":22,"潼南县":23,"铜梁县":24,"大足县":25,"荣昌县":26,"璧山县":27,"梁平县":28,"城口县":29,"丰都县":30,"垫江县":31,"武隆县":32,"忠县":33,"开县":34,"云阳县":35,"奉节县":36,"巫山县":37,"巫溪县":38,"石柱土家族自治县":40,"秀山土家族苗族自治县":41,"酉阳土家族苗族自治县":42,"彭水苗族土家族自治县":43,"江津区":81,"合川市":82,"永川区":83,"南川市":84}},"福建":{code:35,city:{"福州":1,"厦门":2,"莆田":3,"三明":4,"泉州":5,"漳州":6,"南平":7,"龙岩":8,"宁德":9}},"甘肃":{code:62,city:{"兰州":1,"嘉峪关":2,"金昌":3,"白银":4,"天水":5,"武威":6,"张掖":7,"平凉":8,"酒泉":9,"庆阳":10,"定西":24,"陇南":26,"临夏":29,"甘南":30}},"广东":{code:44,city:{"广州":1,"韶关":2,"深圳":3,"珠海":4,"汕头":5,"佛山":6,"江门":7,"湛江":8,"茂名":9,"肇庆":12,"惠州":13,"梅州":14,"汕尾":15,"河源":16,"阳江":17,"清远":18,"东莞":19,"中山":20,"潮州":51,"揭阳":52,"云浮":53}},"广西":{code:45,city:{"南宁":1,"柳州":2,"桂林":3,"梧州":4,"北海":5,"防城港":6,"钦州":7,"贵港":8,"玉林":9,"百色":10,"贺州":11,"河池":12,"来宾":13,"崇左":14}},"贵州":{code:52,city:{"贵阳":1,"六盘水":2,"遵义":3,"安顺":4,"铜仁":22,"黔西南":23,"毕节":24,"黔东南":26,"黔南":27}},"海南":{code:46,city:{"海口":1,"三亚":2,"其他":90}},"河北":{code:13,city:{"石家庄":1,"唐山":2,"秦皇岛":3,"邯郸":4,"邢台":5,"保定":6,"张家口":7,"承德":8,"沧州":9,"廊坊":10,"衡水":11}},"黑龙江":{code:23,city:{"哈尔滨":1,"齐齐哈尔":2,"鸡西":3,"鹤岗":4,"双鸭山":5,"大庆":6,"伊春":7,"佳木斯":8,"七台河":9,"牡丹江":10,"黑河":11,"绥化":12,"大兴安岭":27}},"河南":{code:41,city:{"郑州":1,"开封":2,"洛阳":3,"平顶山":4,"安阳":5,"鹤壁":6,"新乡":7,"焦作":8,"濮阳":9,"许昌":10,"漯河":11,"三门峡":12,"南阳":13,"商丘":14,"信阳":15,"周口":16,"驻马店":17}},"湖北":{code:42,city:{"武汉":1,"黄石":2,"十堰":3,"宜昌":5,"襄阳":6,"鄂州":7,"荆门":8,"孝感":9,"荆州":10,"黄冈":11,"咸宁":12,"随州":13,"恩施土家族苗族自治州":28}},"湖南":{code:43,city:{"长沙":1,"株洲":2,"湘潭":3,"衡阳":4,"邵阳":5,"岳阳":6,"常德":7,"张家界":8,"益阳":9,"郴州":10,"永州":11,"怀化":12,"娄底":13,"湘西土家族苗族自治州":31}},"内蒙古":{code:15,city:{"呼和浩特":1,"包头":2,"乌海":3,"赤峰":4,"通辽":5,"鄂尔多斯":6,"呼伦贝尔":7,"兴安盟":22,"锡林郭勒盟":25,"乌兰察布盟":26,"巴彦淖尔盟":28,"阿拉善盟":29}},"江苏":{code:32,city:{"南京":1,"无锡":2,"徐州":3,"常州":4,"苏州":5,"南通":6,"连云港":7,"淮安":8,"盐城":9,"扬州":10,"镇江":11,"泰州":12,"宿迁":13}},"江西":{code:36,city:{"南昌":1,"景德镇":2,"萍乡":3,"九江":4,"新余":5,"鹰潭":6,"赣州":7,"吉安":8,"宜春":9,"抚州":10,"上饶":11}},"吉林":{code:22,city:{"长春":1,"吉林":2,"四平":3,"辽源":4,"通化":5,"白山":6,"松原":7,"白城":8,"延边朝鲜族自治州":24}},"辽宁":{code:21,city:{"沈阳":1,"大连":2,"鞍山":3,"抚顺":4,"本溪":5,"丹东":6,"锦州":7,"营口":8,"阜新":9,"辽阳":10,"盘锦":11,"铁岭":12,"朝阳":13,"葫芦岛":14}},"宁夏":{code:64,city:{"银川":1,"石嘴山":2,"吴忠":3,"固原":4,"中卫":5}},"青海":{code:63,city:{"西宁":1,"海东":21,"海北":22,"黄南":23,"海南":25,"果洛":26,"玉树":27,"海西":28}},"山西":{code:14,city:{"太原":1,"大同":2,"阳泉":3,"长治":4,"晋城":5,"朔州":6,"晋中":7,"运城":8,"忻州":9,"临汾":10,"吕梁":23}},"山东":{code:37,city:{"济南":1,"青岛":2,"淄博":3,"枣庄":4,"东营":5,"烟台":6,"潍坊":7,"济宁":8,"泰安":9,"威海":10,"日照":11,"莱芜":12,"临沂":13,"德州":14,"聊城":15,"滨州":16,"菏泽":17}},"上海":{code:31,city:{"黄浦区":1,"卢湾区":3,"徐汇区":4,"长宁区":5,"静安区":6,"普陀区":7,"闸北区":8,"虹口区":9,"杨浦区":10,"闵行区":12,"宝山区":13,"嘉定区":14,"浦东新区":15,"金山区":16,"松江区":17,"青浦区":18,"南汇区":19,"奉贤区":20,"崇明县":30}},"四川":{code:51,city:{"成都":1,"自贡":3,"攀枝花":4,"泸州":5,"德阳":6,"绵阳":7,"广元":8,"遂宁":9,"内江":10,"乐山":11,"南充":13,"眉山":14,"宜宾":15,"广安":16,"达州":17,"雅安":18,"巴中":19,"资阳":20,"阿坝":32,"甘孜":33,"凉山":34}},"天津":{code:12,city:{"和平区":1,"河东区":2,"河西区":3,"南开区":4,"河北区":5,"红桥区":6,"塘沽区":7,"汉沽区":8,"大港区":9,"东丽区":10,"西青区":11,"津南区":12,"北辰区":13,"武清区":14,"宝坻区":15,"宁河县":21,"静海县":23,"蓟县":25}},"西藏":{code:54,city:{"拉萨":1,"昌都":21,"山南":22,"日喀则":23,"那曲":24,"阿里":25,"林芝":26}},"新疆":{code:65,city:{"乌鲁木齐":1,"克拉玛依":2,"吐鲁番":21,"哈密":22,"昌吉":23,"博尔塔拉":27,"巴音郭楞":28,"阿克苏":29,"克孜勒苏":30,"喀什":31,"和田":32,"伊犁":40,"塔城":42,"阿勒泰":43,"石河子":44}},"云南":{code:53,city:{"昆明":1,"曲靖":3,"玉溪":4,"保山":5,"昭通":6,"楚雄":23,"红河":25,"文山":26,"思茅":27,"西双版纳":28,"大理":29,"德宏":31,"丽江":32,"怒江":33,"迪庆":34,"临沧":35}},"浙江":{code:33,city:{"杭州":1,"宁波":2,"温州":3,"嘉兴":4,"湖州":5,"绍兴":6,"金华":7,"衢州":8,"舟山":9,"台州":10,"丽水":11}},"陕西":{code:61,city:{"西安":1,"铜川":2,"宝鸡":3,"咸阳":4,"渭南":5,"延安":6,"汉中":7,"榆林":8,"安康":9,"商洛":10}},"台湾":{code:71,city:{"台北":1,"高雄":2,"基隆":3,"台中":4,"台南":5,"新竹":6,"嘉义":7,"其他":90}},"香港":{code:81,city:{"香港":1}},"澳门":{code:82,city:{"澳门":1}},"海外":{code:400,city:{"美国":1,"英国":2,"法国":3,"俄罗斯":4,"加拿大":5,"巴西":6,"澳大利亚":7,"印尼":8,"泰国":9,"马来西亚":10,"新加坡":11,"菲律宾":12,"越南":13,"印度":14,"日本":15,"其他":16}},"其他":{code:100,city:{"不限":1e3}}};return b});
STK.register("common.filter.regionSelect",function(a){var b=a.common.filter.cityList;return function(c){var d,e,f,g,h,i,j,k,l;d=c.provDom;e=c.cityDom||null;f=c.provCode||0;g=c.cityCode||0;if(typeof d=="undefined"){throw"Lack of provDom -> path : common.search.regionSelect"}d.options.length=0;h=d.options;for(var m in b){h[h.length]=new Option(m,b[m]["code"]);if(b[m]["code"]==f){i=true}}if(i){d.value=f}else{d.value=0}var n=function(a,c){g=c?c:g;k=b[a]["city"];e.options.length=0;l=e.options;l[0]=new Option("不限",1e3);for(var d in k){l[l.length]=new Option(d,k[d]);if(k[d]==g){j=true}}if(j){e.value=g}else{if(f!=0){e.value=1e3}else{e.value=0}}};if(e){a.core.evt.addEvent(d,"change",function(){n(d.options[d.selectedIndex].text,1e3)});n(d.options[d.selectedIndex].text)}}});
STK.register("common.form.valueChange",function(a){var b={27:"esc",9:"tab",13:"enter",145:"scrolllock",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",17:"ctrl",16:"shift"};var c,d;return function(e,f){var g={delay:0,callback:a.core.func.empty};var h;f=a.parseParam(g,f);c=a.core.str.trim(e.value);var i=function(a){if(b[a]){return true}else{return false}};var j=function(){if(h){clearTimeout(h)}var b=a.core.evt.getEvent();var g=b.keyCode;d=a.core.str.trim(e.value);if(!i(g)&&d!=c){h=setTimeout(function(){f.callback();c=d;h=null},f.delay)}};a.core.evt.addEvent(e,"keyup",j)}});
STK.register("common.dialog.masterIframe",function(a){var b,c,d,e;b={create:function(f){if(a.core.util.browser.IE6){if(c){b.destroy(c)}d=a.core.dom.position(f);e={w:f.offsetWidth,h:f.offsetHeight};zindex=a.core.dom.getStyle(f,"zIndex");c=a.C("DIV");c.style.cssText="left:"+d.l+";top:"+d.t+";position:absolute;z-index:"+(zindex-1);c.innerHTML='<iframe frameborder="no" width="'+e.w+'px" height="'+e.h+'px"></iframe>';document.body.appendChild(c);return b}return b},getOuter:function(){return c},destroy:function(){try{document.body.removeChild(c)}catch(a){}c=null},setPosition:function(a){c.style.top=a["t"]+"px";c.style.left=a["l"]+"px";return b},setSize:function(a){c.style.width=a.w+"px";c.style.height=a.h+"px"}};return b});
STK.register("common.form.suggestInput",function(a){var b,c,d={},e,f,g,h,i,j,k,l,m,n,o,p={},q,r={},s;var t=false;return function(i,j){i=a.E(i);if(!i){throw"common.form.suggestInput : need el as a param"}var u="<#et tip data>"+"<ul>"+"<#list data as list>"+'<li action-type="suggestList"><a href="javascript:;" style="padding:5px 0; white-space:normal;"><span style="margin:0 5px;display:block;overflow:hidden;height:14px;">${list}</span></a></li>'+"</#list>"+"</ul>"+"</#et>";var v="T_"+a.core.util.getUniqueKey();b={url:"/Ajax_Search/suggest",template:u,left:0,top:0,width:0,focusback:a.core.func.empty,clickback:a.core.func.empty,blurback:a.core.func.empty,css:"",className:"s_suggest_box",focusclass:"current",args:{},key:"key",defaultText:"",nameSelector:null,dataBack:a.core.func.empty,offset:{top:0,left:0}};c=function(a,b){var c;for(c in b){a[c]=b[c]}return a};r[v]=c(b,j);m=a.core.evt.addEvent;n=a.core.evt.removeEvent;var w={listOver:function(b){g=0;var c=b.el;clearTimeout(e);if(k){a.core.dom.removeClassName(k,r[v].focusclass)}k=c;e=setTimeout(function(){a.core.dom.addClassName(c,r[v].focusclass)},20)},listOut:function(b){var c=b.el;clearTimeout(f);f=setTimeout(function(){a.core.dom.removeClassName(c,r[v].focusclass)},10)},clickItem:function(a){var b=a.el;r[v].clickback({el:b})},hotKey:function(a){var b=a||window.event;var c=b.keyCode;if(!g){g=0}switch(c){case 38:w.upKey();break;case 40:w.downKey();break;case 13:w.enterKey();default:break}},downKey:function(){if(g>0){a.core.dom.removeClassName(h[g-1],r[v].focusclass)}g++;if(g>=h.length+1){g=0;i.value=l}if(g>0){var b=h[g-1],c,d=r[v].nameSelector;a.core.dom.addClassName(b,r[v].focusclass);if(r[v].nameSelector){c=a.sizzle(d,b)[0].innerHTML.replace(/<[^>]+>/g,"")}else{c=p[q+"_"+v].data[g-1]}i.value=c;k=b}},upKey:function(){if(g>0){a.core.dom.removeClassName(h[g-1],r[v].focusclass)}g--;if(g<0){g=h.length}if(g>0){var b=h[g-1],c,d=r[v].nameSelector;a.core.dom.addClassName(b,r[v].focusclass);if(r[v].nameSelector){c=a.sizzle(d,b)[0].innerHTML.replace(/<[^>]+>/g,"")}else{c=p[q+"_"+v].data[g-1]}i.value=c;k=h[g-1]}else if(g<=0){i.value=l}},enterKey:function(){if(g-1<0){return}var a=h[g-1];r[v].clickback({el:a})},faceInit:function(b){r[v].dataBack(b);if(b.data.length==0){z.hide();return}tipHTML=a.core.util.easyTemplate(r[v].template,b.data);if(!d[v]){d[v]=a.C("DIV");document.body.appendChild(d[v]);d[v].className=r[v].className;var c=a.core.evt.delegatedEvent(d[v]);c.add("suggestList","mouseover",w.listOver);c.add("suggestList","mouseout",w.listOut);c.add("suggestList","click",w.clickItem);h=[]}d[v].style.cssText="left:"+((r[v].left?r[v].left:a.core.dom.position(i).l)+(r[v].offset.left||0))+"px;top:"+((r[v].top?r[v].top:a.core.dom.position(i).t+i.offsetHeight)+(r[v].offset.top||0))+"px;width:"+((r[v].width?r[v].width:i.offsetWidth)-4)+"px;position:absolute;"+r[v].css;d[v].innerHTML=tipHTML;s=a.common.dialog.masterIframe.create(d[v]);h=a.core.dom.sizzle('[action-type="suggestList"]',d[v]);g=0}};var x=function(){if(t){return}t=true;q=encodeURIComponent(i.value);if(typeof p[q+"_"+v]!="undefined"){w.faceInit(p[q+"_"+v]);t=false}else{r[v].args[r[v].key]=q;a.core.io.ajax({url:r[v].url,args:r[v].args,method:"get",responseType:"json",onComplete:function(a){if(a.code=="100000"){p[q+"_"+v]=a;w.faceInit(a)}t=false}})}};var y=function(){if(o){clearTimeout(o)}o=setTimeout(x,200)};var z={};z.hide=function(){if(d[v]){d[v].style.display="none";g=0;h=[];n(document.body,"click");n(i,"click");s.destroy()}};z.show=function(){if(a.core.str.bLength(a.core.str.trim(i.value))==0){z.hide();return}y();l=i.value;m(document.body,"click",z.hide)};a.core.evt.addEvent(window,"resize",function(){if(d[v]&&d[v].style.display!="none")d[v].style.cssText="left:"+(a.core.dom.position(i).l+r[v].offset.left+1)+"px;top:"+(a.core.dom.position(i).t+i.offsetHeight+r[v].offset.top-1)+"px;width:"+(r[v].width?r[v].width:i.offsetWidth)+"px;position:absolute;"+r[v].css});a.common.form.valueChange(i,{callback:z.show,delay:100});a.addEvent(i,"focus",function(){if(i.value==r[v].defaultText){i.value=""}});a.addEvent(i,"blur",function(){if(a.bLength(a.trim(i.value))==0){i.value=r[v].defaultText}window.setTimeout(function(){z.hide()},200)});m(i,"keydown",w.hotKey);m(i,"click",function(){a.core.evt.stopEvent()});return z}});
STK.register("common.dialog.advSearch",function(a){var b=a.lib.kit.extra.language;var c=a.core.dom.sizzle;var d=false;var e,f;var g=b("#L{请选择日期}");var h=20;var i=$CONFIG.pageid;var j='<div class="m-adv-search" node-type="outer">'+'<div node-type="inner"></div>'+'<div class="btn-box">'+'<a href="javascript:void(0);" class="s-btn-a" node-type="OK" suda-data="key=tblog_search_'+i+"&value="+i+'_profes_OK">#L{'+(i==="user"?"搜索":"搜索微博")+"}</a>"+'<a href="javascript:void(0);" node-type="cancel" suda-data="key=tblog_search_'+i+"&value="+i+'_profes_cancel">#L{取消}</a>'+"</div>"+"</div>";var k=null;var l=function(a,b,c){a.getDom("inner").innerHTML=b["innerStr"]};var m=function(a,b){for(var c in a){if(!a[c]){delete a[c]}else if(a[c]==b[c]){delete a[c]}}return a};var n=function(b){var c=["timescope","region"];for(var d in b){if(!a.inArray(d,c)){b[d]=encodeURIComponent(b[d])}}return b};return function(c){var i,o,p,q,r;i=a.parseParam({title:b("#L{高级搜索}"),OK:a.funcEmpty,cancel:a.funcEmpty,timeout:0,innerStr:"",defaultConfig:{}},c);o={};if(!k){k=a.lib.kit.extra.reuse(function(){var c=a.lib.module.layer(b(j));return c})}p=k.getOne();q=a.lib.ui.dialog();q.setContent(p.getOuter());q.setTitle(i["title"]);l(p,i,q);var s=function(){var b={};var c=[];var d=a.builder(p.getDom("inner")).list,e;a.foreach(d,function(a){if(e=a[0]){b[e.getAttribute("node-type")]=e;if(e.getAttribute("suggest")){c.push(e)}}});if(b.prov&&b.city){a.common.filter.regionSelect({provDom:b.prov,cityDom:b.city?b.city:null,provCode:b.prov.getAttribute("truevalue"),cityCode:b.city?b.city.getAttribute("truevalue"):0})}var f={url:"/Ajax_Search/suggest",clickback:function(){},focusclass:"cur",className:"layer_menu_list",css:"z-index:10002"};a.foreach(c,function(b,c){f.url="/Ajax_Search/suggest?where="+b.name;var d=a.common.form.suggestInput(b,a.parseParam(f,{clickback:function(a){b.value=a.el.getElementsByTagName("A")[0].getElementsByTagName("SPAN")[0].innerHTML;setTimeout(function(){d.hide()},100)}}))})};var t=function(){var c,d;var j=a.sizzle('input[type="checkbox"]',p.getDom("inner"));var k=a.core.util.htmlToJson(p.getDom("inner"));var l=m(k,i.defaultConfig);c=k.keyword?encodeURIComponent(k.keyword):$CONFIG["s_search"];delete k.keyword;if($CONFIG.pageid=="user"){var o=true;for(var r in k){if(k[r]){if(r=="auth"){continue}else if(r=="gender"){continue}else if(r=="prov"&&k[r]==0){continue}else if(r=="city"&&k[r]==0){continue}else if(r=="age"){continue}o=false;break}}if(o){a.lib.ui.alert(b("#L{请补充昵称、标签、学校、公司、地点中任意一项}"),{OK:function(){q.getOuter().style.display=""}});if(a.core.util.browser.IE6){q.getOuter().style.display="none"}return false}}if(k.prov&&k.prov!=0){k.region="custom:"+k.prov+":"+k.city;delete k.prov;delete k.city}if(k.prov==0){delete k.prov;delete k.city}if(k.xsort=="live"){delete k.xsort}if(k.auth=="all"){delete k.auth}if(k.age=="all"){delete k.age}if(k.type){if(k.type=="hot")k["xsort"]="hot";else if(k.type=="ori")k["scope"]="ori";else if(k.type=="category_4")k["category"]="4";else if(k.type=="category_5")k["category"]="5";else k[k.type]=1;delete k.type}if(k.sub){k[k.sub]=1;delete k.sub}if(k.userscope){if(k.userscope.length>=h){k.userscope=k.userscope.substr(0,h)}k.userscope="custom:"+k.userscope}if(k.stime||k.etime){k.stime=k.stime?k.stime:"";k.stime=k.stime==g?"":k.stime;k.etime=k.etime?k.etime:"";k.etime=k.etime==g?"":k.etime;if(k.stime||k.etime){k.timescope="custom:"+(k.stime?k.stime:"")+":"+(k.etime?k.etime:"");e=k.stime;f=k.etime}delete k.stime;delete k.etime}if(k.startHour||k.endHour){e+=k.startHour?"-"+k.startHour:"";f+=k.endHour?"-"+k.endHour:"";delete k.startHour;delete k.endHour;k.timescope="custom:"+e+":"+f}if(k.tag||k.school||k.work||k.nickname){c=""}if(k.nickname){if(k.nickname.length>=h){k.nickname=k.nickname.substr(0,h)}}var s=a.core.json.jsonToQuery(n(k));if(s){s="&"+s}var t=location.href;$CONFIG.pageid=="user"?c="":c=c;if(window.location.href.indexOf("/weibo/")>-1||window.location.href.indexOf("user")>-1||window.location.href.indexOf("/wb/")>-1){if(t.indexOf("?")>0){var u=t.substr(0,t.lastIndexOf("?"))+"?q="+c+s+"&Refer=g"}else{var u=t.substr(0,t.lastIndexOf("/"))+"?q="+c+s+"&Refer=g"}}else{var v=a.sizzle("[node-type=work]")[0];if(!v){if(!!c==false){a.lib.ui.alert(b("#L{请输入关键词}"),{OK:function(){q.getOuter().style.display=""}});if(a.core.util.browser.IE6){q.getOuter().style.display="none"}return}u=t.substr(0,t.lastIndexOf("/")+1)+"weibo?q="+c+s+"&Refer=g"}else if(v){c="";if(!k.nickname&&!k.tag&&!k.school&&!k.work&&!k.region&&!k.age){a.lib.ui.alert(b("#L{请输入至少一个搜索条件}"),{OK:function(){q.getOuter().style.display=""}});if(a.core.util.browser.IE6){q.getOuter().style.display="none"}return}u=t.substr(0,t.lastIndexOf("/")+1)+"user?q="+c+s+"&Refer=g"}}var w=u.replace(/(top\/|list\/)/,"");setTimeout(function(){window.location.href=w},0);q.hide()};if(!d){d=true;a.addEvent(p.getDom("OK"),"click",t)}a.addEvent(p.getDom("cancel"),"click",q.hide);a.custEvent.add(q,"hide",function(){a.custEvent.remove(q,"hide",arguments.callee);a.removeEvent(p.getDom("OK"),"click",q.hide);k.setUnused(p);clearTimeout(r);i["OK"]()});if(i["timeout"]){r=setTimeout(q.hide,i["timeout"])}q.show().setMiddle();s();o.alt=p;o.dia=q;return o}});
STK.register("common.filter.advSearch",function(a){return function(b,c){var d=a.lib.kit.extra.language;var e={};var f=[],g,h,i,j,k="",l=d("#L{请选择日期}"),m,n,o,p,q;var r={typeall:"",suball:"",xsort:"",vip:"",atten:"",haspic:"",hasvideo:"",userscope:"",scope:"",stime:"",etime:"",prov:0,city:0,hasvideo:0,hasmusic:0,haslink:0,startHour:"",endHour:"",category:"",viewpoint:"",discuss:""};var s=d("<#et weibo data>"+'<dl class="clearfix">'+"<dt>#L{关键词}：</dt>"+"<dd>"+'<input type="text" value="#myValue#" class="txt" name="keyword"/>'+"</dd>"+"</dl>"+'<dl class="clearfix"><dt>#L{类型}：</dt><dd>'+'<label for="radio01"><input type="radio" name="type" checked ${data.typeall == 1 ? ("checked=checked"): ""} value="typeall" id="radio01" >#L{全部}</label>'+'<label for="radio02"><input type="radio" name="type" ${data.xsort ==  "hot"? ("checked=checked"): ""} value="hot" id="radio02" >#L{热门}</label>'+'<label for="radio03"><input type="radio" name="type" ${data.scope == "ori" ? ("checked=checked"): ""} value="ori" id="radio03" >#L{原创}</label>'+'<label for="radio04"><input type="radio" name="type" ${data.atten == 1 ? ("checked=checked"): ""} value="atten" id="radio04" >#L{关注人}</label>'+'<label for="radio05"><input type="radio" name="type" ${data.vip == 1 ? ("checked=checked"): ""} value="vip" id="radio05" >#L{认证用户}</label>'+'<label for="radio07"><input type="radio" name="type" ${data.category == 4 ? ("checked=checked"): ""} value="category_4" id="radio07" >#L{媒体}</label>'+'<label for="radio08"><input type="radio" name="type" ${data.viewpoint == 1 ? ("checked=checked"): ""} value="viewpoint" id="radio08" >#L{观点}</label>'+'<label for="radio09" style="display:none;"><input type="radio" name="type" ${data.discuss == 1 ? ("checked=checked"): ""} value="discuss" id="radio09" >#L{网友讨论}</label>'+"</dd></dl>"+'<dl class="clearfix"><dt>#L{包含}：</dt><dd>'+'<label for="radio_sub1"><input name="sub" type="radio" checked ${data.suball == 1 ? ("checked=checked"): ""} value="suball" id="radio_sub1" />#L{全部}</label>'+'<label for="radio_sub2"><input name="sub" type="radio" ${data.haspic == 1 ? ("checked=checked"): ""} value="haspic" id="radio_sub2" />#L{含图片}</label>'+'<label for="radio_sub3"><input name="sub" type="radio" ${data.hasvideo == 1 ? ("checked=checked"): ""} value="hasvideo" id="radio_sub3" />#L{含视频}</label>'+'<label for="radio_sub4"><input name="sub" type="radio" ${data.hasmusic == 1 ? ("checked=checked"): ""} value="hasmusic" id="radio_sub4" />#L{含音乐}</label>'+'<label for="radio_sub5"><input name="sub" type="radio" ${data.haslink == 1 ? ("checked=checked"): ""} value="haslink" id="radio_sub5" />#L{含短链}</label></dd></dl>'+'<dl class="time clearfix">'+"<dt>#L{时间}：</dt>"+'<dd><input type="text" readonly="true" value="${data.stime}" node-type="stime" name="stime" action-type="time" style="vertical-align: middle;" />'+($CONFIG.lang!="en-us"?'<select isFirst=1 name="startHour" action-type="selectHour" node-type="startHour"><option value="">#L{选择时间}</option></select>':"")+"#L{至  }"+'<input type="text" readonly="true" value="${data.etime}"  action-type="time" name="etime" node-type="etime" style="vertical-align: middle;" />'+($CONFIG.lang!="en-us"?'<select isFirst=1 name="endHour" action-type="selectHour" node-type="endHour"><option value="">#L{选择时间}</option></select></dd>':"")+"</dl>"+($CONFIG.lang!="en-us"?'<dl class="clearfix"><dt>#L{地点}：</dt>'+'<dd><select name="prov" node-type="prov" truevalue="${data.prov}"><option></option></select>'+'<select name="city" node-type="city" truevalue="${data.city}"><option></option></select></dd></dl>':"")+"</#et>");var t={};var u={adv_search:function(){var b=a.common.filter.getConfig;var c=b.htmlspecialchars(b.s_search($CONFIG["s_search"]));h=a.common.dialog.advSearch({innerStr:a.core.util.easyTemplate(s,g).toString().replace("#myValue#",c),defaultConfig:{},title:"微博高级搜索",OK:function(a){}});if(a.core.util.browser.IE6){a.custEvent.add(h.dia,"hide",function(){a.core.evt.fireEvent(document.body,"click")})}if(!i){i=true;j=a.sizzle('[node-type="attentDD"]',h.dia.getInner())[0];var e=a.delegatedEvent(h.dia.getInner());e.add("byTime","click",u.byTime);e.add("byHot","click",u.byHot);e.add("bySocail","click",u.bySocail);e.add("selectHour","click",u.selectHour);e.add("time","click",u.show_date)}m=a.sizzle('[node-type="startHour"]',h.dia.getInner())[0];n=a.sizzle('[node-type="endHour"]',h.dia.getInner())[0];o=a.sizzle('[node-type="stime"]',h.dia.getInner())[0];p=a.sizzle('[node-type="etime"]',h.dia.getInner())[0];if(m){for(var f=0;f<24;f++){m[f+1]=new Option(f+d("#L{时}"),f);n[f+1]=new Option(f+d("#L{时}"),f)}if(g.startHour){m.options[parseInt(g.startHour)+1].selected=true}if(g.endHour){n.options[parseInt(g.endHour)+1].selected=true}if(!g.stime||g.stime==l){m.disabled=true}if(!g.etime||g.etime==l){n.disabled=true}}},bySocail:function(){j.style.display="";j.getElementsByTagName("INPUT")[0].checked=false},byHot:function(){j=a.sizzle('[node-type="attentDD"]',h.dia.getInner())[0];j.style.display="none";j.getElementsByTagName("INPUT")[0].checked=false},byTime:function(){j.style.display="";j.getElementsByTagName("INPUT")[0].checked=false},selectHour:function(b){var c=b.el;if(c.getAttribute("node-type")=="startHour"){if(!o.value){a.common.extra.shine(o)}}else{if(!p.value){a.common.extra.shine(p)}}},show_date:function(b){if(b.el.value==l){b.el.value=""}var c=new a.common.filter.calendar(b.el.value,{source:b.el,callback:function(){if(b.el.value){if(m){b.el.getAttribute("node-type")=="stime"?m.disabled=false:n.disabled=false}}}})}};var v={};var w={};var x=function(){y();z();A();B();C();D();E()};var y=function(){if(!b)throw"[pl_advsearchWeibo] : missing  -> path : common.filter.advsearchWeibo";c=a.core.obj.parseParam({html:""},c)};var z=function(){var c=a.builder(b).list,d;a.foreach(c,function(a){if(d=a[0]){f[d.getAttribute("node-type")]=d}})};var A=function(){g=a.common.filter.parseSearchParam();g=a.core.obj.parseParam(r,g);g.stime?g.stime=g.stime:g.stime=l;g.etime?g.etime=g.etime:g.etime=l};var B=function(){};var C=function(){a.core.evt.addEvent(b,"click",u.adv_search)};var D=function(){};var E=function(){};var F=function(){a.core.evt.removeEvent(b,"click",u.adv_search)};x();e.destroy=F;e.eventHandler=u.adv_search;return e}});
STK.register("pl.feedlist.weibo",function(a){return function(b,c){var d={};var e;var f={stopicFollow:function(b){var c=b.data;a.common.trans.global.getTrans("followTopic",{onSuccess:function(d,e){var f="";if(c.align){f='<a href="javascript:void(0);" class="s-btn-c s-fr"><i class="wbicon">Y</i>已关注</a>'}else{f='<a href="javascript:void(0);" class="s-btn-c"><i class="wbicon">Y</i>已关注</a>'}a.core.dom.insertHTML(b.el.parentNode,f,"beforeend");a.core.dom.removeNode(b.el)},onError:function(b){a.lib.ui.alert(b.msg)}}).request({object_id:c.id})},initPageRecord:function(){var c={};var d=a.sizzle('[action-type="feed_list_item"]',b);if(d.length){for(var e=0,f=d.length;e<f;e++){var g=d[e].getAttribute("url_show");var h=d[e].getAttribute("type");if(g!=""&&h=="C2S"){var i=new Image;i.src=decodeURIComponent(g).replace("[timestamp]",+(new Date))}}}}};var g=function(){h();i();j();k()};var h=function(){if(!b)throw"path : pl.feedlist.weibo"};var i=function(){nodes={feed_list:a.sizzle("[node-type=feed_list]",b),textEl:a.sizzle("[node-type=textEl]",b)[0],advsearch:a.sizzle("[node-type=advsearch]",b)[0]}};var j=function(){a.pl.feedlist.newLike(b);a.common.feed.feedList.simpleFeedList(b);f.initPageRecord();if(nodes.advsearch){a.common.filter.advSearch(nodes.advsearch)}if(nodes.textEl){a.pl.feedlist.sendweibo(b)}};var k=function(){var c=a.core.evt.delegatedEvent(b);c.add("stopic_follow","click",f.stopicFollow)};var l=function(){};g();d.destory=l;return d}});
STK.pageletM.register("pl.feedlist.index",function(a){var b=a.E("pl_feedlist_index");if(b){return a.pl.feedlist.weibo(b)}});
STK.pageletM.start();
