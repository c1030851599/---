STK.register("lib.kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a){c[d]=a[d]}for(var d in b){c[d]=b[d]}return c}});
STK.register("lib.kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b["args"];if(e["__rnd"]){delete e["__rnd"]}(new Image).src="//weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b["url"])+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d,e,f,g,h,i,j;i=function(a){h=false;c.onComplete(a,d["args"]);setTimeout(k,0)};j=function(a){h=false;if(typeof c.onFail==="function"){c.onFail(a,d["args"])}setTimeout(k,0);try{b(d)}catch(e){}};f=[];g=null;h=false;d=a.parseParam({url:"",method:"get",responseType:"json",timeout:30*1e3,onTraning:a.funcEmpty,isEncode:true},c);d["onComplete"]=i;d["onFail"]=j;d["onTimeout"]=function(){try{b(d)}catch(a){}};var k=function(){if(!f.length){return}if(h===true){return}h=true;d.args=f.shift();if(d.method.toLowerCase()=="post"){var b=a.core.util.URL(d.url);b.setParam("__rnd",(new Date).valueOf());d.url=b.toString()}g=a.ajax(d)};var l=function(a){while(f.length){f.shift()}h=false;if(g){try{g.abort()}catch(b){}}g=null};e={};e.request=function(a){if(!a){a={}}if(c["noQueue"]){l()}if(!c["uniqueRequest"]||!g){f.push(a);a["_t"]=0;k()}};e.abort=l;return e}});
STK.register("lib.kit.io.jsonp",function(a){return function(b){var c,d,e,f,g;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:30*1e3,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:true},b);e=[];f={};g=false;var h=function(){if(!e.length){return}if(g===true){return}g=true;f.args=e.shift();f.onComplete=function(a){g=false;c.onComplete(a,f["args"]);setTimeout(h,0)};f.onFail=function(a){g=false;c.onFail(a);setTimeout(h,0)};a.jsonp(a.lib.kit.extra.merge(c,{args:f.args,onComplete:function(a){f.onComplete(a)},onFail:function(a){try{f.onFail(a)}catch(b){}}}))};d={};d.request=function(a){if(!a){a={}}e.push(a);a["_t"]=1;h()};d.abort=function(a){while(e.length){e.shift()}g=false;f=null};return d}});
STK.register("lib.kit.io.inter",function(a){return function(){var b,c,d;b={};c={};d={};b.register=function(a,b){if(c[a]!==undefined){throw a+" interface has been registered"}c[a]=b;d[a]={}};b.hookComplete=function(b,c){var e=a.core.util.getUniqueKey();d[b][e]=c;return e};b.removeHook=function(a,b){if(d[a]&&d[a][b]){delete d[a][b]}};b.getTrans=function(b,e){var f=a.lib.kit.extra.merge(c[b],e);f.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a["code"]==="100000"){try{e.onSuccess(a,c)}catch(f){}}else{try{if(a["code"]==="100002"){window.location.href=a["data"];return}e.onError(a,c)}catch(f){}}for(var g in d[b]){try{d[b][g](a,c)}catch(f){}}};if(c[b]["requestMode"]==="jsonp"){return a.lib.kit.io.jsonp(f)}else if(c[b]["requestMode"]==="ijax"){return a.lib.kit.io.ijax(f)}else{return a.lib.kit.io.ajax(f)}};b.request=function(b,e,f){var g=a.core.json.merge(c[b],e);g.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a["code"]==="100000"){try{e.onSuccess(a,c)}catch(f){}}else{try{if(a["code"]==="100002"){window.location.href=a["data"];return}e.onError(a,c)}catch(f){}}for(var g in d[b]){try{d[b][g](a,c)}catch(f){}}};g=a.core.obj.cut(g,["noqueue"]);g.args=f;if(c[b]["requestMode"]==="jsonp"){return a.jsonp(g)}else if(c[b]["requestMode"]==="ijax"){return a.ijax(g)}else{return a.ajax(g)}};return b}});
STK.register("common.trans.global",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("add",{url:"/ajax_User/follow",method:"post"});c("del",{url:"/ajax_User/unfollow",method:"post"});c("addgroup",{url:"/ajax_User/addgroup",method:"post"});c("setgroup",{url:"/ajax_User/addUserToGroup",method:"post"});c("listgroup",{url:"/ajax/user/GroupList",method:"get"});c("followTopic",{url:"/Ajax_object/stopicFollow",method:"post"});c("followList",{url:"/Ajax_Search/suggest",method:"get"});c("publish",{url:"/Ajax_Mblog/publish",method:"post"});c("share",{url:"/ajax/mblog/searchshare",method:"post"});c("topshare",{url:"/ajax/mblog/searchshare",method:"post"});c("upcover",{url:"/ajax/claim/uploadpic",method:"post"});c("commitcover",{url:"/ajax/claim/Setinfo",method:"post"});c("weiboActs",{url:"/ajax/claim/topicweibo",method:"get"});c("weibotop",{url:"/ajax/claim/shield",method:"get"});c("setAD",{url:"/aj/proxy/adclickserve",method:"post"});c("setADMonitor",{url:"/aj/proxy/monitor",method:"post"});c("adDeal",{url:"/aj/ad/deal",method:"post"});c("playstatistics",{url:"/aj/video/playstatistics",method:"post"});c("playInteractLog",{url:"/aj/log/h5playlog",method:"post"});c("newVideoUrl",{url:"/aj/mblog/videourl",method:"get"});c("third_rend",{url:"/aj/mblog/renderfeed",method:"post"});return b});
STK.register("lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});var b=function(a,b){var c=[];for(var d=2,e=arguments.length;d<e;d+=1){c.push(arguments[d])}return a.replace(/#L\{((.*?)(?:[^\\]))\}/ig,function(){var a=arguments[1];var d;if(b&&b[a]!==undefined){d=b[a]}else{d=a}if(c.length){d=d.replace(/(\%s)/ig,function(){var a=c.shift();if(a!==undefined){return a}else{return arguments[0]}})}return d})};return function(a){var c=[].splice.call(arguments,1,arguments.length);var d=[a,$LANG].concat(c);var e=b.apply(this,d);return e}});
STK.register("lib.kit.dom.parseDOM",function(a){return function(a){for(var b in a){if(a[b]&&a[b].length==1){a[b]=a[b][0]}}return a}});
STK.register("lib.kit.extra.reuse",function(a){return function(b,c){var d,e,f;d=a.parseParam({},c);f=[];var g=function(){var a=b();f.push({store:a,used:true});return a};var h=function(b){a.foreach(f,function(a,c){if(b===a["store"]){a["used"]=true;return false}})};var i=function(b){a.foreach(f,function(a,c){if(b===a["store"]){a["used"]=false;return false}})};var j=function(){for(var a=0,b=f.length;a<b;a+=1){if(f[a]["used"]===false){f[a]["used"]=true;return f[a]["store"]}}return g()};e={};e.setUsed=h;e.setUnused=i;e.getOne=j;e.getLength=function(){return f.length};return e}});
STK.register("lib.module.layer",function(a){var b=function(a){var b={};if(a.style.display=="none"){a.style.visibility="hidden";a.style.display="";b.w=a.offsetWidth;b.h=a.offsetHeight;a.style.display="none";a.style.visibility="visible"}else{b.w=a.offsetWidth;b.h=a.offsetHeight}return b};var c=function(c,d){d=d||"topleft";var e=null;if(c.style.display=="none"){c.style.visibility="hidden";c.style.display="";e=a.core.dom.position(c);c.style.display="none";c.style.visibility="visible"}else{e=a.core.dom.position(c)}if(d!=="topleft"){var f=b(c);if(d==="topright"){e["l"]=e["l"]+f["w"]}else if(d==="bottomleft"){e["t"]=e["t"]+f["h"]}else if(d==="bottomright"){e["l"]=e["l"]+f["w"];e["t"]=e["t"]+f["h"]}}return e};return function(d){var e=a.core.dom.builder(d);var f=e.list["outer"][0],g=e.list["inner"][0];var h=a.core.dom.uniqueID(f);var i={};var j=a.core.evt.custEvent.define(i,"show");a.core.evt.custEvent.define(j,"hide");var k=null;i.show=function(){f.style.display="";a.core.evt.custEvent.fire(j,"show");return i};i.hide=function(){f.style.display="none";a.custEvent.fire(j,"hide");return i};i.getPosition=function(a){return c(f,a)};i.getSize=function(a){if(a||!k){k=b.apply(i,[f])}return k};i.html=function(a){if(a!==undefined){g.innerHTML=a}return g.innerHTML};i.text=function(b){if(text!==undefined){g.innerHTML=a.core.str.encodeHTML(b)}return a.core.str.decodeHTML(g.innerHTML)};i.appendChild=function(a){g.appendChild(a);return i};i.getUniqueID=function(){return h};i.getOuter=function(){return f};i.getInner=function(){return g};i.getParentNode=function(){return f.parentNode};i.getDomList=function(){return e.list};i.getDomListByKey=function(a){return e.list[a]};i.getDom=function(a,b){if(!e.list[a]){return false}return e.list[a][b||0]};i.getCascadeDom=function(b,c){if(!e.list[b]){return false}return a.core.dom.cascadeNode(e.list[b][c||0])};return i}});
STK.register("lib.module.dialog",function(a){return function(b,c){if(!b){throw"module.dialog need template as first parameter"}var d,e,f,g,h,i,j,k,l,m,n,o;l=true;var p=function(){if(l!==false){e.hide()}};var q=function(){d=a.parseParam({t:null,l:null,width:null,height:null},c);e=a.lib.module.layer(b,d);g=e.getOuter();h=e.getDom("title");k=e.getDom("title_content");i=e.getDom("inner");j=e.getDom("close");a.addEvent(j,"click",function(b){a.preventDefault(b);n();return false});a.custEvent.add(e,"show",function(){a.hotKey.add(document.documentElement,["esc"],p,{type:"keyup",disableInInput:true})});a.custEvent.add(e,"hide",function(){a.hotKey.remove(document.documentElement,["esc"],p,{type:"keyup"});l=true})};q();o=a.objSup(e,["show","hide"]);n=function(b){if(typeof m==="function"&&!b){if(m()===false){return false}}o.hide();if(a.contains(document.body,e.getOuter())){document.body.removeChild(e.getOuter())}return f};f=e;f.show=function(){if(!a.contains(document.body,e.getOuter())){document.body.appendChild(e.getOuter())}o.show();return f};f.hide=n;f.setPosition=function(a){g.style.top=a["t"]+"px";g.style.left=a["l"]+"px";return f};f.setMiddle=function(){var b=a.core.util.winSize();var c=e.getSize(true);g.style.top=a.core.util.scrollPos()["top"]+(b.height-c.h)/2+"px";g.style.left=(b.width-c.w)/2+"px";return f};f.setTitle=function(a){k.innerHTML=a;return f};f.setContent=function(a){if(typeof a==="string"){i.innerHTML=a}else{i.appendChild(a)}return f};f.clearContent=function(){while(i.children.length){a.removeNode(i.children[0])}return f};f.setAlign=function(){};f.setBeforeHideFn=function(a){m=a};f.clearBeforeHideFn=function(){m=null};f.unsupportEsc=function(){l=false};f.supportEsc=function(){l=true};return f}});
STK.register("lib.kit.dom.fix",function(a){function f(c,e,f){if(!d(c))return;var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.core.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){if(h<o)h=o;if(i<p)i=p}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++){if(typeof b[c]!="number")b[c]=0}return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=true,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){if(!b){b&&a.core.evt.removeEvent(window,"scroll",n)}a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);if(k&&(!b||i=="c")){f(d,i,j)}}if(!b){a.core.evt.addEvent(window,"scroll",n)}a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("lib.module.mask",function(a){function k(b){var c;if(!(c=b.getAttribute(f))){b.setAttribute(f,c=a.getUniqueKey())}return">"+b.tagName.toLowerCase()+"["+f+'="'+c+'"]'}function j(){b=a.C("div");var c='<div node-type="outer">';if(a.core.util.browser.IE6){}c+="</div>";b=a.builder(c).list["outer"][0];document.body.appendChild(b);e=true;d=a.lib.kit.dom.fix(b,"lt");var f=function(){var c=a.core.util.winSize();b.style.cssText=a.core.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+"px").getCss()};i.add(d,"beforeFix",f);f()}var b,c=[],d,e=false,f="STK-Mask-Key";var g=a.core.dom.setStyle,h=a.core.dom.getStyle,i=a.core.evt.custEvent;var l={getNode:function(){return b},show:function(c,f){if(e){c=a.core.obj.parseParam({opacity:.3,background:"#000000"},c);b.style.background=c.background;g(b,"opacity",c.opacity);b.style.opacity=c.opacity;b.style.display="";d.setAlign("lt");f&&f()}else{j();l.show(c,f)}return l},hide:function(){b.style.display="none";nowIndex=undefined;c=[];return l},showUnderNode:function(d,e){if(a.isNode(d)){l.show(e,function(){g(b,"zIndex",h(d,"zIndex"));var e=k(d);var f=a.core.arr.indexOf(c,e);if(f!=-1){c.splice(f,1)}c.push(e);a.core.dom.insertElement(d,b,"beforebegin")})}return l},back:function(){if(c.length<1){return l}var d,e;c.pop();if(c.length<1){l.hide()}else if((e=c[c.length-1])&&(d=a.sizzle(e,document.body)[0])){g(b,"zIndex",h(d,"zIndex"));a.core.dom.insertElement(d,b,"beforebegin")}else{l.back()}return l},destroy:function(){i.remove(d);b.style.display="none";lastNode=undefined;_cache={}}};return l});
STK.register("lib.kit.dom.drag",function(a){return function(b,c){var d,e,f,g,h,i,j,k;var l=function(){m();n()};var m=function(){d=a.parseParam({moveDom:b,perchStyle:"border:solid #999999 2px;",dragtype:"perch",actObj:{},pagePadding:5},c);f=d.moveDom;e={};g={};h=a.drag(b,{actObj:d.actObj});if(d["dragtype"]==="perch"){i=a.C("div");j=false;k=false;f=i}b.style.cursor="move"};var n=function(){a.custEvent.add(d.actObj,"dragStart",o);a.custEvent.add(d.actObj,"dragEnd",p);a.custEvent.add(d.actObj,"draging",q)};var o=function(c,e){document.body.style.cursor="move";var f=a.core.util.pageSize()["page"];g=a.core.dom.position(d.moveDom);g.pageX=e.pageX;g.pageY=e.pageY;g.height=d.moveDom.offsetHeight;g.width=d.moveDom.offsetWidth;g.pageHeight=f["height"];g.pageWidth=f["width"];if(d["dragtype"]==="perch"){var h=[];h.push(d["perchStyle"]);h.push("position:absolute");h.push("z-index:"+(d.moveDom.style.zIndex+10));h.push("width:"+d.moveDom.offsetWidth+"px");h.push("height:"+d.moveDom.offsetHeight+"px");h.push("left:"+g["l"]+"px");h.push("top:"+g["t"]+"px");i.style.cssText=h.join(";");k=true;setTimeout(function(){if(k){document.body.appendChild(i);j=true}},100)}if(b.setCapture!==undefined){b.setCapture()}};var p=function(a,c){document.body.style.cursor="auto";if(b.setCapture!==undefined){b.releaseCapture()}if(d["dragtype"]==="perch"){k=false;d.moveDom.style.top=i.style.top;d.moveDom.style.left=i.style.left;if(j){document.body.removeChild(i);j=false}}};var q=function(a,b){var c=g.t+(b.pageY-g.pageY);var e=g.l+(b.pageX-g.pageX);var h=c+g["height"];var i=e+g["width"];var j=g["pageHeight"]-d["pagePadding"];var k=g["pageWidth"]-d["pagePadding"];if(h<j&&c>0){f.style.top=c+"px"}else{if(c<0){f.style.top="0px"}if(h>=j){f.style.top=j-g["height"]+"px"}}if(i<k&&e>0){f.style.left=e+"px"}else{if(e<0){f.style.left="0px"}if(i>=k){f.style.left=k-g["width"]+"px"}}};l();e.destroy=function(){document.body.style.cursor="auto";if(typeof f.setCapture==="function"){f.releaseCapture()}if(d["dragtype"]==="perch"){k=false;if(j){document.body.removeChild(i);j=false}}a.custEvent.remove(d.actObj,"dragStart",o);a.custEvent.remove(d.actObj,"dragEnd",p);a.custEvent.remove(d.actObj,"draging",q);if(h.destroy){h.destroy()}d=null;f=null;g=null;h=null;i=null;j=null;k=null};e.getActObj=function(){return d.actObj};return e}});
STK.register("lib.ui.dialog",function(a){var b=""+'<div class="m-layer" node-type="outer" style="position:absolute;z-index:10000000">'+'<div class="header">'+'<h6 class="title" node-type="title"><span node-type="title_content"></span></h6>'+'<a href="javascript:void(0);" class="wbicon close" node-type="close">X</a>'+"</div>"+'<div class="inner" node-type="inner">'+"</div>"+"</div>";var c=a.lib.kit.extra.language;var d=null,e;var f=function(){var b=a.lib.module.dialog(c(e["template"]));a.custEvent.add(b,"show",function(){a.lib.module.mask.showUnderNode(b.getOuter())});a.custEvent.add(b,"hide",function(){a.lib.module.mask.back();b.setMiddle()});a.lib.kit.dom.drag(b.getDom("title"),{actObj:b,moveDom:b.getOuter()});b.destroy=function(){g(b);try{b.hide(true)}catch(a){}};return b};var g=function(a){a.setTitle("").clearContent();d.setUnused(a)};return function(c){e=a.parseParam({template:b,isHold:false},c);var h=e["isHold"];e=a.core.obj.cut(e,["isHold"]);if(!d){d=a.lib.kit.extra.reuse(f)}var i=d.getOne();if(!h){a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);g(i)})}return i}});
STK.register("lib.ui.alert",function(a){var b='<div class="m-confirm" node-type="outer">'+'<p class="para" node-type="inner"><i class="" node-type="icon"></i><span node-type="textLarge"></span></p>'+'<div class="btn-box">'+'<a href="javascript:void(0)" class="s-btn-a" node-type="OK"></a>'+"</div>"+"</div>";var c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon-ques"};var d=a.lib.kit.extra.language;var e=null;var f=function(a,b){a.getDom("icon").className=b["icon"];a.getDom("textLarge").innerHTML=b["textLarge"];a.getDom("textSmall").innerHTML=b["textSmall"];a.getDom("OK").innerHTML="<span>"+b["OKText"]+"</span>"};return function(g,h,i){var j,k,l,m,n;j=a.parseParam({title:d("#L{提示}"),icon:"warn",textLarge:g,textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),timeout:0},h);j["icon"]=c[j["icon"]];k={};if(!e){e=a.lib.kit.extra.reuse(function(){var c=a.lib.module.layer(d(b));return c})}l=e.getOne();m=a.lib.ui.dialog();m.setContent(l.getOuter());m.setTitle(j["title"]);f(l,j);var o=function(b){m.is_closed=b.target.parentNode.getAttribute("node-type");a.preventDefault(b);m.hide()};a.addEvent(l.getDom("OK"),"click",o);a.custEvent.add(m,"hide",function(){a.custEvent.remove(m,"hide",arguments.callee);a.removeEvent(l.getDom("OK"),"click",o);e.setUnused(l);clearTimeout(n);m.is_closed=="OK"?j["OK"]():i[0].innerHTML=d("#L{评论}")});if(j["timeout"]){n=setTimeout(m.hide,j["timeout"])}m.show().setMiddle();k.alt=l;k.dia=m;return k}});
STK.register("common.trans.validateCode",function(a){var b=a.lib.kit.io.inter();var c="/ajax/";var d=b.register;d("checkAnswer",{url:c+"pincode/verified?",method:"post"});return b});
STK.register("lib.kit.io.cssLoader",function(a){var b="";var c="//img.t.sinajs.cn/t4/";var d="//timg.sjs.sinajs.cn/t4/";if(typeof $CONFIG!="undefined"){c=$CONFIG.cssPath||c;b=$CONFIG["version"]||""}var e={};return function(f,g,h,i,j){i=i||b;h=h||function(){};var k=function(a,b){var c=e[a]||(e[a]={loaded:false,list:[]});if(c.loaded){b(a);return false}c.list.push(b);if(c.list.length>1){return false}return true};var l=function(a){var b=e[a].list;for(var c=0;c<b.length;c++){b[c](a)}e[a].loaded=true;delete e[a].list};if(!k(f,h))return;var m;if(j){m=d+f}else{m=c+f+"?version="+i}var n=a.C("link");n.setAttribute("rel","Stylesheet");n.setAttribute("type","text/css");n.setAttribute("charset","utf-8");n.setAttribute("href",m);document.getElementsByTagName("head")[0].appendChild(n);var o=a.C("div");o.id=g;a.core.util.hideContainer.appendChild(o);var p=3e3;var q=function(){if(parseInt(a.core.dom.getStyle(o,"height"))==42){a.core.util.hideContainer.removeChild(o);l(f);return}if(--p>0){setTimeout(q,10)}else{a.log(f+"timeout!");a.core.util.hideContainer.removeChild(o);delete e[f]}};setTimeout(q,50)}});
STK.register("lib.ui.confirm",function(a){var b='<div class="m-confirm" node-type="outer">'+'<p class="para" node-type="inner"><i class="" node-type="icon"></i><span node-type="textLarge"></span><span node-type="textComplex"></span>'+'<span node-type="textSmall"></span></p>'+'<div class="btn-box">'+'<a href="javascript:void(0)" class="s-btn-a" node-type="OK"></a>'+'<a href="javascript:void(0)" node-type="cancel"></a>'+"</div>"+"</div>";var c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon-ques"};var d=a.lib.kit.extra.language;var e=null;return function(f,g){var h,i,j,k,l,m;h=a.parseParam({title:d("#L{提示}"),icon:"question",textLarge:f,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),cancel:a.funcEmpty,cancelText:d("#L{取消}")},g);h["icon"]=c[h["icon"]];i={};if(!e){e=a.lib.kit.extra.reuse(function(){var c=a.lib.module.layer(b);return c})}j=e.getOne();k=a.lib.ui.dialog();k.setContent(j.getOuter());j.getDom("icon").className=h["icon"];j.getDom("textLarge").innerHTML=h["textLarge"];j.getDom("OK").innerHTML=h["OKText"];j.getDom("cancel").innerHTML=h["cancelText"];k.setTitle(h["title"]);var n=function(){l=true;m=a.htmlToJson(j.getDom("textComplex"));k.hide()};a.addEvent(j.getDom("OK"),"click",n);a.addEvent(j.getDom("cancel"),"click",k.hide);a.custEvent.add(k,"hide",function(){a.custEvent.remove(k,"hide",arguments.callee);a.removeEvent(j.getDom("OK"),"click",n);a.removeEvent(j.getDom("cancel"),"click",k.hide);e.setUnused(j);if(l){h["OK"](m)}else{h["cancel"](m)}});k.show().setMiddle();i.cfm=j;i.dia=k;return i}});
STK.register("common.dialog.authentication",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.core.util.browser;b=a.parseParam({src:"//weibo.com/a/verify/realname?stage=home_verification&from=search",icon:"warn",isHold:true,width:"380px",height:"240px",title:c("#L{帐号验证}")},b||{});var e={},f,g,h=false;var i="tblog_checkfailed_reform";var j={init:function(){!(d.IE6||d.IE7)&&(window.document.domain="weibo.com");f=a.lib.ui.dialog(b);var c=[];c.push('<iframe id="account_authentication" name="account_authentication" node-type="frame" width="'+b.width+'" height="'+b.height+'" allowtransparency="true" scrolling="no" frameborder="0" src=""></iframe>');var e=a.builder(c.join(""));f.setTitle(b.title);f.setContent(e.box);var g=f.getDomList();a.addEvent(g["close"][0],"click",function(){history.go(0)})},show:function(){try{SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_box")}catch(c){}if(!h){a.lib.kit.io.cssLoader("style/css/module/layer/layer_check_identity.css","js_style_css_module_layer_check_identity",function(){h=true})}f.show().setMiddle();g=a.E("account_authentication");var d=decodeURIComponent(b.src)+"&rnd=";if(g.attachEvent){g.attachEvent("onload",function(){g.height=b.height;f.setMiddle()})}else{g.onload=function(){g.height=b.height;f.setMiddle()}}g.src=d+a.core.util.getUniqueKey()},destroy:function(){},hook:function(a,b){try{if(a=="100000"){j.verifySucc()}else{j.verifyFail()}}catch(c){}},verifySucc:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_success");f.hide();var b={title:c("#L{提示}"),icon:"success",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_play");history.go(0)},OKText:c("#L{进入首页}"),msg:c("#L{恭喜，您的身份已验证成功，马上进入新浪微博。}")};var d=a.lib.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})},verifyFail:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_twotimes");f.hide();var b={title:c("#L{提示}"),icon:"warn",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_triple");j.show()},OKText:c("#L{再次验证}"),msg:c("#L{抱歉，您的身份信息不准确，请再次验证。<br/>}")+'<a class="W_spetxt" suda-data="key=tblog_checkfailed_reform&value=checkfailed_havealook" href="//weibo.com">'+c("#L{您也可以先体验微博，随后再验证身份信息>>}")+"</a>"};var d=a.lib.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})}};j.init();e.destroy=j.destroy;e.show=j.show;window["App"]=window["App"]||{};window["App"]["checkRealName"]=j.hook;return e}});
STK.register("common.layer.ioError",function(a){var b=a.lib.kit.extra.language;var c;return function(d,e,f){f=f||function(){};var g={100001:function(){a.lib.ui.alert(e.msg)},100002:function(){window.location.reload()},100003:function(){var c=a.parseParam({location:"",icon:"warn",title:b("#L{提示}"),OKText:b("#L{确认}"),cancelText:b("#L{取消}"),suda:""},e.data);c["OK"]=function(){a.preventDefault();var b=a.queryToJson(e.data.OKSuda||"");SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);e["ok"]&&e["ok"]();window.location.href=c.location};c["cancel"]=function(){a.preventDefault();var b=a.queryToJson(e.data.cancelSuda||"");SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);e["cancel"]&&e["cancel"]()};a.lib.ui.confirm(e.msg,c)},100004:function(){if(!c){c=a.common.dialog.authentication({})}c.show()}};var h=g[d]||g["100001"];return h()||f(d)}});
STK.register("common.dialog.validateCode",function(a){var b=a.lib.kit.extra.language;var c="/ajax/pincode/pin?type=rule&lang=zh-cn&ts=";var d={dialog_html:'<div class="layer_veriyfycode">'+'<div class="v_image"><img height="50" width="450" class="yzm_img" /></div>'+'<p class="v_chng"><a href="#" onclick="return false;" class="yzm_change" action-type="yzm_change">#L{换另一组题目}</a></p>'+'<p class="v_ans_t">#L{请输入上面问题的答案}：</p>'+'<p class="v_ans_i"><input type="text" class="W_inputStp v_inp yzm_input ontext" action-type="yzm_input"/><div class="M_notice_del yzm_error" style="display:none;"><span class="icon_del"></span><span class="txt"></span></div></p>'+'<p class="v_btn">'+'<a class="S_btn_b yzm_submit" href="#" action-type="yzm_submit"><span>#L{确定}</span></a><a class="Sbtn_a yzm_cancel" href="#" action-type="yzm_cancel" action-data="value=frombtn"><span>#L{取消}</span></a>'+"</p>"+"</div>"};var e;return function(){if(e){return e}var f={};var g={};var h;var i;var j;var k;var l=function(){g.yzm_error.innerHTML="";g.yzm_error.parentNode.style.display="none"};var m=function(a){g.yzm_error.innerHTML=a;g.yzm_error.parentNode.style.display=""};var n=function(){if(!h){o()}l();g.input_text.value="";h.show();t.changesrc();h.setMiddle();a.hotKey.add(document.documentElement,["esc"],t.closeDialog,{type:"keyup",disableInInput:true})};var o=function(){h=a.lib.ui.dialog({isHold:true});h.setTitle(b("#L{请输入验证码}"));h.setContent(b(d.dialog_html));var c=h.getOuter();s(c);u()};var p=a.common.trans.validateCode.getTrans("checkAnswer",{onSuccess:function(b,c){var d=b.data.retcode;l();g.input_text.value="";h.hide();var e=i.requestAjax;var f=a.lib.kit.extra.merge(i.param,{retcode:d});e.request(f);j=false},onError:function(){m(b("#L{验证码错误}"));t.changesrc();j=false},onFail:function(){m(b("#L{验证码错误}"));t.changesrc();j=false}});var q=function(){};var r=function(){};var s=function(b){g.vImg=a.core.dom.sizzle("img.yzm_img",b)[0];g.yzm_change=a.core.dom.sizzle("a.yzm_change",b)[0];g.yzm_submit=a.core.dom.sizzle("a.yzm_submit",b)[0];g.yzm_cancel=a.core.dom.sizzle("a.yzm_cancel",b)[0];g.input_text=a.core.dom.sizzle("input.yzm_input",b)[0];g.yzm_error=a.core.dom.sizzle("div.yzm_error span.txt",b)[0];g.close_icon=h.getDom("close")};var t={changesrc:function(){var b=c+a.getUniqueKey();g.vImg.setAttribute("src",b);try{g.yzm_change.blur()}catch(d){}},checkValidateCode:function(){l();var c=a.core.str.trim(g.input_text.value);if(!c){m(b("#L{请输入验证码}"))}else{if(!j){j=true;p.request({secode:c,type:"rule"})}}try{g.yzm_submit.blur()}catch(d){}},closeDialog:function(b){if(typeof b=="object"&&b.el){h.hide()}if(typeof i=="object"&&i.onRelease&&typeof i.onRelease=="function"){i.onRelease()}a.hotKey.remove(document.documentElement,["esc"],t.closeDialog,{type:"keyup"});try{a.preventDefault()}catch(c){}},onFocus:function(b){b=a.core.evt.getEvent();var c=b.target||b.srcElement;var d=c.value;if(!d){l()}}};var u=function(){var b=h.getOuter();k=a.core.evt.delegatedEvent(b);k.add("yzm_change","click",function(){t.changesrc();a.preventDefault()});k.add("yzm_submit","click",function(){t.checkValidateCode();a.preventDefault()});k.add("yzm_cancel","click",t.closeDialog);a.core.evt.addEvent(g.close_icon,"click",t.closeDialog);a.core.evt.addEvent(g.input_text,"focus",t.onFocus);a.core.evt.addEvent(g.input_text,"blur",t.onFocus)};var v=function(){if(h){k.destroy();a.core.evt.removeEvent(g.close_icon,"click",t.closeDialog);a.core.evt.removeEvent(g.input_text,"focus",t.onFocus);a.core.evt.removeEvent(g.input_text,"blur",t.onFocus);h&&h.destroy&&h.destroy()}h=e=null};var w=function(b,c,d){if(b.code=="100027"){i=d;n()}else if(b.code=="100000"){var e=d.onSuccess;e&&e(b,c)}else if(b.code=="100002"){window.location.href=b["data"];return}else if(b.code=="100050"){d.onError(b,c)}else if(b.code=="100004"){a.common.layer.ioError(b.code,c)}else if(b.code==2e7){var f=JSON.parse(b.msg)||{};a.lib.ui.alert(f.msg,{OK:function(){window.location.href=b.data;return}},c.dom).dia.setTitle(f.title)}else{a.lib.ui.alert(b.msg);d.onError(b,c)}};r();r=null;f.destroy=v;f.validateIntercept=w;f.addUnloadEvent=function(){if(h){a.core.evt.addEvent(window,"unload",v)}};e=f;return f}});
STK.register("lib.kit.dom.isTurnoff",function(a){return function(a){return!(a.parentNode&&a.parentNode.nodeType!=11&&!a.disabled)}});
STK.register("lib.kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c){try{return a.selectionStart}catch(b){return 0}}var d=c.createRange(),e,f,g=0;var h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(g;h.compareEndPoints("StartToStart",d)<0;g++){h.moveStart("character",1)}return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c){a.setSelectionRange(b,d);return}var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i);return}var j=c.createRange();j.moveStart("character",-f);j.text=d};b.replaceText=function(a,d){a.focus();var e=a.value;var f=b.getSelectedText(a);var g=f.length;if(f.length==0){b.insertText(a,d,b.getCursorPos(a))}else{var h=b.getCursorPos(a);if(c){var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}else{var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStart=e.text.length-d.text.length;a.selectionEnd=a.selectionStart+d.text.length;b=a.selectionStart}else if(a.selectionStart||a.selectionStart=="0"){b=a.selectionStart}return b};b.getSelectedText=function(a){var b="";var d=function(a){if(a.selectionStart!=undefined&&a.selectionEnd!=undefined)return a.value.substring(a.selectionStart,a.selectionEnd);else return""};if(window.getSelection){b=d(a)}else{b=c.createRange().text}return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else if(a.setSelectionRange){a.setSelectionRange(b,b+c)}};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("lib.kit.extra.count",function(a){function b(b){var c=41,d=140,e=20,f=b;var g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[];var h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^((http|https):\/\/t.cn)/.test(g[i])){continue}else{if(/^((http|https):\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^((http|https):\/\/)+(weibo.com|weibo.cn)/.test(g[i])){h+=k<=c?k:k<=d?e:k-d+e}else{h+=k<=d?e:k-d+e}}f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return num=b(a)}});
STK.register("lib.module.editor",function(a){var b=a.core.evt.addEvent;var c=a.core.evt.custEvent;var d=a.core.dom.getStyle;var e=a.core.dom.setStyle;return function(b,c){var d={};var c=c;var e={},f="";var g={reset:function(){e.textEl.value="";a.core.evt.custEvent.fire(d,"changed");e.textEl.removeAttribute("extra");f=""},delWords:function(a){var b=g.getWords();if(b.indexOf(a)>-1){e.textEl.value="";i.textInput(b.replace(a,""))}else{return false}},getWords:function(){return a.core.str.trim(e.textEl.value)},getExtra:function(){var b;var c=e.textEl.getAttribute("extra")||"";if(c!=null){b=a.core.str.trim(c)}return b},focus:function(b,c){if(typeof b!="undefined"){a.lib.kit.extra.textareaUtils.setCursor(e.textEl,b,c)}else{var d=e.textEl.value.length;a.lib.kit.extra.textareaUtils.setCursor(e.textEl,d)}h.cacheCurPos()},blur:function(){e.textEl.blur()},addExtraInfo:function(a){if(typeof a=="string"){e.textEl.setAttribute("extra",a)}},disableEditor:function(b){a.core.evt.removeEvent(e.textEl,"mouseup",h.cacheCurPos);if(b===true){e.textEl.setAttribute("disabled","disabled")}else{a.core.evt.addEvent(e.textEl,"mouseup",h.cacheCurPos);e.textEl.removeAttribute("disabled")}},getCurPos:function(){var a=e.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(e.textEl.value).length==0?a.core.str.trim(e.textEl.value):e.textEl.value;return a.lib.kit.extra.count(b)},addShortUrlLog:function(b){b=b&&a.trim(b);if(b){var c=new RegExp("^"+b+"$|"+"_"+b+"$|^"+b+"_|"+"_"+b+"_");if(!c.test(f)){if(!f){f=b}else{f=f+"_"+b}}}},getShortUrlLog:function(){return f}};var h={textElFocus:function(){if(e.recommendTopic){a.core.dom.setStyle(e.recommendTopic,"display","none")}a.custEvent.fire(d,"focus");return;if(e.num){a.core.dom.setStyle(e.num,"display","block")}if(g.getWords()==c.tipText){g.delWords(c.tipText)}},textElBlur:function(){setTimeout(function(){if(e.textEl.value.length===0){if(e.recommendTopic)a.core.dom.setStyle(e.recommendTopic,"display","block");if(e.num&&e.recommendTopic)a.core.dom.setStyle(e.num,"display","none");a.custEvent.fire(d,"blur");if(typeof c.tipText!="undefined"){e.textEl.value=c.tipText}}},50)},cacheCurPos:function(){var b=a.lib.kit.extra.textareaUtils.getSelectedText(e.textEl);var c=b==""||b==null?0:b.length;var d=a.lib.kit.extra.textareaUtils.getCursorPos(e.textEl);var f=d+"&"+c;e.textEl.setAttribute("range",f)}};var i={textChanged:function(){a.custEvent.fire(d,"keyUpCount")},textInput:function(b,f){var i=g.getCurPos();var f=i[0];var j=i[1];if(g.getWords()==c.tipText&&b!=c.tipText){g.delWords(c.tipText)}a.lib.kit.extra.textareaUtils.unCoverInsertText(e.textEl,b,{rcs:i[0],rccl:i[1]});h.cacheCurPos();a.core.evt.custEvent.fire(d,"changed")}};var j={};var k=function(){n();o()};var l=function(){p();r();s();m()};var m=function(){if(c.storeWords){if(e.textEl.value.length==0){i.textInput(c.storeWords)}return}if(c.tipText){e.textEl.value=c.tipText}};var n=function(){if(!b)throw"node is not defined in module editor"};var o=function(){var c=a.core.dom.builder(b).list;e=a.lib.kit.dom.parseDOM(c);if(!e.widget)throw"can not find nodes.widget in module editor"};var p=function(){a.core.evt.addEvent(e.textEl,"focus",h.textElFocus);a.core.evt.addEvent(e.textEl,"blur",h.textElBlur);a.core.evt.addEvent(e.textEl,"mouseup",h.cacheCurPos);a.core.evt.addEvent(e.textEl,"keyup",h.cacheCurPos)};var q=function(){a.core.evt.custEvent.define(d,"changed")};var r=function(){q();a.core.evt.custEvent.add(d,"changed",i.textChanged)};var s=function(){};var t=function(){};k();var u={reset:g.reset,getWords:g.getWords,getExtra:g.getExtra,delWords:g.delWords,focus:g.focus,blur:g.blur,insertText:i.textInput,check:i.textChanged,addExtraInfo:g.addExtraInfo,disableEditor:g.disableEditor,getCurPos:g.getCurPos,count:g.count,textElFocus:h.textElFocus,cacheCurPos:h.cacheCurPos,addShortUrlLog:g.addShortUrlLog,getShortUrlLog:g.getShortUrlLog};d.destroy=t;d.API=u;d.nodeList=e;d.init=l;d.opts=c;return d}});
STK.register("common.editor.plugin.count",function(a){function e(a,b){if(!a.textEl){throw"[editor plugin count]: plz check nodeList"}}function d(a){var d=c(a);var e=Math.abs(b-d);var f;if(d>b||d<1){f={wordsnum:d,vnum:e,overflow:true}}else if(d==0){f={wordsnum:d,vnum:e,overflow:true}}else{f={wordsnum:d,vnum:e,overflow:false}}return f}function c(b){var c=41,d=140,e=20,f=b;var g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[];var h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^((http|https):\/\/t.cn)/.test(g[i])){continue}else{if(/^((http|https):\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^((http|https):\/\/)+(weibo.com|weibo.cn)/.test(g[i])){h+=k<=c?k:k<=d?e:k-d+e}else{h+=k<=d?e:k-d+e}}f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList;var g;var h=c.opts;var i=a.lib.kit.extra.language;b=h.limitNum;e(f);a.core.evt.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl;var k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value;var e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);if(b.length>=0&&j.focus){if(f.overflow&&f.wordsnum!=0){k.innerHTML=(e?i(e):"")+i("#L{已经超过}")+'<strong class="warn">'+f.vnum+"</strong>字"}else{k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<strong>"+f.vnum+"</strong>字"}}else if(b.length===0){k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<strong>"+f.vnum+"</strong>字"}a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("lib.kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i))){c=c.replace(d[1]+d[2]+d[3],"")}return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++){if(c[b].indexOf(a+":")==0){c.splice(b,1)}}return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("lib.module.at",function(a){var b=window,c=document,d=a.core.util.browser,e="font-family:Tahoma,宋体;",f=a.lib.kit.extra.textareaUtils.selectionStart;var g;var h,i,j,k;var l=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',e,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',e,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}();var m=function(){var b=[],c=g.textEl.style.cssText,d;a.foreach(["margin","padding","border"],function(c){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;if(c!="border"){e=b.push(c,"-",d.toLowerCase(),":",a.getStyle(g.textEl,c+d),";");return}a.foreach(["Color","Style","Width"],function(e){b.push(c,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(g.textEl,[c,d,e].join("")),";")})})});b.push("font-size:"+a.getStyle(g.textEl,""+"fontSize")+";");return a.lib.kit.dom.cssText([c,b.join(""),e,"\n\t\t\tword-wrap: break-word;\n\t\t\tline-height: 18px;\n\t\t\toverflow-y:auto;\n\t\t\toverflow-x:hidden;\n\t\t\toutline:none;\n\t\t"].join("")).getCss()};var n=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list;var e=b["wrap"][0],f=b["flag"][0],h=b["after"][0],i=b["before"][0],j=0,n,o,p;var q=function(a){if(d.MOZ){return-2}if(d.MOBILE&&d.SAFARI&&(d.IPAD||d.ITOUCH||d.IPHONE)){return-2}return 0};return{bind:function(){if(o===g.textEl){return}k=a.position(g.textEl);var b=["left:",k.l,"px;top:",k.t+20,"px;"].join("");o=g.textEl;var d=m();o.style.cssText=d;p=[b,d,"\n\t\t\t\t\tposition:absolute;\n\t\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\t\topacity:0;\n\t\t\t\t\tz-index:-1000;\n\t\t\t\t"].join("");e.style.cssText=p;if(!j){j=1;c.body.appendChild(e)}},content:function(b,c,d,j){e.style.cssText=[p,"\n\t\t\t\t\twidth:",(parseInt(a.getStyle(o,"width"))||o.offsetWidth)+q(),"px;\n\t\t\t\t\theight:",parseInt(a.getStyle(o,"height"))||o.offsetHeight,"px;\n\t\t\t\t\toverflow-x:hidden;\n\t\t\t\t\toverflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(o,"overflowY"),";\n\t\t\t\t"].join("");i.innerHTML=l(b);f.innerHTML=l(c)||"&thinsp;";h.innerHTML=l([d,j].join(""));clearTimeout(n);n=setTimeout(function(){var b=a.position(f);a.custEvent.fire(g.eId,"at",{t:b.t-o.scrollTop-k.t,l:b.l-k.l,key:d,flag:c,textarea:g.textEl})},30)},hide:function(){e.style.display="none"},show:function(){e.style.display=""}}}();var o=function(){if(a.lib.kit.dom.isTurnoff(g.textEl)){clearInterval(h);return}var b=g.textEl.value.replace(/\r/g,"");var c=f(g.textEl);if(c<0||c==j){return}j=c;var d=b.slice(0,c);var e=d.match(new RegExp(["(",g["flag"],")([a-zA-Z0-9一-龥_]{0,20})$"].join("")));if(!e){a.custEvent.fire(g.eId,"hidden");return}var i=b.slice(c);d=d.slice(0,-e[0].length);n.content(d,e[1],e[2],i)};return function(b){if(!b||!b["textEl"]){return}b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!g){return}clearInterval(h);a.removeEvent(g.textEl,"blur",c);n.hide()};var d=function(){c();g=b;j=null;n.bind();n.show();h=setInterval(o,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b["eId"]}});
STK.register("lib.module.suggest",function(a){var b=null,c=a.custEvent,d=c.define,e=c.fire,f=c.add,g=a.addEvent,h=a.removeEvent,i=a.stopEvent;var j=[],k={};var l={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9};var m=function(b){var c=-1,j=[],k=b["textNode"],m=b["uiNode"];var n=a.core.evt.delegatedEvent(m);var o=d(k,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);o.setFlag=p;var p=function(a){b.flag=a};var q=function(){return a.sizzle(["[action-type=",b["actionType"],"]"].join(""),m)};var r=function(){c=-1;h(k,"keydown",s);n.destroy()};var s=function(a){var d,f;if(!(d=a)||!(f=d.keyCode)){return}if(f==l["ENTER"]){i();e(o,"onSelect",[c,k,b.flag]);return false}if(f==l["UP"]){i();var g=q().length;c=c<1?g-1:c-1;e(o,"onIndexChange",[c]);return false}if(f==l["DOWN"]){i();var g=q().length;c=c==g-1?0:c+1;e(o,"onIndexChange",[c]);return false}if(f==l["ESC"]){i();r();e(o,"onClose");return false}if(f==l["TAB"]){r();e(o,"onClose");return false}};var t=function(c){e(o,"onSelect",[a.core.arr.indexOf(c.el,q()),k,b["flag"]])};var u=function(b){c=a.core.arr.indexOf(b.el,q());e(o,"onIndexChange",[a.core.arr.indexOf(b.el,q())])};f(o,"open",function(a,c){k=c;r();g(c,"keydown",s);n.add(b["actionType"],"mouseover",u);n.add(b["actionType"],"click",t);e(o,"onOpen",[b.flag])});f(o,"openSetFlag",function(a,b){p(b)});f(o,"close",function(){r();e(o,"onClose",[b.flag])});f(o,"indexChange",function(a,d){c=d;e(o,"onIndexChange",[c,b.flag])});return o};var n=function(b){var c=b["textNode"];var d=a.core.arr.indexOf(c,j);if(!k[d]){j[d=j.length]=c;k[d]=m(b)}return k[d]};return function(c){if(!c["textNode"]||!c["uiNode"]){return}c=a.parseParam({textNode:b,uiNode:b,actionType:"item",actionData:"index",flag:""},c);return n(c)}});
STK.register("common.channel.listener",function(a){var b={};var c={};c.define=function(c,d){if(b[c]!=null){throw"common.channel.listener.define: 频道已被占用"}b[c]=d;var e={};e.register=function(d,e){if(b[c]==null){throw"common.channel.listener.define: 频道未定义"}a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null){throw"common.channel.listener.define: 频道未定义"}a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("common.channel.at",function(a){var b=["open","close"];return a.common.channel.listener.define("common.channel.at",b)});
STK.register("common.editor.plugin.at",function(a){var b=""+'<div style="min-width:100px;" class="m-user-list">'+'<ul node-type="suggestWrap">'+"</ul>"+"</div>";var c={"@":"<#et temp data>"+'<li class="suggest_title"><span>想用@提到谁？</span></li>'+"<#list data as list>"+'<li action-type="item" '+"<#if (list_index == 0)>"+'class="cur" '+"</#if>"+'action-data="value=${list.nickname}" value="${list.nickname}"><a href="javascript:void(0);">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li>'+"</#list>"+"</#et>","#":"<#et temp data>"+'<li class="suggest_title">想用什么话题？</li>'+"<#list data as list>"+'<li action-type="item" '+"<#if (list_index == 0)>"+'class="cur" '+"</#if>"+'action-data="value=${list.topic}" value="${list.topic}"><a href="javascript:void(0);">${list.topic}<#if (list.count)>(${list.count})</#if></a></li>'+"</#list>"+"</#et>"};var d,e,f,g,h,i,j=false,k;var l;var m={"@":"followList","#":"topicList"};var n=0;var o=function(){setTimeout(function(){a.custEvent.fire(d,"close")},200)};var p=function(){h.style.display="none"};var q=function(){a.custEvent.add(d,"onIndexChange",function(a,b){u(b)});a.custEvent.add(d,"onSelect",function(b,c,e,f){a.core.evt.stopEvent();var g=l[c].getAttribute("value");g=g.replace(/\(.*\)/,"");try{e.focus()}catch(h){}var i=a.lib.kit.extra.textareaUtils.selectionStart(e)*1;var j=new RegExp(f+"([a-zA-Z0-9一-龥_]{0,20})$");var k=e.value.slice(0,i).match(j);var m=e.value.slice(i,i+1);k=k&&k[1]?k[1].length:0;var n=a.lib.kit.extra.textareaUtils;if(f=="#"){if(typeof m!="undefined"&&m!=f){g=g+f+" "}}else{g=g+" "}n.insertText(e,g,i,k);var o=n.getCursorPos(e);if(f=="#"&&m==f){n.setCursor(e,o+1);n.insertText(e," ",o+1,0)}o=n.getCursorPos(e);var p=n.getSelectedText(e);var q=p==""||p==null?0:p.length;e.setAttribute("range",o+"&"+q);a.custEvent.fire(d,"close")});a.addEvent(f.textEl,"blur",o);a.custEvent.add(d,"onClose",p);a.custEvent.add(d,"onOpen",function(b,c){g.style.display="";h.style.display="";j=true;setTimeout(function(){a.custEvent.fire(d,"indexChange",0)},100)})};var r=function(){a.core.evt.custEvent.add(e,"hidden",function(b,c){a.custEvent.fire(d,"close")});a.core.evt.custEvent.add(e,"at",function(b,e){i=e.key;if(i.length==0){a.custEvent.fire(d,"close");return}var f=e.flag;var j=a.common.trans.global.getTrans(m[f],{onSuccess:function(b,i){var j=a.core.util.easyTemplate(c[f],b.data);a.custEvent.fire(d,"openSetFlag",f);a.custEvent.fire(d,"open",e.textarea);var k=a.core.dom.builder(j);var l=k.box;g.innerHTML=l;h.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");a.common.channel.at.fire("open");a.lib.kit.dom.layoutPos(h,e.textarea,{pos:"left-top",offsetX:e.l,offsetY:e.t})},onError:function(){a.custEvent.fire(d,"close")}}).request({key:i,type:"at"})})};var s=function(){k=f.textEl;e=STK.lib.module.at({textEl:k,flag:"@|#"})};var t=function(c){h=STK.C("div");document.body.appendChild(h);if(h.innerHTML.length==0){h.innerHTML=b;g=a.core.dom.sizzle('[node-type="suggestWrap"]',h)[0];h.style.display="none"}d=a.lib.module.suggest({textNode:c,uiNode:g,actionType:"item",actionData:"value",flag:"@"});q()};var u=function(b){l=a.sizzle("li[class!=suggest_title]",g);a.core.dom.removeClassName(l[n],"cur");a.core.dom.addClassName(l[b],"cur");n=b};return function(a,b){f=a.nodeList;var c={};c.init=function(){s();t(f.textEl);r()};return c}});
STK.register("common.editor.base",function(a){function c(){}var b={limitNum:140};return function(c,d){var e={};var f,g,h,i;f=a.lib.kit.extra.merge(b,d);g=a.lib.module.editor(c,f);h=g.nodeList;i=[];if(typeof d.count=="undefined"||d.count=="enable"){var j=a.common.editor.plugin.count(g,f)}var k=a.common.editor.plugin.at(g,f);k.init();g.init();g.widget=function(a,b,c){i.push(a);a.init(g,b,c);return g};g.closeWidget=function(){if(i&&i.length!=0){for(var a=0,b=i.length;a<b;a++){i[a].hide()}}};return g}});
STK.register("lib.kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c)){throw"lib.kit.dom.layerOutElement need element as first parameter"}if(c===document.body){return false}if(!c.parentNode){return false}if(c.style.display==="none"){return false}var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f){return false}while(f!==document.body){f=f.parentNode;if(f.style.display==="none"){return false}j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed"){break}if(k==="true"&&j==="relative"){break}}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e["pos"].split("-");if(i[0]==="left"){b.style.left=g.l+e.offsetX+"px"}else if(i[0]==="right"){b.style.left=g.l+h.w+e.offsetX+"px"}else if(i[0]==="center"){b.style.left=g.l+h.w/2+e.offsetX+"px"}if(i[1]==="top"){b.style.top=g.t+e.offsetY+"px"}else if(i[1]==="bottom"){if($CONFIG.pageid=="pic"){e.offsetY+=f.scrollTop}b.style.top=g.t+h.h+e.offsetY+"px"}else if(i[1]==="middle"){b.style.top=g.t+h.h/2+e.offsetY+"px"}return true}});
STK.register("lib.module.bubble",function(a){return function(b,c){if(!b){throw"module.bubble need template as first parameter"}var d;var e,f,g,h,i,j;e=a.parseParam({width:null,height:null,parent:document.body},c);f=a.lib.module.layer(b);g=f.getDom("outer");h=f.getDom("inner");if(f.getDomListByKey("close")){i=f.getDom("close")}g.style.display="none";j=false;var k=function(b){if(j){return true}var c=a.fixEvent(b);if(!a.contains(g,c.target)){f.hide()}};if(i){a.addEvent(i,"click",f.hide)}a.custEvent.add(f,"show",function(){setTimeout(function(){a.addEvent(document.body,"click",k)},0)});a.custEvent.add(f,"hide",function(){j=false;a.removeEvent(document.body,"click",k)});d=f;d.setPosition=function(a){g.style.top=a["t"]+"px";g.style.left=a["l"]+"px";return d};d.setLayout=function(b,c){if(!a.isNode(b)){throw"module.bubble.setDown need element as first parameter"}a.lib.kit.dom.layoutPos(g,b,c);return d};d.setContent=function(b){if(typeof b==="string"){h.innerHTML=b}else if(a.isNode(b)){h.appendChild(b)}return d};d.setArrow=function(a){var b;if(f.getDomListByKey("arrow")){b=f.getDom("arrow");if(a["className"]){b.className=a["className"]||""}if(a["style"]){b.style.cssText=a["style"]||""}}};d.clearContent=function(){while(h.children.length){a.removeNode(h.children[0])}};d.stopBoxClose=function(){j=true};d.startBoxClose=function(){j=false};d.destroy=function(){a.removeEvent(document.body,"click",k);f=null;g=null;h=null;i=null};return d}});
STK.register("core.util.getUniqueKey",function(a){var b=(new Date).getTime().toString(),c=1;return function(){return b+c++}});
STK.register("lib.ui.bubble",function(a){var b=['<div class="m-layer-face" node-type="outer" style="position:absolute">','<a class="wbicon close" href="javascript:void(0);" node-type="close" >X</a>','<div class="bg" node-type="layoutContent">','<div node-type="inner"></div>',"</div>",'<div class="arrow" node-type="arrow"><em class="br"></em><em class="bg"></em></div>',"</div>"].join("");var c=[];return function(d){var e=a.parseParam({template:b,isHold:false},d);var f={get:function(){if(e["isHold"]){return a.lib.module.bubble(e["template"],e)}else{return f.checkBob()}},checkBob:function(){var a;for(var b=0,d=c.length;b<d;b++){if(!c[b]["used"]){a=c[b]["bub"];continue}}if(!a){a=f.create()}return a},refresh:function(a,b){for(var d=0,e=c.length;d<e;d++){if(a===c[d]["bub"]){c[d]["used"]=b;return}}},cevt:function(b){a.custEvent.add(b,"hide",function(){f.refresh(b,false);b.clearContent()});a.custEvent.add(b,"show",function(){f.refresh(b,true)})},create:function(){var b=a.lib.module.bubble(e["template"],e);c.push({bub:b,used:true});f.cevt(b);return b}};return f.get()}});
STK.register("common.trans.publisher",function(a){var b=a.lib.kit.io.inter();var c="/ajax/jsProxy.php?interurl=http://new.weibo.com";var d="/ajax/";var e=b.register;e("publish",{url:"/Ajax_Mblog/publish",method:"post"});e("face",{url:"/ajax_Mblog/face?type=face",method:"get"});e("magicFace",{url:"/ajax_Mblog/face?type=ani",method:"post"});e("getTopic",{url:d+"mblog/face?type=cartoon",method:"post"});e("suggestMusic",{url:c+"/aj/mblog/music/suggest&method=get",requestMode:"jsonp"});e("searchMusic",{url:c+"/aj/mblog/music/search&method=get",requestMode:"jsonp"});e("addMusic",{url:c+"/aj/mblog/music/submit&method=get",requestMode:"jsonp"});e("parseMusic",{url:c+"/aj/mblog/music/parse&method=get",requestMode:"jsonp"});e("parseVideo",{url:c+"/aj/mblog/video&method=post"});return b});
STK.register("common.bubble.magic",function(a){var b=a.core.util.swf;var c=a.lib.module.mask;var d,e,f,g,h,i;var j=function(){if(d)return;d=a.C("div");d.style.cssText="display:none;width:440px;height:360px;z-index:100000;";e=a.core.dom.uniqueID(d);h=function(b){b=a.fixEvent(b||window.event);if(b.target.getAttribute("name")!=e)k.hide()};document.body.appendChild(d)};var k=function(l,m){j();if(f)return;f=true;c.showUnderNode(d);a.addEvent(c.getNode(),"click",h);c.getNode().title="点击关闭";d.style.display="";if(!g){g=a.lib.kit.dom.fix(d,"c")}else{g.setAlign("c")}d.innerHTML=b.html(l,{id:e,width:440,height:360,paras:{allowScriptAccess:"never",wmode:"transparent"},attrs:{name:e},flashvars:{playMovie:"true"}});clearInterval(i);i=setInterval(function(){var a=document[e]||window[e],b=0;if(a&&a.PercentLoaded()==100){clearInterval(i);i=setInterval(function(){var c=a.CurrentFrame(),d;try{d=a.TotalFrames()}catch(e){d=a.TotalFrames}if(c<0){return}if(c<d&&b<=c){b=c}else{k.hide()}},80)}},100)};k.hide=function(){if(d){d.style.display="none";d.innerHTML=""}clearInterval(i);a.removeEvent(c.getNode(),"click",h);c.getNode().title="";c.back();f=false;return k};k.destroy=function(){k.hide();g&&g.destroy();a.removeNode(d);i=d=e=f=g=h};return k});
STK.register("common.bubble.face",function(a){var b=a.lib.kit.extra.language;var c=""+'<div node-type="outer" class="face-box">'+'<div class="tab">'+'<ul node-type="categorys"></ul>'+"</div>"+'<div class="face">'+'<ul class="hot-face" node-type="hotFace"></ul>'+'<ul node-type="inner"></ul>'+"</div>"+"</div>";var d='<li><a href="javascript:void(0);" action-type="category" action-data="category=#{item}">#{item}</a></li>';var e='<li><a href="javascript:void(0);" action-type="category" action-data="category=#{item}" class="cur">#{item}</a></li>';var f='<li action-type="insert" action-data="text=#{phrase}"><img src="#{icon}" alt="#{phrase}" /></li>';var g=b('<li><a action-type="insert" action-data="text=#{value}" class="img" href="javascript:void(0);"><img src="#{icon}" alt="#{phrase}" /></a><a title="#L{表情预览}" class="play" href="javascript:void(0);" action-type="play" action-data="swf=#{swf}"></a><span>#{phrase}</span></li>');var h='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" onclick="return false;">#{label}</a>';var i='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" class="current" onclick="return false;">#{label}</a>';var j=b('<div style="text-align:center"><i class="W_loading S_loading"></i><span>#L{正在加载，请稍后}...</span></div>');var k='<li class="clear"></li>';var l=5;var m=b("#L{默认}");var n,o,p,q,r,s;s={};var t=function(b){var c=b.cPoniter;var f=b.categorys;var g=b.currentCategory;var h=f.slice(c,c+l);h=a.foreach(h,function(b,c){if(g===b){return a.templet(e,{item:b})}else{return a.templet(d,{item:b})}});o["categorys"].innerHTML=h.join("");u(b)};var u=function(a){var b=a.page;if(a.currentCategory===m){o["hotFace"].style.display=""}else{o["hotFace"].style.display="none"}};var v={general:function(a){r=A;r.init();o["inner"].className="faces_list clearfix"},magic:function(a){r=magic;r.init();o["inner"].className="faces_magic_list"}};var w={category:function(a){r.page=0;r.currentCategory=a.data.category;r.rend();setTimeout(function(){t(r)},0)},prev:function(a){var b=r.cPoniter;var c=r.categorys;if(b<=0){return false}r.cPoniter-=l;t(r)},next:function(a){var b=r.cPoniter;var c=r.categorys;if(b>=c.length-l){return false}r.cPoniter+=l;t(r)},play:function(b){a.common.bubble.magic(b.data.swf)},insert:function(b){a.custEvent.fire(s,"insert",{value:b.data.text})},page:function(a){r.page=parseInt(a.data.num,10);r.rend()}};var x=function(b){p=a.lib.ui.bubble();y();z();v[b]();a.custEvent.add(p,"hide",function(b){return function(){a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(s,"hide",{})}}(p))};var y=function(){n=a.lib.module.layer(b(c));o={};var d=n.getDomList();for(var e in d){o[e]=d[e][0]}y=function(){p.setContent(o["outer"])};y()};var z=function(){a.custEvent.define(s,"insert");a.custEvent.define(s,"hide");delegate=a.core.evt.delegatedEvent(o["outer"]);delegate.add("category","click",w["category"]);delegate.add("prev","click",w["prev"]);delegate.add("next","click",w["next"]);delegate.add("insert","click",w["insert"]);delegate.add("play","click",w["play"]);delegate.add("page","click",w["page"]);z=function(){}};var A={init:function(){o["inner"].innerHTML=j;var b=a.common.trans.publisher.getTrans("face",{onSuccess:function(b,c){A.cache=b.data.more||{};try{A.hotList=b.data.usual.hot.slice(0,10);o["hotFace"].innerHTML=a.foreach(A.hotList,function(b,c){return a.templet(f,b)}).join("")}catch(d){}A.categorys=[m];for(var e in A.cache){A.categorys.push(e)}A.cache[m]=b.data.usual.norm;A.init=function(){A.page=0;A.cPoniter=0;A.currentCategory=m;A.rend();t(A)};A.init()},onError:function(a,b){}});b.request({})},rend:function(){var b=A.currentCategory;var c=A.cache[b];var d=A.page;var e=A.itemNumber;c=c.slice(d*e,d*e+e);c=a.foreach(c,function(b,c){return a.templet(f,b)});o["inner"].innerHTML=c.join("")},page:0,cache:null,hotList:null,cPoniter:0,categorys:[],currentCategory:m,itemNumber:1e3};s.getBub=function(){return p};return function(b,c){if(!a.isNode(b)){throw"common.bubble.face need el as first parameter!"}var d=a.parseParam({l:0},c);x("general");p.setLayout(b,{offsetX:-5,offsetY:5});p.show();return s}});
STK.register("common.editor.widget.face",function(a){return function(b){var c={};var d,e,f,g;g=a.parseParam({t:0,l:-15},b);var h=function(a,b){d.API.insertText(b.value);e.getBub().hide()};var i=function(){a.core.evt.preventDefault();e=a.common.bubble.face(d.nodeList[f],g);a.custEvent.add(e,"insert",h);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"insert",h)})};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",i)};c.clear=function(){};c.show=function(){};c.hide=function(){};c.destroy=function(){d=null};return c}});
STK.register("lib.kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128){b+=String.fromCharCode(d)}else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var b;if(typeof b=="undefined"){b=0}var e=0;var f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;if(i<0){i=4294967296+i}return i}});
STK.register("common.extra.imageURL",function(a){return function(b,c){function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};d=a.core.obj.parseParam(d,c);var e=d.size;var g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large"}};if(b.indexOf("https")!=-1||b.indexOf("http")!=-1){return b}var h=b.charAt(9)=="w"||b.charAt(9)=="y";var i=b.charAt(21)=="g"?".gif":".jpg";var j=h?a.lib.kit.extra.crc32(b)%4+1:f(b.substr(19,2))%16+1;var k="//"+(h?"ww":"ss")+j+".sinaimg.cn/"+(h?g["ww"][e]:e)+"/"+b+(h?i:"")+(h?"":g["ss"][e]);return k}});
STK.register("lib.module.editorPlugin.tab",function(a){return function(b,c){function s(b,c){var e={evtType:"click",tNodes:"",dNodes:"",className:"cur",cb:function(){},defaultIdx:0};e=a.core.obj.parseParam(e,c);l=e.cb;n=e.className;p=e.defaultIdx;m=e.evtType;j=typeof e.tNodes=="string"?a.sizzle(e.tNodes,b):e.tNodes;o=j.length;if(e.dNodes!==""){k=typeof e.dNodes=="string"?a.sizzle(e.dNodes,b):e.dNodes;r()}for(var f=0;f<o;f++){d(j[f],m,function(a){return function(){h();q(a)}}(f))}}function r(){if(!g(j)){throw"module.editorPlugin.tab needs tNodes as Array!"}if(!g(k)){throw"module.editorPlugin.tab needs tNodes as Array!"}if(j.length!=k.length){throw"module.editorPlugin.tab needs tNodes'length equal to dNodes'length!"}}function q(a){var b=g(l)?l[a]:l,c=j[a],d=g(k)?k[a]:null;otNode=j[p],odNode=g(k)?k[p]:null;if(d){i(k[p],"display","none");i(k[a],"display","")}f(j[p],n);e(j[a],n);if(a==p){return}b({idx:a,node:d});p=a}var d=a.core.evt.addEvent,e=a.core.dom.addClassName,f=a.core.dom.removeClassName,g=a.core.arr.isArray,h=a.core.evt.preventDefault,i=a.core.dom.setStyle,j,k,l,m,n,o,p;var t={};t.initView=function(a){a=a||c["defaultIdx"];i(k[a],"display","");e(j[a],n);var b=g(l)?l[a]:l,d=g(k)?k[a]:null;b({idx:a,node:d});p=a};t.refresh=function(b){j[b]&&a.fireEvent(j[b],"click")};s(b,c);return t}});
STK.register("lib.kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/;var d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!y){return}var c=b?"visible":"hidden";if(u&&Q(a)){Q(a).style.visibility=c}else{U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(z.ie&&z.mac){return}var g=j.getElementsByTagName("head")[0];if(!g){return}var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);if(z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0){w=j.styleSheets[j.styleSheets.length-1]}x=h}if(z.ie&&z.win){if(w&&typeof w.addRule==c){w.addRule(b,d)}}else{if(w&&typeof j.createTextNode!=a){w.appendChild(j.createTextNode(b+" {"+d+"}"))}}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?true:false}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b){if(typeof b[c]=="function"){b[c]=null}}b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT"){if(z.ie&&z.win){b.style.display="none";(function(){if(b.readyState==4){P(a)}else{setTimeout(arguments.callee,10)}})()}else{b.parentNode.removeChild(b)}}}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312){return g}if(h){if(typeof b.id==a){b.id=e}if(z.ie&&z.win){var i="";for(var j in b){if(b[j]!=Object.prototype[j]){if(j.toLowerCase()=="data"){d.movie=b[j]}else{if(j.toLowerCase()=="styleclass"){i+=' class="'+b[j]+'"'}else{if(j.toLowerCase()!="classid"){i+=" "+j+'="'+b[j]+'"'}}}}}var k="";for(var l in d){if(d[l]!=Object.prototype[l]){k+='<param name="'+l+'" value="'+d[l]+'" />'}}h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b){if(b[n]!=Object.prototype[n]){if(n.toLowerCase()=="styleclass"){m.setAttribute("class",b[n])}else{if(n.toLowerCase()!="classid"){m.setAttribute(n,b[n])}}}}for(var p in d){if(d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"){N(m,p,d[p])}}h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie){b.innerHTML=a.innerHTML}else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++){if(!(e[g].nodeType==1&&e[g].nodeName=="PARAM")&&!(e[g].nodeType==8)){b.appendChild(e[g].cloneNode(true))}}}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){if(a.readyState==4){a.parentNode.removeChild(a)}else{setTimeout(arguments.callee,10)}})()}else{a.parentNode.replaceChild(L(a),a)}}function J(b,c,d,e){v=true;s=e||null;t={success:false,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310){b.width="310"}if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137){b.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;if(typeof c.flashvars!=a){c.flashvars+="&"+k}else{c.flashvars=k}if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){if(f.readyState==4){f.parentNode.removeChild(f)}else{setTimeout(arguments.callee,10)}})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null;var e=Q(b);if(e&&e.nodeName=="OBJECT"){if(typeof e.SetVariable!=a){d=e}else{var f=e.getElementsByTagName(c)[0];if(f){d=f}}}return d}function G(){var b=n.length;if(b>0){for(var c=0;c<b;c++){var d=n[c].id;var e=n[c].callbackFn;var f={success:false,id:d};if(z.pv[0]>0){var g=Q(d);if(g){if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,true);if(e){f.success=true;f.ref=H(d);e(f)}}else{if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";if(g.getAttribute("class")){h.styleclass=g.getAttribute("class")}if(g.getAttribute("align")){h.align=g.getAttribute("align")}var i={};var j=g.getElementsByTagName("param");var k=j.length;for(var l=0;l<k;l++){if(j[l].getAttribute("name").toLowerCase()!="movie"){i[j[l].getAttribute("name")]=j[l].getAttribute("value")}}J(h,i,d,e)}else{K(g);if(e){e(f)}}}}}else{V(d,true);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=true;f.ref=m}e(f)}}}}}function F(){var b=j.getElementsByTagName("body")[0];var d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else{if(g<10){g++;setTimeout(arguments.callee,10);return}}b.removeChild(d);e=null;G()})()}else{G()}}function E(){if(l){F()}else{G()}}function D(b){if(typeof i.addEventListener!=a){i.addEventListener("load",b,false)}else{if(typeof j.addEventListener!=a){j.addEventListener("load",b,false)}else{if(typeof i.attachEvent!=a){S(i,"onload",b)}else{if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else{i.onload=b}}}}}function C(a){if(u){a()}else{m[m.length]=a}}function B(){if(u){return}try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=true;var c=m.length;for(var d=0;d<c;d++){m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=false,m=[E],n=[],o=[],p=[],q,r,s,t,u=false,v=false,w,x,y=true,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,p=!+"1",q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&!(typeof k.mimeTypes!=a&&k.mimeTypes[f]&&!k.mimeTypes[f].enabledPlugin)){l=true;p=false;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof i.ActiveXObject!=a){try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=true;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}}}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!z.w3){return}if(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body)){B()}if(!u){if(typeof j.addEventListener!=a){j.addEventListener("DOMContentLoaded",B,false)}if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});if(i==top){(function(){if(u){return}try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()})()}}if(z.wk){(function(){if(u){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()})()}D(B)}}();var X=function(){if(z.ie&&z.win){window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++){p[c][0].detachEvent(p[c][1],p[c][2])}var d=o.length;for(var e=0;e<d;e++){O(o[e])}for(var f in z){z[f]=null}z=null;for(var g in b){b[g]=null}b=null})}}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,false)}else{if(d){d({success:false,id:a})}}},getObjectById:function(a){if(z.w3){return H(a)}},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:false,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,false);C(function(){e+="";f+="";var n={};if(k&&typeof k===c){for(var o in k){n[o]=k[o]}}n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c){for(var q in j){p[q]=j[q]}}if(i&&typeof i===c){for(var r in i){if(typeof p.flashvars!=a){p.flashvars+="&"+r+"="+i[r]}else{p.flashvars=r+"="+i[r]}}}if(T(g)){var s=M(n,p,d);if(n.id==d){V(d,true)}m.success=true;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}else{V(d,true)}}if(l){l(m)}})}else{if(l){l(m)}}},switchOffAutoHideShow:function(){y=false},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){if(z.w3){return M(a,b,c)}else{return undefined}},showExpressInstall:function(a,b,c,d){if(z.w3&&I()){J(a,b,c,d)}},removeSWF:function(a){if(z.w3){O(a)}},createCSS:function(a,b,c,d){if(z.w3){U(a,b,c,d)}},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){if(/\?/.test(b)){b=b.split("?")[1]}if(a==null){return W(b)}var c=b.split("&");for(var d=0;d<c.length;d++){if(c[d].substring(0,c[d].indexOf("="))==a){return W(c[d].substring(c[d].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,true);if(z.ie&&z.win){q.style.display="block"}}if(s){s(t)}}v=false}}}}();return b});
STK.register("common.flash.imgUpload",function(a){var b=document.documentElement,c=document.body;var d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}};var e=function(a){var b={cn:"zh_CN",tw:"zh_TW"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG["version"],swf_path:$CONFIG["jsPath"]+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"};var h={},i,j;var k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){if(!a.IE){m.getFlash(g.id_swf).height=b}},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}};var l={version:g.version,language:e($CONFIG["lang"]),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"};var m={init:function(){if(!b.id){return}i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";if(!m.getFlash(g.id_swf)){m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!(c[a]&&c[a][b])},bindEvt:function(a){for(key in a){k[a[key]]&&!m.checkAction(g.channel,a[key])&&STK.core.util.listener.register(g.channel,a[key],k[a[key]])}},build:function(){var c={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path};var d={id:b.id};m.bindEvt(l);a.lib.kit.extra.swfobject.embedSWF(g.swf_path+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,c,d)},getFlash:function(){if(navigator.appName.indexOf("Microsoft")!=-1){return window[b.id]}else{return document[b.id]}},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px");m.autoScroll(j.t,j.t+(c-f))},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++){e[f]=h=h/2}clearInterval(d);d=setInterval(function(){if(e.length){window.scrollTo(0,b+e.shift());return}clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){if(a.IE){for(key in l){k[l[key]]&&STK.core.util.listener.remove(g.channel,l[key],k[l[key]])}i.innerHTML=""}};m.init();return h}});
STK.register("common.trans.editor",function(a){var b=a.lib.kit.io.inter();var c=b.register;c("face",{url:"/aj/mblog/face?type=face"});c("magicFace",{url:"/ajax/mblog/face?type=ani"});c("getTopic",{url:"/aj/mblog/trend"});c("cartoon",{url:"/ajax/mblog/face?type=cartoon"});c("suggestMusic",{url:"/aj/mblog/music/suggest",requestMode:"jsonp"});c("searchMusic",{url:"/aj/mblog/music/search",requestMode:"jsonp"});c("addMusic",{url:"/aj/mblog/music/submit",requestMode:"jsonp"});c("parseMusic",{url:"/aj/mblog/music/parse",requestMode:"jsonp"});c("parseVideo",{url:"/aj/mblog/video"});c("waterMark",{url:"/ajax/account/watermark"});c("publishToWeiqun",{url:"/aj/weiqun/add",method:"post"});c("rectopic",{url:"/aj/mblog/rectopic"});c("interactive",{url:"/aj/mblog/interactive",method:"post"});c("plugin",{url:"/aj/publishplug/plug",method:"post"});c("favSongSearch",{url:"//music.weibo.com/yueku/port/sina_t_getcollect.php",method:"get",requestMode:"jsonp"});c("getOutlinkInfo",{url:"//api.weibo.com/widget/info.json",varkey:"callback",method:"get",requestMode:"jsonp"});c("tabLog",{url:"//music.weibo.com/t/port/ajax_log_action.php",method:"get",requestMode:"jsonp"});return b});
STK.register("common.bubble.image",function(a){var b=window.$CONFIG;var c=""+'<div node-type="outer">'+'<div class="layer_send_pic" node-type="wrap">'+'<div node-type="inner">'+'<div class="tab W_textb">'+"<p>"+'<a class="current" href="javascript:void(0);" node-type="tab">#L{本地上传}</a>'+'<a href="javascript:void(0);" node-type="tab">#L{推荐配图}</a>'+"</p>"+"</div>"+'<div node-type="content"></div>'+"</div>"+'<div node-type="uploaded" style="display:none">'+'<div class="laPic_tit">'+'<span node-type="pName"></span><span class="right"></span></div>'+'<div node-type="picWrap" class="laPic_Pic"></div>'+'<div class="lapic_edit">'+'<a class="beautify" href="javascript:void(0);" node-type="beautify" action-type="beautify" suda-data="key=meitu&value=v4||publish||editor">#L{编辑}</a>'+'<a class="delete" href="javascript:void(0);" action-type="delete">#L{删除}</a>'+"</div>"+"</div>"+"</div>"+'<div node-type="flashPanel"></div>';var d=""+'<div node-type="uppic">'+'\t<div class="laPic_btnBox clearfix">'+'\t\t<div class="laPic_btnmore">'+'\t\t\t<a href="javascript:void(0);" class="S_btn_b choose_pic" node-type="inputCover">'+'\t\t\t\t<span><em class="ico_one"></em>#L{单张图片}</span>'+'\t\t\t\t<form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action="">'+'\t\t\t\t\t<input class="input_f" type="file" hidefoucs="true" style="" node-type="fileBtn" name="pic1"/>'+"\t\t\t\t</form></a>"+"\t\t</div>"+'\t\t<div class="laPic_btnmore">'+'\t\t\t<a href="javascript:void(0);" class="S_btn_b choose_pic" node-type="inputCover">'+'\t\t\t\t<span action-type="more" suda-data="key=meitu&value=v4||publish||more"><em class="ico_ones"></em>#L{多张图片}</span>'+"\t\t\t</a>"+"\t\t</div>"+"\t</div>"+'\t<div class="laPic_con W_textb"  node-type="info">#L{支持上传单张5M以下的gif、jpg、png文件}</div>'+"</div>"+'<div node-type="loading"  style="width:230px;display:none">'+'<div class="laPic_con">'+'<div><i class="W_loading S_loading"></i><span>#L{图片正在上传，请等待}...</span></div>'+"</div>"+'<div class="laPic_btn">'+'<a href="javascript:void(0);" class="Sbtn_a" action-type="cancel"><span>#L{取消上传}</span></a>'+"</div>"+"</div>";var e=""+'<p class="tab_kind W_linkb">'+'<span class="right"><a class="pre_d" action-type="prev" node-type="prev" href="javascript:void(0);"></a><a class="next" action-type="next" node-type="next" href="javascript:void(0);"></a></span>'+'<em node-type="categorys"></em>'+"</p>"+'<div node-type="loading"></div>'+'<div class="detail">'+'<ul node-type="list" class="faces_magic_list clearfix"></ul>'+'<div node-type="page" class="W_pages_minibtn"></div>'+"</div>";var f='<div><i class="W_loading S_loading"></i><span>正在加载，请稍候...</span></div>';var g='<a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{item}">#{item}</a>';var h='<a href="javascript:void(0);"  onclick="return false;" action-type="category" action-data="category=#{item}" class="current W_texta">#{item}</a>';var i='<li><a action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}" class="img" href="javascript:void(0);"><img src="#{thumb}" original="#{original}" title="#{value}" alt="#{phrase}" /></a><span title="#{value}"  action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}">#{phrase}</span></li>';var j='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);" >#{label}</a>';var k='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);"  class="current"  onclick="return false;">#{label}</a>';var l='<em class="W_vline">|</em>';var m="默认";var n="#L{分享图片}";var o=5;var p="weibo.com/";var q,r,s,t,u,v,w,x;var y,z,A;var B={};var C={page:0,cache:null,cPoniter:0,categorys:[],currentCategory:m,itemNumber:10};var D,E;var F=a.core.dom.position;var G=a.core.evt.addEvent;var H=a.core.evt.removeEvent;var I=a.lib.kit.extra.language;var J=function(){a.custEvent.define(B,"uploaded");a.custEvent.define(B,"hide");a.custEvent.define(B,"insert");a.custEvent.define(B,"deletePIC");a.custEvent.define(B,"picLoad");a.custEvent.add(q,"hide",function(b){return function(){a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(B,"hide",{})}}(q));a.lib.module.editorPlugin.tab(r,{evtType:"click",tNodes:'[node-type="tab"]',className:"current",cb:[K.init,L.init]});A=a.core.evt.delegatedEvent(r);K.bind()};var K={init:function(){K.initDom();K.bind()},initDom:function(){var b;v=K;D["wrap"].className="layer_send_pic";D["content"].innerHTML=I(d);D["close"]=q.getDomList().close[0];b=a.lib.kit.dom.parseDOM(a.core.dom.builder(r).list);D=a.lib.kit.extra.merge(D,b);K.exchangeInput()},bind:function(){G(D.inputCover,"mousemove",K.ajust);G(D.fileBtn,"change",M.upload);A.add("delete","click",K.deletePic);A.add("cancel","click",K.cancelUpload);A.add("more","click",K.morePic);A.add("beautify","click",K.beautify)},destroy:function(){H(D.inputCover,"mousemove",K.ajust);H(D.fileBtn,"change",M.upload)},handle:function(b){if(!b||b.ret<0){var c="";switch(Math.abs(b.ret)){case 1:c="#L{没有登录}";break;case 4:c="#L{请上传5M以内的JPG、GIF、PNG图片。}";break;default:c="#L{上传图片超时}"}b?K.sendError({ret:b.ret}):K.sendError({ret:"none"});a.lib.ui.alert(I(c),{OK:function(){if(b.ret==-1){window.location.reload()}q.hide()}})}else{K.stopUpload();if(u){D.uppic.style.display="";u=false}else{K.rendSucc(b)}}},sendError:function(b){var c=new Image,d=encodeURIComponent(window.navigator.userAgent);var e=a.lib.kit.extra.merge(b,{ua:d,rnd:(new Date).getTime(),uid:$CONFIG?$CONFIG["uid"]:0,referer:encodeURIComponent(E)});e=a.core.json.jsonToQuery(e);e="//ww1.sinaimg.cn/do_not_delete/fc.html"+"?"+e;c.setAttribute("src",e)},rendLoad:function(){q.stopBoxClose();D.uppic.style.display="none";D.loading.style.display=""},ajust:function(b){var c=a.fixEvent(b);var d=D.inputCover;var e=D.fileBtn;var f=F(d);var g=a.scrollPos();var h=g.top+c.clientY;var i=g.left+c.clientX;var j=parseInt(e.offsetWidth/2),k=parseInt(e.offsetHeight/2);var l=h-f.t;var m=i-f.l;var n=[];n.push("left:"+(m-j)+"px");n.push("top:"+(l-k)+"px");e.style.cssText=n.join(";")},rendSucc:function(b){var c=a.common.extra.imageURL(b.pid);var d=[],e,f;y=y||b.pid;d=y.split(/\/|\\/);e=d[d.length-1];d=e.split(".");if(d.length>1&&a.bLength(d[0])>20){d[0]=a.leftB(d[0],20);f=[d[0],"...",d[1]].join("")}else{f=e}x=b.pid;M.loadPic({url:c,value:f,pid:b.pid});D["beautify"]&&(D["beautify"].style.display="")},deletePic:function(){D.close.style.display="";D.inner.style.display="";D.wrap.style.width="";D.uploaded.style.display="none";D.picWrap.innerHTML="";D.fileBtn.value="";v.destroy();v.init();q.startBoxClose();a.custEvent.fire(B,"deletePIC",{text:I(n)})},stopUpload:function(){D.loading.style.display="none";D.uppic.style.display=""},cancelUpload:function(){u=true;q.startBoxClose();K.stopUpload()},exchangeInput:function(){var b=D.fileBtn;var c=b.parentNode;var d=b.className;var e=b.name;var f=a.C("input");f.className=d;f.name=e;f.type="file";f.hidefocus="true";D.fileBtn=f;c.removeChild(b);c.appendChild(f)},beautifySucess:function(a){y=a;K.handle({pid:a})},morePic:function(){q.stopBoxClose();var c=function(c){var d=c.nickname!="0"||c.logo!="0"||c.domain!="0";var e=b&&b.nick||"";var f="//picupload.service.weibo.com/interface/pic_upload.php?app=miniblog"+"&marks="+(d?"1":"0")+(c.logo=="1"?"&logo=1":"")+(c.nickname=="1"?"&nick="+(e?encodeURIComponent("@"+e):""):"")+(c.domain=="1"?"&url="+p+(b&&b.watermark||b.domain):"")+(c.position?"&markpos="+c.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1";var g={id:"photo_merge",pos:q.getPosition(),service:f,sucess:K.beautifySucess,h:470,w:528,swf:"SinaCollage.swf"};a.common.flash.imgUpload(g,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){q.startBoxClose()},100)}}).show()};w?c(w):M.getWaterMark(c)},beautify:function(){var b={id:"photo_editor",pos:q.getPosition(),service:"//picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:K.beautifySucess,h:385,w:528,swf:"PhotoEditor.swf"};a.common.flash.imgUpload(b,{init:function(b,c){b.setPars(a.common.extra.imageURL(x,{size:"large"}))},close:function(a,b){}}).show()}};var L={init:function(){var b;D.wrap.className="content layer_faces";v=L;K.destroy();D["content"].innerHTML=I(e);b=a.lib.kit.dom.parseDOM(a.core.dom.builder(r).list);D=a.lib.kit.extra.merge(D,b);if(!z){D["loading"].innerHTML=I(f)}L.cartoonStart();L.bind()},bind:function(){A.add("insertSmiley","click",function(a){STK.core.evt.preventDefault();D["beautify"]&&(D["beautify"].style.display="none");var b=a.data.url;var c=a.data.pid;var d=a.data.value;M.loadPic({url:b,value:d,pid:c})});A.add("category","click",function(a){C.page=0;C.currentCategory=a.data.category;L.rend();setTimeout(function(){L.rendCategory(C);L.rendPage(C)},0)});A.add("prev","click",function(a){var b=C.cPoniter;if(b<=0){return false}C.cPoniter-=o;L.rendCategory(C)});A.add("next","click",function(a){var b=C.cPoniter;var c=C.categorys;if(b>=c.length-o){return false}C.cPoniter+=o;L.rendCategory(C)});A.add("page","click",function(a){C.page=parseInt(a.data.num,10);L.rend();setTimeout(function(){L.rendPage(C)},0);return STK.preventDefault(a.evt)})},cartoonStart:function(){a.common.trans.editor.getTrans("cartoon",{onSuccess:function(a,b){C.cache=a.data.more||{};C.categorys=[m];for(var c in C.cache){C.categorys.push(c)}C.cache[m]=a.data.usual.norm;L.cartoonStart=function(){C.page=0;C.cPoniter=0;C.currentCategory=m;L.rend();L.rendCategory(C);L.rendPage(C)};L.cartoonStart()}}).request({})},rend:function(b,c){var d=C.currentCategory;var e=C.cache[d];var f=C.page;var g=C.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){if(a.bLength(b.phrase)>8){b.phrase=[a.leftB(b.phrase,6),"..."].join("")}return a.templet(I(i),b)});D["loading"].innerHTML="";D["list"].innerHTML=e.join("")},rendCategory:function(b){var c=b.cPoniter;var d=b.categorys;var e=b.currentCategory;var f=d.slice(c,c+o);f=a.foreach(f,function(b,c){if(e===b){return a.templet(I(h),{item:b})}else{return a.templet(I(g),{item:b})}});D["categorys"].innerHTML=f.join(l);if(c+6>=d.length){["next"].className="next_d"}else{D["next"].className="next"}if(c<=0){D["prev"].className="pre_d"}else{D["prev"].className="pre"}},rendPage:function(b){var c=b.page;var d=b.cache[b.currentCategory];var e=d.length/b.itemNumber;var f=[];for(var g=0;g<e;g+=1){if(c==g){f.push(a.templet(I(k),{number:g,label:g+1}))}else{f.push(a.templet(I(j),{number:g,label:g+1}))}}D["page"].innerHTML=f.join("")},destroy:function(){}};var M={trans:function(c){a.core.io.ijax({url:"//picupload.service.weibo.com/interface/pic_upload.php",form:STK.E("pic_upload"),abaurl:"//"+document.domain+"/static/upimgback.html",abakey:"cb",timeout:1800*1e3,onComplete:K.handle,onTimeout:K.handle,args:{marks:1,app:"miniblog",s:"rdxt",url:c.domain=="1"?p+(b&&b.watermark||b.domain):0,markpos:c.position||"",logo:c.logo||"",nick:c.nickname=="1"?"@"+(b&&b.nick):0}})},getWaterMark:function(b){a.common.trans.editor.getTrans("waterMark",{onSuccess:function(a,c){w=a.data;b&&b(w)}}).request()},upload:function(){y=D.fileBtn.value;if(a.core.str.trim(y)===""){return}K.rendLoad();w?M.trans(w):M.getWaterMark(M.trans)},loadPic:function(b){D.picWrap.innerHTML="";var c=b.url;var d=D.close;var e=a.C("img");if(b.value){D.pName.innerHTML=b.value}e.src=c;q.stopBoxClose();a.core.evt.custEvent.fire(B,"uploaded",{text:I(n),pid:b.pid});D.wrap.style.display="";D.wrap.className="layer_send_pic";D.wrap.style.width="240px";D.inner.style.display="none";D.uploaded.style.display="";d.style.display="none";D.picWrap.appendChild(e)}};var N={};(function(){if(b&&b.bigpipe==="true"){a.historyM.onpopstate(function(a,b){if(b){q.stopBoxClose();q.hide()}})}})();B.getBub=function(){return q};return function(b,d){if(!a.isNode(b)){throw"common.bubble.image need el as first parameter!"}E=window.location.href;D=a.lib.kit.dom.parseDOM(a.core.dom.builder(I(c)).list);r=D.outer;q=a.lib.ui.bubble();K.initDom();if(d&&d.pid){var e=a.common.extra.imageURL(d.pid);M.loadPic({url:e,pid:d.pid})}J();q.setContent(r);q.setLayout(b,{offsetX:-29,offsetY:5});B.bubble=q;B.setPic=function(a){K.rendSucc({pid:a})};q.show();return B}});
STK.register("common.editor.widget.image",function(a){return function(b){a.log(b);var c={};var d,e,f,g,h;var i=function(a,b){d.API.insertText(b.value);e.getBub().hide()};var j=function(b,c){a.log("upload");var e=d.API.getWords();if(e.length==0){d.API.insertText(c.text)}d.API.addExtraInfo(c.pid);g=true};var k=function(a,b){d.API.delWords(b.text);d.API.addExtraInfo("");clearInterval(h)};var l=function(b){if(g){return}e=a.common.bubble.image(d.nodeList[f]);a.custEvent.add(e,"uploaded",j);a.custEvent.add(e,"insert",i);a.custEvent.add(e,"deletePIC",k);a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);a.custEvent.remove(e,"uploaded",j);a.custEvent.remove(e,"insert",i);a.custEvent.remove(e,"deletePIC",k);a.custEvent.remove(e,"changeType");g=false});if(typeof b=="string"){e.setPic(b)}};c.init=function(b,c,e){d=b;f=c;a.addEvent(b.nodeList[f],"click",l);if(e&&e.pid){l(e.pid)}};c.clear=function(){};c.show=function(){};c.hide=function(){if(e){e.getBub().hide()}};c.resetBubble=function(a){if(e){e.bubble.setLayout(a,{offsetX:-29,offsetY:5})}};c.destroy=function(){d=null};return c}});
STK.register("common.channel.feed",function(a){var b=["forward","publish","comment","delete","refresh","reply","feedTagUpdate"];return a.common.channel.listener.define("common.channel.feed",b)});
STK.register("common.channel.dialog",function(a){var b=["submit","close"];return a.common.channel.listener.define("common.channel.dialog",b)});
STK.register("common.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5},d);var f=e["start"].split("");var g=e["color"].split("");var h=[];for(var i=0;i<e["step"];i+=1){var j=f[0];for(var k=1;k<4;k+=1){var l=parseInt(f[k],16);var m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e["step"],10)).toString(16)}h.push(j)}for(var i=0;i<e["times"];i+=1){h=b(h)}var n=false;var o=a.timer.add(function(){if(!h.length){a.timer.remove(o);return}if(n){n=false;return}else{n=true}c.style.backgroundColor=h.pop()})}});
STK.register("common.dialog.publishtop",function(a){var b=""+'<div class="WB_layer WB_layer_share" node-type="outer">'+'<div class="card card-sender" node-type="wrap">'+'<div class="num" node-type="num"></div>'+'<div class="func">'+'<div class="input-wrap input-wrap-share">'+'<div class="input">'+'<textarea  node-type="textEl"></textarea>'+'<p class="succeed" node-type="successTip"  style="display:none"><i class="icon-warn icon-ok-l"></i>#L{发布成功}</p>'+"</div>"+'<div class="func">'+'<div class="face" node-type="widget">'+'<a href="javascript:void(0);" node-type="smileyBtn"><i class="wbicon icon-face">o</i></a>'+"</div>"+'<div class="btn">'+'<label class="opt"><input type="checkbox" checked="checked" node-type="userFollow">#L{同时关注主持人}</label>'+'<a href="javascript:void(0);" class="s-btn-g" node-type="submits">#L{发布}</a>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";var c={title:"#L{分享}"};var d=a.lib.kit.extra.language;var e={limitNum:1e4};return function(f){var g={};var h,i,j,l,m,n,o,p,q,r;var s,t,u;h=a.parseParam({styleId:"1"},f);p=a.custEvent.define(g,"publish");a.custEvent.define(g,"hide");var v=function(){if(i){if(j==="error"||a.core.dom.hasClassName(m["submits"],"disable")){a.common.extra.shine(m["textEl"])}return}a.common.channel.dialog.fire("submit",["submit"]);var b=n.API.getWords();i=true;j="loading";if(q){if(b.indexOf(q)===-1){b=b+q}}var c={};c["content"]=b;c["action_code"]=11;o.request(c);if(m["userFollow"].checked&&u!=""){var d={};d["type"]="followed";d["uid"]=u;d["action_code"]=71;t.request(d)}};var w=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){v();n.API.blur()}};var x=function(a,b){var c=b["isOver"];if(!c){i=false;j="";if(b.count>=140){m["num"].innerHTML=d('#L{已输入}<strong class="warn">'+b.count+"</strong>#L{字}");m["submits"].className="s-btn-g disable"}else{m["num"].innerHTML=d("#L{已输入}<strong>"+b.count+"</strong>#L{字}");m["submits"].className="s-btn-g"}}else{i=true;j="error";if(b.count>=140||b.count==0){m["num"].innerHTML=d('#L{已输入}<strong class="warn">'+b.count+"</strong>#L{字}");m["submits"].className="s-btn-g disable"}else{m["num"].innerHTML=d("#L{已输入}<strong>"+b.count+"</strong>#L{字}");m["submits"].className="s-btn-g"}}};var y=function(b,c){m["submits"].className="s-btn-g";i=true;j="";m["successTip"].style.display="";m["textEl"].value="";setTimeout(function(){m["successTip"].style.display="none";l.hide()},2*1e3);a.custEvent.fire(p,"publish",[b["data"],c]);a.common.channel.feed.fire("publish",[b["data"],c])};var z=function(b,c){i=false;var d=a.common.dialog.validateCode();d.validateIntercept(b,c,{requestAjax:o,param:c});return;j=""};var A=function(b,c){i=false;j="";a.lib.ui.alert()};var B=function(a){m["textEl"].value="";n.API.insertText(a["content"]);if(a["content"]){i=false;j="";m["submits"].className=""}else{i=true;j="error";m["submits"].className="s-btn-g"}};var C=function(){i=false};var D=function(){n=a.common.editor.base(m["outer"],e);n.widget(a.common.editor.widget.face(),"smileyBtn")};var E=function(){a.addEvent(m["submits"],"click",v);a.addEvent(m["textEl"],"keypress",w)};var F=function(){a.custEvent.add(n,"textNum",x)};var G=function(){o=a.common.trans.global.getTrans("publish",{onSuccess:y,onError:z,onFail:A});t=a.common.trans.global.getTrans("add",{})};var H=function(){D();E();F();G()};var I=function(e){var f=a.parseParam({content:"",defaultValue:"",info:"",title:d(c["title"]),id:"",uid:""},e);s=f.id;u=f.uid;r=f.pid;l=a.lib.ui.dialog();l.setTitle(f["title"]);var g=a.builder(a.lib.kit.extra.language(b));m=a.lib.kit.dom.parseDOM(g.list);if(u==""){a.core.dom.removeNode(m["userFollow"].parentNode)}l.appendChild(m["outer"]);l.show();f["suda"]&&m["submits"].setAttribute("suda-data",f["suda"]);l.setMiddle();if(!n){H()}B(f);a.custEvent.add(l,"hide",function(){a.custEvent.remove(l,"hide",arguments.callee);n.closeWidget();C();l=null;a.custEvent.fire(p,"hide");a.common.channel.dialog.fire("close",["close"])});n.API.focus();q=f["defaultValue"]};var J=function(){l.hide()};var K=function(){if(l){l.hide()}a.removeEvent(m["submits"],"click",v);a.removeEvent(m["textEl"],"keypress",w);a.custEvent.remove(n,"textNum",x);a.custEvent.undefine(p,"publish");m=null;o=null;t=null;i=false;for(k in g){delete g[k]}g=null};g.show=I;g.hide=J;g.destroy=K;return g}});
STK.register("common.dialog.loginLayer",function(a){var b;var c="//tjs.sjs.sinajs.cn/t5/register/js/page/remote/loginLayer.js";return function(d){d=a.core.obj.parseParam({lang:"zh-cn",loginSuccessUrl:d.url?d.url:encodeURIComponent(window.location.href),suda:{submitBtn:d.from?"key=tblog_search_v4&value=weibo_nologin2_landing1":"key=tblog_search_v4&value=weibo_nologin2_landing2",registUrl:d.from?"key=tblog_search_v4&value=weibo_nologin2_register1":"key=tblog_search_v4&value=weibo_nologin2_register2"}},d||{});if(window.WBtopGlobal_loginLayer){WBtopGlobal_loginLayer(d)}else{if(b){return}else{b=true;a.core.io.scriptLoader({url:c,onComplete:function(){b=false;window.WBtopGlobal_loginLayer(d)},timeout:1e4,onTimeout:function(){b=false}})}}}});
STK.register("pl.topic.base",function(a){var b="pl.topic.base";var c;return function(b,d){var e={};var f=0,g="";var h={login:function(){var b={lang:"zh-cn"};a.preventDefault();a.common.dialog.loginLayer(b)},topicShares:function(b){var c=b.data;a.common.dialog.publishtop().show(c)},topicFollows:function(b){var c=a.core.json.queryToJson(b.target.getAttribute("action-data"));a.common.trans.global.getTrans("followTopic",{onSuccess:function(a,c){b.el.style.display="none";b.el.nextElementSibling.style.display="inline-block";f=1},onError:function(b){a.lib.ui.alert(b.msg)}}).request({id:c.id})},topicUnFollows:function(a){a.el.style.display="none";a.el.parentNode.style.display="none";a.el.parentNode.previousElementSibling.style.display="inline-block";f=1},unAreasOver:function(a){if(f==1){f=0;return}a.el.children[1].style.display="inline-block"},unAreasOut:function(a){a.el.children[1].style.display="none"},picOver:function(b){if(a.sizzle('[node-type="topicOpt"]',b.currentTarget).length&&a.sizzle('[node-type="topicOpt"]',b.currentTarget)[0].style.display=="block"){return}if(a.sizzle('[node-type="upPic"]',b.currentTarget).length){a.sizzle('[node-type="upPic"]',b.currentTarget)[0].style.display="block"}},picOut:function(b){if(a.sizzle('[node-type="upPic"]',b.currentTarget).length){a.sizzle('[node-type="upPic"]',b.currentTarget)[0].style.display="none"}},upcoverimg:function(d){var e=d.el;if(a.core.dom.hasClassName(e,"fromSmall")){g=""}else{g=c.coverPic.src}if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(e.value)){c.topicBig.style.display="block";c.topicError.style.display="block";c.topicOpt.style.display="block";c.topicSmall.style.display="none";a.sizzle('[action-type="picSure"]',b)[0].style.display="none";return}var f=e.files[0];var h=new FileReader;h.readAsDataURL(f);h.onload=function(d){var f=new Image;f.src=d.target.result;f.onload=function(){var g=d.target.result.split(",");formData=g[1];if(f.width<1e3||f.height<300){c.topicBig.style.display="block";c.topicError.style.display="block";c.topicOpt.style.display="block";c.topicSmall.style.display="none";if(!a.core.dom.hasClassName(e,"reCover")){e.parentNode.style.display="none"}c.topicPic.style.display="none";a.sizzle('[action-type="picSure"]',b)[0].style.display="none";return}a.common.trans.global.getTrans("upcover",{onSuccess:function(d,f){if(d.code==1e5){c.topicBig.style.display="block";c.topicError.style.display="none";c.topicOpt.style.display="block";c.topicSmall.style.display="none";c.topicPic.style.display="block";a.sizzle('[action-type="picSure"]',b)[0].style.display="inline-block";if(!a.core.dom.hasClassName(e,"reCover")){e.parentNode.style.display="none"}c.coverPic.src=d.data.original_pic.replace("http","https");e.value=""}else{a.lib.ui.alert(d.msg)}},onError:function(b){a.lib.ui.alert(b.msg)}}).request({pic_data:formData})}}},cancelimg:function(){if(g!=""){c.coverPic.src=g;c.topicOpt.style.display="none";c.topicPic.style.display="block";c.topicError.style.display="none";a.sizzle('[action-type="picSure"]',b)[0].style.display="inline-block"}else{c.topicSmall.style.display="block";c.topicBig.style.display="none"}},commitimg:function(b){var d=a.core.json.queryToJson(b.el.getAttribute("action-data"));var e=d.id;var f={pc_cover:c.coverPic.src};a.common.trans.global.getTrans("commitcover",{onSuccess:function(b,d){if(b.code==1e5){c.topicOpt.style.display="none"}else{a.lib.ui.alert(b.msg)}},onError:function(b){a.lib.ui.alert(b.msg)}}).request({object_id:e,data:JSON.stringify(f)})}};var i=function(){j();k();l();m()};var j=function(){if(!b)throw"path : pl.topic.base"};var k=function(){c=a.lib.kit.dom.parseDOM(a.builder(b).list)};var l=function(){};var m=function(){var d=a.core.evt.delegatedEvent(b);d.add("topicShare","click",h.topicShares);d.add("topicFollow","click",h.topicFollows);d.add("topicUnFollow","click",h.topicUnFollows);d.add("unFollowArea","mouseover",h.unAreasOver);d.add("unFollowArea","mouseout",h.unAreasOut);d.add("login","click",h.login);a.core.evt.addEvent(c.topicSmall,"mouseover",h.picOver);a.core.evt.addEvent(c.topicSmall,"mouseout",h.picOut);a.core.evt.addEvent(c.topicBig,"mouseover",h.picOver);a.core.evt.addEvent(c.topicBig,"mouseout",h.picOut);d.add("upCover","change",h.upcoverimg);d.add("reUpCover","change",h.upcoverimg);d.add("picCancel","click",h.cancelimg);d.add("picSure","click",h.commitimg)};var n=function(){var b=a.core.evt.delegatedEvent(c.searchItems);b.remove("login","click")};i();e.destory=n;return e}});
STK.pageletM.register("pl.topic.index",function(a){var b=a.E("pl_topic_header");if(b){return a.pl.topic.base(b)}});
STK.register("pl.band.statistic",function(a){return function(b,c){var d,e;var f;var g=true;var h={initPageRecord:function(){var c={};var d=a.sizzle('[action-type="realtimehot_ad"]',b);if(d[0]){c.word=d[0].getAttribute("word");c.url_show=d[0].getAttribute("url_show");var e=new Image;e.src="//j.s.weibo.com/doit.png"+"?type=show&position=s_bandright_show&word="+c.word+"&time="+ +(new Date);if(c.url_show){var f=new Image;f.src=decodeURIComponent(c.url_show).replace("__REQUESTID__","s_bandright_show"+ +(new Date)).replace("[timestamp]",+(new Date))}}},clickRecord:function(a){function j(){if(b&&c){g=true;window.location.href=a.href_to}}function i(a){c=true;j()}function h(c){b=true;a.url_click?j():f()}function f(b){g=true;window.location.href=a.href_to}var b=false,c=false;var d=new Image;d.onload=h;d.error=f;d.src="//j.s.weibo.com/doit.png?type=click&position=s_bandright_click&word="+a.word+"&time="+ +(new Date);if(a.url_click){var e=new Image;e.onload=i;e.error=f;e.src=decodeURIComponent(a.url_click).replace("__REQUESTID__","s_bandright_click"+ +(new Date)).replace("[timestamp]",+(new Date));setTimeout(function(){window.location.href=a.href_to},1e3)}}};var i={scrollEvtHandler:function(){var c=a.core.dom.getSize(b),d=a.core.dom.getSize(b.parentNode),e=a.core.dom.position(b.parentNode);var f=a.core.util.scrollPos(),g=f.top>e.t+d.height;if(g){b.style.width="300px";b.style.position="fixed";b.style.top="60px";b.style.marginBottom="10px"}else{b.style.position="static"}return},realtimehotClick:function(b){if(!g){return}g=false;var c=a.core.json.merge(b.data,{word:b.el.getAttribute("word"),url_show:b.el.getAttribute("url_show"),url_click:b.el.getAttribute("url_click"),href_to:b.el.getAttribute("href_to")});h.clickRecord(c)}};var j=function(){if(!b)throw"[pl_band_index] : missing  -> path : pl.band.statistic"};var k=function(){};var l=function(){a.core.evt.addEvent(window,"scroll",i.scrollEvtHandler);f=a.delegatedEvent(b);f.add("realtimehot_ad","click",i.realtimehotClick)};var m=function(){j();k();l();h.initPageRecord()};m();var n=function(){f.remove("realtimehot_ad","click",i.realtimehotClick)};d.destroy=n;return d}});
STK.pageletM.register("pl.band.index",function(a){var b=a.E("pl_band_index");if(b){return a.pl.band.statistic(b)}});
;
